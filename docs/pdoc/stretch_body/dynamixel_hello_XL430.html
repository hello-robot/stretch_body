<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>stretch_body.dynamixel_hello_XL430 API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../stretch_body.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;stretch_body</a>

<a href="https://github.com/hello-robot/stretch_body">            <img src="../images/banner.png" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DynamixelCommErrorStats">DynamixelCommErrorStats</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DynamixelCommErrorStats.__init__">DynamixelCommErrorStats</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.status">status</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.rate_log">rate_log</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.n_log">n_log</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.log_idx">log_idx</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.ts_error_last">ts_error_last</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.ts_warn_last">ts_warn_last</a>
                        </li>
                        <li>
                                <a class="variable" href="#DynamixelCommErrorStats.logger">logger</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelCommErrorStats.add_error">add_error</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelCommErrorStats.pretty_print">pretty_print</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DynamixelHelloXL430">DynamixelHelloXL430</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.__init__">DynamixelHelloXL430</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.check_homing_offset">check_homing_offset</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.get_soft_motion_limits">get_soft_motion_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.set_soft_motion_limit_min">set_soft_motion_limit_min</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.set_soft_motion_limit_max">set_soft_motion_limit_max</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.do_ping">do_ping</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.check_servo_errors">check_servo_errors</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.startup">startup</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.stop">stop</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.pull_status">pull_status</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.mark_zero">mark_zero</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.wait_until_at_setpoint">wait_until_at_setpoint</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.pretty_print">pretty_print</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.bound_value">bound_value</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.step_sentry">step_sentry</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.get_dist_to_limits">get_dist_to_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.reboot">reboot</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.enable_torque">enable_torque</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.disable_torque">disable_torque</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.move_to_vel">move_to_vel</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.set_velocity">set_velocity</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.enable_velocity_ctrl">enable_velocity_ctrl</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.move_to">move_to</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.set_motion_params">set_motion_params</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.move_by">move_by</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.quick_stop">quick_stop</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.enable_pos">enable_pos</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.enable_pwm">enable_pwm</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.set_pwm">set_pwm</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.is_trajectory_active">is_trajectory_active</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.get_trajectory_ts">get_trajectory_ts</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.get_trajectory_time_remaining">get_trajectory_time_remaining</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.follow_trajectory">follow_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.update_trajectory">update_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.stop_trajectory">stop_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.home">home</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec">ticks_to_world_rad_per_sec_sec</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec">ticks_to_world_rad_per_sec</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_world_rad">ticks_to_world_rad</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.world_rad_to_ticks">world_rad_to_ticks</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec">world_rad_to_ticks_per_sec</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec">world_rad_to_ticks_per_sec_sec</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_rad">ticks_to_rad</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.rad_to_ticks">rad_to_ticks</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_rad_per_sec">ticks_to_rad_per_sec</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.rad_per_sec_to_ticks">rad_per_sec_to_ticks</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_rad_per_sec_sec">ticks_to_rad_per_sec_sec</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.rad_per_sec_sec_to_ticks">rad_per_sec_sec_to_ticks</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamixelHelloXL430.ticks_to_pct_load">ticks_to_pct_load</a>
                        </li>
                </ul>

            </li>
    </ul>


    <footer>My Package v1.0</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/hello-robot/stretch_body/tree/feature/pdoc/body/stretch_body/dynamixel_hello_XL430.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../stretch_body.html">stretch_body</a><wbr>.dynamixel_hello_XL430    </h1>

                
                        <input id="mod-dynamixel_hello_XL430-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-dynamixel_hello_XL430-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">from</span> <span class="nn">stretch_body.dynamixel_XL430</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">from</span> <span class="nn">stretch_body.device</span> <span class="kn">import</span> <span class="n">Device</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">from</span> <span class="nn">stretch_body.trajectories</span> <span class="kn">import</span> <span class="n">RevoluteTrajectory</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">from</span> <span class="nn">stretch_body.hello_utils</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">termios</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">numpy</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="k">class</span> <span class="nc">DynamixelCommErrorStats</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dxl_comm_errors&#39;</span><span class="p">)</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_rx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_tx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_gsr&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span><span class="o">=</span><span class="mi">10</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">=</span><span class="mi">0</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_error_last</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>    <span class="k">def</span> <span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="c1">#First error</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_error_last</span><span class="p">)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">)</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>        <span class="k">if</span> <span class="n">rx</span><span class="p">:</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_rx&#39;</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_tx&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>        <span class="k">if</span> <span class="n">gsr</span><span class="p">:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_gsr&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>        <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;warn_every_s&#39;</span><span class="p">]:</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">=</span><span class="n">t</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;warn_above_rate&#39;</span><span class="p">]:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Device </span><span class="si">%s</span><span class="s1"> generating </span><span class="si">%f</span><span class="s1"> errors per minute&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Dynamixel Comm Errors </span><span class="si">%s</span><span class="s1"> ----&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rate (Hz): </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">])</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rate (errors per minute): </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num TX: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_tx&#39;</span><span class="p">])</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num RX: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_rx&#39;</span><span class="p">])</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num Group Sync RX: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_gsr&#39;</span><span class="p">])</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="k">class</span> <span class="nc">DynamixelHelloXL430</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">    Abstract the Dynamixel X-Series to handle calibration, radians, etc</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;comm_errors&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vel&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;temp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;shutdown&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hardware_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>                         <span class="s1">&#39;input_voltage_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;overload_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>                         <span class="s1">&#39;stalled&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">thread_rate_hz</span> <span class="o">=</span> <span class="mf">15.0</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">RevoluteTrajectory</span><span class="p">()</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="o">=</span> <span class="n">usb</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;usb_name&#39;</span><span class="p">]</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>            <span class="c1">#Share bus resource amongst many XL430s</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="o">=</span> <span class="n">DynamixelXL430</span><span class="p">(</span><span class="n">dxl_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>                                        <span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>                                        <span class="n">port_handler</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">chain</span><span class="o">.</span><span class="n">port_handler</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>                                        <span class="n">pt_lock</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">chain</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>                                        <span class="n">baud</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;baud&#39;</span><span class="p">],</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>                                        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>                <span class="n">wr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>                <span class="n">wr_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>                <span class="n">wr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>                <span class="n">wr_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;collision&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span><span class="s1">&#39;hard&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">wr_min</span><span class="p">,</span><span class="n">wr_max</span><span class="p">],</span><span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">wr_min</span><span class="p">,</span><span class="n">wr_max</span><span class="p">]}</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span> <span class="o">=</span> <span class="n">DynamixelCommErrorStats</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#Track the motion profile settings on servo</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#Track the motion profile settings on servo</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">False</span> 
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># track dist to min,max limits</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># initial/minimum brake zone thresh value</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">total_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>    <span class="c1"># ###########  Device Methods #############</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="k">def</span> <span class="nf">check_homing_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        Users may incorrectly set the homing offset on a single-turn servo</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        In general on single-turn servos, the homing offset should be zero</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        In some cases it may be non-zero but between -1024 and 1024 (per DXL spec)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">        If it is outside of the valid range it is ignored. However,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        when the servo is placed in other control modes (eg vel) the reported encoder position start using the offset</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">        This can create unexpected behavior</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>            <span class="n">xn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">()</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1024</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel </span><span class="si">%s</span><span class="s1">: Servo is in single-turn mode yet has invalid homing offset of </span><span class="si">%d</span><span class="s1">. </span><span class="se">\n</span><span class="s1"> This may cause &#39;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>                                    <span class="s1">&#39;unexpected results if not set to zero (using REx_dynamixel_jog.py)</span><span class="se">\n</span><span class="s1"> Please contact Hello Robot support for more information&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">xn</span><span class="p">))</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="k">def</span> <span class="nf">get_soft_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">            Return the currently applied soft motion limits: [min, max]</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">            The soft motion limit restricts joint motion to be &lt;= its physical limits.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">            There are three types of limits:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">            Hard: The physical limits</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">            Collision: Limits set by RobotCollision to avoid collisions</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">            User: Limits set by the user software</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">            The joint is limited to the most restrictive range of the Hard / Collision/ User values.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">            Specifying a value of None for a limit indicates that no constraint exists for that limit type.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">            This allows a User limits and Collision limits to coexist.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">            For example, a user can temporarily restrict the range of motion beyond the current collision limits.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">            Then, by commanding User limits of None, the joint limits will revert back to the collision settings.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>    <span class="k">def</span> <span class="nf">set_soft_motion_limit_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span> <span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        x: value to set a joints limit to</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        limit_type: &#39;user&#39; or &#39;collision&#39;</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="n">limit_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;collision&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;hard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="k">def</span> <span class="nf">set_soft_motion_limit_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span> <span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">        x: value to set a joints limit to</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        limit_type: &#39;user&#39; or &#39;collision&#39;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="n">limit_type</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;collision&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;hard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="c1"># ###################################################</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="k">def</span> <span class="nf">do_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_ping</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="k">def</span> <span class="nf">check_servo_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">]:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;WARNING: Servo </span><span class="si">%s</span><span class="s1"> in error state: overload_error. Reboot servo with stretch_robot_dynamixel_reboot.py&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">]:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;WARNING: Servo </span><span class="si">%s</span><span class="s1"> in error state: overheating_error. Reboot servo with stretch_robot_dynamixel_reboot.py&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_ping</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">():</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_multiturn</span><span class="p">()</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">4095</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Warning: Invalid position range for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_pwm_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_limit&#39;</span><span class="p">])</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_temperature_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;temperature_limit&#39;</span><span class="p">])</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_min_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_voltage_limit&#39;</span><span class="p">])</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_max_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_voltage_limit&#39;</span><span class="p">])</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_P_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_I_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_D_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_return_delay_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;return_delay_time&#39;</span><span class="p">])</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">()</span> <span class="c1">#Initialize servo motion profile with default values</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">()</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">check_homing_offset</span><span class="p">()</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="c1">#Pull 3 times given mux / init the status dict</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed... </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="k">except</span> <span class="n">DynamixelCommError</span><span class="p">:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed... </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    <span class="k">def</span> <span class="nf">_thread_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;disable_torque_on_stop&#39;</span><span class="p">]:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>            <span class="k">return</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="n">pos_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="n">vel_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="n">eff_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="n">temp_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="n">err_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="c1">#First pull new data from servo</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="c1">#Or bring in data from a synchronized read</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                <span class="n">pos_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_vel</span><span class="p">()</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_vel</span><span class="p">()</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                <span class="n">vel_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                    <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_load</span><span class="p">()</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                        <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_load</span><span class="p">()</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                    <span class="n">eff_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                    <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_temp</span><span class="p">()</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_temp</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                    <span class="n">temp_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                    <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_hardware_error</span><span class="p">()</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_hardware_error</span><span class="p">()</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                    <span class="n">err_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                    <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">()</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pos_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">vel_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">eff_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">temp_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">err_valid</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during pull_status on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                    <span class="k">return</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during pull_status  on </span><span class="si">%s</span><span class="s1">: &#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>                <span class="c1"># self.motor.port_handler.ser.reset_output_buffer()</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                <span class="c1"># self.motor.port_handler.ser.reset_input_buffer()</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="k">return</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>            <span class="n">eff</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;eff&#39;</span><span class="p">]</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="c1">#Now update status dictionary</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="k">if</span> <span class="n">pos_valid</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="k">if</span> <span class="n">vel_valid</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad_per_sec</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="k">if</span> <span class="n">eff_valid</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eff</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_pct_load</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">eff</span><span class="p">))</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="k">if</span> <span class="n">temp_valid</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="k">if</span> <span class="n">err_valid</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;input_voltage_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">16</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">32</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="c1">#Finally flag if stalled at high effort for too long</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_min_vel&#39;</span><span class="p">]</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="n">over_eff</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_max_effort&#39;</span><span class="p">]</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">]:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">over_eff</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="k">if</span> <span class="n">over_eff</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#Mark the start of being stalled and over-effort</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_max_time&#39;</span><span class="p">]:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>    <span class="k">def</span> <span class="nf">mark_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            <span class="k">return</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Marking current position of (ticks)&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39; as 0 (rad)&#39;</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_device_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Polls for moving status to wait until at commanded position goal</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        Returns</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        -------</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        bool</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">            True if success, False if timeout</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_moving_status</span><span class="p">()</span><span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- HelloXL430 ------ &#39;</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Servo not on bus&#39;</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>            <span class="k">return</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- HelloXL430 ------ &#39;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">])</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity (ticks/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">])</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (%)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">])</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">])</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comm Errors&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">comm_errors</span><span class="p">)</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">])</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Input Voltage Error: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;input_voltage_error&#39;</span><span class="p">])</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Overheating Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">])</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Motor Encoder Error: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">])</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Electrical Shock Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">])</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Overload Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">])</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Watchdog Errors: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">])</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp PC&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">])</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range (ticks)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range (rad) [&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; , &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stalled&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">])</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stall Overload&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">])</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Is Calibrated&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="c1">#self.motor.pretty_print()</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>    <span class="k">def</span> <span class="nf">bound_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="k">return</span> <span class="n">lower_bound</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>            <span class="k">return</span> <span class="n">upper_bound</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;dynamixel_stop_on_runstop&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="n">is_runstopped</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_event&#39;</span><span class="p">]</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>            <span class="k">if</span> <span class="n">is_runstopped</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                <span class="k">if</span> <span class="n">is_runstopped</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span> <span class="o">=</span> <span class="n">is_runstopped</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dist_to_limits</span><span class="p">()</span> <span class="c1"># calculate dist to min,max limits</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span><span class="p">]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In Vel-Braking Zone.&quot;</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_watchdog</span><span class="p">()</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="c1"># disable watchdog if a set_velocity() command is not passed above 1s</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                    <span class="n">wd_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">()</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                    <span class="k">if</span> <span class="n">wd_error</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Watchdog error during Velocity control for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_safety_vel_brake_zone</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="k">def</span> <span class="nf">_update_safety_vel_brake_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">        dynamically update the braking zone thresh based on it is propotional nature to the </span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">        current velocity and the inverse of distance left to reach the nearest hardstop.</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">delta1</span><span class="p">,</span><span class="n">delta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> 
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="n">distance_to_limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">delta1</span><span class="p">,</span><span class="n">delta2</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="n">brake_zone_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel_brakezone_factor&#39;</span><span class="p">]</span> <span class="c1"># Propotional value, for now value 1 seems to work fine with all Dxl joints</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="k">if</span> <span class="n">distance_to_limit</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="n">brake_zone_thresh</span> <span class="o">=</span> <span class="n">brake_zone_factor</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">distance_to_limit</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">brake_zone_thresh</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">bound_value</span><span class="p">(</span><span class="n">brake_zone_thresh</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">total_range</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="n">brake_zone_thresh</span> <span class="o">=</span> <span class="n">brake_zone_thresh</span> <span class="o">+</span> <span class="mf">0.6</span> <span class="c1">#0.6 rad is minimum brake zone thresh  </span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vel_brake_thresh</span><span class="p">(</span><span class="n">brake_zone_thresh</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="k">def</span> <span class="nf">_set_vel_brake_thresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresh</span><span class="p">):</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="o">=</span> <span class="n">thresh</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="k">def</span> <span class="nf">get_dist_to_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>        <span class="n">current_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="n">min_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="n">max_position</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="n">delta1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">min_position</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="n">delta2</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">max_position</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="k">if</span> <span class="n">delta2</span><span class="o">&lt;</span><span class="n">threshold</span> <span class="ow">or</span> <span class="n">delta1</span><span class="o">&lt;</span><span class="n">threshold</span><span class="p">:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="k">return</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>            <span class="k">return</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="c1"># #####################################</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            <span class="k">return</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_reboot</span><span class="p">()</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="k">def</span> <span class="nf">enable_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="k">return</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>    <span class="k">def</span> <span class="nf">disable_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="k">return</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="k">def</span> <span class="nf">move_to_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="k">return</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="k">return</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                <span class="k">break</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to_vel on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    <span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_des</span><span class="p">))</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="n">v_des</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">v</span> <span class="k">if</span> <span class="n">v_des</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">v</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>            <span class="k">return</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>            <span class="k">return</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_operating_mode</span><span class="p">()</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_velocity_ctrl</span><span class="p">()</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;set_safe_velocity&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span><span class="p">:</span> <span class="c1"># only when sentry is active</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_step_vel_braking</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>                    <span class="n">t_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">t_des</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                <span class="k">break</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to_vel on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>    
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="k">def</span> <span class="nf">_step_vel_braking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_des</span><span class="p">):</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        In velocity mode while using set_velocity() command, when the joint is in a braking zone,</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        the input velocities are tapered till the joint limits  to zero and smoothly braked at the limits to </span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">        avoid hitting the hardstops.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span><span class="p">:</span> <span class="c1"># Braking control syncs with the pull status&#39;s freaquency for accurate motion control</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="c1"># Honor joint limits in velocity mode</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="n">lim_lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="n">lim_upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="n">v_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="n">x_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>            <span class="n">to_min</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_curr</span> <span class="o">-</span> <span class="n">lim_lower</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="n">to_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_curr</span> <span class="o">-</span> <span class="n">lim_upper</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">to_min</span><span class="o">&lt;</span><span class="n">to_max</span> <span class="ow">and</span> <span class="n">v_des</span><span class="o">&gt;</span><span class="mi">0</span> <span class="c1"># if v_des -ve</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="n">c2</span> <span class="o">=</span> <span class="n">to_min</span><span class="o">&gt;</span><span class="n">to_max</span> <span class="ow">and</span> <span class="n">v_des</span><span class="o">&lt;</span><span class="mi">0</span> <span class="c1"># if v_des +ve</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>            <span class="n">opp_vel</span> <span class="o">=</span> <span class="n">c1</span> <span class="ow">or</span> <span class="n">c2</span> 
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="n">t_brake</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span> <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>  <span class="c1"># How long to brake from current speed (s)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>            <span class="n">d_brake</span> <span class="o">=</span> <span class="n">t_brake</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># How far it will go before breaking (pos/neg)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>            <span class="n">d_brake</span> <span class="o">=</span> <span class="n">d_brake</span><span class="o">+</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span> <span class="c1">#Pad out by 5 degrees to give a bit of safety margin</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>            <span class="k">if</span> <span class="n">opp_vel</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">v_des</span> <span class="c1"># allow input velocity if direction is opposite to nearest limit</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">v_des</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">+</span> <span class="n">d_brake</span> <span class="o">&gt;=</span> <span class="n">lim_upper</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">v_des</span> <span class="o">&lt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">d_brake</span> <span class="o">&lt;=</span> <span class="n">lim_lower</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">to_max</span><span class="p">,</span><span class="n">to_max</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># apply brakes if the braking distance is &gt;= limits</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                <span class="n">taper</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">to_max</span><span class="p">,</span><span class="n">to_min</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="c1"># normalized (0~1) distance to limits</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">v_des</span><span class="o">*</span><span class="n">taper</span> <span class="c1"># apply tapered velocity inside braking zone</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applied safety brakes near limits. reduced set_vel=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    <span class="k">def</span> <span class="nf">enable_velocity_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_vel</span><span class="p">()</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="k">return</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="k">return</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="c1">#print(&#39;Motion Params&#39;,v_des,a_des)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="n">old_x_des</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">x_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_des</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="o">!=</span> <span class="n">old_x_des</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Clipping move_to(</span><span class="si">{0}</span><span class="s1">) with soft limits </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_x_des</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]))</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="n">t_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks</span><span class="p">(</span><span class="n">x_des</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="n">t_des</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t_des</span><span class="p">))</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="n">success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">go_to_pos</span><span class="p">(</span><span class="n">t_des</span><span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                <span class="n">success</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="k">break</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>    <span class="k">def</span> <span class="nf">set_motion_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                <span class="k">return</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span> <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">v_des</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="k">if</span> <span class="n">v_des</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_velocity</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v_des</span><span class="p">)))</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="n">a_des</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_des</span><span class="p">)</span> <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="n">a_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">],</span> <span class="n">a_des</span><span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="k">if</span> <span class="n">a_des</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_acceleration</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="n">a_des</span><span class="p">)))</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during set_motion_params on: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>    <span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="k">return</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_des</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.00002</span><span class="p">:</span> <span class="c1">#Avoid drift</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>                    <span class="n">cx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="p">,</span> <span class="n">a_des</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Move_By comm failure on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_by on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>    <span class="k">def</span> <span class="nf">quick_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="k">return</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during quick_stop on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>    <span class="k">def</span> <span class="nf">enable_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="k">return</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_multiturn</span><span class="p">()</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during enable_pos on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="k">def</span> <span class="nf">enable_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="k">return</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during enable_pwm on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>    <span class="k">def</span> <span class="nf">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="k">return</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during set_pwm on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="c1"># ######### Waypoint Trajectory Interface ##############################</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>    <span class="k">def</span> <span class="nf">is_trajectory_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">!=</span><span class="kc">None</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="k">def</span> <span class="nf">get_trajectory_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="c1">#Return trajectory execution time</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">):</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>    <span class="k">def</span> <span class="nf">get_trajectory_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_ts</span><span class="p">())</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>    <span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">req_calibration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts executing a waypoint trajectory</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">        `self.trajectory` must be populated with a valid trajectory before calling</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        this method.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">        Parameters</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">        ----------</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">        v_r : float</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">            velocity limit for trajectory in radians per second</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">        a_r : float</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">            acceleration limit for trajectory in radians per second squared</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">        req_calibration : bool</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">            whether to allow motion prior to homing</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">        move_to_start_point : bool</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">            whether to move to the trajectory&#39;s start to avoid a jump, this</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">            time to move doesn&#39;t count against the trajectory&#39;s timeline</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="c1"># check if joint valid, homed, and previous trajectory not executing</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel connection to hardware not valid&#39;</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="k">if</span> <span class="n">req_calibration</span><span class="p">:</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not homed&#39;</span><span class="p">)</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Dynamixel waypoint trajectory already active&#39;</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="c1">#Store current vel/accel so can restore later</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v_des</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_des</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="c1"># check if trajectory valid</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>        <span class="n">vel_limit</span> <span class="o">=</span> <span class="n">v_r</span> <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">acc_limit</span> <span class="o">=</span> <span class="n">a_r</span> <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">vel_limit</span><span class="p">,</span> <span class="n">acc_limit</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel trajectory not valid: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reason</span><span class="p">))</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="k">if</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">reason</span> <span class="o">==</span> <span class="s2">&quot;must have at least two waypoints&quot;</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="c1">#self.logger.warning(&#39;Dynamixel trajectory not valid: {0}&#39;.format(reason))</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>            <span class="c1"># skip this device</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="c1"># set defaults</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">])</span> \
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">])</span> \
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>            <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="c1"># move to start point</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="k">if</span> <span class="n">move_to_start_point</span><span class="p">:</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">():</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel unable to reach starting point&#39;</span><span class="p">)</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="c1"># start trajectory</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="n">p0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_trajectory_vel_ctrl</span><span class="p">()</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>    <span class="k">def</span> <span class="nf">update_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates hardware with the next position goal of `self.trajectory`</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        This method must be called frequently to enable complete trajectory execution</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        and preemption of future segments. If used with `stretch_body.robot.Robot` or</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">        with `self.startup(threaded=True)`, a background thread is launched for this.</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">        Otherwise, the user must handle calling this method.</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="c1"># check if joint valid, previous trajectory not executing, and not runstopped</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">return</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span><span class="p">:</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>            <span class="k">return</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="n">p1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                <span class="c1">#print(&#39;T %f p %f v %f a: %f&#39;%(time.time() - self._waypoint_ts,p1,v1,a1))</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step_trajectory_vel_ctrl</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">a1</span><span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_trajectory_vel_ctrl</span><span class="p">():</span> <span class="c1">#Turn off trajectory if hit a watchdog error during executiong</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="k">def</span> <span class="nf">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop waypoint trajectory immediately and resets hardware</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_trajectory_vel_ctrl</span><span class="p">()</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="k">def</span> <span class="nf">_step_trajectory_vel_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span><span class="n">a1</span><span class="p">):</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="c1"># Command the instantaneious spline velocity to the servo velocity controller</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="c1"># Add a proportional term on the position error to zero out small errors at low velocity</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="n">x_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="n">v_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl_kP&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_curr</span><span class="o">-</span><span class="n">p1</span><span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="n">v_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="c1"># Honor joint limits in velocity mode</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="n">lim_lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="n">lim_upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="c1">#if self.params[&#39;motion&#39;][&#39;trajectory_max&#39;][&#39;accel_r&#39;] &gt; 0:</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="n">t_brake</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span> <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>  <span class="c1"># How long to brake from current speed (s)</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="c1">#else:</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="c1">#    t_brake = 0</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="n">d_brake</span> <span class="o">=</span> <span class="n">t_brake</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># How far it will go before breaking (pos/neg)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="n">d_brake</span> <span class="o">=</span> <span class="n">d_brake</span><span class="o">+</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span> <span class="c1">#Pad out by 5 degrees to give a bit of safety margin</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">+</span> <span class="n">d_brake</span> <span class="o">&gt;=</span> <span class="n">lim_upper</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&lt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">d_brake</span> <span class="o">&lt;=</span> <span class="n">lim_lower</span><span class="p">):</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_vel</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="k">def</span> <span class="nf">_enable_trajectory_vel_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_watchdog</span><span class="p">()</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_vel</span><span class="p">()</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_acceleration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]))</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]))</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="k">def</span> <span class="nf">_disable_trajectory_vel_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="n">wd_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">()</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="k">if</span> <span class="n">wd_error</span><span class="p">:</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Watchdog error during trajectory execution for </span><span class="si">%s</span><span class="s1">. Unable to maintain update rates.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="n">wd_error</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="c1"># ##########################################</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">    Servo calibration works by:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">    </span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">    Homing</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">    ==============</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">    * Move with a fixed PWM to a hardstop</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">    * Store the current position (ticks) in the EEPROM homing offset such that self.motor.status[&#39;pos&#39;]==0 at that hardstop</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">    </span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">    Calibration to SI / joint range:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">    ===============</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">    Once homed, the servo can move to positions within self.params.range_t (ticks).</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">    The &#39;Joint Zero&#39; (self.params.zero_t) is different than the &#39;Servo Zero&#39;. Per the homing procedure, Servo Zero is at one hardstop</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">    Joint Zero is an offset (ticks) from Servo Zero that is added/subtracted to commanded/reported values</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">    Thus when self.motor.status[&#39;pos&#39;]==self.params.zero_t, self.status[&#39;pos]=0 (rad)</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">    </span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">    There is an added complexity with how Dynamixels handle position reporting in multi-turn and single-turn mode</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">    In multi-turn mode, position values and homing values can be large (+/-2B, +/-1M)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">    In single-turn mode, position values are bound to 0-4095 and homing values to -1,024 ~ 1,024</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">    In addition, the home offset stored during a multi-turn homing procedure may not be valid in single turn (out of range)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">    </span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">    The Home Offset(20) adjusts the home position. The offset value is added to the Present Position(132).</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">    Present Position(132) = Actual Position + Homing Offset(20)</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">    Range: -1,044,479 ~ 1,044,479</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">    </span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">    ### NOTE ###</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">    In case of the Position Control Mode(Joint Mode) that rotates less than 360 degrees, any invalid Homing Offset(20) values will be ignored(valid range : -1,024 ~ 1,024).</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">    So when homing in single-turn mode, ensure that the homing offset stored is in range, otherwise unexpected values will appear. </span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">    -- It is possible then to not be able to home a single-turn servo as position can range 0-4096 and depending on hardstop location, a valid homing offset can not be found</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">    -- Also, homing shouldn&#39;t be necessary in single-turn mode as the position reporting is already absolute</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">move_to_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">delay_at_stop</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">save_calibration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">set_homing_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="c1"># Requires at least one hardstop in the pwm_homing[0] direction</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="c1"># Can be in multiturn or single turn mode</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="c1"># Mark the first hardstop as zero ticks on the Dynammixel</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="c1"># Second hardstop is optional</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="c1"># Return success, measured range</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not able to home </span><span class="si">%s</span><span class="s1">. Hardware not present&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homing not required for: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to first hardstop...&#39;</span><span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_homing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&gt;</span><span class="mf">15.0</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_at_stop</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timed out moving to first hardstop. Exiting.&#39;</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="c1">#Need to move back to pos mode to get the position (ticks) w/o the homing offset (single turn mode)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>            <span class="n">contact_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First hardstop contact at position (ticks): </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">contact_0</span><span class="p">)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="k">if</span> <span class="n">set_homing_offset</span><span class="p">:</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homing offset was </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">())</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Marking current position to zero ticks&#39;</span><span class="p">)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">zero_position</span><span class="p">()</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Homing offset is now  </span><span class="si">%d</span><span class="s2"> (ticks)&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">())</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                <span class="n">contact_0</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_calibrated</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current position (ticks):&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">())</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">single_stop</span><span class="p">:</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                <span class="c1">#Measure the range and write to YAML</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to second hardstop...&#39;</span><span class="p">)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_homing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                <span class="n">timeout</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                    <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="mf">15.0</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_at_stop</span><span class="p">)</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timed out moving to second hardstop. Exiting.&#39;</span><span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                <span class="c1"># Need to move back to pos mode to get the position (ticks) w/o the homing offset (single turn mode)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                <span class="n">contact_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hit second hardstop at: (ticks)&#39;</span><span class="p">,</span> <span class="n">contact_1</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homed to range of motion to (ticks):&#39;</span><span class="p">,[</span><span class="n">contact_0</span><span class="p">,</span><span class="n">contact_1</span><span class="p">])</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact_0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_pad_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">contact_1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_pad_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Padded range of motion is (ticks):&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="n">r1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="n">r2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Radians:&#39;</span><span class="p">,[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">])</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Degrees:&#39;</span><span class="p">,[</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r2</span><span class="p">)])</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                <span class="k">if</span> <span class="n">save_calibration</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">write_configuration_param_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.range_t&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="k">if</span> <span class="n">move_to_zero</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to calibrated zero: (rad)&#39;</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">single_stop</span><span class="p">:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                <span class="k">return</span>  <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">]</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="k">except</span> <span class="n">DynamixelCommError</span><span class="p">:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Communication error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="c1"># ##########################################</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">rps_servo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad_per_sec_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rps_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="n">rps_servo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad_per_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rps_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>        <span class="n">rad_servo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rad_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">])</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">rad_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_to_ticks</span><span class="p">(</span><span class="n">rad_servo</span><span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">rad_per_sec_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_per_sec_to_ticks</span><span class="p">(</span><span class="n">rad_per_sec_servo</span><span class="p">)</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="k">return</span> <span class="n">t</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="n">rad_per_sec_sec_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_per_sec_sec_to_ticks</span><span class="p">(</span><span class="n">rad_per_sec_sec_servo</span><span class="p">)</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">return</span> <span class="n">t</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">((</span><span class="mf">360.0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">4096.0</span><span class="p">))</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>    <span class="k">def</span> <span class="nf">rad_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="mf">4096.0</span> <span class="o">*</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="n">rpm</span><span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="mf">0.229</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">rpm</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>    <span class="k">def</span> <span class="nf">rad_per_sec_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>        <span class="n">rpm</span><span class="o">=</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mf">360.0</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rpm</span><span class="o">/</span><span class="mf">0.229</span><span class="p">)</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="n">rpmm</span><span class="o">=</span><span class="n">t</span><span class="o">*</span><span class="mf">214.577</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">rpmm</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="mf">60.0</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>    <span class="k">def</span> <span class="nf">rad_per_sec_sec_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="n">rpmm</span><span class="o">=</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mf">360.0</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rpmm</span><span class="o">/</span><span class="mf">214.577</span><span class="p">)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>    <span class="k">def</span> <span class="nf">ticks_to_pct_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="c1">#-100 to 100.0</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="k">return</span> <span class="n">t</span><span class="o">/</span><span class="mf">10.24</span>
</span></pre></div>


            </section>
                <section id="DynamixelCommErrorStats">
                            <input id="DynamixelCommErrorStats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DynamixelCommErrorStats</span><wbr>(<span class="base"><a href="device.html#Device">stretch_body.device.Device</a></span>):

                <label class="view-source-button" for="DynamixelCommErrorStats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelCommErrorStats-11"><a href="#DynamixelCommErrorStats-11"><span class="linenos">11</span></a><span class="k">class</span> <span class="nc">DynamixelCommErrorStats</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats-12"><a href="#DynamixelCommErrorStats-12"><span class="linenos">12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats-13"><a href="#DynamixelCommErrorStats-13"><span class="linenos">13</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dxl_comm_errors&#39;</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats-14"><a href="#DynamixelCommErrorStats-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
</span><span id="DynamixelCommErrorStats-15"><a href="#DynamixelCommErrorStats-15"><span class="linenos">15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_rx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_tx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_gsr&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="DynamixelCommErrorStats-16"><a href="#DynamixelCommErrorStats-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelCommErrorStats-17"><a href="#DynamixelCommErrorStats-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span><span class="o">=</span><span class="mi">10</span>
</span><span id="DynamixelCommErrorStats-18"><a href="#DynamixelCommErrorStats-18"><span class="linenos">18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">=</span><span class="mi">0</span>
</span><span id="DynamixelCommErrorStats-19"><a href="#DynamixelCommErrorStats-19"><span class="linenos">19</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_error_last</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats-20"><a href="#DynamixelCommErrorStats-20"><span class="linenos">20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats-21"><a href="#DynamixelCommErrorStats-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
</span><span id="DynamixelCommErrorStats-22"><a href="#DynamixelCommErrorStats-22"><span class="linenos">22</span></a>
</span><span id="DynamixelCommErrorStats-23"><a href="#DynamixelCommErrorStats-23"><span class="linenos">23</span></a>    <span class="k">def</span> <span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats-24"><a href="#DynamixelCommErrorStats-24"><span class="linenos">24</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats-25"><a href="#DynamixelCommErrorStats-25"><span class="linenos">25</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="c1">#First error</span>
</span><span id="DynamixelCommErrorStats-26"><a href="#DynamixelCommErrorStats-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats-27"><a href="#DynamixelCommErrorStats-27"><span class="linenos">27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_error_last</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats-28"><a href="#DynamixelCommErrorStats-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span>
</span><span id="DynamixelCommErrorStats-29"><a href="#DynamixelCommErrorStats-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats-30"><a href="#DynamixelCommErrorStats-30"><span class="linenos">30</span></a>        <span class="k">if</span> <span class="n">rx</span><span class="p">:</span>
</span><span id="DynamixelCommErrorStats-31"><a href="#DynamixelCommErrorStats-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_rx&#39;</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="DynamixelCommErrorStats-32"><a href="#DynamixelCommErrorStats-32"><span class="linenos">32</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelCommErrorStats-33"><a href="#DynamixelCommErrorStats-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_tx&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamixelCommErrorStats-34"><a href="#DynamixelCommErrorStats-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="n">gsr</span><span class="p">:</span>
</span><span id="DynamixelCommErrorStats-35"><a href="#DynamixelCommErrorStats-35"><span class="linenos">35</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_gsr&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamixelCommErrorStats-36"><a href="#DynamixelCommErrorStats-36"><span class="linenos">36</span></a>        <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;warn_every_s&#39;</span><span class="p">]:</span>
</span><span id="DynamixelCommErrorStats-37"><a href="#DynamixelCommErrorStats-37"><span class="linenos">37</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">=</span><span class="n">t</span>
</span><span id="DynamixelCommErrorStats-38"><a href="#DynamixelCommErrorStats-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;warn_above_rate&#39;</span><span class="p">]:</span>
</span><span id="DynamixelCommErrorStats-39"><a href="#DynamixelCommErrorStats-39"><span class="linenos">39</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Device </span><span class="si">%s</span><span class="s1"> generating </span><span class="si">%f</span><span class="s1"> errors per minute&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span>
</span><span id="DynamixelCommErrorStats-40"><a href="#DynamixelCommErrorStats-40"><span class="linenos">40</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
</span><span id="DynamixelCommErrorStats-41"><a href="#DynamixelCommErrorStats-41"><span class="linenos">41</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats-42"><a href="#DynamixelCommErrorStats-42"><span class="linenos">42</span></a>
</span><span id="DynamixelCommErrorStats-43"><a href="#DynamixelCommErrorStats-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats-44"><a href="#DynamixelCommErrorStats-44"><span class="linenos">44</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Dynamixel Comm Errors </span><span class="si">%s</span><span class="s1"> ----&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats-45"><a href="#DynamixelCommErrorStats-45"><span class="linenos">45</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rate (Hz): </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">])</span>
</span><span id="DynamixelCommErrorStats-46"><a href="#DynamixelCommErrorStats-46"><span class="linenos">46</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rate (errors per minute): </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>
</span><span id="DynamixelCommErrorStats-47"><a href="#DynamixelCommErrorStats-47"><span class="linenos">47</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num TX: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_tx&#39;</span><span class="p">])</span>
</span><span id="DynamixelCommErrorStats-48"><a href="#DynamixelCommErrorStats-48"><span class="linenos">48</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num RX: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_rx&#39;</span><span class="p">])</span>
</span><span id="DynamixelCommErrorStats-49"><a href="#DynamixelCommErrorStats-49"><span class="linenos">49</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num Group Sync RX: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_gsr&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            <div id="DynamixelCommErrorStats.__init__" class="classattr">
                                        <input id="DynamixelCommErrorStats.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DynamixelCommErrorStats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">logger</span></span>)</span>

                <label class="view-source-button" for="DynamixelCommErrorStats.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelCommErrorStats.__init__-12"><a href="#DynamixelCommErrorStats.__init__-12"><span class="linenos">12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats.__init__-13"><a href="#DynamixelCommErrorStats.__init__-13"><span class="linenos">13</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dxl_comm_errors&#39;</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats.__init__-14"><a href="#DynamixelCommErrorStats.__init__-14"><span class="linenos">14</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
</span><span id="DynamixelCommErrorStats.__init__-15"><a href="#DynamixelCommErrorStats.__init__-15"><span class="linenos">15</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_rx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_tx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_gsr&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="DynamixelCommErrorStats.__init__-16"><a href="#DynamixelCommErrorStats.__init__-16"><span class="linenos">16</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelCommErrorStats.__init__-17"><a href="#DynamixelCommErrorStats.__init__-17"><span class="linenos">17</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span><span class="o">=</span><span class="mi">10</span>
</span><span id="DynamixelCommErrorStats.__init__-18"><a href="#DynamixelCommErrorStats.__init__-18"><span class="linenos">18</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">=</span><span class="mi">0</span>
</span><span id="DynamixelCommErrorStats.__init__-19"><a href="#DynamixelCommErrorStats.__init__-19"><span class="linenos">19</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_error_last</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats.__init__-20"><a href="#DynamixelCommErrorStats.__init__-20"><span class="linenos">20</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats.__init__-21"><a href="#DynamixelCommErrorStats.__init__-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelCommErrorStats.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.name"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.status" class="classattr">
                                <div class="attr variable">
            <span class="name">status</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.status"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.rate_log" class="classattr">
                                <div class="attr variable">
            <span class="name">rate_log</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.rate_log"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.n_log" class="classattr">
                                <div class="attr variable">
            <span class="name">n_log</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.n_log"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.log_idx" class="classattr">
                                <div class="attr variable">
            <span class="name">log_idx</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.log_idx"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.ts_error_last" class="classattr">
                                <div class="attr variable">
            <span class="name">ts_error_last</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.ts_error_last"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.ts_warn_last" class="classattr">
                                <div class="attr variable">
            <span class="name">ts_warn_last</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.ts_warn_last"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.logger"></a>
    
    

                            </div>
                            <div id="DynamixelCommErrorStats.add_error" class="classattr">
                                        <input id="DynamixelCommErrorStats.add_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_error</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rx</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">gsr</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelCommErrorStats.add_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.add_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelCommErrorStats.add_error-23"><a href="#DynamixelCommErrorStats.add_error-23"><span class="linenos">23</span></a>    <span class="k">def</span> <span class="nf">add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats.add_error-24"><a href="#DynamixelCommErrorStats.add_error-24"><span class="linenos">24</span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelCommErrorStats.add_error-25"><a href="#DynamixelCommErrorStats.add_error-25"><span class="linenos">25</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="c1">#First error</span>
</span><span id="DynamixelCommErrorStats.add_error-26"><a href="#DynamixelCommErrorStats.add_error-26"><span class="linenos">26</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats.add_error-27"><a href="#DynamixelCommErrorStats.add_error-27"><span class="linenos">27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_error_last</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats.add_error-28"><a href="#DynamixelCommErrorStats.add_error-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_log</span>
</span><span id="DynamixelCommErrorStats.add_error-29"><a href="#DynamixelCommErrorStats.add_error-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_log</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats.add_error-30"><a href="#DynamixelCommErrorStats.add_error-30"><span class="linenos">30</span></a>        <span class="k">if</span> <span class="n">rx</span><span class="p">:</span>
</span><span id="DynamixelCommErrorStats.add_error-31"><a href="#DynamixelCommErrorStats.add_error-31"><span class="linenos">31</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_rx&#39;</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="DynamixelCommErrorStats.add_error-32"><a href="#DynamixelCommErrorStats.add_error-32"><span class="linenos">32</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelCommErrorStats.add_error-33"><a href="#DynamixelCommErrorStats.add_error-33"><span class="linenos">33</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_tx&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamixelCommErrorStats.add_error-34"><a href="#DynamixelCommErrorStats.add_error-34"><span class="linenos">34</span></a>        <span class="k">if</span> <span class="n">gsr</span><span class="p">:</span>
</span><span id="DynamixelCommErrorStats.add_error-35"><a href="#DynamixelCommErrorStats.add_error-35"><span class="linenos">35</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_gsr&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamixelCommErrorStats.add_error-36"><a href="#DynamixelCommErrorStats.add_error-36"><span class="linenos">36</span></a>        <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;warn_every_s&#39;</span><span class="p">]:</span>
</span><span id="DynamixelCommErrorStats.add_error-37"><a href="#DynamixelCommErrorStats.add_error-37"><span class="linenos">37</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_warn_last</span><span class="o">=</span><span class="n">t</span>
</span><span id="DynamixelCommErrorStats.add_error-38"><a href="#DynamixelCommErrorStats.add_error-38"><span class="linenos">38</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;warn_above_rate&#39;</span><span class="p">]:</span>
</span><span id="DynamixelCommErrorStats.add_error-39"><a href="#DynamixelCommErrorStats.add_error-39"><span class="linenos">39</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Device </span><span class="si">%s</span><span class="s1"> generating </span><span class="si">%f</span><span class="s1"> errors per minute&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="p">)))</span>
</span><span id="DynamixelCommErrorStats.add_error-40"><a href="#DynamixelCommErrorStats.add_error-40"><span class="linenos">40</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]:</span>
</span><span id="DynamixelCommErrorStats.add_error-41"><a href="#DynamixelCommErrorStats.add_error-41"><span class="linenos">41</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelCommErrorStats.pretty_print" class="classattr">
                                        <input id="DynamixelCommErrorStats.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelCommErrorStats.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelCommErrorStats.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelCommErrorStats.pretty_print-43"><a href="#DynamixelCommErrorStats.pretty_print-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelCommErrorStats.pretty_print-44"><a href="#DynamixelCommErrorStats.pretty_print-44"><span class="linenos">44</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---- Dynamixel Comm Errors </span><span class="si">%s</span><span class="s1"> ----&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelCommErrorStats.pretty_print-45"><a href="#DynamixelCommErrorStats.pretty_print-45"><span class="linenos">45</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rate (Hz): </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">])</span>
</span><span id="DynamixelCommErrorStats.pretty_print-46"><a href="#DynamixelCommErrorStats.pretty_print-46"><span class="linenos">46</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rate (errors per minute): </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;error_rate_avg_hz&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="p">))</span>
</span><span id="DynamixelCommErrorStats.pretty_print-47"><a href="#DynamixelCommErrorStats.pretty_print-47"><span class="linenos">47</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num TX: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_tx&#39;</span><span class="p">])</span>
</span><span id="DynamixelCommErrorStats.pretty_print-48"><a href="#DynamixelCommErrorStats.pretty_print-48"><span class="linenos">48</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num RX: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_rx&#39;</span><span class="p">])</span>
</span><span id="DynamixelCommErrorStats.pretty_print-49"><a href="#DynamixelCommErrorStats.pretty_print-49"><span class="linenos">49</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num Group Sync RX: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;n_gsr&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Pretty print the parameters.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="DynamixelCommErrorStats.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="DynamixelCommErrorStats.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="DynamixelCommErrorStats.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="DynamixelCommErrorStats.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="DynamixelCommErrorStats.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="DynamixelCommErrorStats.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="DynamixelCommErrorStats.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="DynamixelCommErrorStats.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="DynamixelCommErrorStats.startup" class="function"><a href="device.html#Device.startup">startup</a></dd>
                <dd id="DynamixelCommErrorStats.stop" class="function"><a href="device.html#Device.stop">stop</a></dd>
                <dd id="DynamixelCommErrorStats.push_command" class="function"><a href="device.html#Device.push_command">push_command</a></dd>
                <dd id="DynamixelCommErrorStats.pull_status" class="function"><a href="device.html#Device.pull_status">pull_status</a></dd>
                <dd id="DynamixelCommErrorStats.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="DynamixelCommErrorStats.step_sentry" class="function"><a href="device.html#Device.step_sentry">step_sentry</a></dd>
                <dd id="DynamixelCommErrorStats.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="DynamixelCommErrorStats.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DynamixelHelloXL430">
                            <input id="DynamixelHelloXL430-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DynamixelHelloXL430</span><wbr>(<span class="base"><a href="device.html#Device">stretch_body.device.Device</a></span>):

                <label class="view-source-button" for="DynamixelHelloXL430-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430-53"><a href="#DynamixelHelloXL430-53"><span class="linenos">  53</span></a><span class="k">class</span> <span class="nc">DynamixelHelloXL430</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-54"><a href="#DynamixelHelloXL430-54"><span class="linenos">  54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-55"><a href="#DynamixelHelloXL430-55"><span class="linenos">  55</span></a><span class="sd">    Abstract the Dynamixel X-Series to handle calibration, radians, etc</span>
</span><span id="DynamixelHelloXL430-56"><a href="#DynamixelHelloXL430-56"><span class="linenos">  56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-57"><a href="#DynamixelHelloXL430-57"><span class="linenos">  57</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-58"><a href="#DynamixelHelloXL430-58"><span class="linenos">  58</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-59"><a href="#DynamixelHelloXL430-59"><span class="linenos">  59</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-60"><a href="#DynamixelHelloXL430-60"><span class="linenos">  60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
</span><span id="DynamixelHelloXL430-61"><a href="#DynamixelHelloXL430-61"><span class="linenos">  61</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-62"><a href="#DynamixelHelloXL430-62"><span class="linenos">  62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;comm_errors&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vel&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;temp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;shutdown&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hardware_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430-63"><a href="#DynamixelHelloXL430-63"><span class="linenos">  63</span></a>                         <span class="s1">&#39;input_voltage_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;overload_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430-64"><a href="#DynamixelHelloXL430-64"><span class="linenos">  64</span></a>                         <span class="s1">&#39;stalled&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="DynamixelHelloXL430-65"><a href="#DynamixelHelloXL430-65"><span class="linenos">  65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">thread_rate_hz</span> <span class="o">=</span> <span class="mf">15.0</span>
</span><span id="DynamixelHelloXL430-66"><a href="#DynamixelHelloXL430-66"><span class="linenos">  66</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">RevoluteTrajectory</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-67"><a href="#DynamixelHelloXL430-67"><span class="linenos">  67</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-68"><a href="#DynamixelHelloXL430-68"><span class="linenos">  68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-69"><a href="#DynamixelHelloXL430-69"><span class="linenos">  69</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-70"><a href="#DynamixelHelloXL430-70"><span class="linenos">  70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="o">=</span> <span class="n">usb</span>
</span><span id="DynamixelHelloXL430-71"><a href="#DynamixelHelloXL430-71"><span class="linenos">  71</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-72"><a href="#DynamixelHelloXL430-72"><span class="linenos">  72</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;usb_name&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-73"><a href="#DynamixelHelloXL430-73"><span class="linenos">  73</span></a>
</span><span id="DynamixelHelloXL430-74"><a href="#DynamixelHelloXL430-74"><span class="linenos">  74</span></a>            <span class="c1">#Share bus resource amongst many XL430s</span>
</span><span id="DynamixelHelloXL430-75"><a href="#DynamixelHelloXL430-75"><span class="linenos">  75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="o">=</span> <span class="n">DynamixelXL430</span><span class="p">(</span><span class="n">dxl_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span><span id="DynamixelHelloXL430-76"><a href="#DynamixelHelloXL430-76"><span class="linenos">  76</span></a>                                        <span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430-77"><a href="#DynamixelHelloXL430-77"><span class="linenos">  77</span></a>                                        <span class="n">port_handler</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">chain</span><span class="o">.</span><span class="n">port_handler</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430-78"><a href="#DynamixelHelloXL430-78"><span class="linenos">  78</span></a>                                        <span class="n">pt_lock</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">chain</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430-79"><a href="#DynamixelHelloXL430-79"><span class="linenos">  79</span></a>                                        <span class="n">baud</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;baud&#39;</span><span class="p">],</span>
</span><span id="DynamixelHelloXL430-80"><a href="#DynamixelHelloXL430-80"><span class="linenos">  80</span></a>                                        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-81"><a href="#DynamixelHelloXL430-81"><span class="linenos">  81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="DynamixelHelloXL430-82"><a href="#DynamixelHelloXL430-82"><span class="linenos">  82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelHelloXL430-83"><a href="#DynamixelHelloXL430-83"><span class="linenos">  83</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-84"><a href="#DynamixelHelloXL430-84"><span class="linenos">  84</span></a>
</span><span id="DynamixelHelloXL430-85"><a href="#DynamixelHelloXL430-85"><span class="linenos">  85</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-86"><a href="#DynamixelHelloXL430-86"><span class="linenos">  86</span></a>                <span class="n">wr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-87"><a href="#DynamixelHelloXL430-87"><span class="linenos">  87</span></a>                <span class="n">wr_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-88"><a href="#DynamixelHelloXL430-88"><span class="linenos">  88</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-89"><a href="#DynamixelHelloXL430-89"><span class="linenos">  89</span></a>                <span class="n">wr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-90"><a href="#DynamixelHelloXL430-90"><span class="linenos">  90</span></a>                <span class="n">wr_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-91"><a href="#DynamixelHelloXL430-91"><span class="linenos">  91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;collision&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span><span class="s1">&#39;hard&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">wr_min</span><span class="p">,</span><span class="n">wr_max</span><span class="p">],</span><span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">wr_min</span><span class="p">,</span><span class="n">wr_max</span><span class="p">]}</span>
</span><span id="DynamixelHelloXL430-92"><a href="#DynamixelHelloXL430-92"><span class="linenos">  92</span></a>
</span><span id="DynamixelHelloXL430-93"><a href="#DynamixelHelloXL430-93"><span class="linenos">  93</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-94"><a href="#DynamixelHelloXL430-94"><span class="linenos">  94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-95"><a href="#DynamixelHelloXL430-95"><span class="linenos">  95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-96"><a href="#DynamixelHelloXL430-96"><span class="linenos">  96</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span> <span class="o">=</span> <span class="n">DynamixelCommErrorStats</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-97"><a href="#DynamixelHelloXL430-97"><span class="linenos">  97</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#Track the motion profile settings on servo</span>
</span><span id="DynamixelHelloXL430-98"><a href="#DynamixelHelloXL430-98"><span class="linenos">  98</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#Track the motion profile settings on servo</span>
</span><span id="DynamixelHelloXL430-99"><a href="#DynamixelHelloXL430-99"><span class="linenos">  99</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-100"><a href="#DynamixelHelloXL430-100"><span class="linenos"> 100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-101"><a href="#DynamixelHelloXL430-101"><span class="linenos"> 101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-102"><a href="#DynamixelHelloXL430-102"><span class="linenos"> 102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">False</span> 
</span><span id="DynamixelHelloXL430-103"><a href="#DynamixelHelloXL430-103"><span class="linenos"> 103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># track dist to min,max limits</span>
</span><span id="DynamixelHelloXL430-104"><a href="#DynamixelHelloXL430-104"><span class="linenos"> 104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># initial/minimum brake zone thresh value</span>
</span><span id="DynamixelHelloXL430-105"><a href="#DynamixelHelloXL430-105"><span class="linenos"> 105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-106"><a href="#DynamixelHelloXL430-106"><span class="linenos"> 106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-107"><a href="#DynamixelHelloXL430-107"><span class="linenos"> 107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">total_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-108"><a href="#DynamixelHelloXL430-108"><span class="linenos"> 108</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-109"><a href="#DynamixelHelloXL430-109"><span class="linenos"> 109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelHelloXL430-110"><a href="#DynamixelHelloXL430-110"><span class="linenos"> 110</span></a>
</span><span id="DynamixelHelloXL430-111"><a href="#DynamixelHelloXL430-111"><span class="linenos"> 111</span></a>    <span class="c1"># ###########  Device Methods #############</span>
</span><span id="DynamixelHelloXL430-112"><a href="#DynamixelHelloXL430-112"><span class="linenos"> 112</span></a>
</span><span id="DynamixelHelloXL430-113"><a href="#DynamixelHelloXL430-113"><span class="linenos"> 113</span></a>    <span class="k">def</span> <span class="nf">check_homing_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-114"><a href="#DynamixelHelloXL430-114"><span class="linenos"> 114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-115"><a href="#DynamixelHelloXL430-115"><span class="linenos"> 115</span></a><span class="sd">        Users may incorrectly set the homing offset on a single-turn servo</span>
</span><span id="DynamixelHelloXL430-116"><a href="#DynamixelHelloXL430-116"><span class="linenos"> 116</span></a><span class="sd">        In general on single-turn servos, the homing offset should be zero</span>
</span><span id="DynamixelHelloXL430-117"><a href="#DynamixelHelloXL430-117"><span class="linenos"> 117</span></a><span class="sd">        In some cases it may be non-zero but between -1024 and 1024 (per DXL spec)</span>
</span><span id="DynamixelHelloXL430-118"><a href="#DynamixelHelloXL430-118"><span class="linenos"> 118</span></a><span class="sd">        If it is outside of the valid range it is ignored. However,</span>
</span><span id="DynamixelHelloXL430-119"><a href="#DynamixelHelloXL430-119"><span class="linenos"> 119</span></a><span class="sd">        when the servo is placed in other control modes (eg vel) the reported encoder position start using the offset</span>
</span><span id="DynamixelHelloXL430-120"><a href="#DynamixelHelloXL430-120"><span class="linenos"> 120</span></a><span class="sd">        This can create unexpected behavior</span>
</span><span id="DynamixelHelloXL430-121"><a href="#DynamixelHelloXL430-121"><span class="linenos"> 121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-122"><a href="#DynamixelHelloXL430-122"><span class="linenos"> 122</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-123"><a href="#DynamixelHelloXL430-123"><span class="linenos"> 123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-124"><a href="#DynamixelHelloXL430-124"><span class="linenos"> 124</span></a>            <span class="n">xn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-125"><a href="#DynamixelHelloXL430-125"><span class="linenos"> 125</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1024</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-126"><a href="#DynamixelHelloXL430-126"><span class="linenos"> 126</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel </span><span class="si">%s</span><span class="s1">: Servo is in single-turn mode yet has invalid homing offset of </span><span class="si">%d</span><span class="s1">. </span><span class="se">\n</span><span class="s1"> This may cause &#39;</span>
</span><span id="DynamixelHelloXL430-127"><a href="#DynamixelHelloXL430-127"><span class="linenos"> 127</span></a>                                    <span class="s1">&#39;unexpected results if not set to zero (using REx_dynamixel_jog.py)</span><span class="se">\n</span><span class="s1"> Please contact Hello Robot support for more information&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">xn</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-128"><a href="#DynamixelHelloXL430-128"><span class="linenos"> 128</span></a>
</span><span id="DynamixelHelloXL430-129"><a href="#DynamixelHelloXL430-129"><span class="linenos"> 129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-130"><a href="#DynamixelHelloXL430-130"><span class="linenos"> 130</span></a>
</span><span id="DynamixelHelloXL430-131"><a href="#DynamixelHelloXL430-131"><span class="linenos"> 131</span></a>    <span class="k">def</span> <span class="nf">get_soft_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-132"><a href="#DynamixelHelloXL430-132"><span class="linenos"> 132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-133"><a href="#DynamixelHelloXL430-133"><span class="linenos"> 133</span></a><span class="sd">            Return the currently applied soft motion limits: [min, max]</span>
</span><span id="DynamixelHelloXL430-134"><a href="#DynamixelHelloXL430-134"><span class="linenos"> 134</span></a>
</span><span id="DynamixelHelloXL430-135"><a href="#DynamixelHelloXL430-135"><span class="linenos"> 135</span></a><span class="sd">            The soft motion limit restricts joint motion to be &lt;= its physical limits.</span>
</span><span id="DynamixelHelloXL430-136"><a href="#DynamixelHelloXL430-136"><span class="linenos"> 136</span></a>
</span><span id="DynamixelHelloXL430-137"><a href="#DynamixelHelloXL430-137"><span class="linenos"> 137</span></a><span class="sd">            There are three types of limits:</span>
</span><span id="DynamixelHelloXL430-138"><a href="#DynamixelHelloXL430-138"><span class="linenos"> 138</span></a><span class="sd">            Hard: The physical limits</span>
</span><span id="DynamixelHelloXL430-139"><a href="#DynamixelHelloXL430-139"><span class="linenos"> 139</span></a><span class="sd">            Collision: Limits set by RobotCollision to avoid collisions</span>
</span><span id="DynamixelHelloXL430-140"><a href="#DynamixelHelloXL430-140"><span class="linenos"> 140</span></a><span class="sd">            User: Limits set by the user software</span>
</span><span id="DynamixelHelloXL430-141"><a href="#DynamixelHelloXL430-141"><span class="linenos"> 141</span></a>
</span><span id="DynamixelHelloXL430-142"><a href="#DynamixelHelloXL430-142"><span class="linenos"> 142</span></a><span class="sd">            The joint is limited to the most restrictive range of the Hard / Collision/ User values.</span>
</span><span id="DynamixelHelloXL430-143"><a href="#DynamixelHelloXL430-143"><span class="linenos"> 143</span></a><span class="sd">            Specifying a value of None for a limit indicates that no constraint exists for that limit type.</span>
</span><span id="DynamixelHelloXL430-144"><a href="#DynamixelHelloXL430-144"><span class="linenos"> 144</span></a><span class="sd">            This allows a User limits and Collision limits to coexist.</span>
</span><span id="DynamixelHelloXL430-145"><a href="#DynamixelHelloXL430-145"><span class="linenos"> 145</span></a><span class="sd">            For example, a user can temporarily restrict the range of motion beyond the current collision limits.</span>
</span><span id="DynamixelHelloXL430-146"><a href="#DynamixelHelloXL430-146"><span class="linenos"> 146</span></a><span class="sd">            Then, by commanding User limits of None, the joint limits will revert back to the collision settings.</span>
</span><span id="DynamixelHelloXL430-147"><a href="#DynamixelHelloXL430-147"><span class="linenos"> 147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-148"><a href="#DynamixelHelloXL430-148"><span class="linenos"> 148</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-149"><a href="#DynamixelHelloXL430-149"><span class="linenos"> 149</span></a>
</span><span id="DynamixelHelloXL430-150"><a href="#DynamixelHelloXL430-150"><span class="linenos"> 150</span></a>    <span class="k">def</span> <span class="nf">set_soft_motion_limit_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span> <span class="p">):</span>
</span><span id="DynamixelHelloXL430-151"><a href="#DynamixelHelloXL430-151"><span class="linenos"> 151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-152"><a href="#DynamixelHelloXL430-152"><span class="linenos"> 152</span></a><span class="sd">        x: value to set a joints limit to</span>
</span><span id="DynamixelHelloXL430-153"><a href="#DynamixelHelloXL430-153"><span class="linenos"> 153</span></a><span class="sd">        limit_type: &#39;user&#39; or &#39;collision&#39;</span>
</span><span id="DynamixelHelloXL430-154"><a href="#DynamixelHelloXL430-154"><span class="linenos"> 154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-155"><a href="#DynamixelHelloXL430-155"><span class="linenos"> 155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="n">limit_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="DynamixelHelloXL430-156"><a href="#DynamixelHelloXL430-156"><span class="linenos"> 156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;collision&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;hard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
</span><span id="DynamixelHelloXL430-157"><a href="#DynamixelHelloXL430-157"><span class="linenos"> 157</span></a>
</span><span id="DynamixelHelloXL430-158"><a href="#DynamixelHelloXL430-158"><span class="linenos"> 158</span></a>
</span><span id="DynamixelHelloXL430-159"><a href="#DynamixelHelloXL430-159"><span class="linenos"> 159</span></a>    <span class="k">def</span> <span class="nf">set_soft_motion_limit_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span> <span class="p">):</span>
</span><span id="DynamixelHelloXL430-160"><a href="#DynamixelHelloXL430-160"><span class="linenos"> 160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-161"><a href="#DynamixelHelloXL430-161"><span class="linenos"> 161</span></a><span class="sd">        x: value to set a joints limit to</span>
</span><span id="DynamixelHelloXL430-162"><a href="#DynamixelHelloXL430-162"><span class="linenos"> 162</span></a><span class="sd">        limit_type: &#39;user&#39; or &#39;collision&#39;</span>
</span><span id="DynamixelHelloXL430-163"><a href="#DynamixelHelloXL430-163"><span class="linenos"> 163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-164"><a href="#DynamixelHelloXL430-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="n">limit_type</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="DynamixelHelloXL430-165"><a href="#DynamixelHelloXL430-165"><span class="linenos"> 165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;collision&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;hard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>
</span><span id="DynamixelHelloXL430-166"><a href="#DynamixelHelloXL430-166"><span class="linenos"> 166</span></a>
</span><span id="DynamixelHelloXL430-167"><a href="#DynamixelHelloXL430-167"><span class="linenos"> 167</span></a>    <span class="c1"># ###################################################</span>
</span><span id="DynamixelHelloXL430-168"><a href="#DynamixelHelloXL430-168"><span class="linenos"> 168</span></a>
</span><span id="DynamixelHelloXL430-169"><a href="#DynamixelHelloXL430-169"><span class="linenos"> 169</span></a>    <span class="k">def</span> <span class="nf">do_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-170"><a href="#DynamixelHelloXL430-170"><span class="linenos"> 170</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_ping</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-171"><a href="#DynamixelHelloXL430-171"><span class="linenos"> 171</span></a>
</span><span id="DynamixelHelloXL430-172"><a href="#DynamixelHelloXL430-172"><span class="linenos"> 172</span></a>    <span class="k">def</span> <span class="nf">check_servo_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-173"><a href="#DynamixelHelloXL430-173"><span class="linenos"> 173</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-174"><a href="#DynamixelHelloXL430-174"><span class="linenos"> 174</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;WARNING: Servo </span><span class="si">%s</span><span class="s1"> in error state: overload_error. Reboot servo with stretch_robot_dynamixel_reboot.py&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="DynamixelHelloXL430-175"><a href="#DynamixelHelloXL430-175"><span class="linenos"> 175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-176"><a href="#DynamixelHelloXL430-176"><span class="linenos"> 176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-177"><a href="#DynamixelHelloXL430-177"><span class="linenos"> 177</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-178"><a href="#DynamixelHelloXL430-178"><span class="linenos"> 178</span></a>
</span><span id="DynamixelHelloXL430-179"><a href="#DynamixelHelloXL430-179"><span class="linenos"> 179</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-180"><a href="#DynamixelHelloXL430-180"><span class="linenos"> 180</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;WARNING: Servo </span><span class="si">%s</span><span class="s1"> in error state: overheating_error. Reboot servo with stretch_robot_dynamixel_reboot.py&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="DynamixelHelloXL430-181"><a href="#DynamixelHelloXL430-181"><span class="linenos"> 181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-182"><a href="#DynamixelHelloXL430-182"><span class="linenos"> 182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430-183"><a href="#DynamixelHelloXL430-183"><span class="linenos"> 183</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-184"><a href="#DynamixelHelloXL430-184"><span class="linenos"> 184</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-185"><a href="#DynamixelHelloXL430-185"><span class="linenos"> 185</span></a>
</span><span id="DynamixelHelloXL430-186"><a href="#DynamixelHelloXL430-186"><span class="linenos"> 186</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-187"><a href="#DynamixelHelloXL430-187"><span class="linenos"> 187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-188"><a href="#DynamixelHelloXL430-188"><span class="linenos"> 188</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-189"><a href="#DynamixelHelloXL430-189"><span class="linenos"> 189</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-190"><a href="#DynamixelHelloXL430-190"><span class="linenos"> 190</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-191"><a href="#DynamixelHelloXL430-191"><span class="linenos"> 191</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_ping</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-192"><a href="#DynamixelHelloXL430-192"><span class="linenos"> 192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-193"><a href="#DynamixelHelloXL430-193"><span class="linenos"> 193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-194"><a href="#DynamixelHelloXL430-194"><span class="linenos"> 194</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-195"><a href="#DynamixelHelloXL430-195"><span class="linenos"> 195</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-196"><a href="#DynamixelHelloXL430-196"><span class="linenos"> 196</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-197"><a href="#DynamixelHelloXL430-197"><span class="linenos"> 197</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_multiturn</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-198"><a href="#DynamixelHelloXL430-198"><span class="linenos"> 198</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-199"><a href="#DynamixelHelloXL430-199"><span class="linenos"> 199</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-200"><a href="#DynamixelHelloXL430-200"><span class="linenos"> 200</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">4095</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-201"><a href="#DynamixelHelloXL430-201"><span class="linenos"> 201</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Warning: Invalid position range for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-202"><a href="#DynamixelHelloXL430-202"><span class="linenos"> 202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_pwm_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-203"><a href="#DynamixelHelloXL430-203"><span class="linenos"> 203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_temperature_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;temperature_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-204"><a href="#DynamixelHelloXL430-204"><span class="linenos"> 204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_min_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_voltage_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-205"><a href="#DynamixelHelloXL430-205"><span class="linenos"> 205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_max_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_voltage_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-206"><a href="#DynamixelHelloXL430-206"><span class="linenos"> 206</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_P_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-207"><a href="#DynamixelHelloXL430-207"><span class="linenos"> 207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_I_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-208"><a href="#DynamixelHelloXL430-208"><span class="linenos"> 208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_D_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-209"><a href="#DynamixelHelloXL430-209"><span class="linenos"> 209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_return_delay_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;return_delay_time&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-210"><a href="#DynamixelHelloXL430-210"><span class="linenos"> 210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">()</span> <span class="c1">#Initialize servo motion profile with default values</span>
</span><span id="DynamixelHelloXL430-211"><a href="#DynamixelHelloXL430-211"><span class="linenos"> 211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-212"><a href="#DynamixelHelloXL430-212"><span class="linenos"> 212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-213"><a href="#DynamixelHelloXL430-213"><span class="linenos"> 213</span></a>
</span><span id="DynamixelHelloXL430-214"><a href="#DynamixelHelloXL430-214"><span class="linenos"> 214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-215"><a href="#DynamixelHelloXL430-215"><span class="linenos"> 215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">check_homing_offset</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-216"><a href="#DynamixelHelloXL430-216"><span class="linenos"> 216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-217"><a href="#DynamixelHelloXL430-217"><span class="linenos"> 217</span></a>                <span class="c1">#Pull 3 times given mux / init the status dict</span>
</span><span id="DynamixelHelloXL430-218"><a href="#DynamixelHelloXL430-218"><span class="linenos"> 218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-219"><a href="#DynamixelHelloXL430-219"><span class="linenos"> 219</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-220"><a href="#DynamixelHelloXL430-220"><span class="linenos"> 220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-221"><a href="#DynamixelHelloXL430-221"><span class="linenos"> 221</span></a>
</span><span id="DynamixelHelloXL430-222"><a href="#DynamixelHelloXL430-222"><span class="linenos"> 222</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-223"><a href="#DynamixelHelloXL430-223"><span class="linenos"> 223</span></a>
</span><span id="DynamixelHelloXL430-224"><a href="#DynamixelHelloXL430-224"><span class="linenos"> 224</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-225"><a href="#DynamixelHelloXL430-225"><span class="linenos"> 225</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-226"><a href="#DynamixelHelloXL430-226"><span class="linenos"> 226</span></a>
</span><span id="DynamixelHelloXL430-227"><a href="#DynamixelHelloXL430-227"><span class="linenos"> 227</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-228"><a href="#DynamixelHelloXL430-228"><span class="linenos"> 228</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-229"><a href="#DynamixelHelloXL430-229"><span class="linenos"> 229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed... </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-230"><a href="#DynamixelHelloXL430-230"><span class="linenos"> 230</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-231"><a href="#DynamixelHelloXL430-231"><span class="linenos"> 231</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-232"><a href="#DynamixelHelloXL430-232"><span class="linenos"> 232</span></a>        <span class="k">except</span> <span class="n">DynamixelCommError</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-233"><a href="#DynamixelHelloXL430-233"><span class="linenos"> 233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed... </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-234"><a href="#DynamixelHelloXL430-234"><span class="linenos"> 234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-235"><a href="#DynamixelHelloXL430-235"><span class="linenos"> 235</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-236"><a href="#DynamixelHelloXL430-236"><span class="linenos"> 236</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-237"><a href="#DynamixelHelloXL430-237"><span class="linenos"> 237</span></a>
</span><span id="DynamixelHelloXL430-238"><a href="#DynamixelHelloXL430-238"><span class="linenos"> 238</span></a>    <span class="k">def</span> <span class="nf">_thread_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-239"><a href="#DynamixelHelloXL430-239"><span class="linenos"> 239</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-240"><a href="#DynamixelHelloXL430-240"><span class="linenos"> 240</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_trajectory</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-241"><a href="#DynamixelHelloXL430-241"><span class="linenos"> 241</span></a>
</span><span id="DynamixelHelloXL430-242"><a href="#DynamixelHelloXL430-242"><span class="linenos"> 242</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-243"><a href="#DynamixelHelloXL430-243"><span class="linenos"> 243</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-244"><a href="#DynamixelHelloXL430-244"><span class="linenos"> 244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-245"><a href="#DynamixelHelloXL430-245"><span class="linenos"> 245</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-246"><a href="#DynamixelHelloXL430-246"><span class="linenos"> 246</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;disable_torque_on_stop&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-247"><a href="#DynamixelHelloXL430-247"><span class="linenos"> 247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-248"><a href="#DynamixelHelloXL430-248"><span class="linenos"> 248</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-249"><a href="#DynamixelHelloXL430-249"><span class="linenos"> 249</span></a>
</span><span id="DynamixelHelloXL430-250"><a href="#DynamixelHelloXL430-250"><span class="linenos"> 250</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-251"><a href="#DynamixelHelloXL430-251"><span class="linenos"> 251</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-252"><a href="#DynamixelHelloXL430-252"><span class="linenos"> 252</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-253"><a href="#DynamixelHelloXL430-253"><span class="linenos"> 253</span></a>
</span><span id="DynamixelHelloXL430-254"><a href="#DynamixelHelloXL430-254"><span class="linenos"> 254</span></a>        <span class="n">pos_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-255"><a href="#DynamixelHelloXL430-255"><span class="linenos"> 255</span></a>        <span class="n">vel_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-256"><a href="#DynamixelHelloXL430-256"><span class="linenos"> 256</span></a>        <span class="n">eff_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-257"><a href="#DynamixelHelloXL430-257"><span class="linenos"> 257</span></a>        <span class="n">temp_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-258"><a href="#DynamixelHelloXL430-258"><span class="linenos"> 258</span></a>        <span class="n">err_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-259"><a href="#DynamixelHelloXL430-259"><span class="linenos"> 259</span></a>
</span><span id="DynamixelHelloXL430-260"><a href="#DynamixelHelloXL430-260"><span class="linenos"> 260</span></a>        <span class="c1">#First pull new data from servo</span>
</span><span id="DynamixelHelloXL430-261"><a href="#DynamixelHelloXL430-261"><span class="linenos"> 261</span></a>        <span class="c1">#Or bring in data from a synchronized read</span>
</span><span id="DynamixelHelloXL430-262"><a href="#DynamixelHelloXL430-262"><span class="linenos"> 262</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-263"><a href="#DynamixelHelloXL430-263"><span class="linenos"> 263</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-264"><a href="#DynamixelHelloXL430-264"><span class="linenos"> 264</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-265"><a href="#DynamixelHelloXL430-265"><span class="linenos"> 265</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-266"><a href="#DynamixelHelloXL430-266"><span class="linenos"> 266</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-267"><a href="#DynamixelHelloXL430-267"><span class="linenos"> 267</span></a>                <span class="n">pos_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430-268"><a href="#DynamixelHelloXL430-268"><span class="linenos"> 268</span></a>
</span><span id="DynamixelHelloXL430-269"><a href="#DynamixelHelloXL430-269"><span class="linenos"> 269</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-270"><a href="#DynamixelHelloXL430-270"><span class="linenos"> 270</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-271"><a href="#DynamixelHelloXL430-271"><span class="linenos"> 271</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-272"><a href="#DynamixelHelloXL430-272"><span class="linenos"> 272</span></a>                <span class="n">vel_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430-273"><a href="#DynamixelHelloXL430-273"><span class="linenos"> 273</span></a>
</span><span id="DynamixelHelloXL430-274"><a href="#DynamixelHelloXL430-274"><span class="linenos"> 274</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-275"><a href="#DynamixelHelloXL430-275"><span class="linenos"> 275</span></a>                    <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_load</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-276"><a href="#DynamixelHelloXL430-276"><span class="linenos"> 276</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-277"><a href="#DynamixelHelloXL430-277"><span class="linenos"> 277</span></a>                        <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_load</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-278"><a href="#DynamixelHelloXL430-278"><span class="linenos"> 278</span></a>                    <span class="n">eff_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430-279"><a href="#DynamixelHelloXL430-279"><span class="linenos"> 279</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-280"><a href="#DynamixelHelloXL430-280"><span class="linenos"> 280</span></a>                    <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-281"><a href="#DynamixelHelloXL430-281"><span class="linenos"> 281</span></a>
</span><span id="DynamixelHelloXL430-282"><a href="#DynamixelHelloXL430-282"><span class="linenos"> 282</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-283"><a href="#DynamixelHelloXL430-283"><span class="linenos"> 283</span></a>                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_temp</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-284"><a href="#DynamixelHelloXL430-284"><span class="linenos"> 284</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-285"><a href="#DynamixelHelloXL430-285"><span class="linenos"> 285</span></a>                        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_temp</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-286"><a href="#DynamixelHelloXL430-286"><span class="linenos"> 286</span></a>                    <span class="n">temp_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430-287"><a href="#DynamixelHelloXL430-287"><span class="linenos"> 287</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-288"><a href="#DynamixelHelloXL430-288"><span class="linenos"> 288</span></a>                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-289"><a href="#DynamixelHelloXL430-289"><span class="linenos"> 289</span></a>
</span><span id="DynamixelHelloXL430-290"><a href="#DynamixelHelloXL430-290"><span class="linenos"> 290</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-291"><a href="#DynamixelHelloXL430-291"><span class="linenos"> 291</span></a>                    <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_hardware_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-292"><a href="#DynamixelHelloXL430-292"><span class="linenos"> 292</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-293"><a href="#DynamixelHelloXL430-293"><span class="linenos"> 293</span></a>                        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_hardware_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-294"><a href="#DynamixelHelloXL430-294"><span class="linenos"> 294</span></a>                    <span class="n">err_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430-295"><a href="#DynamixelHelloXL430-295"><span class="linenos"> 295</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-296"><a href="#DynamixelHelloXL430-296"><span class="linenos"> 296</span></a>                    <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-297"><a href="#DynamixelHelloXL430-297"><span class="linenos"> 297</span></a>
</span><span id="DynamixelHelloXL430-298"><a href="#DynamixelHelloXL430-298"><span class="linenos"> 298</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="DynamixelHelloXL430-299"><a href="#DynamixelHelloXL430-299"><span class="linenos"> 299</span></a>
</span><span id="DynamixelHelloXL430-300"><a href="#DynamixelHelloXL430-300"><span class="linenos"> 300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-301"><a href="#DynamixelHelloXL430-301"><span class="linenos"> 301</span></a>
</span><span id="DynamixelHelloXL430-302"><a href="#DynamixelHelloXL430-302"><span class="linenos"> 302</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pos_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">vel_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">eff_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">temp_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">err_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-303"><a href="#DynamixelHelloXL430-303"><span class="linenos"> 303</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during pull_status on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-304"><a href="#DynamixelHelloXL430-304"><span class="linenos"> 304</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-305"><a href="#DynamixelHelloXL430-305"><span class="linenos"> 305</span></a>                    <span class="k">return</span>
</span><span id="DynamixelHelloXL430-306"><a href="#DynamixelHelloXL430-306"><span class="linenos"> 306</span></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-307"><a href="#DynamixelHelloXL430-307"><span class="linenos"> 307</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-308"><a href="#DynamixelHelloXL430-308"><span class="linenos"> 308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during pull_status  on </span><span class="si">%s</span><span class="s1">: &#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-309"><a href="#DynamixelHelloXL430-309"><span class="linenos"> 309</span></a>                <span class="c1"># self.motor.port_handler.ser.reset_output_buffer()</span>
</span><span id="DynamixelHelloXL430-310"><a href="#DynamixelHelloXL430-310"><span class="linenos"> 310</span></a>                <span class="c1"># self.motor.port_handler.ser.reset_input_buffer()</span>
</span><span id="DynamixelHelloXL430-311"><a href="#DynamixelHelloXL430-311"><span class="linenos"> 311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-312"><a href="#DynamixelHelloXL430-312"><span class="linenos"> 312</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-313"><a href="#DynamixelHelloXL430-313"><span class="linenos"> 313</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-314"><a href="#DynamixelHelloXL430-314"><span class="linenos"> 314</span></a>                <span class="k">return</span>
</span><span id="DynamixelHelloXL430-315"><a href="#DynamixelHelloXL430-315"><span class="linenos"> 315</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-316"><a href="#DynamixelHelloXL430-316"><span class="linenos"> 316</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-317"><a href="#DynamixelHelloXL430-317"><span class="linenos"> 317</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-318"><a href="#DynamixelHelloXL430-318"><span class="linenos"> 318</span></a>            <span class="n">eff</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;eff&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-319"><a href="#DynamixelHelloXL430-319"><span class="linenos"> 319</span></a>            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-320"><a href="#DynamixelHelloXL430-320"><span class="linenos"> 320</span></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-321"><a href="#DynamixelHelloXL430-321"><span class="linenos"> 321</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-322"><a href="#DynamixelHelloXL430-322"><span class="linenos"> 322</span></a>
</span><span id="DynamixelHelloXL430-323"><a href="#DynamixelHelloXL430-323"><span class="linenos"> 323</span></a>        <span class="c1">#Now update status dictionary</span>
</span><span id="DynamixelHelloXL430-324"><a href="#DynamixelHelloXL430-324"><span class="linenos"> 324</span></a>        <span class="k">if</span> <span class="n">pos_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-325"><a href="#DynamixelHelloXL430-325"><span class="linenos"> 325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="DynamixelHelloXL430-326"><a href="#DynamixelHelloXL430-326"><span class="linenos"> 326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-327"><a href="#DynamixelHelloXL430-327"><span class="linenos"> 327</span></a>        <span class="k">if</span> <span class="n">vel_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-328"><a href="#DynamixelHelloXL430-328"><span class="linenos"> 328</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="DynamixelHelloXL430-329"><a href="#DynamixelHelloXL430-329"><span class="linenos"> 329</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad_per_sec</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-330"><a href="#DynamixelHelloXL430-330"><span class="linenos"> 330</span></a>        <span class="k">if</span> <span class="n">eff_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-331"><a href="#DynamixelHelloXL430-331"><span class="linenos"> 331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eff</span>
</span><span id="DynamixelHelloXL430-332"><a href="#DynamixelHelloXL430-332"><span class="linenos"> 332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_pct_load</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">eff</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-333"><a href="#DynamixelHelloXL430-333"><span class="linenos"> 333</span></a>        <span class="k">if</span> <span class="n">temp_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-334"><a href="#DynamixelHelloXL430-334"><span class="linenos"> 334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-335"><a href="#DynamixelHelloXL430-335"><span class="linenos"> 335</span></a>        <span class="k">if</span> <span class="n">err_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-336"><a href="#DynamixelHelloXL430-336"><span class="linenos"> 336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="DynamixelHelloXL430-337"><a href="#DynamixelHelloXL430-337"><span class="linenos"> 337</span></a>
</span><span id="DynamixelHelloXL430-338"><a href="#DynamixelHelloXL430-338"><span class="linenos"> 338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
</span><span id="DynamixelHelloXL430-339"><a href="#DynamixelHelloXL430-339"><span class="linenos"> 339</span></a>
</span><span id="DynamixelHelloXL430-340"><a href="#DynamixelHelloXL430-340"><span class="linenos"> 340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="DynamixelHelloXL430-341"><a href="#DynamixelHelloXL430-341"><span class="linenos"> 341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;input_voltage_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-342"><a href="#DynamixelHelloXL430-342"><span class="linenos"> 342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-343"><a href="#DynamixelHelloXL430-343"><span class="linenos"> 343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-344"><a href="#DynamixelHelloXL430-344"><span class="linenos"> 344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">16</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-345"><a href="#DynamixelHelloXL430-345"><span class="linenos"> 345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">32</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-346"><a href="#DynamixelHelloXL430-346"><span class="linenos"> 346</span></a>
</span><span id="DynamixelHelloXL430-347"><a href="#DynamixelHelloXL430-347"><span class="linenos"> 347</span></a>        <span class="c1">#Finally flag if stalled at high effort for too long</span>
</span><span id="DynamixelHelloXL430-348"><a href="#DynamixelHelloXL430-348"><span class="linenos"> 348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_min_vel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-349"><a href="#DynamixelHelloXL430-349"><span class="linenos"> 349</span></a>        <span class="n">over_eff</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_max_effort&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-350"><a href="#DynamixelHelloXL430-350"><span class="linenos"> 350</span></a>
</span><span id="DynamixelHelloXL430-351"><a href="#DynamixelHelloXL430-351"><span class="linenos"> 351</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-352"><a href="#DynamixelHelloXL430-352"><span class="linenos"> 352</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">over_eff</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-353"><a href="#DynamixelHelloXL430-353"><span class="linenos"> 353</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-354"><a href="#DynamixelHelloXL430-354"><span class="linenos"> 354</span></a>            <span class="k">if</span> <span class="n">over_eff</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#Mark the start of being stalled and over-effort</span>
</span><span id="DynamixelHelloXL430-355"><a href="#DynamixelHelloXL430-355"><span class="linenos"> 355</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-356"><a href="#DynamixelHelloXL430-356"><span class="linenos"> 356</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_max_time&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-357"><a href="#DynamixelHelloXL430-357"><span class="linenos"> 357</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-358"><a href="#DynamixelHelloXL430-358"><span class="linenos"> 358</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-359"><a href="#DynamixelHelloXL430-359"><span class="linenos"> 359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-360"><a href="#DynamixelHelloXL430-360"><span class="linenos"> 360</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-361"><a href="#DynamixelHelloXL430-361"><span class="linenos"> 361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelHelloXL430-362"><a href="#DynamixelHelloXL430-362"><span class="linenos"> 362</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-363"><a href="#DynamixelHelloXL430-363"><span class="linenos"> 363</span></a>
</span><span id="DynamixelHelloXL430-364"><a href="#DynamixelHelloXL430-364"><span class="linenos"> 364</span></a>    <span class="k">def</span> <span class="nf">mark_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-365"><a href="#DynamixelHelloXL430-365"><span class="linenos"> 365</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-366"><a href="#DynamixelHelloXL430-366"><span class="linenos"> 366</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-367"><a href="#DynamixelHelloXL430-367"><span class="linenos"> 367</span></a>        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-368"><a href="#DynamixelHelloXL430-368"><span class="linenos"> 368</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Marking current position of (ticks)&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39; as 0 (rad)&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-369"><a href="#DynamixelHelloXL430-369"><span class="linenos"> 369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="DynamixelHelloXL430-370"><a href="#DynamixelHelloXL430-370"><span class="linenos"> 370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_device_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-371"><a href="#DynamixelHelloXL430-371"><span class="linenos"> 371</span></a>
</span><span id="DynamixelHelloXL430-372"><a href="#DynamixelHelloXL430-372"><span class="linenos"> 372</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-373"><a href="#DynamixelHelloXL430-373"><span class="linenos"> 373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Polls for moving status to wait until at commanded position goal</span>
</span><span id="DynamixelHelloXL430-374"><a href="#DynamixelHelloXL430-374"><span class="linenos"> 374</span></a>
</span><span id="DynamixelHelloXL430-375"><a href="#DynamixelHelloXL430-375"><span class="linenos"> 375</span></a><span class="sd">        Returns</span>
</span><span id="DynamixelHelloXL430-376"><a href="#DynamixelHelloXL430-376"><span class="linenos"> 376</span></a><span class="sd">        -------</span>
</span><span id="DynamixelHelloXL430-377"><a href="#DynamixelHelloXL430-377"><span class="linenos"> 377</span></a><span class="sd">        bool</span>
</span><span id="DynamixelHelloXL430-378"><a href="#DynamixelHelloXL430-378"><span class="linenos"> 378</span></a><span class="sd">            True if success, False if timeout</span>
</span><span id="DynamixelHelloXL430-379"><a href="#DynamixelHelloXL430-379"><span class="linenos"> 379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-380"><a href="#DynamixelHelloXL430-380"><span class="linenos"> 380</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-381"><a href="#DynamixelHelloXL430-381"><span class="linenos"> 381</span></a>        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-382"><a href="#DynamixelHelloXL430-382"><span class="linenos"> 382</span></a>            <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_moving_status</span><span class="p">()</span><span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-383"><a href="#DynamixelHelloXL430-383"><span class="linenos"> 383</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-384"><a href="#DynamixelHelloXL430-384"><span class="linenos"> 384</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-385"><a href="#DynamixelHelloXL430-385"><span class="linenos"> 385</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-386"><a href="#DynamixelHelloXL430-386"><span class="linenos"> 386</span></a>
</span><span id="DynamixelHelloXL430-387"><a href="#DynamixelHelloXL430-387"><span class="linenos"> 387</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-388"><a href="#DynamixelHelloXL430-388"><span class="linenos"> 388</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-389"><a href="#DynamixelHelloXL430-389"><span class="linenos"> 389</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- HelloXL430 ------ &#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-390"><a href="#DynamixelHelloXL430-390"><span class="linenos"> 390</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Servo not on bus&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-391"><a href="#DynamixelHelloXL430-391"><span class="linenos"> 391</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-392"><a href="#DynamixelHelloXL430-392"><span class="linenos"> 392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- HelloXL430 ------ &#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-393"><a href="#DynamixelHelloXL430-393"><span class="linenos"> 393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-394"><a href="#DynamixelHelloXL430-394"><span class="linenos"> 394</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-395"><a href="#DynamixelHelloXL430-395"><span class="linenos"> 395</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-396"><a href="#DynamixelHelloXL430-396"><span class="linenos"> 396</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-397"><a href="#DynamixelHelloXL430-397"><span class="linenos"> 397</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-398"><a href="#DynamixelHelloXL430-398"><span class="linenos"> 398</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity (ticks/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-399"><a href="#DynamixelHelloXL430-399"><span class="linenos"> 399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (%)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-400"><a href="#DynamixelHelloXL430-400"><span class="linenos"> 400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-401"><a href="#DynamixelHelloXL430-401"><span class="linenos"> 401</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-402"><a href="#DynamixelHelloXL430-402"><span class="linenos"> 402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comm Errors&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">comm_errors</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-403"><a href="#DynamixelHelloXL430-403"><span class="linenos"> 403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-404"><a href="#DynamixelHelloXL430-404"><span class="linenos"> 404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Input Voltage Error: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;input_voltage_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-405"><a href="#DynamixelHelloXL430-405"><span class="linenos"> 405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Overheating Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-406"><a href="#DynamixelHelloXL430-406"><span class="linenos"> 406</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Motor Encoder Error: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-407"><a href="#DynamixelHelloXL430-407"><span class="linenos"> 407</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Electrical Shock Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-408"><a href="#DynamixelHelloXL430-408"><span class="linenos"> 408</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Overload Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-409"><a href="#DynamixelHelloXL430-409"><span class="linenos"> 409</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Watchdog Errors: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-410"><a href="#DynamixelHelloXL430-410"><span class="linenos"> 410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp PC&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-411"><a href="#DynamixelHelloXL430-411"><span class="linenos"> 411</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range (ticks)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-412"><a href="#DynamixelHelloXL430-412"><span class="linenos"> 412</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range (rad) [&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; , &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-413"><a href="#DynamixelHelloXL430-413"><span class="linenos"> 413</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stalled&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-414"><a href="#DynamixelHelloXL430-414"><span class="linenos"> 414</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stall Overload&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-415"><a href="#DynamixelHelloXL430-415"><span class="linenos"> 415</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Is Calibrated&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-416"><a href="#DynamixelHelloXL430-416"><span class="linenos"> 416</span></a>        <span class="c1">#self.motor.pretty_print()</span>
</span><span id="DynamixelHelloXL430-417"><a href="#DynamixelHelloXL430-417"><span class="linenos"> 417</span></a>
</span><span id="DynamixelHelloXL430-418"><a href="#DynamixelHelloXL430-418"><span class="linenos"> 418</span></a>    <span class="k">def</span> <span class="nf">bound_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-419"><a href="#DynamixelHelloXL430-419"><span class="linenos"> 419</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-420"><a href="#DynamixelHelloXL430-420"><span class="linenos"> 420</span></a>            <span class="k">return</span> <span class="n">lower_bound</span>
</span><span id="DynamixelHelloXL430-421"><a href="#DynamixelHelloXL430-421"><span class="linenos"> 421</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-422"><a href="#DynamixelHelloXL430-422"><span class="linenos"> 422</span></a>            <span class="k">return</span> <span class="n">upper_bound</span>
</span><span id="DynamixelHelloXL430-423"><a href="#DynamixelHelloXL430-423"><span class="linenos"> 423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-424"><a href="#DynamixelHelloXL430-424"><span class="linenos"> 424</span></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="DynamixelHelloXL430-425"><a href="#DynamixelHelloXL430-425"><span class="linenos"> 425</span></a>
</span><span id="DynamixelHelloXL430-426"><a href="#DynamixelHelloXL430-426"><span class="linenos"> 426</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-427"><a href="#DynamixelHelloXL430-427"><span class="linenos"> 427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;dynamixel_stop_on_runstop&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-428"><a href="#DynamixelHelloXL430-428"><span class="linenos"> 428</span></a>            <span class="n">is_runstopped</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_event&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-429"><a href="#DynamixelHelloXL430-429"><span class="linenos"> 429</span></a>            <span class="k">if</span> <span class="n">is_runstopped</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-430"><a href="#DynamixelHelloXL430-430"><span class="linenos"> 430</span></a>                <span class="k">if</span> <span class="n">is_runstopped</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-431"><a href="#DynamixelHelloXL430-431"><span class="linenos"> 431</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-432"><a href="#DynamixelHelloXL430-432"><span class="linenos"> 432</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-433"><a href="#DynamixelHelloXL430-433"><span class="linenos"> 433</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-434"><a href="#DynamixelHelloXL430-434"><span class="linenos"> 434</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-435"><a href="#DynamixelHelloXL430-435"><span class="linenos"> 435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span> <span class="o">=</span> <span class="n">is_runstopped</span>
</span><span id="DynamixelHelloXL430-436"><a href="#DynamixelHelloXL430-436"><span class="linenos"> 436</span></a>        
</span><span id="DynamixelHelloXL430-437"><a href="#DynamixelHelloXL430-437"><span class="linenos"> 437</span></a>        <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dist_to_limits</span><span class="p">()</span> <span class="c1"># calculate dist to min,max limits</span>
</span><span id="DynamixelHelloXL430-438"><a href="#DynamixelHelloXL430-438"><span class="linenos"> 438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-439"><a href="#DynamixelHelloXL430-439"><span class="linenos"> 439</span></a>
</span><span id="DynamixelHelloXL430-440"><a href="#DynamixelHelloXL430-440"><span class="linenos"> 440</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-441"><a href="#DynamixelHelloXL430-441"><span class="linenos"> 441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In Vel-Braking Zone.&quot;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-442"><a href="#DynamixelHelloXL430-442"><span class="linenos"> 442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-443"><a href="#DynamixelHelloXL430-443"><span class="linenos"> 443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-444"><a href="#DynamixelHelloXL430-444"><span class="linenos"> 444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-445"><a href="#DynamixelHelloXL430-445"><span class="linenos"> 445</span></a>
</span><span id="DynamixelHelloXL430-446"><a href="#DynamixelHelloXL430-446"><span class="linenos"> 446</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-447"><a href="#DynamixelHelloXL430-447"><span class="linenos"> 447</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-448"><a href="#DynamixelHelloXL430-448"><span class="linenos"> 448</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-449"><a href="#DynamixelHelloXL430-449"><span class="linenos"> 449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-450"><a href="#DynamixelHelloXL430-450"><span class="linenos"> 450</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-451"><a href="#DynamixelHelloXL430-451"><span class="linenos"> 451</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-452"><a href="#DynamixelHelloXL430-452"><span class="linenos"> 452</span></a>            
</span><span id="DynamixelHelloXL430-453"><a href="#DynamixelHelloXL430-453"><span class="linenos"> 453</span></a>            <span class="c1"># disable watchdog if a set_velocity() command is not passed above 1s</span>
</span><span id="DynamixelHelloXL430-454"><a href="#DynamixelHelloXL430-454"><span class="linenos"> 454</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-455"><a href="#DynamixelHelloXL430-455"><span class="linenos"> 455</span></a>                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-456"><a href="#DynamixelHelloXL430-456"><span class="linenos"> 456</span></a>                    <span class="n">wd_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-457"><a href="#DynamixelHelloXL430-457"><span class="linenos"> 457</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-458"><a href="#DynamixelHelloXL430-458"><span class="linenos"> 458</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-459"><a href="#DynamixelHelloXL430-459"><span class="linenos"> 459</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-460"><a href="#DynamixelHelloXL430-460"><span class="linenos"> 460</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-461"><a href="#DynamixelHelloXL430-461"><span class="linenos"> 461</span></a>                    <span class="k">if</span> <span class="n">wd_error</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-462"><a href="#DynamixelHelloXL430-462"><span class="linenos"> 462</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Watchdog error during Velocity control for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-463"><a href="#DynamixelHelloXL430-463"><span class="linenos"> 463</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
</span><span id="DynamixelHelloXL430-464"><a href="#DynamixelHelloXL430-464"><span class="linenos"> 464</span></a>
</span><span id="DynamixelHelloXL430-465"><a href="#DynamixelHelloXL430-465"><span class="linenos"> 465</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_safety_vel_brake_zone</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-466"><a href="#DynamixelHelloXL430-466"><span class="linenos"> 466</span></a>    
</span><span id="DynamixelHelloXL430-467"><a href="#DynamixelHelloXL430-467"><span class="linenos"> 467</span></a>    <span class="k">def</span> <span class="nf">_update_safety_vel_brake_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-468"><a href="#DynamixelHelloXL430-468"><span class="linenos"> 468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-469"><a href="#DynamixelHelloXL430-469"><span class="linenos"> 469</span></a><span class="sd">        dynamically update the braking zone thresh based on it is propotional nature to the </span>
</span><span id="DynamixelHelloXL430-470"><a href="#DynamixelHelloXL430-470"><span class="linenos"> 470</span></a><span class="sd">        current velocity and the inverse of distance left to reach the nearest hardstop.</span>
</span><span id="DynamixelHelloXL430-471"><a href="#DynamixelHelloXL430-471"><span class="linenos"> 471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-472"><a href="#DynamixelHelloXL430-472"><span class="linenos"> 472</span></a>        <span class="n">delta1</span><span class="p">,</span><span class="n">delta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> 
</span><span id="DynamixelHelloXL430-473"><a href="#DynamixelHelloXL430-473"><span class="linenos"> 473</span></a>        <span class="n">distance_to_limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">delta1</span><span class="p">,</span><span class="n">delta2</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-474"><a href="#DynamixelHelloXL430-474"><span class="linenos"> 474</span></a>        <span class="n">brake_zone_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel_brakezone_factor&#39;</span><span class="p">]</span> <span class="c1"># Propotional value, for now value 1 seems to work fine with all Dxl joints</span>
</span><span id="DynamixelHelloXL430-475"><a href="#DynamixelHelloXL430-475"><span class="linenos"> 475</span></a>        <span class="k">if</span> <span class="n">distance_to_limit</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-476"><a href="#DynamixelHelloXL430-476"><span class="linenos"> 476</span></a>            <span class="n">brake_zone_thresh</span> <span class="o">=</span> <span class="n">brake_zone_factor</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">distance_to_limit</span>
</span><span id="DynamixelHelloXL430-477"><a href="#DynamixelHelloXL430-477"><span class="linenos"> 477</span></a>            <span class="n">brake_zone_thresh</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">bound_value</span><span class="p">(</span><span class="n">brake_zone_thresh</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">total_range</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-478"><a href="#DynamixelHelloXL430-478"><span class="linenos"> 478</span></a>            <span class="n">brake_zone_thresh</span> <span class="o">=</span> <span class="n">brake_zone_thresh</span> <span class="o">+</span> <span class="mf">0.6</span> <span class="c1">#0.6 rad is minimum brake zone thresh  </span>
</span><span id="DynamixelHelloXL430-479"><a href="#DynamixelHelloXL430-479"><span class="linenos"> 479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vel_brake_thresh</span><span class="p">(</span><span class="n">brake_zone_thresh</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-480"><a href="#DynamixelHelloXL430-480"><span class="linenos"> 480</span></a>
</span><span id="DynamixelHelloXL430-481"><a href="#DynamixelHelloXL430-481"><span class="linenos"> 481</span></a>    <span class="k">def</span> <span class="nf">_set_vel_brake_thresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresh</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-482"><a href="#DynamixelHelloXL430-482"><span class="linenos"> 482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="o">=</span> <span class="n">thresh</span>
</span><span id="DynamixelHelloXL430-483"><a href="#DynamixelHelloXL430-483"><span class="linenos"> 483</span></a>
</span><span id="DynamixelHelloXL430-484"><a href="#DynamixelHelloXL430-484"><span class="linenos"> 484</span></a>    <span class="k">def</span> <span class="nf">get_dist_to_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-485"><a href="#DynamixelHelloXL430-485"><span class="linenos"> 485</span></a>        <span class="n">current_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-486"><a href="#DynamixelHelloXL430-486"><span class="linenos"> 486</span></a>        <span class="n">min_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-487"><a href="#DynamixelHelloXL430-487"><span class="linenos"> 487</span></a>        <span class="n">max_position</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-488"><a href="#DynamixelHelloXL430-488"><span class="linenos"> 488</span></a>        <span class="n">delta1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">min_position</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-489"><a href="#DynamixelHelloXL430-489"><span class="linenos"> 489</span></a>        <span class="n">delta2</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">max_position</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-490"><a href="#DynamixelHelloXL430-490"><span class="linenos"> 490</span></a>        
</span><span id="DynamixelHelloXL430-491"><a href="#DynamixelHelloXL430-491"><span class="linenos"> 491</span></a>        <span class="k">if</span> <span class="n">delta2</span><span class="o">&lt;</span><span class="n">threshold</span> <span class="ow">or</span> <span class="n">delta1</span><span class="o">&lt;</span><span class="n">threshold</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-492"><a href="#DynamixelHelloXL430-492"><span class="linenos"> 492</span></a>            <span class="k">return</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span>
</span><span id="DynamixelHelloXL430-493"><a href="#DynamixelHelloXL430-493"><span class="linenos"> 493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-494"><a href="#DynamixelHelloXL430-494"><span class="linenos"> 494</span></a>            <span class="k">return</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span>
</span><span id="DynamixelHelloXL430-495"><a href="#DynamixelHelloXL430-495"><span class="linenos"> 495</span></a>
</span><span id="DynamixelHelloXL430-496"><a href="#DynamixelHelloXL430-496"><span class="linenos"> 496</span></a>    <span class="c1"># #####################################</span>
</span><span id="DynamixelHelloXL430-497"><a href="#DynamixelHelloXL430-497"><span class="linenos"> 497</span></a>
</span><span id="DynamixelHelloXL430-498"><a href="#DynamixelHelloXL430-498"><span class="linenos"> 498</span></a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-499"><a href="#DynamixelHelloXL430-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-500"><a href="#DynamixelHelloXL430-500"><span class="linenos"> 500</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-501"><a href="#DynamixelHelloXL430-501"><span class="linenos"> 501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_reboot</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-502"><a href="#DynamixelHelloXL430-502"><span class="linenos"> 502</span></a>
</span><span id="DynamixelHelloXL430-503"><a href="#DynamixelHelloXL430-503"><span class="linenos"> 503</span></a>    <span class="k">def</span> <span class="nf">enable_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-504"><a href="#DynamixelHelloXL430-504"><span class="linenos"> 504</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-505"><a href="#DynamixelHelloXL430-505"><span class="linenos"> 505</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-506"><a href="#DynamixelHelloXL430-506"><span class="linenos"> 506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-507"><a href="#DynamixelHelloXL430-507"><span class="linenos"> 507</span></a>
</span><span id="DynamixelHelloXL430-508"><a href="#DynamixelHelloXL430-508"><span class="linenos"> 508</span></a>    <span class="k">def</span> <span class="nf">disable_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-509"><a href="#DynamixelHelloXL430-509"><span class="linenos"> 509</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-510"><a href="#DynamixelHelloXL430-510"><span class="linenos"> 510</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-511"><a href="#DynamixelHelloXL430-511"><span class="linenos"> 511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-512"><a href="#DynamixelHelloXL430-512"><span class="linenos"> 512</span></a>
</span><span id="DynamixelHelloXL430-513"><a href="#DynamixelHelloXL430-513"><span class="linenos"> 513</span></a>    <span class="k">def</span> <span class="nf">move_to_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-514"><a href="#DynamixelHelloXL430-514"><span class="linenos"> 514</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DynamixelHelloXL430-515"><a href="#DynamixelHelloXL430-515"><span class="linenos"> 515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-516"><a href="#DynamixelHelloXL430-516"><span class="linenos"> 516</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-517"><a href="#DynamixelHelloXL430-517"><span class="linenos"> 517</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-518"><a href="#DynamixelHelloXL430-518"><span class="linenos"> 518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-519"><a href="#DynamixelHelloXL430-519"><span class="linenos"> 519</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-520"><a href="#DynamixelHelloXL430-520"><span class="linenos"> 520</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-521"><a href="#DynamixelHelloXL430-521"><span class="linenos"> 521</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-522"><a href="#DynamixelHelloXL430-522"><span class="linenos"> 522</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-523"><a href="#DynamixelHelloXL430-523"><span class="linenos"> 523</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-524"><a href="#DynamixelHelloXL430-524"><span class="linenos"> 524</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-525"><a href="#DynamixelHelloXL430-525"><span class="linenos"> 525</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-526"><a href="#DynamixelHelloXL430-526"><span class="linenos"> 526</span></a>                <span class="k">break</span>
</span><span id="DynamixelHelloXL430-527"><a href="#DynamixelHelloXL430-527"><span class="linenos"> 527</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-528"><a href="#DynamixelHelloXL430-528"><span class="linenos"> 528</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to_vel on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-529"><a href="#DynamixelHelloXL430-529"><span class="linenos"> 529</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-530"><a href="#DynamixelHelloXL430-530"><span class="linenos"> 530</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-531"><a href="#DynamixelHelloXL430-531"><span class="linenos"> 531</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-532"><a href="#DynamixelHelloXL430-532"><span class="linenos"> 532</span></a>
</span><span id="DynamixelHelloXL430-533"><a href="#DynamixelHelloXL430-533"><span class="linenos"> 533</span></a>    <span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-534"><a href="#DynamixelHelloXL430-534"><span class="linenos"> 534</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_des</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-535"><a href="#DynamixelHelloXL430-535"><span class="linenos"> 535</span></a>        <span class="n">v_des</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">v</span> <span class="k">if</span> <span class="n">v_des</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">v</span>
</span><span id="DynamixelHelloXL430-536"><a href="#DynamixelHelloXL430-536"><span class="linenos"> 536</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DynamixelHelloXL430-537"><a href="#DynamixelHelloXL430-537"><span class="linenos"> 537</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-538"><a href="#DynamixelHelloXL430-538"><span class="linenos"> 538</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-539"><a href="#DynamixelHelloXL430-539"><span class="linenos"> 539</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-540"><a href="#DynamixelHelloXL430-540"><span class="linenos"> 540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-541"><a href="#DynamixelHelloXL430-541"><span class="linenos"> 541</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-542"><a href="#DynamixelHelloXL430-542"><span class="linenos"> 542</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-543"><a href="#DynamixelHelloXL430-543"><span class="linenos"> 543</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-544"><a href="#DynamixelHelloXL430-544"><span class="linenos"> 544</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_operating_mode</span><span class="p">()</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-545"><a href="#DynamixelHelloXL430-545"><span class="linenos"> 545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_velocity_ctrl</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-546"><a href="#DynamixelHelloXL430-546"><span class="linenos"> 546</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-547"><a href="#DynamixelHelloXL430-547"><span class="linenos"> 547</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-548"><a href="#DynamixelHelloXL430-548"><span class="linenos"> 548</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;set_safe_velocity&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span><span class="p">:</span> <span class="c1"># only when sentry is active</span>
</span><span id="DynamixelHelloXL430-549"><a href="#DynamixelHelloXL430-549"><span class="linenos"> 549</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_step_vel_braking</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-550"><a href="#DynamixelHelloXL430-550"><span class="linenos"> 550</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-551"><a href="#DynamixelHelloXL430-551"><span class="linenos"> 551</span></a>                    <span class="n">t_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-552"><a href="#DynamixelHelloXL430-552"><span class="linenos"> 552</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">t_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-553"><a href="#DynamixelHelloXL430-553"><span class="linenos"> 553</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-554"><a href="#DynamixelHelloXL430-554"><span class="linenos"> 554</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-555"><a href="#DynamixelHelloXL430-555"><span class="linenos"> 555</span></a>                <span class="k">break</span>
</span><span id="DynamixelHelloXL430-556"><a href="#DynamixelHelloXL430-556"><span class="linenos"> 556</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-557"><a href="#DynamixelHelloXL430-557"><span class="linenos"> 557</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to_vel on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-558"><a href="#DynamixelHelloXL430-558"><span class="linenos"> 558</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-559"><a href="#DynamixelHelloXL430-559"><span class="linenos"> 559</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-560"><a href="#DynamixelHelloXL430-560"><span class="linenos"> 560</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-561"><a href="#DynamixelHelloXL430-561"><span class="linenos"> 561</span></a>    
</span><span id="DynamixelHelloXL430-562"><a href="#DynamixelHelloXL430-562"><span class="linenos"> 562</span></a>    <span class="k">def</span> <span class="nf">_step_vel_braking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_des</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-563"><a href="#DynamixelHelloXL430-563"><span class="linenos"> 563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-564"><a href="#DynamixelHelloXL430-564"><span class="linenos"> 564</span></a><span class="sd">        In velocity mode while using set_velocity() command, when the joint is in a braking zone,</span>
</span><span id="DynamixelHelloXL430-565"><a href="#DynamixelHelloXL430-565"><span class="linenos"> 565</span></a><span class="sd">        the input velocities are tapered till the joint limits  to zero and smoothly braked at the limits to </span>
</span><span id="DynamixelHelloXL430-566"><a href="#DynamixelHelloXL430-566"><span class="linenos"> 566</span></a><span class="sd">        avoid hitting the hardstops.</span>
</span><span id="DynamixelHelloXL430-567"><a href="#DynamixelHelloXL430-567"><span class="linenos"> 567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-568"><a href="#DynamixelHelloXL430-568"><span class="linenos"> 568</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-569"><a href="#DynamixelHelloXL430-569"><span class="linenos"> 569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-570"><a href="#DynamixelHelloXL430-570"><span class="linenos"> 570</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span><span class="p">:</span> <span class="c1"># Braking control syncs with the pull status&#39;s freaquency for accurate motion control</span>
</span><span id="DynamixelHelloXL430-571"><a href="#DynamixelHelloXL430-571"><span class="linenos"> 571</span></a>            <span class="c1"># Honor joint limits in velocity mode</span>
</span><span id="DynamixelHelloXL430-572"><a href="#DynamixelHelloXL430-572"><span class="linenos"> 572</span></a>            <span class="n">lim_lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="DynamixelHelloXL430-573"><a href="#DynamixelHelloXL430-573"><span class="linenos"> 573</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-574"><a href="#DynamixelHelloXL430-574"><span class="linenos"> 574</span></a>            <span class="n">lim_upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="DynamixelHelloXL430-575"><a href="#DynamixelHelloXL430-575"><span class="linenos"> 575</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-576"><a href="#DynamixelHelloXL430-576"><span class="linenos"> 576</span></a>            
</span><span id="DynamixelHelloXL430-577"><a href="#DynamixelHelloXL430-577"><span class="linenos"> 577</span></a>            <span class="n">v_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-578"><a href="#DynamixelHelloXL430-578"><span class="linenos"> 578</span></a>            <span class="n">x_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-579"><a href="#DynamixelHelloXL430-579"><span class="linenos"> 579</span></a>
</span><span id="DynamixelHelloXL430-580"><a href="#DynamixelHelloXL430-580"><span class="linenos"> 580</span></a>            <span class="n">to_min</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_curr</span> <span class="o">-</span> <span class="n">lim_lower</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-581"><a href="#DynamixelHelloXL430-581"><span class="linenos"> 581</span></a>            <span class="n">to_max</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_curr</span> <span class="o">-</span> <span class="n">lim_upper</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-582"><a href="#DynamixelHelloXL430-582"><span class="linenos"> 582</span></a>
</span><span id="DynamixelHelloXL430-583"><a href="#DynamixelHelloXL430-583"><span class="linenos"> 583</span></a>            <span class="n">c1</span> <span class="o">=</span> <span class="n">to_min</span><span class="o">&lt;</span><span class="n">to_max</span> <span class="ow">and</span> <span class="n">v_des</span><span class="o">&gt;</span><span class="mi">0</span> <span class="c1"># if v_des -ve</span>
</span><span id="DynamixelHelloXL430-584"><a href="#DynamixelHelloXL430-584"><span class="linenos"> 584</span></a>            <span class="n">c2</span> <span class="o">=</span> <span class="n">to_min</span><span class="o">&gt;</span><span class="n">to_max</span> <span class="ow">and</span> <span class="n">v_des</span><span class="o">&lt;</span><span class="mi">0</span> <span class="c1"># if v_des +ve</span>
</span><span id="DynamixelHelloXL430-585"><a href="#DynamixelHelloXL430-585"><span class="linenos"> 585</span></a>            <span class="n">opp_vel</span> <span class="o">=</span> <span class="n">c1</span> <span class="ow">or</span> <span class="n">c2</span> 
</span><span id="DynamixelHelloXL430-586"><a href="#DynamixelHelloXL430-586"><span class="linenos"> 586</span></a>
</span><span id="DynamixelHelloXL430-587"><a href="#DynamixelHelloXL430-587"><span class="linenos"> 587</span></a>            <span class="n">t_brake</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span> <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>  <span class="c1"># How long to brake from current speed (s)</span>
</span><span id="DynamixelHelloXL430-588"><a href="#DynamixelHelloXL430-588"><span class="linenos"> 588</span></a>            <span class="n">d_brake</span> <span class="o">=</span> <span class="n">t_brake</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># How far it will go before breaking (pos/neg)</span>
</span><span id="DynamixelHelloXL430-589"><a href="#DynamixelHelloXL430-589"><span class="linenos"> 589</span></a>            <span class="n">d_brake</span> <span class="o">=</span> <span class="n">d_brake</span><span class="o">+</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span> <span class="c1">#Pad out by 5 degrees to give a bit of safety margin</span>
</span><span id="DynamixelHelloXL430-590"><a href="#DynamixelHelloXL430-590"><span class="linenos"> 590</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-591"><a href="#DynamixelHelloXL430-591"><span class="linenos"> 591</span></a>            <span class="k">if</span> <span class="n">opp_vel</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-592"><a href="#DynamixelHelloXL430-592"><span class="linenos"> 592</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">v_des</span> <span class="c1"># allow input velocity if direction is opposite to nearest limit</span>
</span><span id="DynamixelHelloXL430-593"><a href="#DynamixelHelloXL430-593"><span class="linenos"> 593</span></a>            <span class="k">elif</span> <span class="p">(</span><span class="n">v_des</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">+</span> <span class="n">d_brake</span> <span class="o">&gt;=</span> <span class="n">lim_upper</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">v_des</span> <span class="o">&lt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">d_brake</span> <span class="o">&lt;=</span> <span class="n">lim_lower</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">to_max</span><span class="p">,</span><span class="n">to_max</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-594"><a href="#DynamixelHelloXL430-594"><span class="linenos"> 594</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># apply brakes if the braking distance is &gt;= limits</span>
</span><span id="DynamixelHelloXL430-595"><a href="#DynamixelHelloXL430-595"><span class="linenos"> 595</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-596"><a href="#DynamixelHelloXL430-596"><span class="linenos"> 596</span></a>                <span class="n">taper</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">to_max</span><span class="p">,</span><span class="n">to_min</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="c1"># normalized (0~1) distance to limits</span>
</span><span id="DynamixelHelloXL430-597"><a href="#DynamixelHelloXL430-597"><span class="linenos"> 597</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">v_des</span><span class="o">*</span><span class="n">taper</span> <span class="c1"># apply tapered velocity inside braking zone</span>
</span><span id="DynamixelHelloXL430-598"><a href="#DynamixelHelloXL430-598"><span class="linenos"> 598</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applied safety brakes near limits. reduced set_vel=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> rad/s&quot;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-599"><a href="#DynamixelHelloXL430-599"><span class="linenos"> 599</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-600"><a href="#DynamixelHelloXL430-600"><span class="linenos"> 600</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-601"><a href="#DynamixelHelloXL430-601"><span class="linenos"> 601</span></a>
</span><span id="DynamixelHelloXL430-602"><a href="#DynamixelHelloXL430-602"><span class="linenos"> 602</span></a>    <span class="k">def</span> <span class="nf">enable_velocity_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-603"><a href="#DynamixelHelloXL430-603"><span class="linenos"> 603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-604"><a href="#DynamixelHelloXL430-604"><span class="linenos"> 604</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-605"><a href="#DynamixelHelloXL430-605"><span class="linenos"> 605</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-606"><a href="#DynamixelHelloXL430-606"><span class="linenos"> 606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-607"><a href="#DynamixelHelloXL430-607"><span class="linenos"> 607</span></a>
</span><span id="DynamixelHelloXL430-608"><a href="#DynamixelHelloXL430-608"><span class="linenos"> 608</span></a>    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-609"><a href="#DynamixelHelloXL430-609"><span class="linenos"> 609</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DynamixelHelloXL430-610"><a href="#DynamixelHelloXL430-610"><span class="linenos"> 610</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-611"><a href="#DynamixelHelloXL430-611"><span class="linenos"> 611</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-612"><a href="#DynamixelHelloXL430-612"><span class="linenos"> 612</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-613"><a href="#DynamixelHelloXL430-613"><span class="linenos"> 613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-614"><a href="#DynamixelHelloXL430-614"><span class="linenos"> 614</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-615"><a href="#DynamixelHelloXL430-615"><span class="linenos"> 615</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-616"><a href="#DynamixelHelloXL430-616"><span class="linenos"> 616</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-617"><a href="#DynamixelHelloXL430-617"><span class="linenos"> 617</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-618"><a href="#DynamixelHelloXL430-618"><span class="linenos"> 618</span></a>        <span class="c1">#print(&#39;Motion Params&#39;,v_des,a_des)</span>
</span><span id="DynamixelHelloXL430-619"><a href="#DynamixelHelloXL430-619"><span class="linenos"> 619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-620"><a href="#DynamixelHelloXL430-620"><span class="linenos"> 620</span></a>        <span class="n">old_x_des</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="DynamixelHelloXL430-621"><a href="#DynamixelHelloXL430-621"><span class="linenos"> 621</span></a>        <span class="n">x_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_des</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-622"><a href="#DynamixelHelloXL430-622"><span class="linenos"> 622</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="o">!=</span> <span class="n">old_x_des</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-623"><a href="#DynamixelHelloXL430-623"><span class="linenos"> 623</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Clipping move_to(</span><span class="si">{0}</span><span class="s1">) with soft limits </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_x_des</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-624"><a href="#DynamixelHelloXL430-624"><span class="linenos"> 624</span></a>        <span class="n">t_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks</span><span class="p">(</span><span class="n">x_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-625"><a href="#DynamixelHelloXL430-625"><span class="linenos"> 625</span></a>        <span class="n">t_des</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t_des</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-626"><a href="#DynamixelHelloXL430-626"><span class="linenos"> 626</span></a>        <span class="n">success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-627"><a href="#DynamixelHelloXL430-627"><span class="linenos"> 627</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-628"><a href="#DynamixelHelloXL430-628"><span class="linenos"> 628</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-629"><a href="#DynamixelHelloXL430-629"><span class="linenos"> 629</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">go_to_pos</span><span class="p">(</span><span class="n">t_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-630"><a href="#DynamixelHelloXL430-630"><span class="linenos"> 630</span></a>                <span class="n">success</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430-631"><a href="#DynamixelHelloXL430-631"><span class="linenos"> 631</span></a>                <span class="k">break</span>
</span><span id="DynamixelHelloXL430-632"><a href="#DynamixelHelloXL430-632"><span class="linenos"> 632</span></a>            <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-633"><a href="#DynamixelHelloXL430-633"><span class="linenos"> 633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-634"><a href="#DynamixelHelloXL430-634"><span class="linenos"> 634</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-635"><a href="#DynamixelHelloXL430-635"><span class="linenos"> 635</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-636"><a href="#DynamixelHelloXL430-636"><span class="linenos"> 636</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-637"><a href="#DynamixelHelloXL430-637"><span class="linenos"> 637</span></a>
</span><span id="DynamixelHelloXL430-638"><a href="#DynamixelHelloXL430-638"><span class="linenos"> 638</span></a>    <span class="k">def</span> <span class="nf">set_motion_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-639"><a href="#DynamixelHelloXL430-639"><span class="linenos"> 639</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-640"><a href="#DynamixelHelloXL430-640"><span class="linenos"> 640</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-641"><a href="#DynamixelHelloXL430-641"><span class="linenos"> 641</span></a>                <span class="k">return</span>
</span><span id="DynamixelHelloXL430-642"><a href="#DynamixelHelloXL430-642"><span class="linenos"> 642</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span> <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-643"><a href="#DynamixelHelloXL430-643"><span class="linenos"> 643</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-644"><a href="#DynamixelHelloXL430-644"><span class="linenos"> 644</span></a>            <span class="k">if</span> <span class="n">v_des</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-645"><a href="#DynamixelHelloXL430-645"><span class="linenos"> 645</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_velocity</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v_des</span><span class="p">)))</span>
</span><span id="DynamixelHelloXL430-646"><a href="#DynamixelHelloXL430-646"><span class="linenos"> 646</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="DynamixelHelloXL430-647"><a href="#DynamixelHelloXL430-647"><span class="linenos"> 647</span></a>
</span><span id="DynamixelHelloXL430-648"><a href="#DynamixelHelloXL430-648"><span class="linenos"> 648</span></a>            <span class="n">a_des</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_des</span><span class="p">)</span> <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-649"><a href="#DynamixelHelloXL430-649"><span class="linenos"> 649</span></a>            <span class="n">a_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">],</span> <span class="n">a_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-650"><a href="#DynamixelHelloXL430-650"><span class="linenos"> 650</span></a>            <span class="k">if</span> <span class="n">a_des</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-651"><a href="#DynamixelHelloXL430-651"><span class="linenos"> 651</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_acceleration</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="n">a_des</span><span class="p">)))</span>
</span><span id="DynamixelHelloXL430-652"><a href="#DynamixelHelloXL430-652"><span class="linenos"> 652</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="DynamixelHelloXL430-653"><a href="#DynamixelHelloXL430-653"><span class="linenos"> 653</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-654"><a href="#DynamixelHelloXL430-654"><span class="linenos"> 654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during set_motion_params on: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-655"><a href="#DynamixelHelloXL430-655"><span class="linenos"> 655</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-656"><a href="#DynamixelHelloXL430-656"><span class="linenos"> 656</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-657"><a href="#DynamixelHelloXL430-657"><span class="linenos"> 657</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-658"><a href="#DynamixelHelloXL430-658"><span class="linenos"> 658</span></a>
</span><span id="DynamixelHelloXL430-659"><a href="#DynamixelHelloXL430-659"><span class="linenos"> 659</span></a>
</span><span id="DynamixelHelloXL430-660"><a href="#DynamixelHelloXL430-660"><span class="linenos"> 660</span></a>    <span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-661"><a href="#DynamixelHelloXL430-661"><span class="linenos"> 661</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-662"><a href="#DynamixelHelloXL430-662"><span class="linenos"> 662</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-663"><a href="#DynamixelHelloXL430-663"><span class="linenos"> 663</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-664"><a href="#DynamixelHelloXL430-664"><span class="linenos"> 664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-665"><a href="#DynamixelHelloXL430-665"><span class="linenos"> 665</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-666"><a href="#DynamixelHelloXL430-666"><span class="linenos"> 666</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_des</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.00002</span><span class="p">:</span> <span class="c1">#Avoid drift</span>
</span><span id="DynamixelHelloXL430-667"><a href="#DynamixelHelloXL430-667"><span class="linenos"> 667</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-668"><a href="#DynamixelHelloXL430-668"><span class="linenos"> 668</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-669"><a href="#DynamixelHelloXL430-669"><span class="linenos"> 669</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-670"><a href="#DynamixelHelloXL430-670"><span class="linenos"> 670</span></a>
</span><span id="DynamixelHelloXL430-671"><a href="#DynamixelHelloXL430-671"><span class="linenos"> 671</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-672"><a href="#DynamixelHelloXL430-672"><span class="linenos"> 672</span></a>                    <span class="n">cx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-673"><a href="#DynamixelHelloXL430-673"><span class="linenos"> 673</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="p">,</span> <span class="n">a_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-674"><a href="#DynamixelHelloXL430-674"><span class="linenos"> 674</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-675"><a href="#DynamixelHelloXL430-675"><span class="linenos"> 675</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Move_By comm failure on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-676"><a href="#DynamixelHelloXL430-676"><span class="linenos"> 676</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-677"><a href="#DynamixelHelloXL430-677"><span class="linenos"> 677</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_by on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-678"><a href="#DynamixelHelloXL430-678"><span class="linenos"> 678</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-679"><a href="#DynamixelHelloXL430-679"><span class="linenos"> 679</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-680"><a href="#DynamixelHelloXL430-680"><span class="linenos"> 680</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-681"><a href="#DynamixelHelloXL430-681"><span class="linenos"> 681</span></a>
</span><span id="DynamixelHelloXL430-682"><a href="#DynamixelHelloXL430-682"><span class="linenos"> 682</span></a>    <span class="k">def</span> <span class="nf">quick_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-683"><a href="#DynamixelHelloXL430-683"><span class="linenos"> 683</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-684"><a href="#DynamixelHelloXL430-684"><span class="linenos"> 684</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-685"><a href="#DynamixelHelloXL430-685"><span class="linenos"> 685</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-686"><a href="#DynamixelHelloXL430-686"><span class="linenos"> 686</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-687"><a href="#DynamixelHelloXL430-687"><span class="linenos"> 687</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-688"><a href="#DynamixelHelloXL430-688"><span class="linenos"> 688</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-689"><a href="#DynamixelHelloXL430-689"><span class="linenos"> 689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during quick_stop on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-690"><a href="#DynamixelHelloXL430-690"><span class="linenos"> 690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-691"><a href="#DynamixelHelloXL430-691"><span class="linenos"> 691</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-692"><a href="#DynamixelHelloXL430-692"><span class="linenos"> 692</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-693"><a href="#DynamixelHelloXL430-693"><span class="linenos"> 693</span></a>
</span><span id="DynamixelHelloXL430-694"><a href="#DynamixelHelloXL430-694"><span class="linenos"> 694</span></a>    <span class="k">def</span> <span class="nf">enable_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-695"><a href="#DynamixelHelloXL430-695"><span class="linenos"> 695</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-696"><a href="#DynamixelHelloXL430-696"><span class="linenos"> 696</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-697"><a href="#DynamixelHelloXL430-697"><span class="linenos"> 697</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-698"><a href="#DynamixelHelloXL430-698"><span class="linenos"> 698</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-699"><a href="#DynamixelHelloXL430-699"><span class="linenos"> 699</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-700"><a href="#DynamixelHelloXL430-700"><span class="linenos"> 700</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_multiturn</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-701"><a href="#DynamixelHelloXL430-701"><span class="linenos"> 701</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-702"><a href="#DynamixelHelloXL430-702"><span class="linenos"> 702</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-703"><a href="#DynamixelHelloXL430-703"><span class="linenos"> 703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-704"><a href="#DynamixelHelloXL430-704"><span class="linenos"> 704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-705"><a href="#DynamixelHelloXL430-705"><span class="linenos"> 705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-706"><a href="#DynamixelHelloXL430-706"><span class="linenos"> 706</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-707"><a href="#DynamixelHelloXL430-707"><span class="linenos"> 707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during enable_pos on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-708"><a href="#DynamixelHelloXL430-708"><span class="linenos"> 708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-709"><a href="#DynamixelHelloXL430-709"><span class="linenos"> 709</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-710"><a href="#DynamixelHelloXL430-710"><span class="linenos"> 710</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-711"><a href="#DynamixelHelloXL430-711"><span class="linenos"> 711</span></a>
</span><span id="DynamixelHelloXL430-712"><a href="#DynamixelHelloXL430-712"><span class="linenos"> 712</span></a>    <span class="k">def</span> <span class="nf">enable_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-713"><a href="#DynamixelHelloXL430-713"><span class="linenos"> 713</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-714"><a href="#DynamixelHelloXL430-714"><span class="linenos"> 714</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-715"><a href="#DynamixelHelloXL430-715"><span class="linenos"> 715</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-716"><a href="#DynamixelHelloXL430-716"><span class="linenos"> 716</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-717"><a href="#DynamixelHelloXL430-717"><span class="linenos"> 717</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-718"><a href="#DynamixelHelloXL430-718"><span class="linenos"> 718</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-719"><a href="#DynamixelHelloXL430-719"><span class="linenos"> 719</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-720"><a href="#DynamixelHelloXL430-720"><span class="linenos"> 720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during enable_pwm on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-721"><a href="#DynamixelHelloXL430-721"><span class="linenos"> 721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-722"><a href="#DynamixelHelloXL430-722"><span class="linenos"> 722</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-723"><a href="#DynamixelHelloXL430-723"><span class="linenos"> 723</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-724"><a href="#DynamixelHelloXL430-724"><span class="linenos"> 724</span></a>
</span><span id="DynamixelHelloXL430-725"><a href="#DynamixelHelloXL430-725"><span class="linenos"> 725</span></a>
</span><span id="DynamixelHelloXL430-726"><a href="#DynamixelHelloXL430-726"><span class="linenos"> 726</span></a>    <span class="k">def</span> <span class="nf">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-727"><a href="#DynamixelHelloXL430-727"><span class="linenos"> 727</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-728"><a href="#DynamixelHelloXL430-728"><span class="linenos"> 728</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-729"><a href="#DynamixelHelloXL430-729"><span class="linenos"> 729</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-730"><a href="#DynamixelHelloXL430-730"><span class="linenos"> 730</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-731"><a href="#DynamixelHelloXL430-731"><span class="linenos"> 731</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-732"><a href="#DynamixelHelloXL430-732"><span class="linenos"> 732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during set_pwm on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-733"><a href="#DynamixelHelloXL430-733"><span class="linenos"> 733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-734"><a href="#DynamixelHelloXL430-734"><span class="linenos"> 734</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-735"><a href="#DynamixelHelloXL430-735"><span class="linenos"> 735</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430-736"><a href="#DynamixelHelloXL430-736"><span class="linenos"> 736</span></a>
</span><span id="DynamixelHelloXL430-737"><a href="#DynamixelHelloXL430-737"><span class="linenos"> 737</span></a>    <span class="c1"># ######### Waypoint Trajectory Interface ##############################</span>
</span><span id="DynamixelHelloXL430-738"><a href="#DynamixelHelloXL430-738"><span class="linenos"> 738</span></a>
</span><span id="DynamixelHelloXL430-739"><a href="#DynamixelHelloXL430-739"><span class="linenos"> 739</span></a>    <span class="k">def</span> <span class="nf">is_trajectory_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-740"><a href="#DynamixelHelloXL430-740"><span class="linenos"> 740</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">!=</span><span class="kc">None</span>
</span><span id="DynamixelHelloXL430-741"><a href="#DynamixelHelloXL430-741"><span class="linenos"> 741</span></a>
</span><span id="DynamixelHelloXL430-742"><a href="#DynamixelHelloXL430-742"><span class="linenos"> 742</span></a>    <span class="k">def</span> <span class="nf">get_trajectory_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-743"><a href="#DynamixelHelloXL430-743"><span class="linenos"> 743</span></a>        <span class="c1">#Return trajectory execution time</span>
</span><span id="DynamixelHelloXL430-744"><a href="#DynamixelHelloXL430-744"><span class="linenos"> 744</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-745"><a href="#DynamixelHelloXL430-745"><span class="linenos"> 745</span></a>            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span>
</span><span id="DynamixelHelloXL430-746"><a href="#DynamixelHelloXL430-746"><span class="linenos"> 746</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-747"><a href="#DynamixelHelloXL430-747"><span class="linenos"> 747</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="DynamixelHelloXL430-748"><a href="#DynamixelHelloXL430-748"><span class="linenos"> 748</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-749"><a href="#DynamixelHelloXL430-749"><span class="linenos"> 749</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-750"><a href="#DynamixelHelloXL430-750"><span class="linenos"> 750</span></a>
</span><span id="DynamixelHelloXL430-751"><a href="#DynamixelHelloXL430-751"><span class="linenos"> 751</span></a>    <span class="k">def</span> <span class="nf">get_trajectory_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-752"><a href="#DynamixelHelloXL430-752"><span class="linenos"> 752</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-753"><a href="#DynamixelHelloXL430-753"><span class="linenos"> 753</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-754"><a href="#DynamixelHelloXL430-754"><span class="linenos"> 754</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-755"><a href="#DynamixelHelloXL430-755"><span class="linenos"> 755</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_ts</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430-756"><a href="#DynamixelHelloXL430-756"><span class="linenos"> 756</span></a>
</span><span id="DynamixelHelloXL430-757"><a href="#DynamixelHelloXL430-757"><span class="linenos"> 757</span></a>    <span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">req_calibration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-758"><a href="#DynamixelHelloXL430-758"><span class="linenos"> 758</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts executing a waypoint trajectory</span>
</span><span id="DynamixelHelloXL430-759"><a href="#DynamixelHelloXL430-759"><span class="linenos"> 759</span></a>
</span><span id="DynamixelHelloXL430-760"><a href="#DynamixelHelloXL430-760"><span class="linenos"> 760</span></a><span class="sd">        `self.trajectory` must be populated with a valid trajectory before calling</span>
</span><span id="DynamixelHelloXL430-761"><a href="#DynamixelHelloXL430-761"><span class="linenos"> 761</span></a><span class="sd">        this method.</span>
</span><span id="DynamixelHelloXL430-762"><a href="#DynamixelHelloXL430-762"><span class="linenos"> 762</span></a>
</span><span id="DynamixelHelloXL430-763"><a href="#DynamixelHelloXL430-763"><span class="linenos"> 763</span></a><span class="sd">        Parameters</span>
</span><span id="DynamixelHelloXL430-764"><a href="#DynamixelHelloXL430-764"><span class="linenos"> 764</span></a><span class="sd">        ----------</span>
</span><span id="DynamixelHelloXL430-765"><a href="#DynamixelHelloXL430-765"><span class="linenos"> 765</span></a><span class="sd">        v_r : float</span>
</span><span id="DynamixelHelloXL430-766"><a href="#DynamixelHelloXL430-766"><span class="linenos"> 766</span></a><span class="sd">            velocity limit for trajectory in radians per second</span>
</span><span id="DynamixelHelloXL430-767"><a href="#DynamixelHelloXL430-767"><span class="linenos"> 767</span></a><span class="sd">        a_r : float</span>
</span><span id="DynamixelHelloXL430-768"><a href="#DynamixelHelloXL430-768"><span class="linenos"> 768</span></a><span class="sd">            acceleration limit for trajectory in radians per second squared</span>
</span><span id="DynamixelHelloXL430-769"><a href="#DynamixelHelloXL430-769"><span class="linenos"> 769</span></a><span class="sd">        req_calibration : bool</span>
</span><span id="DynamixelHelloXL430-770"><a href="#DynamixelHelloXL430-770"><span class="linenos"> 770</span></a><span class="sd">            whether to allow motion prior to homing</span>
</span><span id="DynamixelHelloXL430-771"><a href="#DynamixelHelloXL430-771"><span class="linenos"> 771</span></a><span class="sd">        move_to_start_point : bool</span>
</span><span id="DynamixelHelloXL430-772"><a href="#DynamixelHelloXL430-772"><span class="linenos"> 772</span></a><span class="sd">            whether to move to the trajectory&#39;s start to avoid a jump, this</span>
</span><span id="DynamixelHelloXL430-773"><a href="#DynamixelHelloXL430-773"><span class="linenos"> 773</span></a><span class="sd">            time to move doesn&#39;t count against the trajectory&#39;s timeline</span>
</span><span id="DynamixelHelloXL430-774"><a href="#DynamixelHelloXL430-774"><span class="linenos"> 774</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-775"><a href="#DynamixelHelloXL430-775"><span class="linenos"> 775</span></a>        <span class="c1"># check if joint valid, homed, and previous trajectory not executing</span>
</span><span id="DynamixelHelloXL430-776"><a href="#DynamixelHelloXL430-776"><span class="linenos"> 776</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-777"><a href="#DynamixelHelloXL430-777"><span class="linenos"> 777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel connection to hardware not valid&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-778"><a href="#DynamixelHelloXL430-778"><span class="linenos"> 778</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-779"><a href="#DynamixelHelloXL430-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="n">req_calibration</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-780"><a href="#DynamixelHelloXL430-780"><span class="linenos"> 780</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-781"><a href="#DynamixelHelloXL430-781"><span class="linenos"> 781</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not homed&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-782"><a href="#DynamixelHelloXL430-782"><span class="linenos"> 782</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-783"><a href="#DynamixelHelloXL430-783"><span class="linenos"> 783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-784"><a href="#DynamixelHelloXL430-784"><span class="linenos"> 784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Dynamixel waypoint trajectory already active&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-785"><a href="#DynamixelHelloXL430-785"><span class="linenos"> 785</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-786"><a href="#DynamixelHelloXL430-786"><span class="linenos"> 786</span></a>
</span><span id="DynamixelHelloXL430-787"><a href="#DynamixelHelloXL430-787"><span class="linenos"> 787</span></a>        <span class="c1">#Store current vel/accel so can restore later</span>
</span><span id="DynamixelHelloXL430-788"><a href="#DynamixelHelloXL430-788"><span class="linenos"> 788</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v_des</span>
</span><span id="DynamixelHelloXL430-789"><a href="#DynamixelHelloXL430-789"><span class="linenos"> 789</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_des</span>
</span><span id="DynamixelHelloXL430-790"><a href="#DynamixelHelloXL430-790"><span class="linenos"> 790</span></a>
</span><span id="DynamixelHelloXL430-791"><a href="#DynamixelHelloXL430-791"><span class="linenos"> 791</span></a>        <span class="c1"># check if trajectory valid</span>
</span><span id="DynamixelHelloXL430-792"><a href="#DynamixelHelloXL430-792"><span class="linenos"> 792</span></a>        <span class="n">vel_limit</span> <span class="o">=</span> <span class="n">v_r</span> <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-793"><a href="#DynamixelHelloXL430-793"><span class="linenos"> 793</span></a>        <span class="n">acc_limit</span> <span class="o">=</span> <span class="n">a_r</span> <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-794"><a href="#DynamixelHelloXL430-794"><span class="linenos"> 794</span></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">vel_limit</span><span class="p">,</span> <span class="n">acc_limit</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-795"><a href="#DynamixelHelloXL430-795"><span class="linenos"> 795</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-796"><a href="#DynamixelHelloXL430-796"><span class="linenos"> 796</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel trajectory not valid: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reason</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-797"><a href="#DynamixelHelloXL430-797"><span class="linenos"> 797</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-798"><a href="#DynamixelHelloXL430-798"><span class="linenos"> 798</span></a>        <span class="k">if</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">reason</span> <span class="o">==</span> <span class="s2">&quot;must have at least two waypoints&quot;</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-799"><a href="#DynamixelHelloXL430-799"><span class="linenos"> 799</span></a>            <span class="c1">#self.logger.warning(&#39;Dynamixel trajectory not valid: {0}&#39;.format(reason))</span>
</span><span id="DynamixelHelloXL430-800"><a href="#DynamixelHelloXL430-800"><span class="linenos"> 800</span></a>            <span class="c1"># skip this device</span>
</span><span id="DynamixelHelloXL430-801"><a href="#DynamixelHelloXL430-801"><span class="linenos"> 801</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-802"><a href="#DynamixelHelloXL430-802"><span class="linenos"> 802</span></a>
</span><span id="DynamixelHelloXL430-803"><a href="#DynamixelHelloXL430-803"><span class="linenos"> 803</span></a>        <span class="c1"># set defaults</span>
</span><span id="DynamixelHelloXL430-804"><a href="#DynamixelHelloXL430-804"><span class="linenos"> 804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">])</span> \
</span><span id="DynamixelHelloXL430-805"><a href="#DynamixelHelloXL430-805"><span class="linenos"> 805</span></a>            <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-806"><a href="#DynamixelHelloXL430-806"><span class="linenos"> 806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">])</span> \
</span><span id="DynamixelHelloXL430-807"><a href="#DynamixelHelloXL430-807"><span class="linenos"> 807</span></a>            <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-808"><a href="#DynamixelHelloXL430-808"><span class="linenos"> 808</span></a>
</span><span id="DynamixelHelloXL430-809"><a href="#DynamixelHelloXL430-809"><span class="linenos"> 809</span></a>
</span><span id="DynamixelHelloXL430-810"><a href="#DynamixelHelloXL430-810"><span class="linenos"> 810</span></a>        <span class="c1"># move to start point</span>
</span><span id="DynamixelHelloXL430-811"><a href="#DynamixelHelloXL430-811"><span class="linenos"> 811</span></a>        <span class="k">if</span> <span class="n">move_to_start_point</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-812"><a href="#DynamixelHelloXL430-812"><span class="linenos"> 812</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-813"><a href="#DynamixelHelloXL430-813"><span class="linenos"> 813</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-814"><a href="#DynamixelHelloXL430-814"><span class="linenos"> 814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel unable to reach starting point&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-815"><a href="#DynamixelHelloXL430-815"><span class="linenos"> 815</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-816"><a href="#DynamixelHelloXL430-816"><span class="linenos"> 816</span></a>
</span><span id="DynamixelHelloXL430-817"><a href="#DynamixelHelloXL430-817"><span class="linenos"> 817</span></a>        <span class="c1"># start trajectory</span>
</span><span id="DynamixelHelloXL430-818"><a href="#DynamixelHelloXL430-818"><span class="linenos"> 818</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-819"><a href="#DynamixelHelloXL430-819"><span class="linenos"> 819</span></a>        <span class="n">p0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-820"><a href="#DynamixelHelloXL430-820"><span class="linenos"> 820</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-821"><a href="#DynamixelHelloXL430-821"><span class="linenos"> 821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-822"><a href="#DynamixelHelloXL430-822"><span class="linenos"> 822</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-823"><a href="#DynamixelHelloXL430-823"><span class="linenos"> 823</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_trajectory_vel_ctrl</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-824"><a href="#DynamixelHelloXL430-824"><span class="linenos"> 824</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-825"><a href="#DynamixelHelloXL430-825"><span class="linenos"> 825</span></a>
</span><span id="DynamixelHelloXL430-826"><a href="#DynamixelHelloXL430-826"><span class="linenos"> 826</span></a>    <span class="k">def</span> <span class="nf">update_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-827"><a href="#DynamixelHelloXL430-827"><span class="linenos"> 827</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates hardware with the next position goal of `self.trajectory`</span>
</span><span id="DynamixelHelloXL430-828"><a href="#DynamixelHelloXL430-828"><span class="linenos"> 828</span></a>
</span><span id="DynamixelHelloXL430-829"><a href="#DynamixelHelloXL430-829"><span class="linenos"> 829</span></a><span class="sd">        This method must be called frequently to enable complete trajectory execution</span>
</span><span id="DynamixelHelloXL430-830"><a href="#DynamixelHelloXL430-830"><span class="linenos"> 830</span></a><span class="sd">        and preemption of future segments. If used with `stretch_body.robot.Robot` or</span>
</span><span id="DynamixelHelloXL430-831"><a href="#DynamixelHelloXL430-831"><span class="linenos"> 831</span></a><span class="sd">        with `self.startup(threaded=True)`, a background thread is launched for this.</span>
</span><span id="DynamixelHelloXL430-832"><a href="#DynamixelHelloXL430-832"><span class="linenos"> 832</span></a><span class="sd">        Otherwise, the user must handle calling this method.</span>
</span><span id="DynamixelHelloXL430-833"><a href="#DynamixelHelloXL430-833"><span class="linenos"> 833</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-834"><a href="#DynamixelHelloXL430-834"><span class="linenos"> 834</span></a>        <span class="c1"># check if joint valid, previous trajectory not executing, and not runstopped</span>
</span><span id="DynamixelHelloXL430-835"><a href="#DynamixelHelloXL430-835"><span class="linenos"> 835</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-836"><a href="#DynamixelHelloXL430-836"><span class="linenos"> 836</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-837"><a href="#DynamixelHelloXL430-837"><span class="linenos"> 837</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-838"><a href="#DynamixelHelloXL430-838"><span class="linenos"> 838</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430-839"><a href="#DynamixelHelloXL430-839"><span class="linenos"> 839</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-840"><a href="#DynamixelHelloXL430-840"><span class="linenos"> 840</span></a>            <span class="n">p1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-841"><a href="#DynamixelHelloXL430-841"><span class="linenos"> 841</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-842"><a href="#DynamixelHelloXL430-842"><span class="linenos"> 842</span></a>                <span class="c1">#print(&#39;T %f p %f v %f a: %f&#39;%(time.time() - self._waypoint_ts,p1,v1,a1))</span>
</span><span id="DynamixelHelloXL430-843"><a href="#DynamixelHelloXL430-843"><span class="linenos"> 843</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step_trajectory_vel_ctrl</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">a1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-844"><a href="#DynamixelHelloXL430-844"><span class="linenos"> 844</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-845"><a href="#DynamixelHelloXL430-845"><span class="linenos"> 845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-846"><a href="#DynamixelHelloXL430-846"><span class="linenos"> 846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-847"><a href="#DynamixelHelloXL430-847"><span class="linenos"> 847</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_trajectory_vel_ctrl</span><span class="p">():</span> <span class="c1">#Turn off trajectory if hit a watchdog error during executiong</span>
</span><span id="DynamixelHelloXL430-848"><a href="#DynamixelHelloXL430-848"><span class="linenos"> 848</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-849"><a href="#DynamixelHelloXL430-849"><span class="linenos"> 849</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-850"><a href="#DynamixelHelloXL430-850"><span class="linenos"> 850</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-851"><a href="#DynamixelHelloXL430-851"><span class="linenos"> 851</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-852"><a href="#DynamixelHelloXL430-852"><span class="linenos"> 852</span></a>
</span><span id="DynamixelHelloXL430-853"><a href="#DynamixelHelloXL430-853"><span class="linenos"> 853</span></a>
</span><span id="DynamixelHelloXL430-854"><a href="#DynamixelHelloXL430-854"><span class="linenos"> 854</span></a>    <span class="k">def</span> <span class="nf">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-855"><a href="#DynamixelHelloXL430-855"><span class="linenos"> 855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop waypoint trajectory immediately and resets hardware</span>
</span><span id="DynamixelHelloXL430-856"><a href="#DynamixelHelloXL430-856"><span class="linenos"> 856</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-857"><a href="#DynamixelHelloXL430-857"><span class="linenos"> 857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-858"><a href="#DynamixelHelloXL430-858"><span class="linenos"> 858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-859"><a href="#DynamixelHelloXL430-859"><span class="linenos"> 859</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-860"><a href="#DynamixelHelloXL430-860"><span class="linenos"> 860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_trajectory_vel_ctrl</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-861"><a href="#DynamixelHelloXL430-861"><span class="linenos"> 861</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-862"><a href="#DynamixelHelloXL430-862"><span class="linenos"> 862</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-863"><a href="#DynamixelHelloXL430-863"><span class="linenos"> 863</span></a>
</span><span id="DynamixelHelloXL430-864"><a href="#DynamixelHelloXL430-864"><span class="linenos"> 864</span></a>    <span class="k">def</span> <span class="nf">_step_trajectory_vel_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span><span class="n">a1</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-865"><a href="#DynamixelHelloXL430-865"><span class="linenos"> 865</span></a>        <span class="c1"># Command the instantaneious spline velocity to the servo velocity controller</span>
</span><span id="DynamixelHelloXL430-866"><a href="#DynamixelHelloXL430-866"><span class="linenos"> 866</span></a>        <span class="c1"># Add a proportional term on the position error to zero out small errors at low velocity</span>
</span><span id="DynamixelHelloXL430-867"><a href="#DynamixelHelloXL430-867"><span class="linenos"> 867</span></a>        <span class="n">x_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-868"><a href="#DynamixelHelloXL430-868"><span class="linenos"> 868</span></a>        <span class="n">v_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-869"><a href="#DynamixelHelloXL430-869"><span class="linenos"> 869</span></a>        <span class="n">v1</span><span class="o">=</span><span class="n">v1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl_kP&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x_curr</span><span class="o">-</span><span class="n">p1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-870"><a href="#DynamixelHelloXL430-870"><span class="linenos"> 870</span></a>        <span class="n">v_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-871"><a href="#DynamixelHelloXL430-871"><span class="linenos"> 871</span></a>        <span class="c1"># Honor joint limits in velocity mode</span>
</span><span id="DynamixelHelloXL430-872"><a href="#DynamixelHelloXL430-872"><span class="linenos"> 872</span></a>        <span class="n">lim_lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="DynamixelHelloXL430-873"><a href="#DynamixelHelloXL430-873"><span class="linenos"> 873</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-874"><a href="#DynamixelHelloXL430-874"><span class="linenos"> 874</span></a>        <span class="n">lim_upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="DynamixelHelloXL430-875"><a href="#DynamixelHelloXL430-875"><span class="linenos"> 875</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-876"><a href="#DynamixelHelloXL430-876"><span class="linenos"> 876</span></a>
</span><span id="DynamixelHelloXL430-877"><a href="#DynamixelHelloXL430-877"><span class="linenos"> 877</span></a>        <span class="c1">#if self.params[&#39;motion&#39;][&#39;trajectory_max&#39;][&#39;accel_r&#39;] &gt; 0:</span>
</span><span id="DynamixelHelloXL430-878"><a href="#DynamixelHelloXL430-878"><span class="linenos"> 878</span></a>        <span class="n">t_brake</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span> <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>  <span class="c1"># How long to brake from current speed (s)</span>
</span><span id="DynamixelHelloXL430-879"><a href="#DynamixelHelloXL430-879"><span class="linenos"> 879</span></a>        <span class="c1">#else:</span>
</span><span id="DynamixelHelloXL430-880"><a href="#DynamixelHelloXL430-880"><span class="linenos"> 880</span></a>        <span class="c1">#    t_brake = 0</span>
</span><span id="DynamixelHelloXL430-881"><a href="#DynamixelHelloXL430-881"><span class="linenos"> 881</span></a>        <span class="n">d_brake</span> <span class="o">=</span> <span class="n">t_brake</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_curr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># How far it will go before breaking (pos/neg)</span>
</span><span id="DynamixelHelloXL430-882"><a href="#DynamixelHelloXL430-882"><span class="linenos"> 882</span></a>        <span class="n">d_brake</span> <span class="o">=</span> <span class="n">d_brake</span><span class="o">+</span><span class="n">deg_to_rad</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span> <span class="c1">#Pad out by 5 degrees to give a bit of safety margin</span>
</span><span id="DynamixelHelloXL430-883"><a href="#DynamixelHelloXL430-883"><span class="linenos"> 883</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">+</span> <span class="n">d_brake</span> <span class="o">&gt;=</span> <span class="n">lim_upper</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&lt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">d_brake</span> <span class="o">&lt;=</span> <span class="n">lim_lower</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-884"><a href="#DynamixelHelloXL430-884"><span class="linenos"> 884</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430-885"><a href="#DynamixelHelloXL430-885"><span class="linenos"> 885</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">move_to_vel</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-886"><a href="#DynamixelHelloXL430-886"><span class="linenos"> 886</span></a>
</span><span id="DynamixelHelloXL430-887"><a href="#DynamixelHelloXL430-887"><span class="linenos"> 887</span></a>    <span class="k">def</span> <span class="nf">_enable_trajectory_vel_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-888"><a href="#DynamixelHelloXL430-888"><span class="linenos"> 888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-889"><a href="#DynamixelHelloXL430-889"><span class="linenos"> 889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-890"><a href="#DynamixelHelloXL430-890"><span class="linenos"> 890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430-891"><a href="#DynamixelHelloXL430-891"><span class="linenos"> 891</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-892"><a href="#DynamixelHelloXL430-892"><span class="linenos"> 892</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_acceleration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-893"><a href="#DynamixelHelloXL430-893"><span class="linenos"> 893</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430-894"><a href="#DynamixelHelloXL430-894"><span class="linenos"> 894</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-895"><a href="#DynamixelHelloXL430-895"><span class="linenos"> 895</span></a>
</span><span id="DynamixelHelloXL430-896"><a href="#DynamixelHelloXL430-896"><span class="linenos"> 896</span></a>    <span class="k">def</span> <span class="nf">_disable_trajectory_vel_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-897"><a href="#DynamixelHelloXL430-897"><span class="linenos"> 897</span></a>        <span class="n">wd_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-898"><a href="#DynamixelHelloXL430-898"><span class="linenos"> 898</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-899"><a href="#DynamixelHelloXL430-899"><span class="linenos"> 899</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-900"><a href="#DynamixelHelloXL430-900"><span class="linenos"> 900</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-901"><a href="#DynamixelHelloXL430-901"><span class="linenos"> 901</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-902"><a href="#DynamixelHelloXL430-902"><span class="linenos"> 902</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-903"><a href="#DynamixelHelloXL430-903"><span class="linenos"> 903</span></a>        <span class="k">if</span> <span class="n">wd_error</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-904"><a href="#DynamixelHelloXL430-904"><span class="linenos"> 904</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Watchdog error during trajectory execution for </span><span class="si">%s</span><span class="s1">. Unable to maintain update rates.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-905"><a href="#DynamixelHelloXL430-905"><span class="linenos"> 905</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
</span><span id="DynamixelHelloXL430-906"><a href="#DynamixelHelloXL430-906"><span class="linenos"> 906</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="n">wd_error</span>
</span><span id="DynamixelHelloXL430-907"><a href="#DynamixelHelloXL430-907"><span class="linenos"> 907</span></a>
</span><span id="DynamixelHelloXL430-908"><a href="#DynamixelHelloXL430-908"><span class="linenos"> 908</span></a><span class="c1"># ##########################################</span>
</span><span id="DynamixelHelloXL430-909"><a href="#DynamixelHelloXL430-909"><span class="linenos"> 909</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-910"><a href="#DynamixelHelloXL430-910"><span class="linenos"> 910</span></a><span class="sd">    Servo calibration works by:</span>
</span><span id="DynamixelHelloXL430-911"><a href="#DynamixelHelloXL430-911"><span class="linenos"> 911</span></a><span class="sd">    </span>
</span><span id="DynamixelHelloXL430-912"><a href="#DynamixelHelloXL430-912"><span class="linenos"> 912</span></a><span class="sd">    Homing</span>
</span><span id="DynamixelHelloXL430-913"><a href="#DynamixelHelloXL430-913"><span class="linenos"> 913</span></a><span class="sd">    ==============</span>
</span><span id="DynamixelHelloXL430-914"><a href="#DynamixelHelloXL430-914"><span class="linenos"> 914</span></a><span class="sd">    * Move with a fixed PWM to a hardstop</span>
</span><span id="DynamixelHelloXL430-915"><a href="#DynamixelHelloXL430-915"><span class="linenos"> 915</span></a><span class="sd">    * Store the current position (ticks) in the EEPROM homing offset such that self.motor.status[&#39;pos&#39;]==0 at that hardstop</span>
</span><span id="DynamixelHelloXL430-916"><a href="#DynamixelHelloXL430-916"><span class="linenos"> 916</span></a><span class="sd">    </span>
</span><span id="DynamixelHelloXL430-917"><a href="#DynamixelHelloXL430-917"><span class="linenos"> 917</span></a><span class="sd">    Calibration to SI / joint range:</span>
</span><span id="DynamixelHelloXL430-918"><a href="#DynamixelHelloXL430-918"><span class="linenos"> 918</span></a><span class="sd">    ===============</span>
</span><span id="DynamixelHelloXL430-919"><a href="#DynamixelHelloXL430-919"><span class="linenos"> 919</span></a><span class="sd">    Once homed, the servo can move to positions within self.params.range_t (ticks).</span>
</span><span id="DynamixelHelloXL430-920"><a href="#DynamixelHelloXL430-920"><span class="linenos"> 920</span></a><span class="sd">    The &#39;Joint Zero&#39; (self.params.zero_t) is different than the &#39;Servo Zero&#39;. Per the homing procedure, Servo Zero is at one hardstop</span>
</span><span id="DynamixelHelloXL430-921"><a href="#DynamixelHelloXL430-921"><span class="linenos"> 921</span></a><span class="sd">    Joint Zero is an offset (ticks) from Servo Zero that is added/subtracted to commanded/reported values</span>
</span><span id="DynamixelHelloXL430-922"><a href="#DynamixelHelloXL430-922"><span class="linenos"> 922</span></a><span class="sd">    Thus when self.motor.status[&#39;pos&#39;]==self.params.zero_t, self.status[&#39;pos]=0 (rad)</span>
</span><span id="DynamixelHelloXL430-923"><a href="#DynamixelHelloXL430-923"><span class="linenos"> 923</span></a><span class="sd">    </span>
</span><span id="DynamixelHelloXL430-924"><a href="#DynamixelHelloXL430-924"><span class="linenos"> 924</span></a><span class="sd">    There is an added complexity with how Dynamixels handle position reporting in multi-turn and single-turn mode</span>
</span><span id="DynamixelHelloXL430-925"><a href="#DynamixelHelloXL430-925"><span class="linenos"> 925</span></a><span class="sd">    In multi-turn mode, position values and homing values can be large (+/-2B, +/-1M)</span>
</span><span id="DynamixelHelloXL430-926"><a href="#DynamixelHelloXL430-926"><span class="linenos"> 926</span></a><span class="sd">    In single-turn mode, position values are bound to 0-4095 and homing values to -1,024 ~ 1,024</span>
</span><span id="DynamixelHelloXL430-927"><a href="#DynamixelHelloXL430-927"><span class="linenos"> 927</span></a><span class="sd">    In addition, the home offset stored during a multi-turn homing procedure may not be valid in single turn (out of range)</span>
</span><span id="DynamixelHelloXL430-928"><a href="#DynamixelHelloXL430-928"><span class="linenos"> 928</span></a><span class="sd">    </span>
</span><span id="DynamixelHelloXL430-929"><a href="#DynamixelHelloXL430-929"><span class="linenos"> 929</span></a><span class="sd">    The Home Offset(20) adjusts the home position. The offset value is added to the Present Position(132).</span>
</span><span id="DynamixelHelloXL430-930"><a href="#DynamixelHelloXL430-930"><span class="linenos"> 930</span></a><span class="sd">    Present Position(132) = Actual Position + Homing Offset(20)</span>
</span><span id="DynamixelHelloXL430-931"><a href="#DynamixelHelloXL430-931"><span class="linenos"> 931</span></a><span class="sd">    Range: -1,044,479 ~ 1,044,479</span>
</span><span id="DynamixelHelloXL430-932"><a href="#DynamixelHelloXL430-932"><span class="linenos"> 932</span></a><span class="sd">    </span>
</span><span id="DynamixelHelloXL430-933"><a href="#DynamixelHelloXL430-933"><span class="linenos"> 933</span></a><span class="sd">    ### NOTE ###</span>
</span><span id="DynamixelHelloXL430-934"><a href="#DynamixelHelloXL430-934"><span class="linenos"> 934</span></a><span class="sd">    In case of the Position Control Mode(Joint Mode) that rotates less than 360 degrees, any invalid Homing Offset(20) values will be ignored(valid range : -1,024 ~ 1,024).</span>
</span><span id="DynamixelHelloXL430-935"><a href="#DynamixelHelloXL430-935"><span class="linenos"> 935</span></a><span class="sd">    So when homing in single-turn mode, ensure that the homing offset stored is in range, otherwise unexpected values will appear. </span>
</span><span id="DynamixelHelloXL430-936"><a href="#DynamixelHelloXL430-936"><span class="linenos"> 936</span></a><span class="sd">    -- It is possible then to not be able to home a single-turn servo as position can range 0-4096 and depending on hardstop location, a valid homing offset can not be found</span>
</span><span id="DynamixelHelloXL430-937"><a href="#DynamixelHelloXL430-937"><span class="linenos"> 937</span></a><span class="sd">    -- Also, homing shouldn&#39;t be necessary in single-turn mode as the position reporting is already absolute</span>
</span><span id="DynamixelHelloXL430-938"><a href="#DynamixelHelloXL430-938"><span class="linenos"> 938</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430-939"><a href="#DynamixelHelloXL430-939"><span class="linenos"> 939</span></a>
</span><span id="DynamixelHelloXL430-940"><a href="#DynamixelHelloXL430-940"><span class="linenos"> 940</span></a>    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">move_to_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">delay_at_stop</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">save_calibration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">set_homing_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-941"><a href="#DynamixelHelloXL430-941"><span class="linenos"> 941</span></a>        <span class="c1"># Requires at least one hardstop in the pwm_homing[0] direction</span>
</span><span id="DynamixelHelloXL430-942"><a href="#DynamixelHelloXL430-942"><span class="linenos"> 942</span></a>        <span class="c1"># Can be in multiturn or single turn mode</span>
</span><span id="DynamixelHelloXL430-943"><a href="#DynamixelHelloXL430-943"><span class="linenos"> 943</span></a>        <span class="c1"># Mark the first hardstop as zero ticks on the Dynammixel</span>
</span><span id="DynamixelHelloXL430-944"><a href="#DynamixelHelloXL430-944"><span class="linenos"> 944</span></a>        <span class="c1"># Second hardstop is optional</span>
</span><span id="DynamixelHelloXL430-945"><a href="#DynamixelHelloXL430-945"><span class="linenos"> 945</span></a>        <span class="c1"># Return success, measured range</span>
</span><span id="DynamixelHelloXL430-946"><a href="#DynamixelHelloXL430-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430-947"><a href="#DynamixelHelloXL430-947"><span class="linenos"> 947</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-948"><a href="#DynamixelHelloXL430-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-949"><a href="#DynamixelHelloXL430-949"><span class="linenos"> 949</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not able to home </span><span class="si">%s</span><span class="s1">. Hardware not present&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-950"><a href="#DynamixelHelloXL430-950"><span class="linenos"> 950</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-951"><a href="#DynamixelHelloXL430-951"><span class="linenos"> 951</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-952"><a href="#DynamixelHelloXL430-952"><span class="linenos"> 952</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homing not required for: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-953"><a href="#DynamixelHelloXL430-953"><span class="linenos"> 953</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-954"><a href="#DynamixelHelloXL430-954"><span class="linenos"> 954</span></a>
</span><span id="DynamixelHelloXL430-955"><a href="#DynamixelHelloXL430-955"><span class="linenos"> 955</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-956"><a href="#DynamixelHelloXL430-956"><span class="linenos"> 956</span></a>
</span><span id="DynamixelHelloXL430-957"><a href="#DynamixelHelloXL430-957"><span class="linenos"> 957</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-958"><a href="#DynamixelHelloXL430-958"><span class="linenos"> 958</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-959"><a href="#DynamixelHelloXL430-959"><span class="linenos"> 959</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-960"><a href="#DynamixelHelloXL430-960"><span class="linenos"> 960</span></a>
</span><span id="DynamixelHelloXL430-961"><a href="#DynamixelHelloXL430-961"><span class="linenos"> 961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430-962"><a href="#DynamixelHelloXL430-962"><span class="linenos"> 962</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-963"><a href="#DynamixelHelloXL430-963"><span class="linenos"> 963</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to first hardstop...&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-964"><a href="#DynamixelHelloXL430-964"><span class="linenos"> 964</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_homing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-965"><a href="#DynamixelHelloXL430-965"><span class="linenos"> 965</span></a>            <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-966"><a href="#DynamixelHelloXL430-966"><span class="linenos"> 966</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-967"><a href="#DynamixelHelloXL430-967"><span class="linenos"> 967</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-968"><a href="#DynamixelHelloXL430-968"><span class="linenos"> 968</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-969"><a href="#DynamixelHelloXL430-969"><span class="linenos"> 969</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&gt;</span><span class="mf">15.0</span>
</span><span id="DynamixelHelloXL430-970"><a href="#DynamixelHelloXL430-970"><span class="linenos"> 970</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-971"><a href="#DynamixelHelloXL430-971"><span class="linenos"> 971</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_at_stop</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-972"><a href="#DynamixelHelloXL430-972"><span class="linenos"> 972</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-973"><a href="#DynamixelHelloXL430-973"><span class="linenos"> 973</span></a>
</span><span id="DynamixelHelloXL430-974"><a href="#DynamixelHelloXL430-974"><span class="linenos"> 974</span></a>            <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-975"><a href="#DynamixelHelloXL430-975"><span class="linenos"> 975</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timed out moving to first hardstop. Exiting.&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-976"><a href="#DynamixelHelloXL430-976"><span class="linenos"> 976</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-977"><a href="#DynamixelHelloXL430-977"><span class="linenos"> 977</span></a>
</span><span id="DynamixelHelloXL430-978"><a href="#DynamixelHelloXL430-978"><span class="linenos"> 978</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-979"><a href="#DynamixelHelloXL430-979"><span class="linenos"> 979</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-980"><a href="#DynamixelHelloXL430-980"><span class="linenos"> 980</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-981"><a href="#DynamixelHelloXL430-981"><span class="linenos"> 981</span></a>
</span><span id="DynamixelHelloXL430-982"><a href="#DynamixelHelloXL430-982"><span class="linenos"> 982</span></a>            <span class="c1">#Need to move back to pos mode to get the position (ticks) w/o the homing offset (single turn mode)</span>
</span><span id="DynamixelHelloXL430-983"><a href="#DynamixelHelloXL430-983"><span class="linenos"> 983</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-984"><a href="#DynamixelHelloXL430-984"><span class="linenos"> 984</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-985"><a href="#DynamixelHelloXL430-985"><span class="linenos"> 985</span></a>            <span class="n">contact_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-986"><a href="#DynamixelHelloXL430-986"><span class="linenos"> 986</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First hardstop contact at position (ticks): </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">contact_0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-987"><a href="#DynamixelHelloXL430-987"><span class="linenos"> 987</span></a>
</span><span id="DynamixelHelloXL430-988"><a href="#DynamixelHelloXL430-988"><span class="linenos"> 988</span></a>            <span class="k">if</span> <span class="n">set_homing_offset</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-989"><a href="#DynamixelHelloXL430-989"><span class="linenos"> 989</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-990"><a href="#DynamixelHelloXL430-990"><span class="linenos"> 990</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-991"><a href="#DynamixelHelloXL430-991"><span class="linenos"> 991</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homing offset was </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430-992"><a href="#DynamixelHelloXL430-992"><span class="linenos"> 992</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Marking current position to zero ticks&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-993"><a href="#DynamixelHelloXL430-993"><span class="linenos"> 993</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">zero_position</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-994"><a href="#DynamixelHelloXL430-994"><span class="linenos"> 994</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Homing offset is now  </span><span class="si">%d</span><span class="s2"> (ticks)&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430-995"><a href="#DynamixelHelloXL430-995"><span class="linenos"> 995</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-996"><a href="#DynamixelHelloXL430-996"><span class="linenos"> 996</span></a>                <span class="n">contact_0</span><span class="o">=</span><span class="mi">0</span>
</span><span id="DynamixelHelloXL430-997"><a href="#DynamixelHelloXL430-997"><span class="linenos"> 997</span></a>
</span><span id="DynamixelHelloXL430-998"><a href="#DynamixelHelloXL430-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-999"><a href="#DynamixelHelloXL430-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_calibrated</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1000"><a href="#DynamixelHelloXL430-1000"><span class="linenos">1000</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="mi">1</span>
</span><span id="DynamixelHelloXL430-1001"><a href="#DynamixelHelloXL430-1001"><span class="linenos">1001</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-1002"><a href="#DynamixelHelloXL430-1002"><span class="linenos">1002</span></a>
</span><span id="DynamixelHelloXL430-1003"><a href="#DynamixelHelloXL430-1003"><span class="linenos">1003</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-1004"><a href="#DynamixelHelloXL430-1004"><span class="linenos">1004</span></a>
</span><span id="DynamixelHelloXL430-1005"><a href="#DynamixelHelloXL430-1005"><span class="linenos">1005</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current position (ticks):&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430-1006"><a href="#DynamixelHelloXL430-1006"><span class="linenos">1006</span></a>
</span><span id="DynamixelHelloXL430-1007"><a href="#DynamixelHelloXL430-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">single_stop</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1008"><a href="#DynamixelHelloXL430-1008"><span class="linenos">1008</span></a>                <span class="c1">#Measure the range and write to YAML</span>
</span><span id="DynamixelHelloXL430-1009"><a href="#DynamixelHelloXL430-1009"><span class="linenos">1009</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to second hardstop...&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1010"><a href="#DynamixelHelloXL430-1010"><span class="linenos">1010</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_homing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1011"><a href="#DynamixelHelloXL430-1011"><span class="linenos">1011</span></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-1012"><a href="#DynamixelHelloXL430-1012"><span class="linenos">1012</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1013"><a href="#DynamixelHelloXL430-1013"><span class="linenos">1013</span></a>                <span class="n">timeout</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-1014"><a href="#DynamixelHelloXL430-1014"><span class="linenos">1014</span></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1015"><a href="#DynamixelHelloXL430-1015"><span class="linenos">1015</span></a>                    <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="mf">15.0</span>
</span><span id="DynamixelHelloXL430-1016"><a href="#DynamixelHelloXL430-1016"><span class="linenos">1016</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1017"><a href="#DynamixelHelloXL430-1017"><span class="linenos">1017</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_at_stop</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1018"><a href="#DynamixelHelloXL430-1018"><span class="linenos">1018</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1019"><a href="#DynamixelHelloXL430-1019"><span class="linenos">1019</span></a>
</span><span id="DynamixelHelloXL430-1020"><a href="#DynamixelHelloXL430-1020"><span class="linenos">1020</span></a>                <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1021"><a href="#DynamixelHelloXL430-1021"><span class="linenos">1021</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timed out moving to second hardstop. Exiting.&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1022"><a href="#DynamixelHelloXL430-1022"><span class="linenos">1022</span></a>                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-1023"><a href="#DynamixelHelloXL430-1023"><span class="linenos">1023</span></a>
</span><span id="DynamixelHelloXL430-1024"><a href="#DynamixelHelloXL430-1024"><span class="linenos">1024</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430-1025"><a href="#DynamixelHelloXL430-1025"><span class="linenos">1025</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1026"><a href="#DynamixelHelloXL430-1026"><span class="linenos">1026</span></a>                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-1027"><a href="#DynamixelHelloXL430-1027"><span class="linenos">1027</span></a>
</span><span id="DynamixelHelloXL430-1028"><a href="#DynamixelHelloXL430-1028"><span class="linenos">1028</span></a>                <span class="c1"># Need to move back to pos mode to get the position (ticks) w/o the homing offset (single turn mode)</span>
</span><span id="DynamixelHelloXL430-1029"><a href="#DynamixelHelloXL430-1029"><span class="linenos">1029</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430-1030"><a href="#DynamixelHelloXL430-1030"><span class="linenos">1030</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-1031"><a href="#DynamixelHelloXL430-1031"><span class="linenos">1031</span></a>                <span class="n">contact_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-1032"><a href="#DynamixelHelloXL430-1032"><span class="linenos">1032</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hit second hardstop at: (ticks)&#39;</span><span class="p">,</span> <span class="n">contact_1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1033"><a href="#DynamixelHelloXL430-1033"><span class="linenos">1033</span></a>
</span><span id="DynamixelHelloXL430-1034"><a href="#DynamixelHelloXL430-1034"><span class="linenos">1034</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homed to range of motion to (ticks):&#39;</span><span class="p">,[</span><span class="n">contact_0</span><span class="p">,</span><span class="n">contact_1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1035"><a href="#DynamixelHelloXL430-1035"><span class="linenos">1035</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact_0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_pad_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">contact_1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_pad_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="DynamixelHelloXL430-1036"><a href="#DynamixelHelloXL430-1036"><span class="linenos">1036</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Padded range of motion is (ticks):&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1037"><a href="#DynamixelHelloXL430-1037"><span class="linenos">1037</span></a>                <span class="n">r1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1038"><a href="#DynamixelHelloXL430-1038"><span class="linenos">1038</span></a>                <span class="n">r2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1039"><a href="#DynamixelHelloXL430-1039"><span class="linenos">1039</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Radians:&#39;</span><span class="p">,[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1040"><a href="#DynamixelHelloXL430-1040"><span class="linenos">1040</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Degrees:&#39;</span><span class="p">,[</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r2</span><span class="p">)])</span>
</span><span id="DynamixelHelloXL430-1041"><a href="#DynamixelHelloXL430-1041"><span class="linenos">1041</span></a>
</span><span id="DynamixelHelloXL430-1042"><a href="#DynamixelHelloXL430-1042"><span class="linenos">1042</span></a>                <span class="k">if</span> <span class="n">save_calibration</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1043"><a href="#DynamixelHelloXL430-1043"><span class="linenos">1043</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">write_configuration_param_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.range_t&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1044"><a href="#DynamixelHelloXL430-1044"><span class="linenos">1044</span></a>
</span><span id="DynamixelHelloXL430-1045"><a href="#DynamixelHelloXL430-1045"><span class="linenos">1045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430-1046"><a href="#DynamixelHelloXL430-1046"><span class="linenos">1046</span></a>            <span class="k">if</span> <span class="n">move_to_zero</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1047"><a href="#DynamixelHelloXL430-1047"><span class="linenos">1047</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to calibrated zero: (rad)&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1048"><a href="#DynamixelHelloXL430-1048"><span class="linenos">1048</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1049"><a href="#DynamixelHelloXL430-1049"><span class="linenos">1049</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1050"><a href="#DynamixelHelloXL430-1050"><span class="linenos">1050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430-1051"><a href="#DynamixelHelloXL430-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430-1052"><a href="#DynamixelHelloXL430-1052"><span class="linenos">1052</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">single_stop</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1053"><a href="#DynamixelHelloXL430-1053"><span class="linenos">1053</span></a>                <span class="k">return</span>  <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-1054"><a href="#DynamixelHelloXL430-1054"><span class="linenos">1054</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-1055"><a href="#DynamixelHelloXL430-1055"><span class="linenos">1055</span></a>        <span class="k">except</span> <span class="n">DynamixelCommError</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430-1056"><a href="#DynamixelHelloXL430-1056"><span class="linenos">1056</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Communication error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1057"><a href="#DynamixelHelloXL430-1057"><span class="linenos">1057</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430-1058"><a href="#DynamixelHelloXL430-1058"><span class="linenos">1058</span></a>
</span><span id="DynamixelHelloXL430-1059"><a href="#DynamixelHelloXL430-1059"><span class="linenos">1059</span></a><span class="c1"># ##########################################</span>
</span><span id="DynamixelHelloXL430-1060"><a href="#DynamixelHelloXL430-1060"><span class="linenos">1060</span></a>
</span><span id="DynamixelHelloXL430-1061"><a href="#DynamixelHelloXL430-1061"><span class="linenos">1061</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1062"><a href="#DynamixelHelloXL430-1062"><span class="linenos">1062</span></a>        <span class="n">rps_servo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad_per_sec_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1063"><a href="#DynamixelHelloXL430-1063"><span class="linenos">1063</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rps_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-1064"><a href="#DynamixelHelloXL430-1064"><span class="linenos">1064</span></a>
</span><span id="DynamixelHelloXL430-1065"><a href="#DynamixelHelloXL430-1065"><span class="linenos">1065</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1066"><a href="#DynamixelHelloXL430-1066"><span class="linenos">1066</span></a>        <span class="n">rps_servo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad_per_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1067"><a href="#DynamixelHelloXL430-1067"><span class="linenos">1067</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rps_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-1068"><a href="#DynamixelHelloXL430-1068"><span class="linenos">1068</span></a>
</span><span id="DynamixelHelloXL430-1069"><a href="#DynamixelHelloXL430-1069"><span class="linenos">1069</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1070"><a href="#DynamixelHelloXL430-1070"><span class="linenos">1070</span></a>        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-1071"><a href="#DynamixelHelloXL430-1071"><span class="linenos">1071</span></a>        <span class="n">rad_servo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1072"><a href="#DynamixelHelloXL430-1072"><span class="linenos">1072</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rad_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430-1073"><a href="#DynamixelHelloXL430-1073"><span class="linenos">1073</span></a>
</span><span id="DynamixelHelloXL430-1074"><a href="#DynamixelHelloXL430-1074"><span class="linenos">1074</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1075"><a href="#DynamixelHelloXL430-1075"><span class="linenos">1075</span></a>        <span class="n">rad_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="DynamixelHelloXL430-1076"><a href="#DynamixelHelloXL430-1076"><span class="linenos">1076</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_to_ticks</span><span class="p">(</span><span class="n">rad_servo</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1077"><a href="#DynamixelHelloXL430-1077"><span class="linenos">1077</span></a>        <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430-1078"><a href="#DynamixelHelloXL430-1078"><span class="linenos">1078</span></a>
</span><span id="DynamixelHelloXL430-1079"><a href="#DynamixelHelloXL430-1079"><span class="linenos">1079</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1080"><a href="#DynamixelHelloXL430-1080"><span class="linenos">1080</span></a>        <span class="n">rad_per_sec_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="DynamixelHelloXL430-1081"><a href="#DynamixelHelloXL430-1081"><span class="linenos">1081</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_per_sec_to_ticks</span><span class="p">(</span><span class="n">rad_per_sec_servo</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1082"><a href="#DynamixelHelloXL430-1082"><span class="linenos">1082</span></a>        <span class="k">return</span> <span class="n">t</span>
</span><span id="DynamixelHelloXL430-1083"><a href="#DynamixelHelloXL430-1083"><span class="linenos">1083</span></a>
</span><span id="DynamixelHelloXL430-1084"><a href="#DynamixelHelloXL430-1084"><span class="linenos">1084</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1085"><a href="#DynamixelHelloXL430-1085"><span class="linenos">1085</span></a>        <span class="n">rad_per_sec_sec_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="DynamixelHelloXL430-1086"><a href="#DynamixelHelloXL430-1086"><span class="linenos">1086</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_per_sec_sec_to_ticks</span><span class="p">(</span><span class="n">rad_per_sec_sec_servo</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1087"><a href="#DynamixelHelloXL430-1087"><span class="linenos">1087</span></a>        <span class="k">return</span> <span class="n">t</span>
</span><span id="DynamixelHelloXL430-1088"><a href="#DynamixelHelloXL430-1088"><span class="linenos">1088</span></a>
</span><span id="DynamixelHelloXL430-1089"><a href="#DynamixelHelloXL430-1089"><span class="linenos">1089</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1090"><a href="#DynamixelHelloXL430-1090"><span class="linenos">1090</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">((</span><span class="mf">360.0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">4096.0</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430-1091"><a href="#DynamixelHelloXL430-1091"><span class="linenos">1091</span></a>
</span><span id="DynamixelHelloXL430-1092"><a href="#DynamixelHelloXL430-1092"><span class="linenos">1092</span></a>    <span class="k">def</span> <span class="nf">rad_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1093"><a href="#DynamixelHelloXL430-1093"><span class="linenos">1093</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="mf">4096.0</span> <span class="o">*</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1094"><a href="#DynamixelHelloXL430-1094"><span class="linenos">1094</span></a>
</span><span id="DynamixelHelloXL430-1095"><a href="#DynamixelHelloXL430-1095"><span class="linenos">1095</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1096"><a href="#DynamixelHelloXL430-1096"><span class="linenos">1096</span></a>        <span class="n">rpm</span><span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="mf">0.229</span>
</span><span id="DynamixelHelloXL430-1097"><a href="#DynamixelHelloXL430-1097"><span class="linenos">1097</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">rpm</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1098"><a href="#DynamixelHelloXL430-1098"><span class="linenos">1098</span></a>
</span><span id="DynamixelHelloXL430-1099"><a href="#DynamixelHelloXL430-1099"><span class="linenos">1099</span></a>    <span class="k">def</span> <span class="nf">rad_per_sec_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1100"><a href="#DynamixelHelloXL430-1100"><span class="linenos">1100</span></a>        <span class="n">rpm</span><span class="o">=</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mf">360.0</span>
</span><span id="DynamixelHelloXL430-1101"><a href="#DynamixelHelloXL430-1101"><span class="linenos">1101</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rpm</span><span class="o">/</span><span class="mf">0.229</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1102"><a href="#DynamixelHelloXL430-1102"><span class="linenos">1102</span></a>
</span><span id="DynamixelHelloXL430-1103"><a href="#DynamixelHelloXL430-1103"><span class="linenos">1103</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1104"><a href="#DynamixelHelloXL430-1104"><span class="linenos">1104</span></a>        <span class="n">rpmm</span><span class="o">=</span><span class="n">t</span><span class="o">*</span><span class="mf">214.577</span>
</span><span id="DynamixelHelloXL430-1105"><a href="#DynamixelHelloXL430-1105"><span class="linenos">1105</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">rpmm</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="mf">60.0</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1106"><a href="#DynamixelHelloXL430-1106"><span class="linenos">1106</span></a>
</span><span id="DynamixelHelloXL430-1107"><a href="#DynamixelHelloXL430-1107"><span class="linenos">1107</span></a>    <span class="k">def</span> <span class="nf">rad_per_sec_sec_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1108"><a href="#DynamixelHelloXL430-1108"><span class="linenos">1108</span></a>        <span class="n">rpmm</span><span class="o">=</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mf">360.0</span>
</span><span id="DynamixelHelloXL430-1109"><a href="#DynamixelHelloXL430-1109"><span class="linenos">1109</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rpmm</span><span class="o">/</span><span class="mf">214.577</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430-1110"><a href="#DynamixelHelloXL430-1110"><span class="linenos">1110</span></a>
</span><span id="DynamixelHelloXL430-1111"><a href="#DynamixelHelloXL430-1111"><span class="linenos">1111</span></a>    <span class="k">def</span> <span class="nf">ticks_to_pct_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430-1112"><a href="#DynamixelHelloXL430-1112"><span class="linenos">1112</span></a>        <span class="c1">#-100 to 100.0</span>
</span><span id="DynamixelHelloXL430-1113"><a href="#DynamixelHelloXL430-1113"><span class="linenos">1113</span></a>        <span class="k">return</span> <span class="n">t</span><span class="o">/</span><span class="mf">10.24</span>
</span></pre></div>


            <div class="docstring"><p>Abstract the Dynamixel X-Series to handle calibration, radians, etc</p>
</div>


                            <div id="DynamixelHelloXL430.__init__" class="classattr">
                                        <input id="DynamixelHelloXL430.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DynamixelHelloXL430</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">chain</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">usb</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="DynamixelHelloXL430.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.__init__-57"><a href="#DynamixelHelloXL430.__init__-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.__init__-58"><a href="#DynamixelHelloXL430.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.__init__-59"><a href="#DynamixelHelloXL430.__init__-59"><span class="linenos"> 59</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.__init__-60"><a href="#DynamixelHelloXL430.__init__-60"><span class="linenos"> 60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
</span><span id="DynamixelHelloXL430.__init__-61"><a href="#DynamixelHelloXL430.__init__-61"><span class="linenos"> 61</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-62"><a href="#DynamixelHelloXL430.__init__-62"><span class="linenos"> 62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;comm_errors&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vel&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;temp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;shutdown&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;hardware_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430.__init__-63"><a href="#DynamixelHelloXL430.__init__-63"><span class="linenos"> 63</span></a>                         <span class="s1">&#39;input_voltage_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;overload_error&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430.__init__-64"><a href="#DynamixelHelloXL430.__init__-64"><span class="linenos"> 64</span></a>                         <span class="s1">&#39;stalled&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="DynamixelHelloXL430.__init__-65"><a href="#DynamixelHelloXL430.__init__-65"><span class="linenos"> 65</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">thread_rate_hz</span> <span class="o">=</span> <span class="mf">15.0</span>
</span><span id="DynamixelHelloXL430.__init__-66"><a href="#DynamixelHelloXL430.__init__-66"><span class="linenos"> 66</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span> <span class="o">=</span> <span class="n">RevoluteTrajectory</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.__init__-67"><a href="#DynamixelHelloXL430.__init__-67"><span class="linenos"> 67</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.__init__-68"><a href="#DynamixelHelloXL430.__init__-68"><span class="linenos"> 68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.__init__-69"><a href="#DynamixelHelloXL430.__init__-69"><span class="linenos"> 69</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.__init__-70"><a href="#DynamixelHelloXL430.__init__-70"><span class="linenos"> 70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="o">=</span> <span class="n">usb</span>
</span><span id="DynamixelHelloXL430.__init__-71"><a href="#DynamixelHelloXL430.__init__-71"><span class="linenos"> 71</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.__init__-72"><a href="#DynamixelHelloXL430.__init__-72"><span class="linenos"> 72</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">usb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;usb_name&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.__init__-73"><a href="#DynamixelHelloXL430.__init__-73"><span class="linenos"> 73</span></a>
</span><span id="DynamixelHelloXL430.__init__-74"><a href="#DynamixelHelloXL430.__init__-74"><span class="linenos"> 74</span></a>            <span class="c1">#Share bus resource amongst many XL430s</span>
</span><span id="DynamixelHelloXL430.__init__-75"><a href="#DynamixelHelloXL430.__init__-75"><span class="linenos"> 75</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="o">=</span> <span class="n">DynamixelXL430</span><span class="p">(</span><span class="n">dxl_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
</span><span id="DynamixelHelloXL430.__init__-76"><a href="#DynamixelHelloXL430.__init__-76"><span class="linenos"> 76</span></a>                                        <span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430.__init__-77"><a href="#DynamixelHelloXL430.__init__-77"><span class="linenos"> 77</span></a>                                        <span class="n">port_handler</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">chain</span><span class="o">.</span><span class="n">port_handler</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430.__init__-78"><a href="#DynamixelHelloXL430.__init__-78"><span class="linenos"> 78</span></a>                                        <span class="n">pt_lock</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">chain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">chain</span><span class="o">.</span><span class="n">pt_lock</span><span class="p">,</span>
</span><span id="DynamixelHelloXL430.__init__-79"><a href="#DynamixelHelloXL430.__init__-79"><span class="linenos"> 79</span></a>                                        <span class="n">baud</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;baud&#39;</span><span class="p">],</span>
</span><span id="DynamixelHelloXL430.__init__-80"><a href="#DynamixelHelloXL430.__init__-80"><span class="linenos"> 80</span></a>                                        <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.__init__-81"><a href="#DynamixelHelloXL430.__init__-81"><span class="linenos"> 81</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="DynamixelHelloXL430.__init__-82"><a href="#DynamixelHelloXL430.__init__-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelHelloXL430.__init__-83"><a href="#DynamixelHelloXL430.__init__-83"><span class="linenos"> 83</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-84"><a href="#DynamixelHelloXL430.__init__-84"><span class="linenos"> 84</span></a>
</span><span id="DynamixelHelloXL430.__init__-85"><a href="#DynamixelHelloXL430.__init__-85"><span class="linenos"> 85</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.__init__-86"><a href="#DynamixelHelloXL430.__init__-86"><span class="linenos"> 86</span></a>                <span class="n">wr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.__init__-87"><a href="#DynamixelHelloXL430.__init__-87"><span class="linenos"> 87</span></a>                <span class="n">wr_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.__init__-88"><a href="#DynamixelHelloXL430.__init__-88"><span class="linenos"> 88</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.__init__-89"><a href="#DynamixelHelloXL430.__init__-89"><span class="linenos"> 89</span></a>                <span class="n">wr_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.__init__-90"><a href="#DynamixelHelloXL430.__init__-90"><span class="linenos"> 90</span></a>                <span class="n">wr_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.__init__-91"><a href="#DynamixelHelloXL430.__init__-91"><span class="linenos"> 91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;collision&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span><span class="s1">&#39;hard&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">wr_min</span><span class="p">,</span><span class="n">wr_max</span><span class="p">],</span><span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">wr_min</span><span class="p">,</span><span class="n">wr_max</span><span class="p">]}</span>
</span><span id="DynamixelHelloXL430.__init__-92"><a href="#DynamixelHelloXL430.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="DynamixelHelloXL430.__init__-93"><a href="#DynamixelHelloXL430.__init__-93"><span class="linenos"> 93</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-94"><a href="#DynamixelHelloXL430.__init__-94"><span class="linenos"> 94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.__init__-95"><a href="#DynamixelHelloXL430.__init__-95"><span class="linenos"> 95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-96"><a href="#DynamixelHelloXL430.__init__-96"><span class="linenos"> 96</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span> <span class="o">=</span> <span class="n">DynamixelCommErrorStats</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.__init__-97"><a href="#DynamixelHelloXL430.__init__-97"><span class="linenos"> 97</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#Track the motion profile settings on servo</span>
</span><span id="DynamixelHelloXL430.__init__-98"><a href="#DynamixelHelloXL430.__init__-98"><span class="linenos"> 98</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#Track the motion profile settings on servo</span>
</span><span id="DynamixelHelloXL430.__init__-99"><a href="#DynamixelHelloXL430.__init__-99"><span class="linenos"> 99</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-100"><a href="#DynamixelHelloXL430.__init__-100"><span class="linenos">100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-101"><a href="#DynamixelHelloXL430.__init__-101"><span class="linenos">101</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-102"><a href="#DynamixelHelloXL430.__init__-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">False</span> 
</span><span id="DynamixelHelloXL430.__init__-103"><a href="#DynamixelHelloXL430.__init__-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># track dist to min,max limits</span>
</span><span id="DynamixelHelloXL430.__init__-104"><a href="#DynamixelHelloXL430.__init__-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># initial/minimum brake zone thresh value</span>
</span><span id="DynamixelHelloXL430.__init__-105"><a href="#DynamixelHelloXL430.__init__-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.__init__-106"><a href="#DynamixelHelloXL430.__init__-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.__init__-107"><a href="#DynamixelHelloXL430.__init__-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">total_range</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430.__init__-108"><a href="#DynamixelHelloXL430.__init__-108"><span class="linenos">108</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.__init__-109"><a href="#DynamixelHelloXL430.__init__-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">=</span><span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.check_homing_offset" class="classattr">
                                        <input id="DynamixelHelloXL430.check_homing_offset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_homing_offset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.check_homing_offset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.check_homing_offset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.check_homing_offset-113"><a href="#DynamixelHelloXL430.check_homing_offset-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">check_homing_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-114"><a href="#DynamixelHelloXL430.check_homing_offset-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-115"><a href="#DynamixelHelloXL430.check_homing_offset-115"><span class="linenos">115</span></a><span class="sd">        Users may incorrectly set the homing offset on a single-turn servo</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-116"><a href="#DynamixelHelloXL430.check_homing_offset-116"><span class="linenos">116</span></a><span class="sd">        In general on single-turn servos, the homing offset should be zero</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-117"><a href="#DynamixelHelloXL430.check_homing_offset-117"><span class="linenos">117</span></a><span class="sd">        In some cases it may be non-zero but between -1024 and 1024 (per DXL spec)</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-118"><a href="#DynamixelHelloXL430.check_homing_offset-118"><span class="linenos">118</span></a><span class="sd">        If it is outside of the valid range it is ignored. However,</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-119"><a href="#DynamixelHelloXL430.check_homing_offset-119"><span class="linenos">119</span></a><span class="sd">        when the servo is placed in other control modes (eg vel) the reported encoder position start using the offset</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-120"><a href="#DynamixelHelloXL430.check_homing_offset-120"><span class="linenos">120</span></a><span class="sd">        This can create unexpected behavior</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-121"><a href="#DynamixelHelloXL430.check_homing_offset-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-122"><a href="#DynamixelHelloXL430.check_homing_offset-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-123"><a href="#DynamixelHelloXL430.check_homing_offset-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-124"><a href="#DynamixelHelloXL430.check_homing_offset-124"><span class="linenos">124</span></a>            <span class="n">xn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-125"><a href="#DynamixelHelloXL430.check_homing_offset-125"><span class="linenos">125</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1024</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-126"><a href="#DynamixelHelloXL430.check_homing_offset-126"><span class="linenos">126</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel </span><span class="si">%s</span><span class="s1">: Servo is in single-turn mode yet has invalid homing offset of </span><span class="si">%d</span><span class="s1">. </span><span class="se">\n</span><span class="s1"> This may cause &#39;</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-127"><a href="#DynamixelHelloXL430.check_homing_offset-127"><span class="linenos">127</span></a>                                    <span class="s1">&#39;unexpected results if not set to zero (using REx_dynamixel_jog.py)</span><span class="se">\n</span><span class="s1"> Please contact Hello Robot support for more information&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">xn</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.check_homing_offset-128"><a href="#DynamixelHelloXL430.check_homing_offset-128"><span class="linenos">128</span></a>
</span><span id="DynamixelHelloXL430.check_homing_offset-129"><a href="#DynamixelHelloXL430.check_homing_offset-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Users may incorrectly set the homing offset on a single-turn servo
In general on single-turn servos, the homing offset should be zero
In some cases it may be non-zero but between -1024 and 1024 (per DXL spec)
If it is outside of the valid range it is ignored. However,
when the servo is placed in other control modes (eg vel) the reported encoder position start using the offset
This can create unexpected behavior</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.get_soft_motion_limits" class="classattr">
                                        <input id="DynamixelHelloXL430.get_soft_motion_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_soft_motion_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.get_soft_motion_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.get_soft_motion_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.get_soft_motion_limits-131"><a href="#DynamixelHelloXL430.get_soft_motion_limits-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">get_soft_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-132"><a href="#DynamixelHelloXL430.get_soft_motion_limits-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-133"><a href="#DynamixelHelloXL430.get_soft_motion_limits-133"><span class="linenos">133</span></a><span class="sd">            Return the currently applied soft motion limits: [min, max]</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-134"><a href="#DynamixelHelloXL430.get_soft_motion_limits-134"><span class="linenos">134</span></a>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-135"><a href="#DynamixelHelloXL430.get_soft_motion_limits-135"><span class="linenos">135</span></a><span class="sd">            The soft motion limit restricts joint motion to be &lt;= its physical limits.</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-136"><a href="#DynamixelHelloXL430.get_soft_motion_limits-136"><span class="linenos">136</span></a>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-137"><a href="#DynamixelHelloXL430.get_soft_motion_limits-137"><span class="linenos">137</span></a><span class="sd">            There are three types of limits:</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-138"><a href="#DynamixelHelloXL430.get_soft_motion_limits-138"><span class="linenos">138</span></a><span class="sd">            Hard: The physical limits</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-139"><a href="#DynamixelHelloXL430.get_soft_motion_limits-139"><span class="linenos">139</span></a><span class="sd">            Collision: Limits set by RobotCollision to avoid collisions</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-140"><a href="#DynamixelHelloXL430.get_soft_motion_limits-140"><span class="linenos">140</span></a><span class="sd">            User: Limits set by the user software</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-141"><a href="#DynamixelHelloXL430.get_soft_motion_limits-141"><span class="linenos">141</span></a>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-142"><a href="#DynamixelHelloXL430.get_soft_motion_limits-142"><span class="linenos">142</span></a><span class="sd">            The joint is limited to the most restrictive range of the Hard / Collision/ User values.</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-143"><a href="#DynamixelHelloXL430.get_soft_motion_limits-143"><span class="linenos">143</span></a><span class="sd">            Specifying a value of None for a limit indicates that no constraint exists for that limit type.</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-144"><a href="#DynamixelHelloXL430.get_soft_motion_limits-144"><span class="linenos">144</span></a><span class="sd">            This allows a User limits and Collision limits to coexist.</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-145"><a href="#DynamixelHelloXL430.get_soft_motion_limits-145"><span class="linenos">145</span></a><span class="sd">            For example, a user can temporarily restrict the range of motion beyond the current collision limits.</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-146"><a href="#DynamixelHelloXL430.get_soft_motion_limits-146"><span class="linenos">146</span></a><span class="sd">            Then, by commanding User limits of None, the joint limits will revert back to the collision settings.</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-147"><a href="#DynamixelHelloXL430.get_soft_motion_limits-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.get_soft_motion_limits-148"><a href="#DynamixelHelloXL430.get_soft_motion_limits-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return the currently applied soft motion limits: [min, max]</p>

<p>The soft motion limit restricts joint motion to be &lt;= its physical limits.</p>

<p>There are three types of limits:
Hard: The physical limits
Collision: Limits set by RobotCollision to avoid collisions
User: Limits set by the user software</p>

<p>The joint is limited to the most restrictive range of the Hard / Collision/ User values.
Specifying a value of None for a limit indicates that no constraint exists for that limit type.
This allows a User limits and Collision limits to coexist.
For example, a user can temporarily restrict the range of motion beyond the current collision limits.
Then, by commanding User limits of None, the joint limits will revert back to the collision settings.</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.set_soft_motion_limit_min" class="classattr">
                                        <input id="DynamixelHelloXL430.set_soft_motion_limit_min-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_soft_motion_limit_min</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.set_soft_motion_limit_min-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.set_soft_motion_limit_min"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-150"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">set_soft_motion_limit_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span> <span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-151"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-151"><span class="linenos">151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-152"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-152"><span class="linenos">152</span></a><span class="sd">        x: value to set a joints limit to</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-153"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-153"><span class="linenos">153</span></a><span class="sd">        limit_type: &#39;user&#39; or &#39;collision&#39;</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-154"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-155"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="n">limit_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_min-156"><a href="#DynamixelHelloXL430.set_soft_motion_limit_min-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;collision&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;hard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
</span></pre></div>


            <div class="docstring"><p>x: value to set a joints limit to
limit_type: 'user' or 'collision'</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.set_soft_motion_limit_max" class="classattr">
                                        <input id="DynamixelHelloXL430.set_soft_motion_limit_max-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_soft_motion_limit_max</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.set_soft_motion_limit_max-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.set_soft_motion_limit_max"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-159"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="nf">set_soft_motion_limit_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">limit_type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span> <span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-160"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-160"><span class="linenos">160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-161"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-161"><span class="linenos">161</span></a><span class="sd">        x: value to set a joints limit to</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-162"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-162"><span class="linenos">162</span></a><span class="sd">        limit_type: &#39;user&#39; or &#39;collision&#39;</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-163"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-163"><span class="linenos">163</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-164"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="n">limit_type</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="DynamixelHelloXL430.set_soft_motion_limit_max-165"><a href="#DynamixelHelloXL430.set_soft_motion_limit_max-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;collision&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;hard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>
</span></pre></div>


            <div class="docstring"><p>x: value to set a joints limit to
limit_type: 'user' or 'collision'</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.do_ping" class="classattr">
                                        <input id="DynamixelHelloXL430.do_ping-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">do_ping</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.do_ping-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.do_ping"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.do_ping-169"><a href="#DynamixelHelloXL430.do_ping-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">do_ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.do_ping-170"><a href="#DynamixelHelloXL430.do_ping-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_ping</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.check_servo_errors" class="classattr">
                                        <input id="DynamixelHelloXL430.check_servo_errors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_servo_errors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.check_servo_errors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.check_servo_errors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.check_servo_errors-172"><a href="#DynamixelHelloXL430.check_servo_errors-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="nf">check_servo_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-173"><a href="#DynamixelHelloXL430.check_servo_errors-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-174"><a href="#DynamixelHelloXL430.check_servo_errors-174"><span class="linenos">174</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;WARNING: Servo </span><span class="si">%s</span><span class="s1"> in error state: overload_error. Reboot servo with stretch_robot_dynamixel_reboot.py&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-175"><a href="#DynamixelHelloXL430.check_servo_errors-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-176"><a href="#DynamixelHelloXL430.check_servo_errors-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-177"><a href="#DynamixelHelloXL430.check_servo_errors-177"><span class="linenos">177</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-178"><a href="#DynamixelHelloXL430.check_servo_errors-178"><span class="linenos">178</span></a>
</span><span id="DynamixelHelloXL430.check_servo_errors-179"><a href="#DynamixelHelloXL430.check_servo_errors-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-180"><a href="#DynamixelHelloXL430.check_servo_errors-180"><span class="linenos">180</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;WARNING: Servo </span><span class="si">%s</span><span class="s1"> in error state: overheating_error. Reboot servo with stretch_robot_dynamixel_reboot.py&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-181"><a href="#DynamixelHelloXL430.check_servo_errors-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-182"><a href="#DynamixelHelloXL430.check_servo_errors-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">warn_error</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-183"><a href="#DynamixelHelloXL430.check_servo_errors-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.check_servo_errors-184"><a href="#DynamixelHelloXL430.check_servo_errors-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.startup" class="classattr">
                                        <input id="DynamixelHelloXL430.startup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">startup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.startup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.startup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.startup-186"><a href="#DynamixelHelloXL430.startup-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.startup-187"><a href="#DynamixelHelloXL430.startup-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.startup-188"><a href="#DynamixelHelloXL430.startup-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.startup-189"><a href="#DynamixelHelloXL430.startup-189"><span class="linenos">189</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-190"><a href="#DynamixelHelloXL430.startup-190"><span class="linenos">190</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.startup-191"><a href="#DynamixelHelloXL430.startup-191"><span class="linenos">191</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_ping</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.startup-192"><a href="#DynamixelHelloXL430.startup-192"><span class="linenos">192</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.startup-193"><a href="#DynamixelHelloXL430.startup-193"><span class="linenos">193</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-194"><a href="#DynamixelHelloXL430.startup-194"><span class="linenos">194</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.startup-195"><a href="#DynamixelHelloXL430.startup-195"><span class="linenos">195</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-196"><a href="#DynamixelHelloXL430.startup-196"><span class="linenos">196</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.startup-197"><a href="#DynamixelHelloXL430.startup-197"><span class="linenos">197</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_multiturn</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-198"><a href="#DynamixelHelloXL430.startup-198"><span class="linenos">198</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.startup-199"><a href="#DynamixelHelloXL430.startup-199"><span class="linenos">199</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-200"><a href="#DynamixelHelloXL430.startup-200"><span class="linenos">200</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">4095</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.startup-201"><a href="#DynamixelHelloXL430.startup-201"><span class="linenos">201</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Warning: Invalid position range for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-202"><a href="#DynamixelHelloXL430.startup-202"><span class="linenos">202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_pwm_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-203"><a href="#DynamixelHelloXL430.startup-203"><span class="linenos">203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_temperature_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;temperature_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-204"><a href="#DynamixelHelloXL430.startup-204"><span class="linenos">204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_min_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_voltage_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-205"><a href="#DynamixelHelloXL430.startup-205"><span class="linenos">205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_max_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_voltage_limit&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-206"><a href="#DynamixelHelloXL430.startup-206"><span class="linenos">206</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_P_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-207"><a href="#DynamixelHelloXL430.startup-207"><span class="linenos">207</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_I_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-208"><a href="#DynamixelHelloXL430.startup-208"><span class="linenos">208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_D_gain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-209"><a href="#DynamixelHelloXL430.startup-209"><span class="linenos">209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_return_delay_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;return_delay_time&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.startup-210"><a href="#DynamixelHelloXL430.startup-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">()</span> <span class="c1">#Initialize servo motion profile with default values</span>
</span><span id="DynamixelHelloXL430.startup-211"><a href="#DynamixelHelloXL430.startup-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.startup-212"><a href="#DynamixelHelloXL430.startup-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.startup-213"><a href="#DynamixelHelloXL430.startup-213"><span class="linenos">213</span></a>
</span><span id="DynamixelHelloXL430.startup-214"><a href="#DynamixelHelloXL430.startup-214"><span class="linenos">214</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-215"><a href="#DynamixelHelloXL430.startup-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">check_homing_offset</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-216"><a href="#DynamixelHelloXL430.startup-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-217"><a href="#DynamixelHelloXL430.startup-217"><span class="linenos">217</span></a>                <span class="c1">#Pull 3 times given mux / init the status dict</span>
</span><span id="DynamixelHelloXL430.startup-218"><a href="#DynamixelHelloXL430.startup-218"><span class="linenos">218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-219"><a href="#DynamixelHelloXL430.startup-219"><span class="linenos">219</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-220"><a href="#DynamixelHelloXL430.startup-220"><span class="linenos">220</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.startup-221"><a href="#DynamixelHelloXL430.startup-221"><span class="linenos">221</span></a>
</span><span id="DynamixelHelloXL430.startup-222"><a href="#DynamixelHelloXL430.startup-222"><span class="linenos">222</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.startup-223"><a href="#DynamixelHelloXL430.startup-223"><span class="linenos">223</span></a>
</span><span id="DynamixelHelloXL430.startup-224"><a href="#DynamixelHelloXL430.startup-224"><span class="linenos">224</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.startup-225"><a href="#DynamixelHelloXL430.startup-225"><span class="linenos">225</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.startup-226"><a href="#DynamixelHelloXL430.startup-226"><span class="linenos">226</span></a>
</span><span id="DynamixelHelloXL430.startup-227"><a href="#DynamixelHelloXL430.startup-227"><span class="linenos">227</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.startup-228"><a href="#DynamixelHelloXL430.startup-228"><span class="linenos">228</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.startup-229"><a href="#DynamixelHelloXL430.startup-229"><span class="linenos">229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed... </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-230"><a href="#DynamixelHelloXL430.startup-230"><span class="linenos">230</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-231"><a href="#DynamixelHelloXL430.startup-231"><span class="linenos">231</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.startup-232"><a href="#DynamixelHelloXL430.startup-232"><span class="linenos">232</span></a>        <span class="k">except</span> <span class="n">DynamixelCommError</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.startup-233"><a href="#DynamixelHelloXL430.startup-233"><span class="linenos">233</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed... </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-234"><a href="#DynamixelHelloXL430.startup-234"><span class="linenos">234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-235"><a href="#DynamixelHelloXL430.startup-235"><span class="linenos">235</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DynamixelHelloXL430 Ping failed...&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.startup-236"><a href="#DynamixelHelloXL430.startup-236"><span class="linenos">236</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Starts machinery required to interface with this device</p>

<h2 id="parameters">Parameters</h2>

<p>threaded : bool.
    Whether a thread manages hardware polling/pushing in the background</p>

<h2 id="returns">Returns</h2>

<p>bool:
    Whether the startup procedure succeeded</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.stop" class="classattr">
                                        <input id="DynamixelHelloXL430.stop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.stop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.stop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.stop-242"><a href="#DynamixelHelloXL430.stop-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.stop-243"><a href="#DynamixelHelloXL430.stop-243"><span class="linenos">243</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.stop-244"><a href="#DynamixelHelloXL430.stop-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.stop-245"><a href="#DynamixelHelloXL430.stop-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.stop-246"><a href="#DynamixelHelloXL430.stop-246"><span class="linenos">246</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;disable_torque_on_stop&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.stop-247"><a href="#DynamixelHelloXL430.stop-247"><span class="linenos">247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.stop-248"><a href="#DynamixelHelloXL430.stop-248"><span class="linenos">248</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Shuts down machinery started in <code><a href="#DynamixelHelloXL430.startup">startup()</a></code></p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.pull_status" class="classattr">
                                        <input id="DynamixelHelloXL430.pull_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.pull_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.pull_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.pull_status-250"><a href="#DynamixelHelloXL430.pull_status-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.pull_status-251"><a href="#DynamixelHelloXL430.pull_status-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-252"><a href="#DynamixelHelloXL430.pull_status-252"><span class="linenos">252</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.pull_status-253"><a href="#DynamixelHelloXL430.pull_status-253"><span class="linenos">253</span></a>
</span><span id="DynamixelHelloXL430.pull_status-254"><a href="#DynamixelHelloXL430.pull_status-254"><span class="linenos">254</span></a>        <span class="n">pos_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.pull_status-255"><a href="#DynamixelHelloXL430.pull_status-255"><span class="linenos">255</span></a>        <span class="n">vel_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.pull_status-256"><a href="#DynamixelHelloXL430.pull_status-256"><span class="linenos">256</span></a>        <span class="n">eff_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.pull_status-257"><a href="#DynamixelHelloXL430.pull_status-257"><span class="linenos">257</span></a>        <span class="n">temp_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.pull_status-258"><a href="#DynamixelHelloXL430.pull_status-258"><span class="linenos">258</span></a>        <span class="n">err_valid</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.pull_status-259"><a href="#DynamixelHelloXL430.pull_status-259"><span class="linenos">259</span></a>
</span><span id="DynamixelHelloXL430.pull_status-260"><a href="#DynamixelHelloXL430.pull_status-260"><span class="linenos">260</span></a>        <span class="c1">#First pull new data from servo</span>
</span><span id="DynamixelHelloXL430.pull_status-261"><a href="#DynamixelHelloXL430.pull_status-261"><span class="linenos">261</span></a>        <span class="c1">#Or bring in data from a synchronized read</span>
</span><span id="DynamixelHelloXL430.pull_status-262"><a href="#DynamixelHelloXL430.pull_status-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-263"><a href="#DynamixelHelloXL430.pull_status-263"><span class="linenos">263</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-264"><a href="#DynamixelHelloXL430.pull_status-264"><span class="linenos">264</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-265"><a href="#DynamixelHelloXL430.pull_status-265"><span class="linenos">265</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-266"><a href="#DynamixelHelloXL430.pull_status-266"><span class="linenos">266</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-267"><a href="#DynamixelHelloXL430.pull_status-267"><span class="linenos">267</span></a>                <span class="n">pos_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430.pull_status-268"><a href="#DynamixelHelloXL430.pull_status-268"><span class="linenos">268</span></a>
</span><span id="DynamixelHelloXL430.pull_status-269"><a href="#DynamixelHelloXL430.pull_status-269"><span class="linenos">269</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-270"><a href="#DynamixelHelloXL430.pull_status-270"><span class="linenos">270</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-271"><a href="#DynamixelHelloXL430.pull_status-271"><span class="linenos">271</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-272"><a href="#DynamixelHelloXL430.pull_status-272"><span class="linenos">272</span></a>                <span class="n">vel_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430.pull_status-273"><a href="#DynamixelHelloXL430.pull_status-273"><span class="linenos">273</span></a>
</span><span id="DynamixelHelloXL430.pull_status-274"><a href="#DynamixelHelloXL430.pull_status-274"><span class="linenos">274</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-275"><a href="#DynamixelHelloXL430.pull_status-275"><span class="linenos">275</span></a>                    <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_load</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-276"><a href="#DynamixelHelloXL430.pull_status-276"><span class="linenos">276</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-277"><a href="#DynamixelHelloXL430.pull_status-277"><span class="linenos">277</span></a>                        <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_load</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-278"><a href="#DynamixelHelloXL430.pull_status-278"><span class="linenos">278</span></a>                    <span class="n">eff_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430.pull_status-279"><a href="#DynamixelHelloXL430.pull_status-279"><span class="linenos">279</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-280"><a href="#DynamixelHelloXL430.pull_status-280"><span class="linenos">280</span></a>                    <span class="n">eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-281"><a href="#DynamixelHelloXL430.pull_status-281"><span class="linenos">281</span></a>
</span><span id="DynamixelHelloXL430.pull_status-282"><a href="#DynamixelHelloXL430.pull_status-282"><span class="linenos">282</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-283"><a href="#DynamixelHelloXL430.pull_status-283"><span class="linenos">283</span></a>                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_temp</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-284"><a href="#DynamixelHelloXL430.pull_status-284"><span class="linenos">284</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-285"><a href="#DynamixelHelloXL430.pull_status-285"><span class="linenos">285</span></a>                        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_temp</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-286"><a href="#DynamixelHelloXL430.pull_status-286"><span class="linenos">286</span></a>                    <span class="n">temp_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430.pull_status-287"><a href="#DynamixelHelloXL430.pull_status-287"><span class="linenos">287</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-288"><a href="#DynamixelHelloXL430.pull_status-288"><span class="linenos">288</span></a>                    <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-289"><a href="#DynamixelHelloXL430.pull_status-289"><span class="linenos">289</span></a>
</span><span id="DynamixelHelloXL430.pull_status-290"><a href="#DynamixelHelloXL430.pull_status-290"><span class="linenos">290</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-291"><a href="#DynamixelHelloXL430.pull_status-291"><span class="linenos">291</span></a>                    <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_hardware_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-292"><a href="#DynamixelHelloXL430.pull_status-292"><span class="linenos">292</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-293"><a href="#DynamixelHelloXL430.pull_status-293"><span class="linenos">293</span></a>                        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_hardware_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-294"><a href="#DynamixelHelloXL430.pull_status-294"><span class="linenos">294</span></a>                    <span class="n">err_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span>
</span><span id="DynamixelHelloXL430.pull_status-295"><a href="#DynamixelHelloXL430.pull_status-295"><span class="linenos">295</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-296"><a href="#DynamixelHelloXL430.pull_status-296"><span class="linenos">296</span></a>                    <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-297"><a href="#DynamixelHelloXL430.pull_status-297"><span class="linenos">297</span></a>
</span><span id="DynamixelHelloXL430.pull_status-298"><a href="#DynamixelHelloXL430.pull_status-298"><span class="linenos">298</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_mux_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
</span><span id="DynamixelHelloXL430.pull_status-299"><a href="#DynamixelHelloXL430.pull_status-299"><span class="linenos">299</span></a>
</span><span id="DynamixelHelloXL430.pull_status-300"><a href="#DynamixelHelloXL430.pull_status-300"><span class="linenos">300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-301"><a href="#DynamixelHelloXL430.pull_status-301"><span class="linenos">301</span></a>
</span><span id="DynamixelHelloXL430.pull_status-302"><a href="#DynamixelHelloXL430.pull_status-302"><span class="linenos">302</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">pos_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">vel_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">eff_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">temp_valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">err_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-303"><a href="#DynamixelHelloXL430.pull_status-303"><span class="linenos">303</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during pull_status on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pull_status-304"><a href="#DynamixelHelloXL430.pull_status-304"><span class="linenos">304</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pull_status-305"><a href="#DynamixelHelloXL430.pull_status-305"><span class="linenos">305</span></a>                    <span class="k">return</span>
</span><span id="DynamixelHelloXL430.pull_status-306"><a href="#DynamixelHelloXL430.pull_status-306"><span class="linenos">306</span></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-307"><a href="#DynamixelHelloXL430.pull_status-307"><span class="linenos">307</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.pull_status-308"><a href="#DynamixelHelloXL430.pull_status-308"><span class="linenos">308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during pull_status  on </span><span class="si">%s</span><span class="s1">: &#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pull_status-309"><a href="#DynamixelHelloXL430.pull_status-309"><span class="linenos">309</span></a>                <span class="c1"># self.motor.port_handler.ser.reset_output_buffer()</span>
</span><span id="DynamixelHelloXL430.pull_status-310"><a href="#DynamixelHelloXL430.pull_status-310"><span class="linenos">310</span></a>                <span class="c1"># self.motor.port_handler.ser.reset_input_buffer()</span>
</span><span id="DynamixelHelloXL430.pull_status-311"><a href="#DynamixelHelloXL430.pull_status-311"><span class="linenos">311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pull_status-312"><a href="#DynamixelHelloXL430.pull_status-312"><span class="linenos">312</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-313"><a href="#DynamixelHelloXL430.pull_status-313"><span class="linenos">313</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span><span id="DynamixelHelloXL430.pull_status-314"><a href="#DynamixelHelloXL430.pull_status-314"><span class="linenos">314</span></a>                <span class="k">return</span>
</span><span id="DynamixelHelloXL430.pull_status-315"><a href="#DynamixelHelloXL430.pull_status-315"><span class="linenos">315</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-316"><a href="#DynamixelHelloXL430.pull_status-316"><span class="linenos">316</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-317"><a href="#DynamixelHelloXL430.pull_status-317"><span class="linenos">317</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-318"><a href="#DynamixelHelloXL430.pull_status-318"><span class="linenos">318</span></a>            <span class="n">eff</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;eff&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-319"><a href="#DynamixelHelloXL430.pull_status-319"><span class="linenos">319</span></a>            <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-320"><a href="#DynamixelHelloXL430.pull_status-320"><span class="linenos">320</span></a>            <span class="n">ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-321"><a href="#DynamixelHelloXL430.pull_status-321"><span class="linenos">321</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-322"><a href="#DynamixelHelloXL430.pull_status-322"><span class="linenos">322</span></a>
</span><span id="DynamixelHelloXL430.pull_status-323"><a href="#DynamixelHelloXL430.pull_status-323"><span class="linenos">323</span></a>        <span class="c1">#Now update status dictionary</span>
</span><span id="DynamixelHelloXL430.pull_status-324"><a href="#DynamixelHelloXL430.pull_status-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="n">pos_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-325"><a href="#DynamixelHelloXL430.pull_status-325"><span class="linenos">325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="DynamixelHelloXL430.pull_status-326"><a href="#DynamixelHelloXL430.pull_status-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.pull_status-327"><a href="#DynamixelHelloXL430.pull_status-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="n">vel_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-328"><a href="#DynamixelHelloXL430.pull_status-328"><span class="linenos">328</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="DynamixelHelloXL430.pull_status-329"><a href="#DynamixelHelloXL430.pull_status-329"><span class="linenos">329</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad_per_sec</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.pull_status-330"><a href="#DynamixelHelloXL430.pull_status-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">eff_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-331"><a href="#DynamixelHelloXL430.pull_status-331"><span class="linenos">331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eff</span>
</span><span id="DynamixelHelloXL430.pull_status-332"><a href="#DynamixelHelloXL430.pull_status-332"><span class="linenos">332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_pct_load</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">eff</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.pull_status-333"><a href="#DynamixelHelloXL430.pull_status-333"><span class="linenos">333</span></a>        <span class="k">if</span> <span class="n">temp_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-334"><a href="#DynamixelHelloXL430.pull_status-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pull_status-335"><a href="#DynamixelHelloXL430.pull_status-335"><span class="linenos">335</span></a>        <span class="k">if</span> <span class="n">err_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-336"><a href="#DynamixelHelloXL430.pull_status-336"><span class="linenos">336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="DynamixelHelloXL430.pull_status-337"><a href="#DynamixelHelloXL430.pull_status-337"><span class="linenos">337</span></a>
</span><span id="DynamixelHelloXL430.pull_status-338"><a href="#DynamixelHelloXL430.pull_status-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
</span><span id="DynamixelHelloXL430.pull_status-339"><a href="#DynamixelHelloXL430.pull_status-339"><span class="linenos">339</span></a>
</span><span id="DynamixelHelloXL430.pull_status-340"><a href="#DynamixelHelloXL430.pull_status-340"><span class="linenos">340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">err</span>
</span><span id="DynamixelHelloXL430.pull_status-341"><a href="#DynamixelHelloXL430.pull_status-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;input_voltage_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.pull_status-342"><a href="#DynamixelHelloXL430.pull_status-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.pull_status-343"><a href="#DynamixelHelloXL430.pull_status-343"><span class="linenos">343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">8</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.pull_status-344"><a href="#DynamixelHelloXL430.pull_status-344"><span class="linenos">344</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">16</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.pull_status-345"><a href="#DynamixelHelloXL430.pull_status-345"><span class="linenos">345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">32</span> <span class="o">!=</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.pull_status-346"><a href="#DynamixelHelloXL430.pull_status-346"><span class="linenos">346</span></a>
</span><span id="DynamixelHelloXL430.pull_status-347"><a href="#DynamixelHelloXL430.pull_status-347"><span class="linenos">347</span></a>        <span class="c1">#Finally flag if stalled at high effort for too long</span>
</span><span id="DynamixelHelloXL430.pull_status-348"><a href="#DynamixelHelloXL430.pull_status-348"><span class="linenos">348</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_min_vel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-349"><a href="#DynamixelHelloXL430.pull_status-349"><span class="linenos">349</span></a>        <span class="n">over_eff</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_max_effort&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.pull_status-350"><a href="#DynamixelHelloXL430.pull_status-350"><span class="linenos">350</span></a>
</span><span id="DynamixelHelloXL430.pull_status-351"><a href="#DynamixelHelloXL430.pull_status-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-352"><a href="#DynamixelHelloXL430.pull_status-352"><span class="linenos">352</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">over_eff</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-353"><a href="#DynamixelHelloXL430.pull_status-353"><span class="linenos">353</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.pull_status-354"><a href="#DynamixelHelloXL430.pull_status-354"><span class="linenos">354</span></a>            <span class="k">if</span> <span class="n">over_eff</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#Mark the start of being stalled and over-effort</span>
</span><span id="DynamixelHelloXL430.pull_status-355"><a href="#DynamixelHelloXL430.pull_status-355"><span class="linenos">355</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.pull_status-356"><a href="#DynamixelHelloXL430.pull_status-356"><span class="linenos">356</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;stall_max_time&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.pull_status-357"><a href="#DynamixelHelloXL430.pull_status-357"><span class="linenos">357</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.pull_status-358"><a href="#DynamixelHelloXL430.pull_status-358"><span class="linenos">358</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-359"><a href="#DynamixelHelloXL430.pull_status-359"><span class="linenos">359</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.pull_status-360"><a href="#DynamixelHelloXL430.pull_status-360"><span class="linenos">360</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pull_status-361"><a href="#DynamixelHelloXL430.pull_status-361"><span class="linenos">361</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ts_over_eff_start</span><span class="o">=</span><span class="kc">None</span>
</span><span id="DynamixelHelloXL430.pull_status-362"><a href="#DynamixelHelloXL430.pull_status-362"><span class="linenos">362</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Pull status used for different devices of the robot.</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.mark_zero" class="classattr">
                                        <input id="DynamixelHelloXL430.mark_zero-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_zero</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.mark_zero-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.mark_zero"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.mark_zero-364"><a href="#DynamixelHelloXL430.mark_zero-364"><span class="linenos">364</span></a>    <span class="k">def</span> <span class="nf">mark_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.mark_zero-365"><a href="#DynamixelHelloXL430.mark_zero-365"><span class="linenos">365</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.mark_zero-366"><a href="#DynamixelHelloXL430.mark_zero-366"><span class="linenos">366</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.mark_zero-367"><a href="#DynamixelHelloXL430.mark_zero-367"><span class="linenos">367</span></a>        <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.mark_zero-368"><a href="#DynamixelHelloXL430.mark_zero-368"><span class="linenos">368</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Marking current position of (ticks)&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39; as 0 (rad)&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.mark_zero-369"><a href="#DynamixelHelloXL430.mark_zero-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">x</span>
</span><span id="DynamixelHelloXL430.mark_zero-370"><a href="#DynamixelHelloXL430.mark_zero-370"><span class="linenos">370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write_device_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.wait_until_at_setpoint" class="classattr">
                                        <input id="DynamixelHelloXL430.wait_until_at_setpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wait_until_at_setpoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.wait_until_at_setpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.wait_until_at_setpoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.wait_until_at_setpoint-372"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-373"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-373"><span class="linenos">373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Polls for moving status to wait until at commanded position goal</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-374"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-374"><span class="linenos">374</span></a>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-375"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-375"><span class="linenos">375</span></a><span class="sd">        Returns</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-376"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-376"><span class="linenos">376</span></a><span class="sd">        -------</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-377"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-377"><span class="linenos">377</span></a><span class="sd">        bool</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-378"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-378"><span class="linenos">378</span></a><span class="sd">            True if success, False if timeout</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-379"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-379"><span class="linenos">379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-380"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-380"><span class="linenos">380</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-381"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-381"><span class="linenos">381</span></a>        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-382"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-382"><span class="linenos">382</span></a>            <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_moving_status</span><span class="p">()</span><span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-383"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-383"><span class="linenos">383</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-384"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-384"><span class="linenos">384</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.wait_until_at_setpoint-385"><a href="#DynamixelHelloXL430.wait_until_at_setpoint-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Polls for moving status to wait until at commanded position goal</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if success, False if timeout</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.pretty_print" class="classattr">
                                        <input id="DynamixelHelloXL430.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.pretty_print-387"><a href="#DynamixelHelloXL430.pretty_print-387"><span class="linenos">387</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.pretty_print-388"><a href="#DynamixelHelloXL430.pretty_print-388"><span class="linenos">388</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.pretty_print-389"><a href="#DynamixelHelloXL430.pretty_print-389"><span class="linenos">389</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- HelloXL430 ------ &#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-390"><a href="#DynamixelHelloXL430.pretty_print-390"><span class="linenos">390</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Servo not on bus&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-391"><a href="#DynamixelHelloXL430.pretty_print-391"><span class="linenos">391</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.pretty_print-392"><a href="#DynamixelHelloXL430.pretty_print-392"><span class="linenos">392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- HelloXL430 ------ &#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-393"><a href="#DynamixelHelloXL430.pretty_print-393"><span class="linenos">393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-394"><a href="#DynamixelHelloXL430.pretty_print-394"><span class="linenos">394</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-395"><a href="#DynamixelHelloXL430.pretty_print-395"><span class="linenos">395</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430.pretty_print-396"><a href="#DynamixelHelloXL430.pretty_print-396"><span class="linenos">396</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Position (ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_ticks&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-397"><a href="#DynamixelHelloXL430.pretty_print-397"><span class="linenos">397</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-398"><a href="#DynamixelHelloXL430.pretty_print-398"><span class="linenos">398</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity (ticks/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel_ticks&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-399"><a href="#DynamixelHelloXL430.pretty_print-399"><span class="linenos">399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (%)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-400"><a href="#DynamixelHelloXL430.pretty_print-400"><span class="linenos">400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-401"><a href="#DynamixelHelloXL430.pretty_print-401"><span class="linenos">401</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Temp&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-402"><a href="#DynamixelHelloXL430.pretty_print-402"><span class="linenos">402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comm Errors&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">comm_errors</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-403"><a href="#DynamixelHelloXL430.pretty_print-403"><span class="linenos">403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;hardware_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-404"><a href="#DynamixelHelloXL430.pretty_print-404"><span class="linenos">404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Input Voltage Error: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;input_voltage_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-405"><a href="#DynamixelHelloXL430.pretty_print-405"><span class="linenos">405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Overheating Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overheating_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-406"><a href="#DynamixelHelloXL430.pretty_print-406"><span class="linenos">406</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Motor Encoder Error: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;motor_encoder_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-407"><a href="#DynamixelHelloXL430.pretty_print-407"><span class="linenos">407</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Electrical Shock Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;electrical_shock_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-408"><a href="#DynamixelHelloXL430.pretty_print-408"><span class="linenos">408</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hardware Error: Overload Error: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;overload_error&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-409"><a href="#DynamixelHelloXL430.pretty_print-409"><span class="linenos">409</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Watchdog Errors: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-410"><a href="#DynamixelHelloXL430.pretty_print-410"><span class="linenos">410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp PC&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp_pc&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-411"><a href="#DynamixelHelloXL430.pretty_print-411"><span class="linenos">411</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range (ticks)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-412"><a href="#DynamixelHelloXL430.pretty_print-412"><span class="linenos">412</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range (rad) [&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; , &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-413"><a href="#DynamixelHelloXL430.pretty_print-413"><span class="linenos">413</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stalled&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stalled&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-414"><a href="#DynamixelHelloXL430.pretty_print-414"><span class="linenos">414</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stall Overload&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;stall_overload&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.pretty_print-415"><a href="#DynamixelHelloXL430.pretty_print-415"><span class="linenos">415</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Is Calibrated&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.pretty_print-416"><a href="#DynamixelHelloXL430.pretty_print-416"><span class="linenos">416</span></a>        <span class="c1">#self.motor.pretty_print()</span>
</span></pre></div>


            <div class="docstring"><p>Pretty print the parameters.</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.bound_value" class="classattr">
                                        <input id="DynamixelHelloXL430.bound_value-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bound_value</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">value</span>, </span><span class="param"><span class="n">lower_bound</span>, </span><span class="param"><span class="n">upper_bound</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.bound_value-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.bound_value"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.bound_value-418"><a href="#DynamixelHelloXL430.bound_value-418"><span class="linenos">418</span></a>    <span class="k">def</span> <span class="nf">bound_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.bound_value-419"><a href="#DynamixelHelloXL430.bound_value-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.bound_value-420"><a href="#DynamixelHelloXL430.bound_value-420"><span class="linenos">420</span></a>            <span class="k">return</span> <span class="n">lower_bound</span>
</span><span id="DynamixelHelloXL430.bound_value-421"><a href="#DynamixelHelloXL430.bound_value-421"><span class="linenos">421</span></a>        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.bound_value-422"><a href="#DynamixelHelloXL430.bound_value-422"><span class="linenos">422</span></a>            <span class="k">return</span> <span class="n">upper_bound</span>
</span><span id="DynamixelHelloXL430.bound_value-423"><a href="#DynamixelHelloXL430.bound_value-423"><span class="linenos">423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.bound_value-424"><a href="#DynamixelHelloXL430.bound_value-424"><span class="linenos">424</span></a>            <span class="k">return</span> <span class="n">value</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.step_sentry" class="classattr">
                                        <input id="DynamixelHelloXL430.step_sentry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">step_sentry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">robot</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.step_sentry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.step_sentry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.step_sentry-426"><a href="#DynamixelHelloXL430.step_sentry-426"><span class="linenos">426</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.step_sentry-427"><a href="#DynamixelHelloXL430.step_sentry-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;dynamixel_stop_on_runstop&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.step_sentry-428"><a href="#DynamixelHelloXL430.step_sentry-428"><span class="linenos">428</span></a>            <span class="n">is_runstopped</span> <span class="o">=</span> <span class="n">robot</span><span class="o">.</span><span class="n">pimu</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_event&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.step_sentry-429"><a href="#DynamixelHelloXL430.step_sentry-429"><span class="linenos">429</span></a>            <span class="k">if</span> <span class="n">is_runstopped</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-430"><a href="#DynamixelHelloXL430.step_sentry-430"><span class="linenos">430</span></a>                <span class="k">if</span> <span class="n">is_runstopped</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-431"><a href="#DynamixelHelloXL430.step_sentry-431"><span class="linenos">431</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">stop_trajectory</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-432"><a href="#DynamixelHelloXL430.step_sentry-432"><span class="linenos">432</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-433"><a href="#DynamixelHelloXL430.step_sentry-433"><span class="linenos">433</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-434"><a href="#DynamixelHelloXL430.step_sentry-434"><span class="linenos">434</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-435"><a href="#DynamixelHelloXL430.step_sentry-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span> <span class="o">=</span> <span class="n">is_runstopped</span>
</span><span id="DynamixelHelloXL430.step_sentry-436"><a href="#DynamixelHelloXL430.step_sentry-436"><span class="linenos">436</span></a>        
</span><span id="DynamixelHelloXL430.step_sentry-437"><a href="#DynamixelHelloXL430.step_sentry-437"><span class="linenos">437</span></a>        <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dist_to_limits</span><span class="p">()</span> <span class="c1"># calculate dist to min,max limits</span>
</span><span id="DynamixelHelloXL430.step_sentry-438"><a href="#DynamixelHelloXL430.step_sentry-438"><span class="linenos">438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.step_sentry-439"><a href="#DynamixelHelloXL430.step_sentry-439"><span class="linenos">439</span></a>
</span><span id="DynamixelHelloXL430.step_sentry-440"><a href="#DynamixelHelloXL430.step_sentry-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist_to_min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vel_brake_zone_thresh</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-441"><a href="#DynamixelHelloXL430.step_sentry-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;In Vel-Braking Zone.&quot;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.step_sentry-442"><a href="#DynamixelHelloXL430.step_sentry-442"><span class="linenos">442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.step_sentry-443"><a href="#DynamixelHelloXL430.step_sentry-443"><span class="linenos">443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-444"><a href="#DynamixelHelloXL430.step_sentry-444"><span class="linenos">444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.step_sentry-445"><a href="#DynamixelHelloXL430.step_sentry-445"><span class="linenos">445</span></a>
</span><span id="DynamixelHelloXL430.step_sentry-446"><a href="#DynamixelHelloXL430.step_sentry-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-447"><a href="#DynamixelHelloXL430.step_sentry-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-448"><a href="#DynamixelHelloXL430.step_sentry-448"><span class="linenos">448</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-449"><a href="#DynamixelHelloXL430.step_sentry-449"><span class="linenos">449</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-450"><a href="#DynamixelHelloXL430.step_sentry-450"><span class="linenos">450</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.step_sentry-451"><a href="#DynamixelHelloXL430.step_sentry-451"><span class="linenos">451</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-452"><a href="#DynamixelHelloXL430.step_sentry-452"><span class="linenos">452</span></a>            
</span><span id="DynamixelHelloXL430.step_sentry-453"><a href="#DynamixelHelloXL430.step_sentry-453"><span class="linenos">453</span></a>            <span class="c1"># disable watchdog if a set_velocity() command is not passed above 1s</span>
</span><span id="DynamixelHelloXL430.step_sentry-454"><a href="#DynamixelHelloXL430.step_sentry-454"><span class="linenos">454</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-455"><a href="#DynamixelHelloXL430.step_sentry-455"><span class="linenos">455</span></a>                <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-456"><a href="#DynamixelHelloXL430.step_sentry-456"><span class="linenos">456</span></a>                    <span class="n">wd_error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_watchdog_error</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-457"><a href="#DynamixelHelloXL430.step_sentry-457"><span class="linenos">457</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-458"><a href="#DynamixelHelloXL430.step_sentry-458"><span class="linenos">458</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_watchdog</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-459"><a href="#DynamixelHelloXL430.step_sentry-459"><span class="linenos">459</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">watchdog_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.step_sentry-460"><a href="#DynamixelHelloXL430.step_sentry-460"><span class="linenos">460</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.step_sentry-461"><a href="#DynamixelHelloXL430.step_sentry-461"><span class="linenos">461</span></a>                    <span class="k">if</span> <span class="n">wd_error</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.step_sentry-462"><a href="#DynamixelHelloXL430.step_sentry-462"><span class="linenos">462</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Watchdog error during Velocity control for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.step_sentry-463"><a href="#DynamixelHelloXL430.step_sentry-463"><span class="linenos">463</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;watchdog_errors&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
</span><span id="DynamixelHelloXL430.step_sentry-464"><a href="#DynamixelHelloXL430.step_sentry-464"><span class="linenos">464</span></a>
</span><span id="DynamixelHelloXL430.step_sentry-465"><a href="#DynamixelHelloXL430.step_sentry-465"><span class="linenos">465</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_safety_vel_brake_zone</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Perform a step in the sentry routine.</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.get_dist_to_limits" class="classattr">
                                        <input id="DynamixelHelloXL430.get_dist_to_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_dist_to_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.get_dist_to_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.get_dist_to_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.get_dist_to_limits-484"><a href="#DynamixelHelloXL430.get_dist_to_limits-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="nf">get_dist_to_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-485"><a href="#DynamixelHelloXL430.get_dist_to_limits-485"><span class="linenos">485</span></a>        <span class="n">current_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-486"><a href="#DynamixelHelloXL430.get_dist_to_limits-486"><span class="linenos">486</span></a>        <span class="n">min_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-487"><a href="#DynamixelHelloXL430.get_dist_to_limits-487"><span class="linenos">487</span></a>        <span class="n">max_position</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-488"><a href="#DynamixelHelloXL430.get_dist_to_limits-488"><span class="linenos">488</span></a>        <span class="n">delta1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">min_position</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-489"><a href="#DynamixelHelloXL430.get_dist_to_limits-489"><span class="linenos">489</span></a>        <span class="n">delta2</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">max_position</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-490"><a href="#DynamixelHelloXL430.get_dist_to_limits-490"><span class="linenos">490</span></a>        
</span><span id="DynamixelHelloXL430.get_dist_to_limits-491"><a href="#DynamixelHelloXL430.get_dist_to_limits-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="n">delta2</span><span class="o">&lt;</span><span class="n">threshold</span> <span class="ow">or</span> <span class="n">delta1</span><span class="o">&lt;</span><span class="n">threshold</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-492"><a href="#DynamixelHelloXL430.get_dist_to_limits-492"><span class="linenos">492</span></a>            <span class="k">return</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-493"><a href="#DynamixelHelloXL430.get_dist_to_limits-493"><span class="linenos">493</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.get_dist_to_limits-494"><a href="#DynamixelHelloXL430.get_dist_to_limits-494"><span class="linenos">494</span></a>            <span class="k">return</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.reboot" class="classattr">
                                        <input id="DynamixelHelloXL430.reboot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reboot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.reboot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.reboot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.reboot-498"><a href="#DynamixelHelloXL430.reboot-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="nf">reboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.reboot-499"><a href="#DynamixelHelloXL430.reboot-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.reboot-500"><a href="#DynamixelHelloXL430.reboot-500"><span class="linenos">500</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.reboot-501"><a href="#DynamixelHelloXL430.reboot-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">do_reboot</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.enable_torque" class="classattr">
                                        <input id="DynamixelHelloXL430.enable_torque-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_torque</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.enable_torque-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.enable_torque"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.enable_torque-503"><a href="#DynamixelHelloXL430.enable_torque-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">enable_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.enable_torque-504"><a href="#DynamixelHelloXL430.enable_torque-504"><span class="linenos">504</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_torque-505"><a href="#DynamixelHelloXL430.enable_torque-505"><span class="linenos">505</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.enable_torque-506"><a href="#DynamixelHelloXL430.enable_torque-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.disable_torque" class="classattr">
                                        <input id="DynamixelHelloXL430.disable_torque-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_torque</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.disable_torque-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.disable_torque"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.disable_torque-508"><a href="#DynamixelHelloXL430.disable_torque-508"><span class="linenos">508</span></a>    <span class="k">def</span> <span class="nf">disable_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.disable_torque-509"><a href="#DynamixelHelloXL430.disable_torque-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.disable_torque-510"><a href="#DynamixelHelloXL430.disable_torque-510"><span class="linenos">510</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.disable_torque-511"><a href="#DynamixelHelloXL430.disable_torque-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.move_to_vel" class="classattr">
                                        <input id="DynamixelHelloXL430.move_to_vel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_to_vel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">v_des</span>, </span><span class="param"><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.move_to_vel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.move_to_vel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.move_to_vel-513"><a href="#DynamixelHelloXL430.move_to_vel-513"><span class="linenos">513</span></a>    <span class="k">def</span> <span class="nf">move_to_vel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_to_vel-514"><a href="#DynamixelHelloXL430.move_to_vel-514"><span class="linenos">514</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DynamixelHelloXL430.move_to_vel-515"><a href="#DynamixelHelloXL430.move_to_vel-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to_vel-516"><a href="#DynamixelHelloXL430.move_to_vel-516"><span class="linenos">516</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.move_to_vel-517"><a href="#DynamixelHelloXL430.move_to_vel-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to_vel-518"><a href="#DynamixelHelloXL430.move_to_vel-518"><span class="linenos">518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to_vel-519"><a href="#DynamixelHelloXL430.move_to_vel-519"><span class="linenos">519</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to_vel-520"><a href="#DynamixelHelloXL430.move_to_vel-520"><span class="linenos">520</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.move_to_vel-521"><a href="#DynamixelHelloXL430.move_to_vel-521"><span class="linenos">521</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.move_to_vel-522"><a href="#DynamixelHelloXL430.move_to_vel-522"><span class="linenos">522</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_to_vel-523"><a href="#DynamixelHelloXL430.move_to_vel-523"><span class="linenos">523</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to_vel-524"><a href="#DynamixelHelloXL430.move_to_vel-524"><span class="linenos">524</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to_vel-525"><a href="#DynamixelHelloXL430.move_to_vel-525"><span class="linenos">525</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.move_to_vel-526"><a href="#DynamixelHelloXL430.move_to_vel-526"><span class="linenos">526</span></a>                <span class="k">break</span>
</span><span id="DynamixelHelloXL430.move_to_vel-527"><a href="#DynamixelHelloXL430.move_to_vel-527"><span class="linenos">527</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_to_vel-528"><a href="#DynamixelHelloXL430.move_to_vel-528"><span class="linenos">528</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to_vel on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to_vel-529"><a href="#DynamixelHelloXL430.move_to_vel-529"><span class="linenos">529</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to_vel-530"><a href="#DynamixelHelloXL430.move_to_vel-530"><span class="linenos">530</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to_vel-531"><a href="#DynamixelHelloXL430.move_to_vel-531"><span class="linenos">531</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.set_velocity" class="classattr">
                                        <input id="DynamixelHelloXL430.set_velocity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_velocity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">v_des</span>, </span><span class="param"><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.set_velocity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.set_velocity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.set_velocity-533"><a href="#DynamixelHelloXL430.set_velocity-533"><span class="linenos">533</span></a>    <span class="k">def</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_velocity-534"><a href="#DynamixelHelloXL430.set_velocity-534"><span class="linenos">534</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_des</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.set_velocity-535"><a href="#DynamixelHelloXL430.set_velocity-535"><span class="linenos">535</span></a>        <span class="n">v_des</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">v</span> <span class="k">if</span> <span class="n">v_des</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="n">v</span>
</span><span id="DynamixelHelloXL430.set_velocity-536"><a href="#DynamixelHelloXL430.set_velocity-536"><span class="linenos">536</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DynamixelHelloXL430.set_velocity-537"><a href="#DynamixelHelloXL430.set_velocity-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_velocity-538"><a href="#DynamixelHelloXL430.set_velocity-538"><span class="linenos">538</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.set_velocity-539"><a href="#DynamixelHelloXL430.set_velocity-539"><span class="linenos">539</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_velocity-540"><a href="#DynamixelHelloXL430.set_velocity-540"><span class="linenos">540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-541"><a href="#DynamixelHelloXL430.set_velocity-541"><span class="linenos">541</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-542"><a href="#DynamixelHelloXL430.set_velocity-542"><span class="linenos">542</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.set_velocity-543"><a href="#DynamixelHelloXL430.set_velocity-543"><span class="linenos">543</span></a>        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.set_velocity-544"><a href="#DynamixelHelloXL430.set_velocity-544"><span class="linenos">544</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_operating_mode</span><span class="p">()</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_velocity-545"><a href="#DynamixelHelloXL430.set_velocity-545"><span class="linenos">545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_velocity_ctrl</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.set_velocity-546"><a href="#DynamixelHelloXL430.set_velocity-546"><span class="linenos">546</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_velocity-547"><a href="#DynamixelHelloXL430.set_velocity-547"><span class="linenos">547</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_velocity-548"><a href="#DynamixelHelloXL430.set_velocity-548"><span class="linenos">548</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;set_safe_velocity&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_brake_zone</span><span class="p">:</span> <span class="c1"># only when sentry is active</span>
</span><span id="DynamixelHelloXL430.set_velocity-549"><a href="#DynamixelHelloXL430.set_velocity-549"><span class="linenos">549</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_step_vel_braking</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-550"><a href="#DynamixelHelloXL430.set_velocity-550"><span class="linenos">550</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_velocity-551"><a href="#DynamixelHelloXL430.set_velocity-551"><span class="linenos">551</span></a>                    <span class="n">t_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-552"><a href="#DynamixelHelloXL430.set_velocity-552"><span class="linenos">552</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">t_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-553"><a href="#DynamixelHelloXL430.set_velocity-553"><span class="linenos">553</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_prev_set_vel_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.set_velocity-554"><a href="#DynamixelHelloXL430.set_velocity-554"><span class="linenos">554</span></a>                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.set_velocity-555"><a href="#DynamixelHelloXL430.set_velocity-555"><span class="linenos">555</span></a>                <span class="k">break</span>
</span><span id="DynamixelHelloXL430.set_velocity-556"><a href="#DynamixelHelloXL430.set_velocity-556"><span class="linenos">556</span></a>            <span class="k">except</span><span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_velocity-557"><a href="#DynamixelHelloXL430.set_velocity-557"><span class="linenos">557</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to_vel on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-558"><a href="#DynamixelHelloXL430.set_velocity-558"><span class="linenos">558</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_velocity-559"><a href="#DynamixelHelloXL430.set_velocity-559"><span class="linenos">559</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_velocity-560"><a href="#DynamixelHelloXL430.set_velocity-560"><span class="linenos">560</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.enable_velocity_ctrl" class="classattr">
                                        <input id="DynamixelHelloXL430.enable_velocity_ctrl-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_velocity_ctrl</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.enable_velocity_ctrl-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.enable_velocity_ctrl"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.enable_velocity_ctrl-602"><a href="#DynamixelHelloXL430.enable_velocity_ctrl-602"><span class="linenos">602</span></a>    <span class="k">def</span> <span class="nf">enable_velocity_ctrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.enable_velocity_ctrl-603"><a href="#DynamixelHelloXL430.enable_velocity_ctrl-603"><span class="linenos">603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_velocity_ctrl-604"><a href="#DynamixelHelloXL430.enable_velocity_ctrl-604"><span class="linenos">604</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_vel</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_velocity_ctrl-605"><a href="#DynamixelHelloXL430.enable_velocity_ctrl-605"><span class="linenos">605</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_velocity_ctrl-606"><a href="#DynamixelHelloXL430.enable_velocity_ctrl-606"><span class="linenos">606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.move_to" class="classattr">
                                        <input id="DynamixelHelloXL430.move_to-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_to</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x_des</span>, </span><span class="param"><span class="n">v_des</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.move_to-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.move_to"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.move_to-608"><a href="#DynamixelHelloXL430.move_to-608"><span class="linenos">608</span></a>    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_to-609"><a href="#DynamixelHelloXL430.move_to-609"><span class="linenos">609</span></a>        <span class="n">nretry</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DynamixelHelloXL430.move_to-610"><a href="#DynamixelHelloXL430.move_to-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to-611"><a href="#DynamixelHelloXL430.move_to-611"><span class="linenos">611</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.move_to-612"><a href="#DynamixelHelloXL430.move_to-612"><span class="linenos">612</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to-613"><a href="#DynamixelHelloXL430.move_to-613"><span class="linenos">613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-614"><a href="#DynamixelHelloXL430.move_to-614"><span class="linenos">614</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dynamixel not calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-615"><a href="#DynamixelHelloXL430.move_to-615"><span class="linenos">615</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.move_to-616"><a href="#DynamixelHelloXL430.move_to-616"><span class="linenos">616</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to-617"><a href="#DynamixelHelloXL430.move_to-617"><span class="linenos">617</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.move_to-618"><a href="#DynamixelHelloXL430.move_to-618"><span class="linenos">618</span></a>        <span class="c1">#print(&#39;Motion Params&#39;,v_des,a_des)</span>
</span><span id="DynamixelHelloXL430.move_to-619"><a href="#DynamixelHelloXL430.move_to-619"><span class="linenos">619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="n">v_des</span><span class="p">,</span><span class="n">a_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-620"><a href="#DynamixelHelloXL430.move_to-620"><span class="linenos">620</span></a>        <span class="n">old_x_des</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="DynamixelHelloXL430.move_to-621"><a href="#DynamixelHelloXL430.move_to-621"><span class="linenos">621</span></a>        <span class="n">x_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_des</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_soft_motion_limits</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.move_to-622"><a href="#DynamixelHelloXL430.move_to-622"><span class="linenos">622</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="o">!=</span> <span class="n">old_x_des</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to-623"><a href="#DynamixelHelloXL430.move_to-623"><span class="linenos">623</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Clipping move_to(</span><span class="si">{0}</span><span class="s1">) with soft limits </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old_x_des</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soft_motion_limits</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]))</span>
</span><span id="DynamixelHelloXL430.move_to-624"><a href="#DynamixelHelloXL430.move_to-624"><span class="linenos">624</span></a>        <span class="n">t_des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks</span><span class="p">(</span><span class="n">x_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-625"><a href="#DynamixelHelloXL430.move_to-625"><span class="linenos">625</span></a>        <span class="n">t_des</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t_des</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.move_to-626"><a href="#DynamixelHelloXL430.move_to-626"><span class="linenos">626</span></a>        <span class="n">success</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.move_to-627"><a href="#DynamixelHelloXL430.move_to-627"><span class="linenos">627</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nretry</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_to-628"><a href="#DynamixelHelloXL430.move_to-628"><span class="linenos">628</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to-629"><a href="#DynamixelHelloXL430.move_to-629"><span class="linenos">629</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">go_to_pos</span><span class="p">(</span><span class="n">t_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-630"><a href="#DynamixelHelloXL430.move_to-630"><span class="linenos">630</span></a>                <span class="n">success</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430.move_to-631"><a href="#DynamixelHelloXL430.move_to-631"><span class="linenos">631</span></a>                <span class="k">break</span>
</span><span id="DynamixelHelloXL430.move_to-632"><a href="#DynamixelHelloXL430.move_to-632"><span class="linenos">632</span></a>            <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_to-633"><a href="#DynamixelHelloXL430.move_to-633"><span class="linenos">633</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_to on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-634"><a href="#DynamixelHelloXL430.move_to-634"><span class="linenos">634</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_to-635"><a href="#DynamixelHelloXL430.move_to-635"><span class="linenos">635</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_to-636"><a href="#DynamixelHelloXL430.move_to-636"><span class="linenos">636</span></a>                    <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.set_motion_params" class="classattr">
                                        <input id="DynamixelHelloXL430.set_motion_params-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_motion_params</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">v_des</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">force</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.set_motion_params-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.set_motion_params"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.set_motion_params-638"><a href="#DynamixelHelloXL430.set_motion_params-638"><span class="linenos">638</span></a>    <span class="k">def</span> <span class="nf">set_motion_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_motion_params-639"><a href="#DynamixelHelloXL430.set_motion_params-639"><span class="linenos">639</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_motion_params-640"><a href="#DynamixelHelloXL430.set_motion_params-640"><span class="linenos">640</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_motion_params-641"><a href="#DynamixelHelloXL430.set_motion_params-641"><span class="linenos">641</span></a>                <span class="k">return</span>
</span><span id="DynamixelHelloXL430.set_motion_params-642"><a href="#DynamixelHelloXL430.set_motion_params-642"><span class="linenos">642</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_des</span><span class="p">)</span> <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.set_motion_params-643"><a href="#DynamixelHelloXL430.set_motion_params-643"><span class="linenos">643</span></a>            <span class="n">v_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">v_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_motion_params-644"><a href="#DynamixelHelloXL430.set_motion_params-644"><span class="linenos">644</span></a>            <span class="k">if</span> <span class="n">v_des</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_motion_params-645"><a href="#DynamixelHelloXL430.set_motion_params-645"><span class="linenos">645</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_velocity</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="n">v_des</span><span class="p">)))</span>
</span><span id="DynamixelHelloXL430.set_motion_params-646"><a href="#DynamixelHelloXL430.set_motion_params-646"><span class="linenos">646</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">v_des</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="DynamixelHelloXL430.set_motion_params-647"><a href="#DynamixelHelloXL430.set_motion_params-647"><span class="linenos">647</span></a>
</span><span id="DynamixelHelloXL430.set_motion_params-648"><a href="#DynamixelHelloXL430.set_motion_params-648"><span class="linenos">648</span></a>            <span class="n">a_des</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a_des</span><span class="p">)</span> <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.set_motion_params-649"><a href="#DynamixelHelloXL430.set_motion_params-649"><span class="linenos">649</span></a>            <span class="n">a_des</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">],</span> <span class="n">a_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_motion_params-650"><a href="#DynamixelHelloXL430.set_motion_params-650"><span class="linenos">650</span></a>            <span class="k">if</span> <span class="n">a_des</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_motion_params-651"><a href="#DynamixelHelloXL430.set_motion_params-651"><span class="linenos">651</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_profile_acceleration</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="n">a_des</span><span class="p">)))</span>
</span><span id="DynamixelHelloXL430.set_motion_params-652"><a href="#DynamixelHelloXL430.set_motion_params-652"><span class="linenos">652</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">a_des</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="DynamixelHelloXL430.set_motion_params-653"><a href="#DynamixelHelloXL430.set_motion_params-653"><span class="linenos">653</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_motion_params-654"><a href="#DynamixelHelloXL430.set_motion_params-654"><span class="linenos">654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during set_motion_params on: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_motion_params-655"><a href="#DynamixelHelloXL430.set_motion_params-655"><span class="linenos">655</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_motion_params-656"><a href="#DynamixelHelloXL430.set_motion_params-656"><span class="linenos">656</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_motion_params-657"><a href="#DynamixelHelloXL430.set_motion_params-657"><span class="linenos">657</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.move_by" class="classattr">
                                        <input id="DynamixelHelloXL430.move_by-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">move_by</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x_des</span>, </span><span class="param"><span class="n">v_des</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">a_des</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.move_by-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.move_by"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.move_by-660"><a href="#DynamixelHelloXL430.move_by-660"><span class="linenos">660</span></a>    <span class="k">def</span> <span class="nf">move_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_by-661"><a href="#DynamixelHelloXL430.move_by-661"><span class="linenos">661</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_by-662"><a href="#DynamixelHelloXL430.move_by-662"><span class="linenos">662</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.move_by-663"><a href="#DynamixelHelloXL430.move_by-663"><span class="linenos">663</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_by-664"><a href="#DynamixelHelloXL430.move_by-664"><span class="linenos">664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.move_by-665"><a href="#DynamixelHelloXL430.move_by-665"><span class="linenos">665</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_by-666"><a href="#DynamixelHelloXL430.move_by-666"><span class="linenos">666</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_des</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.00002</span><span class="p">:</span> <span class="c1">#Avoid drift</span>
</span><span id="DynamixelHelloXL430.move_by-667"><a href="#DynamixelHelloXL430.move_by-667"><span class="linenos">667</span></a>                <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.move_by-668"><a href="#DynamixelHelloXL430.move_by-668"><span class="linenos">668</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;retry_on_comm_failure&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.move_by-669"><a href="#DynamixelHelloXL430.move_by-669"><span class="linenos">669</span></a>                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.move_by-670"><a href="#DynamixelHelloXL430.move_by-670"><span class="linenos">670</span></a>
</span><span id="DynamixelHelloXL430.move_by-671"><a href="#DynamixelHelloXL430.move_by-671"><span class="linenos">671</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">last_comm_success</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_by-672"><a href="#DynamixelHelloXL430.move_by-672"><span class="linenos">672</span></a>                    <span class="n">cx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_by-673"><a href="#DynamixelHelloXL430.move_by-673"><span class="linenos">673</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">x_des</span><span class="p">,</span> <span class="n">v_des</span><span class="p">,</span> <span class="n">a_des</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_by-674"><a href="#DynamixelHelloXL430.move_by-674"><span class="linenos">674</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_by-675"><a href="#DynamixelHelloXL430.move_by-675"><span class="linenos">675</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Move_By comm failure on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_by-676"><a href="#DynamixelHelloXL430.move_by-676"><span class="linenos">676</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.move_by-677"><a href="#DynamixelHelloXL430.move_by-677"><span class="linenos">677</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during move_by on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_by-678"><a href="#DynamixelHelloXL430.move_by-678"><span class="linenos">678</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.move_by-679"><a href="#DynamixelHelloXL430.move_by-679"><span class="linenos">679</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.move_by-680"><a href="#DynamixelHelloXL430.move_by-680"><span class="linenos">680</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.quick_stop" class="classattr">
                                        <input id="DynamixelHelloXL430.quick_stop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quick_stop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.quick_stop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.quick_stop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.quick_stop-682"><a href="#DynamixelHelloXL430.quick_stop-682"><span class="linenos">682</span></a>    <span class="k">def</span> <span class="nf">quick_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.quick_stop-683"><a href="#DynamixelHelloXL430.quick_stop-683"><span class="linenos">683</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.quick_stop-684"><a href="#DynamixelHelloXL430.quick_stop-684"><span class="linenos">684</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.quick_stop-685"><a href="#DynamixelHelloXL430.quick_stop-685"><span class="linenos">685</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.quick_stop-686"><a href="#DynamixelHelloXL430.quick_stop-686"><span class="linenos">686</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.quick_stop-687"><a href="#DynamixelHelloXL430.quick_stop-687"><span class="linenos">687</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.quick_stop-688"><a href="#DynamixelHelloXL430.quick_stop-688"><span class="linenos">688</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.quick_stop-689"><a href="#DynamixelHelloXL430.quick_stop-689"><span class="linenos">689</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during quick_stop on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.quick_stop-690"><a href="#DynamixelHelloXL430.quick_stop-690"><span class="linenos">690</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.quick_stop-691"><a href="#DynamixelHelloXL430.quick_stop-691"><span class="linenos">691</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.quick_stop-692"><a href="#DynamixelHelloXL430.quick_stop-692"><span class="linenos">692</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.enable_pos" class="classattr">
                                        <input id="DynamixelHelloXL430.enable_pos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.enable_pos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.enable_pos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.enable_pos-694"><a href="#DynamixelHelloXL430.enable_pos-694"><span class="linenos">694</span></a>    <span class="k">def</span> <span class="nf">enable_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.enable_pos-695"><a href="#DynamixelHelloXL430.enable_pos-695"><span class="linenos">695</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pos-696"><a href="#DynamixelHelloXL430.enable_pos-696"><span class="linenos">696</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.enable_pos-697"><a href="#DynamixelHelloXL430.enable_pos-697"><span class="linenos">697</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pos-698"><a href="#DynamixelHelloXL430.enable_pos-698"><span class="linenos">698</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pos-699"><a href="#DynamixelHelloXL430.enable_pos-699"><span class="linenos">699</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.enable_pos-700"><a href="#DynamixelHelloXL430.enable_pos-700"><span class="linenos">700</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_multiturn</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pos-701"><a href="#DynamixelHelloXL430.enable_pos-701"><span class="linenos">701</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pos-702"><a href="#DynamixelHelloXL430.enable_pos-702"><span class="linenos">702</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pos-703"><a href="#DynamixelHelloXL430.enable_pos-703"><span class="linenos">703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pos-704"><a href="#DynamixelHelloXL430.enable_pos-704"><span class="linenos">704</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.enable_pos-705"><a href="#DynamixelHelloXL430.enable_pos-705"><span class="linenos">705</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">in_vel_mode</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.enable_pos-706"><a href="#DynamixelHelloXL430.enable_pos-706"><span class="linenos">706</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.enable_pos-707"><a href="#DynamixelHelloXL430.enable_pos-707"><span class="linenos">707</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during enable_pos on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.enable_pos-708"><a href="#DynamixelHelloXL430.enable_pos-708"><span class="linenos">708</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.enable_pos-709"><a href="#DynamixelHelloXL430.enable_pos-709"><span class="linenos">709</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pos-710"><a href="#DynamixelHelloXL430.enable_pos-710"><span class="linenos">710</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.enable_pwm" class="classattr">
                                        <input id="DynamixelHelloXL430.enable_pwm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pwm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.enable_pwm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.enable_pwm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.enable_pwm-712"><a href="#DynamixelHelloXL430.enable_pwm-712"><span class="linenos">712</span></a>    <span class="k">def</span> <span class="nf">enable_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.enable_pwm-713"><a href="#DynamixelHelloXL430.enable_pwm-713"><span class="linenos">713</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pwm-714"><a href="#DynamixelHelloXL430.enable_pwm-714"><span class="linenos">714</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.enable_pwm-715"><a href="#DynamixelHelloXL430.enable_pwm-715"><span class="linenos">715</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pwm-716"><a href="#DynamixelHelloXL430.enable_pwm-716"><span class="linenos">716</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pwm-717"><a href="#DynamixelHelloXL430.enable_pwm-717"><span class="linenos">717</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pwm-718"><a href="#DynamixelHelloXL430.enable_pwm-718"><span class="linenos">718</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.enable_pwm-719"><a href="#DynamixelHelloXL430.enable_pwm-719"><span class="linenos">719</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.enable_pwm-720"><a href="#DynamixelHelloXL430.enable_pwm-720"><span class="linenos">720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during enable_pwm on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.enable_pwm-721"><a href="#DynamixelHelloXL430.enable_pwm-721"><span class="linenos">721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.enable_pwm-722"><a href="#DynamixelHelloXL430.enable_pwm-722"><span class="linenos">722</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.enable_pwm-723"><a href="#DynamixelHelloXL430.enable_pwm-723"><span class="linenos">723</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.set_pwm" class="classattr">
                                        <input id="DynamixelHelloXL430.set_pwm-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pwm</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.set_pwm-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.set_pwm"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.set_pwm-726"><a href="#DynamixelHelloXL430.set_pwm-726"><span class="linenos">726</span></a>    <span class="k">def</span> <span class="nf">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_pwm-727"><a href="#DynamixelHelloXL430.set_pwm-727"><span class="linenos">727</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_pwm-728"><a href="#DynamixelHelloXL430.set_pwm-728"><span class="linenos">728</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.set_pwm-729"><a href="#DynamixelHelloXL430.set_pwm-729"><span class="linenos">729</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_pwm-730"><a href="#DynamixelHelloXL430.set_pwm-730"><span class="linenos">730</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_pwm-731"><a href="#DynamixelHelloXL430.set_pwm-731"><span class="linenos">731</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">termios</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">DynamixelCommError</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.set_pwm-732"><a href="#DynamixelHelloXL430.set_pwm-732"><span class="linenos">732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel communication error during set_pwm on </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_pwm-733"><a href="#DynamixelHelloXL430.set_pwm-733"><span class="linenos">733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">comm_errors</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">rx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gsr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.set_pwm-734"><a href="#DynamixelHelloXL430.set_pwm-734"><span class="linenos">734</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.set_pwm-735"><a href="#DynamixelHelloXL430.set_pwm-735"><span class="linenos">735</span></a>                <span class="k">raise</span> <span class="n">DynamixelCommError</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.is_trajectory_active" class="classattr">
                                        <input id="DynamixelHelloXL430.is_trajectory_active-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_trajectory_active</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.is_trajectory_active-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.is_trajectory_active"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.is_trajectory_active-739"><a href="#DynamixelHelloXL430.is_trajectory_active-739"><span class="linenos">739</span></a>    <span class="k">def</span> <span class="nf">is_trajectory_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.is_trajectory_active-740"><a href="#DynamixelHelloXL430.is_trajectory_active-740"><span class="linenos">740</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">!=</span><span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.get_trajectory_ts" class="classattr">
                                        <input id="DynamixelHelloXL430.get_trajectory_ts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_trajectory_ts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.get_trajectory_ts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.get_trajectory_ts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.get_trajectory_ts-742"><a href="#DynamixelHelloXL430.get_trajectory_ts-742"><span class="linenos">742</span></a>    <span class="k">def</span> <span class="nf">get_trajectory_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-743"><a href="#DynamixelHelloXL430.get_trajectory_ts-743"><span class="linenos">743</span></a>        <span class="c1">#Return trajectory execution time</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-744"><a href="#DynamixelHelloXL430.get_trajectory_ts-744"><span class="linenos">744</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-745"><a href="#DynamixelHelloXL430.get_trajectory_ts-745"><span class="linenos">745</span></a>            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-746"><a href="#DynamixelHelloXL430.get_trajectory_ts-746"><span class="linenos">746</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-747"><a href="#DynamixelHelloXL430.get_trajectory_ts-747"><span class="linenos">747</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-748"><a href="#DynamixelHelloXL430.get_trajectory_ts-748"><span class="linenos">748</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.get_trajectory_ts-749"><a href="#DynamixelHelloXL430.get_trajectory_ts-749"><span class="linenos">749</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.get_trajectory_time_remaining" class="classattr">
                                        <input id="DynamixelHelloXL430.get_trajectory_time_remaining-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_trajectory_time_remaining</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.get_trajectory_time_remaining-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.get_trajectory_time_remaining"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.get_trajectory_time_remaining-751"><a href="#DynamixelHelloXL430.get_trajectory_time_remaining-751"><span class="linenos">751</span></a>    <span class="k">def</span> <span class="nf">get_trajectory_time_remaining</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.get_trajectory_time_remaining-752"><a href="#DynamixelHelloXL430.get_trajectory_time_remaining-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trajectory_active</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.get_trajectory_time_remaining-753"><a href="#DynamixelHelloXL430.get_trajectory_time_remaining-753"><span class="linenos">753</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="DynamixelHelloXL430.get_trajectory_time_remaining-754"><a href="#DynamixelHelloXL430.get_trajectory_time_remaining-754"><span class="linenos">754</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.get_trajectory_time_remaining-755"><a href="#DynamixelHelloXL430.get_trajectory_time_remaining-755"><span class="linenos">755</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">waypoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_ts</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.follow_trajectory" class="classattr">
                                        <input id="DynamixelHelloXL430.follow_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">follow_trajectory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">v_r</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">a_r</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">req_calibration</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.follow_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.follow_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.follow_trajectory-757"><a href="#DynamixelHelloXL430.follow_trajectory-757"><span class="linenos">757</span></a>    <span class="k">def</span> <span class="nf">follow_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">req_calibration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">move_to_start_point</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-758"><a href="#DynamixelHelloXL430.follow_trajectory-758"><span class="linenos">758</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts executing a waypoint trajectory</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-759"><a href="#DynamixelHelloXL430.follow_trajectory-759"><span class="linenos">759</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-760"><a href="#DynamixelHelloXL430.follow_trajectory-760"><span class="linenos">760</span></a><span class="sd">        `self.trajectory` must be populated with a valid trajectory before calling</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-761"><a href="#DynamixelHelloXL430.follow_trajectory-761"><span class="linenos">761</span></a><span class="sd">        this method.</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-762"><a href="#DynamixelHelloXL430.follow_trajectory-762"><span class="linenos">762</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-763"><a href="#DynamixelHelloXL430.follow_trajectory-763"><span class="linenos">763</span></a><span class="sd">        Parameters</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-764"><a href="#DynamixelHelloXL430.follow_trajectory-764"><span class="linenos">764</span></a><span class="sd">        ----------</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-765"><a href="#DynamixelHelloXL430.follow_trajectory-765"><span class="linenos">765</span></a><span class="sd">        v_r : float</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-766"><a href="#DynamixelHelloXL430.follow_trajectory-766"><span class="linenos">766</span></a><span class="sd">            velocity limit for trajectory in radians per second</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-767"><a href="#DynamixelHelloXL430.follow_trajectory-767"><span class="linenos">767</span></a><span class="sd">        a_r : float</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-768"><a href="#DynamixelHelloXL430.follow_trajectory-768"><span class="linenos">768</span></a><span class="sd">            acceleration limit for trajectory in radians per second squared</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-769"><a href="#DynamixelHelloXL430.follow_trajectory-769"><span class="linenos">769</span></a><span class="sd">        req_calibration : bool</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-770"><a href="#DynamixelHelloXL430.follow_trajectory-770"><span class="linenos">770</span></a><span class="sd">            whether to allow motion prior to homing</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-771"><a href="#DynamixelHelloXL430.follow_trajectory-771"><span class="linenos">771</span></a><span class="sd">        move_to_start_point : bool</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-772"><a href="#DynamixelHelloXL430.follow_trajectory-772"><span class="linenos">772</span></a><span class="sd">            whether to move to the trajectory&#39;s start to avoid a jump, this</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-773"><a href="#DynamixelHelloXL430.follow_trajectory-773"><span class="linenos">773</span></a><span class="sd">            time to move doesn&#39;t count against the trajectory&#39;s timeline</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-774"><a href="#DynamixelHelloXL430.follow_trajectory-774"><span class="linenos">774</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-775"><a href="#DynamixelHelloXL430.follow_trajectory-775"><span class="linenos">775</span></a>        <span class="c1"># check if joint valid, homed, and previous trajectory not executing</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-776"><a href="#DynamixelHelloXL430.follow_trajectory-776"><span class="linenos">776</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-777"><a href="#DynamixelHelloXL430.follow_trajectory-777"><span class="linenos">777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel connection to hardware not valid&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-778"><a href="#DynamixelHelloXL430.follow_trajectory-778"><span class="linenos">778</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-779"><a href="#DynamixelHelloXL430.follow_trajectory-779"><span class="linenos">779</span></a>        <span class="k">if</span> <span class="n">req_calibration</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-780"><a href="#DynamixelHelloXL430.follow_trajectory-780"><span class="linenos">780</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-781"><a href="#DynamixelHelloXL430.follow_trajectory-781"><span class="linenos">781</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel not homed&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-782"><a href="#DynamixelHelloXL430.follow_trajectory-782"><span class="linenos">782</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-783"><a href="#DynamixelHelloXL430.follow_trajectory-783"><span class="linenos">783</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-784"><a href="#DynamixelHelloXL430.follow_trajectory-784"><span class="linenos">784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Dynamixel waypoint trajectory already active&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-785"><a href="#DynamixelHelloXL430.follow_trajectory-785"><span class="linenos">785</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-786"><a href="#DynamixelHelloXL430.follow_trajectory-786"><span class="linenos">786</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-787"><a href="#DynamixelHelloXL430.follow_trajectory-787"><span class="linenos">787</span></a>        <span class="c1">#Store current vel/accel so can restore later</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-788"><a href="#DynamixelHelloXL430.follow_trajectory-788"><span class="linenos">788</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">v_des</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-789"><a href="#DynamixelHelloXL430.follow_trajectory-789"><span class="linenos">789</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a_des</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-790"><a href="#DynamixelHelloXL430.follow_trajectory-790"><span class="linenos">790</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-791"><a href="#DynamixelHelloXL430.follow_trajectory-791"><span class="linenos">791</span></a>        <span class="c1"># check if trajectory valid</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-792"><a href="#DynamixelHelloXL430.follow_trajectory-792"><span class="linenos">792</span></a>        <span class="n">vel_limit</span> <span class="o">=</span> <span class="n">v_r</span> <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-793"><a href="#DynamixelHelloXL430.follow_trajectory-793"><span class="linenos">793</span></a>        <span class="n">acc_limit</span> <span class="o">=</span> <span class="n">a_r</span> <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-794"><a href="#DynamixelHelloXL430.follow_trajectory-794"><span class="linenos">794</span></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">vel_limit</span><span class="p">,</span> <span class="n">acc_limit</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-795"><a href="#DynamixelHelloXL430.follow_trajectory-795"><span class="linenos">795</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-796"><a href="#DynamixelHelloXL430.follow_trajectory-796"><span class="linenos">796</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel trajectory not valid: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reason</span><span class="p">))</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-797"><a href="#DynamixelHelloXL430.follow_trajectory-797"><span class="linenos">797</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-798"><a href="#DynamixelHelloXL430.follow_trajectory-798"><span class="linenos">798</span></a>        <span class="k">if</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">reason</span> <span class="o">==</span> <span class="s2">&quot;must have at least two waypoints&quot;</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-799"><a href="#DynamixelHelloXL430.follow_trajectory-799"><span class="linenos">799</span></a>            <span class="c1">#self.logger.warning(&#39;Dynamixel trajectory not valid: {0}&#39;.format(reason))</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-800"><a href="#DynamixelHelloXL430.follow_trajectory-800"><span class="linenos">800</span></a>            <span class="c1"># skip this device</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-801"><a href="#DynamixelHelloXL430.follow_trajectory-801"><span class="linenos">801</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-802"><a href="#DynamixelHelloXL430.follow_trajectory-802"><span class="linenos">802</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-803"><a href="#DynamixelHelloXL430.follow_trajectory-803"><span class="linenos">803</span></a>        <span class="c1"># set defaults</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-804"><a href="#DynamixelHelloXL430.follow_trajectory-804"><span class="linenos">804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">])</span> \
</span><span id="DynamixelHelloXL430.follow_trajectory-805"><a href="#DynamixelHelloXL430.follow_trajectory-805"><span class="linenos">805</span></a>            <span class="k">if</span> <span class="n">v_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;vel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-806"><a href="#DynamixelHelloXL430.follow_trajectory-806"><span class="linenos">806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">])</span> \
</span><span id="DynamixelHelloXL430.follow_trajectory-807"><a href="#DynamixelHelloXL430.follow_trajectory-807"><span class="linenos">807</span></a>            <span class="k">if</span> <span class="n">a_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_max&#39;</span><span class="p">][</span><span class="s1">&#39;accel_r&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-808"><a href="#DynamixelHelloXL430.follow_trajectory-808"><span class="linenos">808</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-809"><a href="#DynamixelHelloXL430.follow_trajectory-809"><span class="linenos">809</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-810"><a href="#DynamixelHelloXL430.follow_trajectory-810"><span class="linenos">810</span></a>        <span class="c1"># move to start point</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-811"><a href="#DynamixelHelloXL430.follow_trajectory-811"><span class="linenos">811</span></a>        <span class="k">if</span> <span class="n">move_to_start_point</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-812"><a href="#DynamixelHelloXL430.follow_trajectory-812"><span class="linenos">812</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-813"><a href="#DynamixelHelloXL430.follow_trajectory-813"><span class="linenos">813</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-814"><a href="#DynamixelHelloXL430.follow_trajectory-814"><span class="linenos">814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dynamixel unable to reach starting point&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-815"><a href="#DynamixelHelloXL430.follow_trajectory-815"><span class="linenos">815</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-816"><a href="#DynamixelHelloXL430.follow_trajectory-816"><span class="linenos">816</span></a>
</span><span id="DynamixelHelloXL430.follow_trajectory-817"><a href="#DynamixelHelloXL430.follow_trajectory-817"><span class="linenos">817</span></a>        <span class="c1"># start trajectory</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-818"><a href="#DynamixelHelloXL430.follow_trajectory-818"><span class="linenos">818</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-819"><a href="#DynamixelHelloXL430.follow_trajectory-819"><span class="linenos">819</span></a>        <span class="n">p0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-820"><a href="#DynamixelHelloXL430.follow_trajectory-820"><span class="linenos">820</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-821"><a href="#DynamixelHelloXL430.follow_trajectory-821"><span class="linenos">821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-822"><a href="#DynamixelHelloXL430.follow_trajectory-822"><span class="linenos">822</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-823"><a href="#DynamixelHelloXL430.follow_trajectory-823"><span class="linenos">823</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_trajectory_vel_ctrl</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.follow_trajectory-824"><a href="#DynamixelHelloXL430.follow_trajectory-824"><span class="linenos">824</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Starts executing a waypoint trajectory</p>

<p><code>self.trajectory</code> must be populated with a valid trajectory before calling
this method.</p>

<h2 id="parameters">Parameters</h2>

<p>v_r : float
    velocity limit for trajectory in radians per second
a_r : float
    acceleration limit for trajectory in radians per second squared
req_calibration : bool
    whether to allow motion prior to homing
move_to_start_point : bool
    whether to move to the trajectory's start to avoid a jump, this
    time to move doesn't count against the trajectory's timeline</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.update_trajectory" class="classattr">
                                        <input id="DynamixelHelloXL430.update_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.update_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.update_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.update_trajectory-826"><a href="#DynamixelHelloXL430.update_trajectory-826"><span class="linenos">826</span></a>    <span class="k">def</span> <span class="nf">update_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.update_trajectory-827"><a href="#DynamixelHelloXL430.update_trajectory-827"><span class="linenos">827</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates hardware with the next position goal of `self.trajectory`</span>
</span><span id="DynamixelHelloXL430.update_trajectory-828"><a href="#DynamixelHelloXL430.update_trajectory-828"><span class="linenos">828</span></a>
</span><span id="DynamixelHelloXL430.update_trajectory-829"><a href="#DynamixelHelloXL430.update_trajectory-829"><span class="linenos">829</span></a><span class="sd">        This method must be called frequently to enable complete trajectory execution</span>
</span><span id="DynamixelHelloXL430.update_trajectory-830"><a href="#DynamixelHelloXL430.update_trajectory-830"><span class="linenos">830</span></a><span class="sd">        and preemption of future segments. If used with `stretch_body.robot.Robot` or</span>
</span><span id="DynamixelHelloXL430.update_trajectory-831"><a href="#DynamixelHelloXL430.update_trajectory-831"><span class="linenos">831</span></a><span class="sd">        with `self.startup(threaded=True)`, a background thread is launched for this.</span>
</span><span id="DynamixelHelloXL430.update_trajectory-832"><a href="#DynamixelHelloXL430.update_trajectory-832"><span class="linenos">832</span></a><span class="sd">        Otherwise, the user must handle calling this method.</span>
</span><span id="DynamixelHelloXL430.update_trajectory-833"><a href="#DynamixelHelloXL430.update_trajectory-833"><span class="linenos">833</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.update_trajectory-834"><a href="#DynamixelHelloXL430.update_trajectory-834"><span class="linenos">834</span></a>        <span class="c1"># check if joint valid, previous trajectory not executing, and not runstopped</span>
</span><span id="DynamixelHelloXL430.update_trajectory-835"><a href="#DynamixelHelloXL430.update_trajectory-835"><span class="linenos">835</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-836"><a href="#DynamixelHelloXL430.update_trajectory-836"><span class="linenos">836</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.update_trajectory-837"><a href="#DynamixelHelloXL430.update_trajectory-837"><span class="linenos">837</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">was_runstopped</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-838"><a href="#DynamixelHelloXL430.update_trajectory-838"><span class="linenos">838</span></a>            <span class="k">return</span>
</span><span id="DynamixelHelloXL430.update_trajectory-839"><a href="#DynamixelHelloXL430.update_trajectory-839"><span class="linenos">839</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-840"><a href="#DynamixelHelloXL430.update_trajectory-840"><span class="linenos">840</span></a>            <span class="n">p1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.update_trajectory-841"><a href="#DynamixelHelloXL430.update_trajectory-841"><span class="linenos">841</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-842"><a href="#DynamixelHelloXL430.update_trajectory-842"><span class="linenos">842</span></a>                <span class="c1">#print(&#39;T %f p %f v %f a: %f&#39;%(time.time() - self._waypoint_ts,p1,v1,a1))</span>
</span><span id="DynamixelHelloXL430.update_trajectory-843"><a href="#DynamixelHelloXL430.update_trajectory-843"><span class="linenos">843</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_step_trajectory_vel_ctrl</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">a1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.update_trajectory-844"><a href="#DynamixelHelloXL430.update_trajectory-844"><span class="linenos">844</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-845"><a href="#DynamixelHelloXL430.update_trajectory-845"><span class="linenos">845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.update_trajectory-846"><a href="#DynamixelHelloXL430.update_trajectory-846"><span class="linenos">846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-847"><a href="#DynamixelHelloXL430.update_trajectory-847"><span class="linenos">847</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_trajectory_vel_ctrl</span><span class="p">():</span> <span class="c1">#Turn off trajectory if hit a watchdog error during executiong</span>
</span><span id="DynamixelHelloXL430.update_trajectory-848"><a href="#DynamixelHelloXL430.update_trajectory-848"><span class="linenos">848</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.update_trajectory-849"><a href="#DynamixelHelloXL430.update_trajectory-849"><span class="linenos">849</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.update_trajectory-850"><a href="#DynamixelHelloXL430.update_trajectory-850"><span class="linenos">850</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.update_trajectory-851"><a href="#DynamixelHelloXL430.update_trajectory-851"><span class="linenos">851</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Updates hardware with the next position goal of <code>self.trajectory</code></p>

<p>This method must be called frequently to enable complete trajectory execution
and preemption of future segments. If used with <code><a href="robot.html#Robot">stretch_body.robot.Robot</a></code> or
with <code>self.startup(threaded=True)</code>, a background thread is launched for this.
Otherwise, the user must handle calling this method.</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.stop_trajectory" class="classattr">
                                        <input id="DynamixelHelloXL430.stop_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.stop_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.stop_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.stop_trajectory-854"><a href="#DynamixelHelloXL430.stop_trajectory-854"><span class="linenos">854</span></a>    <span class="k">def</span> <span class="nf">stop_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-855"><a href="#DynamixelHelloXL430.stop_trajectory-855"><span class="linenos">855</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop waypoint trajectory immediately and resets hardware</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-856"><a href="#DynamixelHelloXL430.stop_trajectory-856"><span class="linenos">856</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-857"><a href="#DynamixelHelloXL430.stop_trajectory-857"><span class="linenos">857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_vel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_accel</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-858"><a href="#DynamixelHelloXL430.stop_trajectory-858"><span class="linenos">858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-859"><a href="#DynamixelHelloXL430.stop_trajectory-859"><span class="linenos">859</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;trajectory_vel_ctrl&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-860"><a href="#DynamixelHelloXL430.stop_trajectory-860"><span class="linenos">860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_trajectory_vel_ctrl</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-861"><a href="#DynamixelHelloXL430.stop_trajectory-861"><span class="linenos">861</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.stop_trajectory-862"><a href="#DynamixelHelloXL430.stop_trajectory-862"><span class="linenos">862</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_motion_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_vel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_traj_acc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Stop waypoint trajectory immediately and resets hardware</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.home" class="classattr">
                                        <input id="DynamixelHelloXL430.home-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">home</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">single_stop</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">move_to_zero</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">delay_at_stop</span><span class="o">=</span><span class="mf">0.0</span>,</span><span class="param">	<span class="n">save_calibration</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">set_homing_offset</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.home-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.home"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.home-940"><a href="#DynamixelHelloXL430.home-940"><span class="linenos"> 940</span></a>    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_stop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">move_to_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">delay_at_stop</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">save_calibration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">set_homing_offset</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.home-941"><a href="#DynamixelHelloXL430.home-941"><span class="linenos"> 941</span></a>        <span class="c1"># Requires at least one hardstop in the pwm_homing[0] direction</span>
</span><span id="DynamixelHelloXL430.home-942"><a href="#DynamixelHelloXL430.home-942"><span class="linenos"> 942</span></a>        <span class="c1"># Can be in multiturn or single turn mode</span>
</span><span id="DynamixelHelloXL430.home-943"><a href="#DynamixelHelloXL430.home-943"><span class="linenos"> 943</span></a>        <span class="c1"># Mark the first hardstop as zero ticks on the Dynammixel</span>
</span><span id="DynamixelHelloXL430.home-944"><a href="#DynamixelHelloXL430.home-944"><span class="linenos"> 944</span></a>        <span class="c1"># Second hardstop is optional</span>
</span><span id="DynamixelHelloXL430.home-945"><a href="#DynamixelHelloXL430.home-945"><span class="linenos"> 945</span></a>        <span class="c1"># Return success, measured range</span>
</span><span id="DynamixelHelloXL430.home-946"><a href="#DynamixelHelloXL430.home-946"><span class="linenos"> 946</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430.home-947"><a href="#DynamixelHelloXL430.home-947"><span class="linenos"> 947</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-948"><a href="#DynamixelHelloXL430.home-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-949"><a href="#DynamixelHelloXL430.home-949"><span class="linenos"> 949</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Not able to home </span><span class="si">%s</span><span class="s1">. Hardware not present&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-950"><a href="#DynamixelHelloXL430.home-950"><span class="linenos"> 950</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-951"><a href="#DynamixelHelloXL430.home-951"><span class="linenos"> 951</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;req_calibration&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.home-952"><a href="#DynamixelHelloXL430.home-952"><span class="linenos"> 952</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homing not required for: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-953"><a href="#DynamixelHelloXL430.home-953"><span class="linenos"> 953</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-954"><a href="#DynamixelHelloXL430.home-954"><span class="linenos"> 954</span></a>
</span><span id="DynamixelHelloXL430.home-955"><a href="#DynamixelHelloXL430.home-955"><span class="linenos"> 955</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-956"><a href="#DynamixelHelloXL430.home-956"><span class="linenos"> 956</span></a>
</span><span id="DynamixelHelloXL430.home-957"><a href="#DynamixelHelloXL430.home-957"><span class="linenos"> 957</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.home-958"><a href="#DynamixelHelloXL430.home-958"><span class="linenos"> 958</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-959"><a href="#DynamixelHelloXL430.home-959"><span class="linenos"> 959</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-960"><a href="#DynamixelHelloXL430.home-960"><span class="linenos"> 960</span></a>
</span><span id="DynamixelHelloXL430.home-961"><a href="#DynamixelHelloXL430.home-961"><span class="linenos"> 961</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamixelHelloXL430.home-962"><a href="#DynamixelHelloXL430.home-962"><span class="linenos"> 962</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-963"><a href="#DynamixelHelloXL430.home-963"><span class="linenos"> 963</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to first hardstop...&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-964"><a href="#DynamixelHelloXL430.home-964"><span class="linenos"> 964</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_homing&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-965"><a href="#DynamixelHelloXL430.home-965"><span class="linenos"> 965</span></a>            <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-966"><a href="#DynamixelHelloXL430.home-966"><span class="linenos"> 966</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-967"><a href="#DynamixelHelloXL430.home-967"><span class="linenos"> 967</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.home-968"><a href="#DynamixelHelloXL430.home-968"><span class="linenos"> 968</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-969"><a href="#DynamixelHelloXL430.home-969"><span class="linenos"> 969</span></a>                <span class="n">timeout</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&gt;</span><span class="mf">15.0</span>
</span><span id="DynamixelHelloXL430.home-970"><a href="#DynamixelHelloXL430.home-970"><span class="linenos"> 970</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-971"><a href="#DynamixelHelloXL430.home-971"><span class="linenos"> 971</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_at_stop</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-972"><a href="#DynamixelHelloXL430.home-972"><span class="linenos"> 972</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-973"><a href="#DynamixelHelloXL430.home-973"><span class="linenos"> 973</span></a>
</span><span id="DynamixelHelloXL430.home-974"><a href="#DynamixelHelloXL430.home-974"><span class="linenos"> 974</span></a>            <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-975"><a href="#DynamixelHelloXL430.home-975"><span class="linenos"> 975</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timed out moving to first hardstop. Exiting.&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-976"><a href="#DynamixelHelloXL430.home-976"><span class="linenos"> 976</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-977"><a href="#DynamixelHelloXL430.home-977"><span class="linenos"> 977</span></a>
</span><span id="DynamixelHelloXL430.home-978"><a href="#DynamixelHelloXL430.home-978"><span class="linenos"> 978</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.home-979"><a href="#DynamixelHelloXL430.home-979"><span class="linenos"> 979</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-980"><a href="#DynamixelHelloXL430.home-980"><span class="linenos"> 980</span></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-981"><a href="#DynamixelHelloXL430.home-981"><span class="linenos"> 981</span></a>
</span><span id="DynamixelHelloXL430.home-982"><a href="#DynamixelHelloXL430.home-982"><span class="linenos"> 982</span></a>            <span class="c1">#Need to move back to pos mode to get the position (ticks) w/o the homing offset (single turn mode)</span>
</span><span id="DynamixelHelloXL430.home-983"><a href="#DynamixelHelloXL430.home-983"><span class="linenos"> 983</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.home-984"><a href="#DynamixelHelloXL430.home-984"><span class="linenos"> 984</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-985"><a href="#DynamixelHelloXL430.home-985"><span class="linenos"> 985</span></a>            <span class="n">contact_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-986"><a href="#DynamixelHelloXL430.home-986"><span class="linenos"> 986</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First hardstop contact at position (ticks): </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">contact_0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-987"><a href="#DynamixelHelloXL430.home-987"><span class="linenos"> 987</span></a>
</span><span id="DynamixelHelloXL430.home-988"><a href="#DynamixelHelloXL430.home-988"><span class="linenos"> 988</span></a>            <span class="k">if</span> <span class="n">set_homing_offset</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-989"><a href="#DynamixelHelloXL430.home-989"><span class="linenos"> 989</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-990"><a href="#DynamixelHelloXL430.home-990"><span class="linenos"> 990</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-991"><a href="#DynamixelHelloXL430.home-991"><span class="linenos"> 991</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homing offset was </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430.home-992"><a href="#DynamixelHelloXL430.home-992"><span class="linenos"> 992</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Marking current position to zero ticks&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-993"><a href="#DynamixelHelloXL430.home-993"><span class="linenos"> 993</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">zero_position</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-994"><a href="#DynamixelHelloXL430.home-994"><span class="linenos"> 994</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Homing offset is now  </span><span class="si">%d</span><span class="s2"> (ticks)&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_homing_offset</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430.home-995"><a href="#DynamixelHelloXL430.home-995"><span class="linenos"> 995</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-996"><a href="#DynamixelHelloXL430.home-996"><span class="linenos"> 996</span></a>                <span class="n">contact_0</span><span class="o">=</span><span class="mi">0</span>
</span><span id="DynamixelHelloXL430.home-997"><a href="#DynamixelHelloXL430.home-997"><span class="linenos"> 997</span></a>
</span><span id="DynamixelHelloXL430.home-998"><a href="#DynamixelHelloXL430.home-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">disable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-999"><a href="#DynamixelHelloXL430.home-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">set_calibrated</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1000"><a href="#DynamixelHelloXL430.home-1000"><span class="linenos">1000</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_calibrated</span><span class="o">=</span><span class="mi">1</span>
</span><span id="DynamixelHelloXL430.home-1001"><a href="#DynamixelHelloXL430.home-1001"><span class="linenos">1001</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">enable_torque</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-1002"><a href="#DynamixelHelloXL430.home-1002"><span class="linenos">1002</span></a>
</span><span id="DynamixelHelloXL430.home-1003"><a href="#DynamixelHelloXL430.home-1003"><span class="linenos">1003</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pwm</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-1004"><a href="#DynamixelHelloXL430.home-1004"><span class="linenos">1004</span></a>
</span><span id="DynamixelHelloXL430.home-1005"><a href="#DynamixelHelloXL430.home-1005"><span class="linenos">1005</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current position (ticks):&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">())</span>
</span><span id="DynamixelHelloXL430.home-1006"><a href="#DynamixelHelloXL430.home-1006"><span class="linenos">1006</span></a>
</span><span id="DynamixelHelloXL430.home-1007"><a href="#DynamixelHelloXL430.home-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">single_stop</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1008"><a href="#DynamixelHelloXL430.home-1008"><span class="linenos">1008</span></a>                <span class="c1">#Measure the range and write to YAML</span>
</span><span id="DynamixelHelloXL430.home-1009"><a href="#DynamixelHelloXL430.home-1009"><span class="linenos">1009</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to second hardstop...&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1010"><a href="#DynamixelHelloXL430.home-1010"><span class="linenos">1010</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;pwm_homing&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1011"><a href="#DynamixelHelloXL430.home-1011"><span class="linenos">1011</span></a>                <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-1012"><a href="#DynamixelHelloXL430.home-1012"><span class="linenos">1012</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1013"><a href="#DynamixelHelloXL430.home-1013"><span class="linenos">1013</span></a>                <span class="n">timeout</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.home-1014"><a href="#DynamixelHelloXL430.home-1014"><span class="linenos">1014</span></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">is_moving</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1015"><a href="#DynamixelHelloXL430.home-1015"><span class="linenos">1015</span></a>                    <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="mf">15.0</span>
</span><span id="DynamixelHelloXL430.home-1016"><a href="#DynamixelHelloXL430.home-1016"><span class="linenos">1016</span></a>                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1017"><a href="#DynamixelHelloXL430.home-1017"><span class="linenos">1017</span></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_at_stop</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1018"><a href="#DynamixelHelloXL430.home-1018"><span class="linenos">1018</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1019"><a href="#DynamixelHelloXL430.home-1019"><span class="linenos">1019</span></a>
</span><span id="DynamixelHelloXL430.home-1020"><a href="#DynamixelHelloXL430.home-1020"><span class="linenos">1020</span></a>                <span class="k">if</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1021"><a href="#DynamixelHelloXL430.home-1021"><span class="linenos">1021</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Timed out moving to second hardstop. Exiting.&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1022"><a href="#DynamixelHelloXL430.home-1022"><span class="linenos">1022</span></a>                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-1023"><a href="#DynamixelHelloXL430.home-1023"><span class="linenos">1023</span></a>
</span><span id="DynamixelHelloXL430.home-1024"><a href="#DynamixelHelloXL430.home-1024"><span class="linenos">1024</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_servo_errors</span><span class="p">():</span>
</span><span id="DynamixelHelloXL430.home-1025"><a href="#DynamixelHelloXL430.home-1025"><span class="linenos">1025</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Hardware error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1026"><a href="#DynamixelHelloXL430.home-1026"><span class="linenos">1026</span></a>                    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-1027"><a href="#DynamixelHelloXL430.home-1027"><span class="linenos">1027</span></a>
</span><span id="DynamixelHelloXL430.home-1028"><a href="#DynamixelHelloXL430.home-1028"><span class="linenos">1028</span></a>                <span class="c1"># Need to move back to pos mode to get the position (ticks) w/o the homing offset (single turn mode)</span>
</span><span id="DynamixelHelloXL430.home-1029"><a href="#DynamixelHelloXL430.home-1029"><span class="linenos">1029</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;use_multiturn&#39;</span><span class="p">]:</span>
</span><span id="DynamixelHelloXL430.home-1030"><a href="#DynamixelHelloXL430.home-1030"><span class="linenos">1030</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-1031"><a href="#DynamixelHelloXL430.home-1031"><span class="linenos">1031</span></a>                <span class="n">contact_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">get_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-1032"><a href="#DynamixelHelloXL430.home-1032"><span class="linenos">1032</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hit second hardstop at: (ticks)&#39;</span><span class="p">,</span> <span class="n">contact_1</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1033"><a href="#DynamixelHelloXL430.home-1033"><span class="linenos">1033</span></a>
</span><span id="DynamixelHelloXL430.home-1034"><a href="#DynamixelHelloXL430.home-1034"><span class="linenos">1034</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Homed to range of motion to (ticks):&#39;</span><span class="p">,[</span><span class="n">contact_0</span><span class="p">,</span><span class="n">contact_1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1035"><a href="#DynamixelHelloXL430.home-1035"><span class="linenos">1035</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">contact_0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_pad_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">contact_1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_pad_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="DynamixelHelloXL430.home-1036"><a href="#DynamixelHelloXL430.home-1036"><span class="linenos">1036</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Padded range of motion is (ticks):&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1037"><a href="#DynamixelHelloXL430.home-1037"><span class="linenos">1037</span></a>                <span class="n">r1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1038"><a href="#DynamixelHelloXL430.home-1038"><span class="linenos">1038</span></a>                <span class="n">r2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1039"><a href="#DynamixelHelloXL430.home-1039"><span class="linenos">1039</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Radians:&#39;</span><span class="p">,[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1040"><a href="#DynamixelHelloXL430.home-1040"><span class="linenos">1040</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Degrees:&#39;</span><span class="p">,[</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r2</span><span class="p">)])</span>
</span><span id="DynamixelHelloXL430.home-1041"><a href="#DynamixelHelloXL430.home-1041"><span class="linenos">1041</span></a>
</span><span id="DynamixelHelloXL430.home-1042"><a href="#DynamixelHelloXL430.home-1042"><span class="linenos">1042</span></a>                <span class="k">if</span> <span class="n">save_calibration</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1043"><a href="#DynamixelHelloXL430.home-1043"><span class="linenos">1043</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">write_configuration_param_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.range_t&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">])</span>
</span><span id="DynamixelHelloXL430.home-1044"><a href="#DynamixelHelloXL430.home-1044"><span class="linenos">1044</span></a>
</span><span id="DynamixelHelloXL430.home-1045"><a href="#DynamixelHelloXL430.home-1045"><span class="linenos">1045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_pos</span><span class="p">()</span>
</span><span id="DynamixelHelloXL430.home-1046"><a href="#DynamixelHelloXL430.home-1046"><span class="linenos">1046</span></a>            <span class="k">if</span> <span class="n">move_to_zero</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1047"><a href="#DynamixelHelloXL430.home-1047"><span class="linenos">1047</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Moving to calibrated zero: (rad)&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1048"><a href="#DynamixelHelloXL430.home-1048"><span class="linenos">1048</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1049"><a href="#DynamixelHelloXL430.home-1049"><span class="linenos">1049</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_at_setpoint</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1050"><a href="#DynamixelHelloXL430.home-1050"><span class="linenos">1050</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_homing</span><span class="o">=</span><span class="kc">False</span>
</span><span id="DynamixelHelloXL430.home-1051"><a href="#DynamixelHelloXL430.home-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bubble_up_comm_exception</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamixelHelloXL430.home-1052"><a href="#DynamixelHelloXL430.home-1052"><span class="linenos">1052</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">single_stop</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1053"><a href="#DynamixelHelloXL430.home-1053"><span class="linenos">1053</span></a>                <span class="k">return</span>  <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;range_t&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.home-1054"><a href="#DynamixelHelloXL430.home-1054"><span class="linenos">1054</span></a>            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DynamixelHelloXL430.home-1055"><a href="#DynamixelHelloXL430.home-1055"><span class="linenos">1055</span></a>        <span class="k">except</span> <span class="n">DynamixelCommError</span><span class="p">:</span>
</span><span id="DynamixelHelloXL430.home-1056"><a href="#DynamixelHelloXL430.home-1056"><span class="linenos">1056</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Communication error, unable to home. Exiting&#39;</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.home-1057"><a href="#DynamixelHelloXL430.home-1057"><span class="linenos">1057</span></a>            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Home used for different devices of the robot.</p>
</div>


                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_world_rad_per_sec_sec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-1061"><a href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-1061"><span class="linenos">1061</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-1062"><a href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-1062"><span class="linenos">1062</span></a>        <span class="n">rps_servo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad_per_sec_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-1063"><a href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec_sec-1063"><span class="linenos">1063</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rps_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_world_rad_per_sec" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_world_rad_per_sec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_world_rad_per_sec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_world_rad_per_sec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_world_rad_per_sec-1065"><a href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec-1065"><span class="linenos">1065</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad_per_sec-1066"><a href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec-1066"><span class="linenos">1066</span></a>        <span class="n">rps_servo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad_per_sec</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad_per_sec-1067"><a href="#DynamixelHelloXL430.ticks_to_world_rad_per_sec-1067"><span class="linenos">1067</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rps_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_world_rad" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_world_rad-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_world_rad</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_world_rad-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_world_rad"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_world_rad-1069"><a href="#DynamixelHelloXL430.ticks_to_world_rad-1069"><span class="linenos">1069</span></a>    <span class="k">def</span> <span class="nf">ticks_to_world_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad-1070"><a href="#DynamixelHelloXL430.ticks_to_world_rad-1070"><span class="linenos">1070</span></a>        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad-1071"><a href="#DynamixelHelloXL430.ticks_to_world_rad-1071"><span class="linenos">1071</span></a>        <span class="n">rad_servo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks_to_rad</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.ticks_to_world_rad-1072"><a href="#DynamixelHelloXL430.ticks_to_world_rad-1072"><span class="linenos">1072</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span><span class="o">*</span><span class="n">rad_servo</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.world_rad_to_ticks" class="classattr">
                                        <input id="DynamixelHelloXL430.world_rad_to_ticks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">world_rad_to_ticks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.world_rad_to_ticks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.world_rad_to_ticks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.world_rad_to_ticks-1074"><a href="#DynamixelHelloXL430.world_rad_to_ticks-1074"><span class="linenos">1074</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks-1075"><a href="#DynamixelHelloXL430.world_rad_to_ticks-1075"><span class="linenos">1075</span></a>        <span class="n">rad_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks-1076"><a href="#DynamixelHelloXL430.world_rad_to_ticks-1076"><span class="linenos">1076</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_to_ticks</span><span class="p">(</span><span class="n">rad_servo</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks-1077"><a href="#DynamixelHelloXL430.world_rad_to_ticks-1077"><span class="linenos">1077</span></a>        <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;zero_t&#39;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.world_rad_to_ticks_per_sec" class="classattr">
                                        <input id="DynamixelHelloXL430.world_rad_to_ticks_per_sec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">world_rad_to_ticks_per_sec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.world_rad_to_ticks_per_sec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec-1079"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec-1079"><span class="linenos">1079</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec-1080"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec-1080"><span class="linenos">1080</span></a>        <span class="n">rad_per_sec_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec-1081"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec-1081"><span class="linenos">1081</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_per_sec_to_ticks</span><span class="p">(</span><span class="n">rad_per_sec_servo</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec-1082"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec-1082"><span class="linenos">1082</span></a>        <span class="k">return</span> <span class="n">t</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec" class="classattr">
                                        <input id="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">world_rad_to_ticks_per_sec_sec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1084"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1084"><span class="linenos">1084</span></a>    <span class="k">def</span> <span class="nf">world_rad_to_ticks_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1085"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1085"><span class="linenos">1085</span></a>        <span class="n">rad_per_sec_sec_servo</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">polarity</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1086"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1086"><span class="linenos">1086</span></a>        <span class="n">t</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rad_per_sec_sec_to_ticks</span><span class="p">(</span><span class="n">rad_per_sec_sec_servo</span><span class="p">)</span>
</span><span id="DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1087"><a href="#DynamixelHelloXL430.world_rad_to_ticks_per_sec_sec-1087"><span class="linenos">1087</span></a>        <span class="k">return</span> <span class="n">t</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_rad" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_rad-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_rad</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_rad-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_rad"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_rad-1089"><a href="#DynamixelHelloXL430.ticks_to_rad-1089"><span class="linenos">1089</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_rad-1090"><a href="#DynamixelHelloXL430.ticks_to_rad-1090"><span class="linenos">1090</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">((</span><span class="mf">360.0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">4096.0</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.rad_to_ticks" class="classattr">
                                        <input id="DynamixelHelloXL430.rad_to_ticks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rad_to_ticks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.rad_to_ticks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.rad_to_ticks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.rad_to_ticks-1092"><a href="#DynamixelHelloXL430.rad_to_ticks-1092"><span class="linenos">1092</span></a>    <span class="k">def</span> <span class="nf">rad_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.rad_to_ticks-1093"><a href="#DynamixelHelloXL430.rad_to_ticks-1093"><span class="linenos">1093</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="mf">4096.0</span> <span class="o">*</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_rad_per_sec" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_rad_per_sec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_rad_per_sec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_rad_per_sec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_rad_per_sec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_rad_per_sec-1095"><a href="#DynamixelHelloXL430.ticks_to_rad_per_sec-1095"><span class="linenos">1095</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad_per_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_rad_per_sec-1096"><a href="#DynamixelHelloXL430.ticks_to_rad_per_sec-1096"><span class="linenos">1096</span></a>        <span class="n">rpm</span><span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="mf">0.229</span>
</span><span id="DynamixelHelloXL430.ticks_to_rad_per_sec-1097"><a href="#DynamixelHelloXL430.ticks_to_rad_per_sec-1097"><span class="linenos">1097</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">rpm</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.rad_per_sec_to_ticks" class="classattr">
                                        <input id="DynamixelHelloXL430.rad_per_sec_to_ticks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rad_per_sec_to_ticks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.rad_per_sec_to_ticks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.rad_per_sec_to_ticks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.rad_per_sec_to_ticks-1099"><a href="#DynamixelHelloXL430.rad_per_sec_to_ticks-1099"><span class="linenos">1099</span></a>    <span class="k">def</span> <span class="nf">rad_per_sec_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.rad_per_sec_to_ticks-1100"><a href="#DynamixelHelloXL430.rad_per_sec_to_ticks-1100"><span class="linenos">1100</span></a>        <span class="n">rpm</span><span class="o">=</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mf">360.0</span>
</span><span id="DynamixelHelloXL430.rad_per_sec_to_ticks-1101"><a href="#DynamixelHelloXL430.rad_per_sec_to_ticks-1101"><span class="linenos">1101</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rpm</span><span class="o">/</span><span class="mf">0.229</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_rad_per_sec_sec" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_rad_per_sec_sec-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_rad_per_sec_sec</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_rad_per_sec_sec-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_rad_per_sec_sec"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_rad_per_sec_sec-1103"><a href="#DynamixelHelloXL430.ticks_to_rad_per_sec_sec-1103"><span class="linenos">1103</span></a>    <span class="k">def</span> <span class="nf">ticks_to_rad_per_sec_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_rad_per_sec_sec-1104"><a href="#DynamixelHelloXL430.ticks_to_rad_per_sec_sec-1104"><span class="linenos">1104</span></a>        <span class="n">rpmm</span><span class="o">=</span><span class="n">t</span><span class="o">*</span><span class="mf">214.577</span>
</span><span id="DynamixelHelloXL430.ticks_to_rad_per_sec_sec-1105"><a href="#DynamixelHelloXL430.ticks_to_rad_per_sec_sec-1105"><span class="linenos">1105</span></a>        <span class="k">return</span> <span class="n">deg_to_rad</span><span class="p">(</span><span class="n">rpmm</span><span class="o">*</span><span class="mi">360</span><span class="o">/</span><span class="mf">60.0</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.rad_per_sec_sec_to_ticks" class="classattr">
                                        <input id="DynamixelHelloXL430.rad_per_sec_sec_to_ticks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rad_per_sec_sec_to_ticks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">r</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.rad_per_sec_sec_to_ticks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.rad_per_sec_sec_to_ticks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.rad_per_sec_sec_to_ticks-1107"><a href="#DynamixelHelloXL430.rad_per_sec_sec_to_ticks-1107"><span class="linenos">1107</span></a>    <span class="k">def</span> <span class="nf">rad_per_sec_sec_to_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.rad_per_sec_sec_to_ticks-1108"><a href="#DynamixelHelloXL430.rad_per_sec_sec_to_ticks-1108"><span class="linenos">1108</span></a>        <span class="n">rpmm</span><span class="o">=</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">/</span><span class="mf">360.0</span>
</span><span id="DynamixelHelloXL430.rad_per_sec_sec_to_ticks-1109"><a href="#DynamixelHelloXL430.rad_per_sec_sec_to_ticks-1109"><span class="linenos">1109</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rpmm</span><span class="o">/</span><span class="mf">214.577</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="DynamixelHelloXL430.ticks_to_pct_load" class="classattr">
                                        <input id="DynamixelHelloXL430.ticks_to_pct_load-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ticks_to_pct_load</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamixelHelloXL430.ticks_to_pct_load-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamixelHelloXL430.ticks_to_pct_load"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamixelHelloXL430.ticks_to_pct_load-1111"><a href="#DynamixelHelloXL430.ticks_to_pct_load-1111"><span class="linenos">1111</span></a>    <span class="k">def</span> <span class="nf">ticks_to_pct_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
</span><span id="DynamixelHelloXL430.ticks_to_pct_load-1112"><a href="#DynamixelHelloXL430.ticks_to_pct_load-1112"><span class="linenos">1112</span></a>        <span class="c1">#-100 to 100.0</span>
</span><span id="DynamixelHelloXL430.ticks_to_pct_load-1113"><a href="#DynamixelHelloXL430.ticks_to_pct_load-1113"><span class="linenos">1113</span></a>        <span class="k">return</span> <span class="n">t</span><span class="o">/</span><span class="mf">10.24</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="DynamixelHelloXL430.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="DynamixelHelloXL430.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="DynamixelHelloXL430.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="DynamixelHelloXL430.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="DynamixelHelloXL430.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="DynamixelHelloXL430.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="DynamixelHelloXL430.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="DynamixelHelloXL430.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="DynamixelHelloXL430.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="DynamixelHelloXL430.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="DynamixelHelloXL430.push_command" class="function"><a href="device.html#Device.push_command">push_command</a></dd>
                <dd id="DynamixelHelloXL430.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="DynamixelHelloXL430.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>
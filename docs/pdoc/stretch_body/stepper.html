<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>stretch_body.stepper API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../stretch_body.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;stretch_body</a>

<a href="https://github.com/hello-robot/stretch_body">            <img src="../images/banner.png" class="logo" alt="project logo"/>
</a>
            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#StepperBase">StepperBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StepperBase.__init__">StepperBase</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.usb">usb</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.transport">transport</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.status">status</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.status_aux">status_aux</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.status_zero">status_zero</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.board_info">board_info</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.motion_limits">motion_limits</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.is_moving_history">is_moving_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.load_test_payload">load_test_payload</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.hw_valid">hw_valid</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.gains">gains</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.gains_flash">gains_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.startup">startup</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.stop">stop</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.is_sync_required">is_sync_required</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.push_command">push_command</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.push_command_async">push_command_async</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pull_status">pull_status</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pull_status_async">pull_status_async</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.step_sentry">step_sentry</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_motion_limits">set_motion_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_gains">set_gains</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.board_reset">board_reset</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.mark_position">mark_position</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.reset_motion_gen">reset_motion_gen</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_safety">enable_safety</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_freewheel">enable_freewheel</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_hold">enable_hold</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_vel_pid">enable_vel_pid</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_pid">enable_pos_pid</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_vel_traj">enable_vel_traj</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_traj">enable_pos_traj</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_current">enable_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_sync_mode">enable_sync_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_sync_mode">disable_sync_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_runstop">enable_runstop</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_runstop">disable_runstop</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_command">set_command</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.get_chip_id">get_chip_id</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.print_menu">print_menu</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.menu_transaction">menu_transaction</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.unpack_board_info">unpack_board_info</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.unpack_gains">unpack_gains</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_motion_limits">pack_motion_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_command">pack_command</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_gains">pack_gains</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_trigger">pack_trigger</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_command_reply">rpc_command_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_status_reply">rpc_status_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P0">Stepper_Protocol_P0</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P0.unpack_status">unpack_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P0.pretty_print">pretty_print</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P1">Stepper_Protocol_P1</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.unpack_status">unpack_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.pretty_print">pretty_print</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.start_waypoint_trajectory">start_waypoint_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.set_next_trajectory_segment">set_next_trajectory_segment</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.stop_waypoint_trajectory">stop_waypoint_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.pack_trajectory_segment">pack_trajectory_segment</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.rpc_reset_traj_reply">rpc_reset_traj_reply</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P2">Stepper_Protocol_P2</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.read_firmware_trace">read_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.unpack_debug_trace">unpack_debug_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.unpack_print_trace">unpack_print_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.enable_firmware_trace">enable_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.disable_firmware_trace">disable_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.unpack_status">unpack_status</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P3">Stepper_Protocol_P3</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.push_load_test">push_load_test</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.pull_load_test">pull_load_test</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_load_test_push_reply">rpc_load_test_push_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_load_test_pull_reply">rpc_load_test_pull_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.pull_status_aux">pull_status_aux</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.unpack_status_aux">unpack_status_aux</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_status_aux_reply">rpc_status_aux_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.unpack_command_reply">unpack_command_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_command_reply">rpc_command_reply</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper">Stepper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper.__init__">Stepper</a>
                        </li>
                        <li>
                                <a class="variable" href="#Stepper.supported_protocols">supported_protocols</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper.expand_protocol_methods">expand_protocol_methods</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper.startup">startup</a>
                        </li>
                </ul>

            </li>
    </ul>


    <footer>My Package v1.0</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                        <a class="pdoc-button git-button" href="https://github.com/hello-robot/stretch_body/tree/feature/pdoc/body/stretch_body/stepper.py">Edit on GitHub</a>
                    <h1 class="modulename">
<a href="./../stretch_body.html">stretch_body</a><wbr>.stepper    </h1>

                
                        <input id="mod-stepper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-stepper-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">from</span> <span class="nn">stretch_body.transport</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">from</span> <span class="nn">stretch_body.device</span> <span class="kn">import</span> <span class="n">Device</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">from</span> <span class="nn">stretch_body.hello_utils</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">textwrap</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">threading</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">array</span> <span class="k">as</span> <span class="nn">arr</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="c1"># ######################## STEPPER #################################</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="k">class</span> <span class="nc">StepperBase</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>    <span class="n">RPC_SET_COMMAND</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>    <span class="n">RPC_REPLY_COMMAND</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>    <span class="n">RPC_GET_STATUS</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>    <span class="n">RPC_REPLY_STATUS</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="n">RPC_SET_GAINS</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>    <span class="n">RPC_REPLY_GAINS</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>    <span class="n">RPC_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">RPC_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">9</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>    <span class="n">RPC_REPLY_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>    <span class="n">RPC_SET_ENC_CALIB</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>    <span class="n">RPC_REPLY_ENC_CALIB</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="n">RPC_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>    <span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="n">RPC_SET_MENU_ON</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>    <span class="n">RPC_REPLY_MENU_ON</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="n">RPC_GET_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">RPC_SET_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">19</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="n">RPC_REPLY_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">21</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">22</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>    <span class="n">RPC_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">23</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>    <span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">24</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="n">RPC_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">25</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>    <span class="n">RPC_REPLY_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">26</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>    <span class="n">RPC_READ_TRACE</span> <span class="o">=</span><span class="mi">27</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="n">RPC_REPLY_READ_TRACE</span> <span class="o">=</span><span class="mi">28</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="n">RPC_GET_STATUS_AUX</span> <span class="o">=</span> <span class="mi">29</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="n">RPC_REPLY_STATUS_AUX</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="n">RPC_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">31</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="n">MODE_SAFETY</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="n">MODE_FREEWHEEL</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="n">MODE_HOLD</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="n">MODE_POS_PID</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="n">MODE_VEL_PID</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="n">MODE_POS_TRAJ</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>    <span class="n">MODE_VEL_TRAJ</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="n">MODE_CURRENT</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="n">MODE_POS_TRAJ_INCR</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="o">=</span><span class="mi">9</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="n">MODE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="n">MODE_SAFETY</span><span class="p">:</span> <span class="s1">&#39;MODE_SAFETY&#39;</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        <span class="n">MODE_FREEWHEEL</span><span class="p">:</span> <span class="s1">&#39;MODE_FREEWHEEL&#39;</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="n">MODE_HOLD</span><span class="p">:</span> <span class="s1">&#39;MODE_HOLD&#39;</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="n">MODE_POS_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_PID&#39;</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="n">MODE_VEL_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_PID&#39;</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="n">MODE_POS_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ&#39;</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>        <span class="n">MODE_VEL_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_TRAJ&#39;</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>        <span class="n">MODE_CURRENT</span><span class="p">:</span> <span class="s1">&#39;MODE_CURRENT&#39;</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_INCR&#39;</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_WAYPOINT&#39;</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    <span class="p">}</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>    <span class="n">DIAG_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Has a pos zero RPC been received since powerup</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>    <span class="n">DIAG_RUNSTOP_ON</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Is controller in runstop mode</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>    <span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Is pos controller within gains.pAs_d of setpoint</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Is vel controller within gains.vAs_d of setpoint</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="n">DIAG_IS_MOVING</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># Is measured velocity greater than gains.vAs_d</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># Is controller current saturated</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">=</span> <span class="mi">64</span>  <span class="c1"># Is controller motion generator acceleration non-zero</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="n">DIAG_IS_MG_MOVING</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># Is controller motion generator velocity non-zero</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>    <span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># Is calibration table in flash</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Guarded event occurred during motion</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>    <span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># Is it forced into safety mode</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">2048</span>  <span class="c1"># Command received but no sync yet</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="n">DIAG_TRAJ_ACTIVE</span>     <span class="o">=</span> <span class="mi">4096</span>     <span class="c1"># Whether a waypoint trajectory is actively executing</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>    <span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">8192</span> <span class="c1"># Currently waiting on a sync signal before starting trajectory</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">=</span> <span class="mi">16384</span>        <span class="c1"># Currently running in sync mode</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>    <span class="n">DIAG_IS_TRACE_ON</span> <span class="o">=</span> <span class="mi">32768</span>   <span class="c1">#Is trace recording</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="n">CONFIG_SAFETY_HOLD</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Hold position in safety mode? Otherwise freewheel</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>    <span class="n">CONFIG_ENABLE_RUNSTOP</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Recognize runstop signal?</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="n">CONFIG_ENABLE_SYNC_MODE</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Commands are synchronized from digital trigger</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Stops on current threshold</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>    <span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">=</span> <span class="mi">64</span> <span class="c1">#Timeout velocity commands</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="n">TRIGGER_MARK_POS</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    <span class="n">TRIGGER_RESET_MOTION_GEN</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="n">TRIGGER_BOARD_RESET</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="n">TRIGGER_RESET_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>    <span class="n">TRIGGER_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="n">TRIGGER_MARK_POS_ON_CONTACT</span><span class="o">=</span><span class="mi">64</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="n">TRIGGER_ENABLE_TRACE</span><span class="o">=</span><span class="mi">128</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="n">TRIGGER_DISABLE_TRACE</span><span class="o">=</span><span class="mi">256</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="n">TRACE_TYPE_STATUS</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>    <span class="n">TRACE_TYPE_DEBUG</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="n">TRACE_TYPE_PRINT</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="c1">#Pull from usb device name</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">Transport</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;a_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stiffness&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_pct&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;current&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                       <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                       <span class="s1">&#39;is_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                       <span class="s1">&#39;in_safety_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;trace_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                       <span class="s1">&#39;waypoint_traj&#39;</span><span class="p">:{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="s1">&#39;setpoint&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;segment_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,}}</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;board_variant&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;firmware_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    <span class="c1"># ###########  Device Methods #############</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                <span class="c1"># Pull board info</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STEPPER_BOARD_INFO</span><span class="p">])</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_board_info_reply</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">configure_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span><span class="kc">False</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>    <span class="c1">#Configure control mode prior to calling this on process shutdown (or default to freewheel)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="k">return</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down Stepper on: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">exiting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>    <span class="k">def</span> <span class="nf">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_last_sync</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines if synchronization is required base on current the status.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        Parameters</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        ----------</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        ts_last_sync : float.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">            The timestamp of the last synchronized motion.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        Returns</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        -------</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">        bool:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">            True if synchronization is required, False otherwise.</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="n">ts_last_sync</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current commands to the robot&#39;s hardware</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>            <span class="k">return</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span>  <span class="c1"># Mark the time of latest new motion command sent</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current commands to the robot&#39;s hardware in an asynchronous way</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>            <span class="k">return</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span> <span class="c1">#Mark the time of latest new motion command sent</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the current status of the robot&#39;s hardware</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="k">return</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the current status of the robot&#39;s hardware in an asynchronous way</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>            <span class="k">return</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;stepper_is_moving_filter&#39;</span><span class="p">]:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>    <span class="k">def</span> <span class="nf">set_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">):</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set motion limits for the robot&#39;s motion range</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        Parameters</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        ----------</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">        limit_neg : float.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">            The new negative motion limit</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">        limit_pos : float.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">            The new positive motion limit</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="k">if</span> <span class="n">limit_neg</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">limit_pos</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>            <span class="c1">#Push out immediately</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MOTION_LIMITS</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_motion_limits</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_motion_limits_reply</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the gains</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        Parameters</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">        ----------</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">        g : array?</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">            An array containing the new gains to set.</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;This method has been deprecated since v0.3.0&#39;</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger writing gains to flash memory.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>    <span class="k">def</span> <span class="nf">read_gains_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gains should be read from flash memory.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>    <span class="k">def</span> <span class="nf">board_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a board reset.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_BOARD_RESET</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>    <span class="k">def</span> <span class="nf">mark_position_on_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger mark a position on contact.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">        Parameters</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        ----------</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">        x : float.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">            The position of the mark contact.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS_ON_CONTACT</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark a position.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">        Parameters</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">        ----------</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        x : float.</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">            The position to mark.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        </span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">        Notes:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        ------</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">        This method only performs the operation if the mode is MODE_SAFETY.</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not mark position. Must be in MODE_SAFETY for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="k">return</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="n">x</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>    <span class="k">def</span> <span class="nf">reset_motion_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a reset of the motion generator.</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_MOTION_GEN</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>    <span class="k">def</span> <span class="nf">reset_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a reset of the calibrated position.  </span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_POS_CALIBRATED</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="k">def</span> <span class="nf">set_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger seting the calibrated position.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_POS_CALIBRATED</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>    <span class="k">def</span> <span class="nf">enable_safety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Enable safety mode</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>    <span class="k">def</span> <span class="nf">enable_freewheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Enable freewheel mode.</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_FREEWHEEL</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="k">def</span> <span class="nf">enable_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable hold mode.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_HOLD</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>    <span class="k">def</span> <span class="nf">enable_vel_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable velocity PID control mode.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="k">def</span> <span class="nf">enable_pos_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position PID control mode.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_PID</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="k">def</span> <span class="nf">enable_vel_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable velocity trajectory control mode.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position trajectory control mode.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable incremental position trajectory control mode.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="k">def</span> <span class="nf">enable_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable current mode.</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">,</span> <span class="n">i_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="k">def</span> <span class="nf">enable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable synchrous mode.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="k">def</span> <span class="nf">disable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable asynchronous mode.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>    <span class="k">def</span> <span class="nf">enable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable runstop mode.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>    <span class="k">def</span> <span class="nf">disable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable runstop mode.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>    <span class="k">def</span> <span class="nf">enable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable guarded mode.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    <span class="k">def</span> <span class="nf">disable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable guarded mode.</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>    <span class="c1"># ######################################################################</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>    <span class="c1">#Primary interface to controlling the stepper</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="c1">#YAML defaults are used if values not provided</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>    <span class="c1">#This allows user to override defaults every control cycle and then easily revert to defaults</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span>  <span class="p">):</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a command.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">        Parameters</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        ----------</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        mode : int or None, optional.</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">            The command mode to set, if not provided the current mode remains unchanged, by default None.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">        </span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">        x_des : float or None, optional.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">            The desired position to change, if not provided the position remains unchanged. If the mode is MODE_POS_TRAJ_INCR, this parameter</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">        increments the &#39;incr_trigger&#39; value, by default None.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">        </span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">        v_des : float or None, optional.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">            The desired velocity set, if not provided the value is determined based on the current mode or set 0 if the mode is velocity-based, by default None.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">        </span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        a_des : float or None, optional.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">            The desired acceleration to set, if not provided the value is determined based on the current motion configuration, by default None.</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">        </span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">        i_des : float or None, optional.</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">            The desired current to set, if not provided the current value remains unchanged unless the mode is MODE_CURRENT, in which case it updates the `i_feedforward` value, by default None.</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        </span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        stiffness : float or None, optional.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">            The stiffnes value to set. If not provided it remains unchanged, by default None.</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">        </span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">        i_feedforward : float or None, optional.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">            The feedforward current to set, if not provided it remains unchanged unless the mode is `MODE_CURRENT`, by default None.</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">        </span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">        i_contact_pos : float or None, optional.</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">            The positive contact current to set, if not provided it is determined based on the current gains configuration, by default None.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">        </span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        i_contact_neg : float or None, optional.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">            The negative contact current to set, if not provided it is determined based on the current gains configuration, by default None.</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Notes:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        ------</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        This method updates the internal command dictionary and marks it as dirty,</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">        indicating that it has been modified.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">255</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="k">if</span> <span class="n">i_feedforward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_feedforward</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="k">if</span> <span class="n">i_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">i_des</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>        <span class="k">if</span> <span class="n">i_contact_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_pos</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="k">if</span> <span class="n">i_contact_neg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_neg</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="c1">#print(time.time(), i_des, self._command[&#39;i_feedforward&#39;],mode == self.MODE_CURRENT)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="c1">#print(time.time(),self._command[&#39;x_des&#39;],self._command[&#39;incr_trigger&#39;],self._command[&#39;v_des&#39;],self._command[&#39;a_des&#39;])</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        Poll until is moving flag is false.</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">        </span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">        Return True if success.</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        </span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        Return False if timeout.</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">        Poll until near setpoint.</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">        </span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">        Return True if success.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">        </span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">        Return False if timeout.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="c1">########### Handle current and effort conversions  ###########</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    <span class="c1">#Effort_ticks are in the units of the uC current controller (0-255 8 bit)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>    <span class="c1">#Conversion to A is based on the sense resistor and motor driver (see firmware)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert current to motor effort ticks.</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">        Parameters</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">        ----------</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">        i_A : float.</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">            The current in amperes to convert.</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        Returns</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        -------</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        int:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">            The motor effort values in ticks, between -255 to 255.</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>        <span class="n">effort_ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_A</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mA_per_tick</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">255</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">effort_ticks</span><span class="p">)))</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>    <span class="k">def</span> <span class="nf">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert motor effort ticks to current.</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        Parameters</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        ----------</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        e : int.</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">            The motor effort value in ticks to convert.</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        Returns</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        -------</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        float:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">            The current value in amperes.</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="n">mA_per_tick</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="c1"># Effort_pct is defined as a percentage of the maximum allowable motor winding current</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>    <span class="c1"># Range is -100.0 to 100.0</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert current to motor effor percentage.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        Parameters</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        ----------</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">        i_A : float.</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">            The current in amperes to convert.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        Returns</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">        -------</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">        float:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">            The motor effort percentage.</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="k">if</span> <span class="n">i_A</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i_A</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]))</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i_A</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])))</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>    <span class="k">def</span> <span class="nf">effort_pct_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert motor effort percentage to current.</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        Parameters</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">        ----------</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">        e_pct : float.</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">            The motor effort percentage to convert.</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">        Returns</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        -------</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">        float:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">            The current value in amperes.</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="n">e_pct</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="k">def</span> <span class="nf">current_to_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method current_to_torque has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>    <span class="k">def</span> <span class="nf">torque_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tq</span><span class="p">):</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method torque_to_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="c1"># ####################### Encoder Calibration ######################</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>    <span class="k">def</span> <span class="nf">get_chip_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the chip ID.</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">        Returns</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        -------</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">        str:</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">            The chip ID as a UTF-8 decoded string.</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="k">return</span> <span class="n">cid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read enconder calibration from YAML.</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        Returns</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        -------</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">        dict:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">            The encoder calibration data read from the YAML file.</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="n">device_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        <span class="n">sn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">sn</span><span class="o">+</span><span class="s1">&#39;.yaml&#39;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">enc_data</span><span class="o">=</span><span class="n">read_fleet_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="k">return</span> <span class="n">enc_data</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write encoder calibration data to YAML file.</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        Parameters</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        ----------</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        data : dict.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">            The encoder data to write.</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">        </span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        filename : str or None, optional.</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">            The filename of the YAML file. If not provided, it is constructed based on the device name and serial number, by default None.</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">        </span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">        fleet_dir : str or None, optional.</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">            The directory where the file should be saved, if not provided the default directory is used, by default None.</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="n">device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">sn</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="n">write_fleet_yaml</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">fleet_dir</span><span class="o">=</span><span class="n">fleet_dir</span><span class="p">)</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read encoder calibration data from flash memory.</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        Returns</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">        -------</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        list:</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">            The encoder calibration data as a list of floats.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">19</span><span class="p">]</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reseting board&#39;</span><span class="p">)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_reset</span><span class="p">()</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># We now have string of floats, convert to list of floats</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="n">enc_calib</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="n">ff</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>            <span class="k">if</span> <span class="n">ff</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ff</span><span class="p">]))</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_calib</span><span class="p">)</span><span class="o">==</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Successful read of encoder calibration&#39;</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Failed to read encoder calibration&#39;</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="k">return</span> <span class="n">enc_calib</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write encoder calibration data to flash memory.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        Parameters</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">        ----------</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">        data : list.</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">            The encoder calirbation data to write.</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="k">return</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="c1">#This will take a few seconds. Blocks until complete.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">!=</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad encoder data&#39;</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_ENC_CALIB</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="n">sidx</span><span class="o">=</span><span class="mi">2</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                    <span class="n">pack_float_t</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">64</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                    <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                <span class="c1"># self.logger.debug(&#39;Sending encoder calibration rpc of size&#39;,sidx)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_enc_calib_reply</span><span class="p">)</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>    <span class="k">def</span> <span class="nf">rpc_enc_calib_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reply</span><span class="p">):</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the rpc reply for encoder calibration.</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">        Parameters</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">        ----------</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">        reply : list.</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">            The RPC reply message.</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_ENC_CALIB</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_ENC_CALIB&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="c1"># ######################Menu Interface ################################3</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>    <span class="k">def</span> <span class="nf">turn_rpc_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn on the RPC interface.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;zyx&#39;</span><span class="p">)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="k">def</span> <span class="nf">turn_menu_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn on the menu interface.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="k">return</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MENU_ON</span><span class="p">])</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_menu_on_reply</span><span class="p">)</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>    <span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the menu</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    <span class="k">def</span> <span class="nf">menu_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a menu transaction.</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">        Parameters</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">        ----------</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">        x : bytes.</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">            The command to send for the menu transaction.</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">        </span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">        do_print : bool, optional</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">            A flag to control whether to print the reply in the console, by default True</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">        Returns</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        -------</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        list:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">            A list containing the reply messages received during the transaction.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="k">return</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="n">reply</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="k">if</span> <span class="n">do_print</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="n">reply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="k">return</span> <span class="n">reply</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="c1"># ################Waypoint Trajectory Interface #####################</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    <span class="c1"># ################Transport Callbacks #####################</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="k">def</span> <span class="nf">unpack_board_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack board information and updates the `self.board_info`.</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">        Parameters</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">        ----------</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">            A byte string containing packed board information.</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">        Returns</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">        -------</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">        int:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span> <span class="c1">#New format of Stepper.x  Older format of Stepper.BoardName.Vx&#39; If older format,default to 0</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):]</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>    <span class="k">def</span> <span class="nf">unpack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack gains data from a byte string and updates the `self.gains_flash` dictionary.</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        Parameters</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">        ----------</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">            A byte string containing packed gains data.</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">        Returns</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        -------</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">        int:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>    <span class="k">def</span> <span class="nf">pack_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs motion limits data starting at index sidx.</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">        Parameters</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        ----------</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">            A byte string to which motion limits data will be packed.</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">        </span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">        sidx : int.</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">        Returns</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">        -------</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">        int:</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>    <span class="k">def</span> <span class="nf">pack_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs command data starting at index sidx.</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">        Parameters</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">        ----------</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">            A byte string to which command data will be packed.</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">        </span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">        sidx : int.</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">        Returns</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">        -------</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        int:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">])</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">])</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">])</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">])</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">])</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">])</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="k">def</span> <span class="nf">pack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs gains data starting at index sidx.</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">        Parameters</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">        ----------</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">            A byte string to which gains data will be packed.</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">        </span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        sidx : int.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">        Returns</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        -------</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">        int:</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="n">config</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]:</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]:</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]:</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]:</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>    <span class="k">def</span> <span class="nf">pack_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs trigger data starting at index sidx.</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        Parameters</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        ----------</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">            A byte string to which trigger data will be packed.</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        sidx : int.</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">        Returns</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        -------</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">        int:</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>        <span class="n">pack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">)</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>    <span class="k">def</span> <span class="nf">rpc_board_info_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for board information.</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">        Parameters</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">        ----------</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span><span class="p">:</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unpack_board_info</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STEPPER_BOARD_INFO&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>    <span class="k">def</span> <span class="nf">rpc_gains_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for gains.</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">        Parameters</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        ----------</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_GAINS</span><span class="p">:</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_GAINS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>    <span class="k">def</span> <span class="nf">rpc_trigger_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for trigger.</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">        Parameters</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        ----------</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_TRIGGER</span><span class="p">:</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_SET_TRIGGER&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for command.</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">        Parameters</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">        ----------</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>    <span class="k">def</span> <span class="nf">rpc_motion_limits_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for motion limits.</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        Parameters</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">        ----------</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MOTION_LIMITS</span><span class="p">:</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MOTION_LIMITS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>    <span class="k">def</span> <span class="nf">rpc_menu_on_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for menu activation.</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">        Parameters</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">        ----------</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MENU_ON</span><span class="p">:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MENU_ON&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>    <span class="k">def</span> <span class="nf">rpc_status_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for status.</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">        Parameters</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">        ----------</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS</span><span class="p">:</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>    <span class="k">def</span> <span class="nf">rpc_read_gains_from_flash_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for reading gains from flash.</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">        Parameters</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        ----------</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">            The reply message.</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_gains</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_GAINS_FROM_FLASH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="c1"># ######################## STEPPER PROTOCOL PO #################################</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P0</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack status information and udpates `self.status` dictionary.</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">        Parameters</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">        ----------</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">        s : bytes</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">        Returns</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">        -------</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">        int:</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a readable representation of the robot&#39;s status</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="c1"># ######################## STEPPER PROTOCOL P1 #################################</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P1</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack status information and udpates `self.status` dictionary.</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">        Parameters</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        ----------</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        s : bytes</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">        Returns</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">        -------</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">        int:</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a readable representation of the robot&#39;s status</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Trace recording:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">])</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waypoint Trajectory&#39;</span><span class="p">)</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       State:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Setpoint: (rad) </span><span class="si">%s</span><span class="s1"> | (deg) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">],</span>  <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">])))</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Segment ID:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">])</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position trajectory waypoint</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">)</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts execution of a waypoint trajectory on hardware.</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="sd">        Parameters</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">        ----------</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="sd">        first_segment : list.</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">            The hardware begins executing this first segment of a spline. The segment&#39;s duration and</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">            six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">            2 for the first segment, fills the last element of the list.</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">        Returns</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="sd">        -------</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a><span class="sd">        bool:</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">            True if uC successfully initiated a new trajectory.</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">first_segment</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_START_NEW_TRAJECTORY</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start_new_traj_reply</span><span class="p">)</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span><span class="p">:</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>        <span class="c1"># return self._waypoint_traj_start_success</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the next segment for the hardware to execute.</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a><span class="sd">        This method is generally called multiple times while the prior segment is executing. This</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a><span class="sd">        provides the hardware with the next segment to gracefully transition across the entire spline,</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a><span class="sd">        while allowing users to preempt or modify the future trajectory in real time.</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">        This method will return False if there is not already an segment executing on the uC.</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a><span class="sd">        Parameters</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a><span class="sd">        ----------</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="sd">        next_segment : list.</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">            Duration and six coefficients fill the first seven elements of the list. Generally, the</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">            coefficients are calculated to smoothly transition across a spline. The segment ID, always</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a><span class="sd">            1 higher than the prior segment&#39;s ID, fills the last element of the list.</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="sd">        Returns</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="sd">        -------</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">        bool:</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">            True if uC successfully queued next trajectory.</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">next_segment</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_set_next_traj_seg_reply</span><span class="p">)</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span><span class="p">:</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops execution of the waypoint trajectory.</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_RESET_TRAJECTORY</span><span class="p">])</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_reset_traj_reply</span><span class="p">)</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs trajectory segment data starting at index sidx.</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="sd">        Parameters</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">        ----------</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a><span class="sd">            A byte string to which trajectory segment data will be packed.</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a><span class="sd">        </span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">        sidx : int.</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a><span class="sd">        Returns</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a><span class="sd">        -------</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a><span class="sd">        int:</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>            <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for starting a new trajectory.</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a><span class="sd">        Parameters</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a><span class="sd">        ----------</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for setting the next trajectory segment.</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="sd">        Parameters</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a><span class="sd">        ----------</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for resetting the trajectory.</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">        Parameters</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">        ----------</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_RESET_TRAJECTORY</span><span class="p">:</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_RESET_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="c1"># ######################## STEPPER PROTOCOL P2 #################################</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P2</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>    <span class="k">def</span> <span class="nf">read_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads firmware trace data and returns it as a list.</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">        Returns</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">        -------</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">        list:</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">            A list containing the firmware trace data.</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1">#Timestamp holds state, reset within lock to avoid threading issues</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>        <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>        <span class="k">while</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&lt;</span><span class="mf">60.0</span><span class="p">:</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_TRACE</span><span class="p">])</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_firmware_trace_reply</span><span class="p">)</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>    <span class="k">def</span> <span class="nf">unpack_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks debug trace data into the `unpack_to` dictionary.</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a><span class="sd">        Parameters</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">        ----------</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">            The byte string containing debug trace information.</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">        </span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="sd">        unpack_to : dict.</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">            A dictionary to store the unpacked information.</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">        Returns</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">        -------</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">        int:</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>    <span class="k">def</span> <span class="nf">unpack_print_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and prints trace information into the `unpack_to` dictionary.</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="sd">        Parameters</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">        ----------</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">            The byte string containing print trace information.</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a><span class="sd">        </span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a><span class="sd">        unpack_to : dict.</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a><span class="sd">        Returns</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a><span class="sd">        -------</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a><span class="sd">        int:</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>        <span class="n">line_len</span><span class="o">=</span><span class="mi">32</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="n">line_len</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="n">line_len</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for reading the firmware trace.</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a><span class="sd">        Parameters</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a><span class="sd">        ----------</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_TRACE</span><span class="p">:</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{},</span><span class="s1">&#39;debug&#39;</span><span class="p">:{},</span><span class="s1">&#39;print&#39;</span><span class="p">:{}})</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_STATUS</span><span class="p">:</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_DEBUG</span><span class="p">:</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_debug_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_PRINT</span><span class="p">:</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_print_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;print&#39;</span><span class="p">])</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized trace type </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_TRACE&#39;</span><span class="p">)</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the trigger to enable firmware trace.</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_ENABLE_TRACE</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the trigger to disable firmware trace.</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_DISABLE_TRACE</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks status information and updates the `unpack_to` dictionary.</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a><span class="sd">        Parameters</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a><span class="sd">        ----------</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a><span class="sd">        </span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a><span class="sd">        unpack_to : dict, optional.</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a><span class="sd">            A dictionary to store the unpacked status information, by default None.</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a><span class="sd">        Returns</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a><span class="sd">        -------</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a><span class="sd">        int:</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_TRACE_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a><span class="c1"># ######################## STEPPER PROTOCOL P3 #################################</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P3</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for starting a new trajectory.</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a><span class="sd">        Parameters</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a><span class="sd">        ----------</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a><span class="sd">            The RPC reply sequence.</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for setting the next trajectory segment.</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a><span class="sd">        Parameters</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a><span class="sd">        ----------</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push a load test payload to the hardware for testing.</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>            <span class="k">return</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PUSH</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_push_reply</span><span class="p">)</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the results of a load test.</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>            <span class="k">return</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PULL</span><span class="p">])</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_pull_reply</span><span class="p">)</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_push_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for a load push test.</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a><span class="sd">        Parameters</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a><span class="sd">        ----------</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PUSH</span><span class="p">:</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PUSH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_pull_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for a load pull test.</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a><span class="sd">        Parameters</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a><span class="sd">        ----------</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a><span class="sd">        reply : bytes.</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PULL</span><span class="p">:</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">]:</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load test pull bad data&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successful load test pull&#39;</span><span class="p">)</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PULL&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull auxiliary status information.</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>            <span class="k">return</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS_AUX</span><span class="p">])</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_aux_reply</span><span class="p">)</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>    <span class="k">def</span> <span class="nf">unpack_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and stores auxiliary status information.</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a><span class="sd">        Parameters</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a><span class="sd">        ----------</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a><span class="sd">            The byte string containing auxiliary status information.</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a><span class="sd">        Returns</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a><span class="sd">        -------</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a><span class="sd">        int:</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>    <span class="k">def</span> <span class="nf">rpc_status_aux_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the reply to the auxiliary status command.</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a><span class="sd">        Parameters</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a><span class="sd">        ----------</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a><span class="sd">            The reply received.</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS_AUX</span><span class="p">:</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status_aux</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>    <span class="k">def</span> <span class="nf">unpack_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and stores command related information </span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="sd">        Parameters</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a><span class="sd">        ----------</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a><span class="sd">        s : bytes.</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a><span class="sd">            A byte sequence containing command related information.</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a><span class="sd">        Returns</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a><span class="sd">        -------</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a><span class="sd">        int:</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the reply for a command-related information.</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a><span class="sd">        Parameters</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a><span class="sd">        ----------</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a><span class="sd">        reply : list.</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a><span class="sd">            A list containing the reply data.</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_command_reply</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a><span class="c1"># ######################## STEPPER #################################</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a><span class="k">class</span> <span class="nc">Stepper</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P3</span><span class="p">,</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,)}</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>    
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>    <span class="k">def</span> <span class="nf">expand_protocol_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_class</span><span class="p">):</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Expands protocol methods for use.</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a><span class="sd">        Parameters</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a><span class="sd">        ----------</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a><span class="sd">        protocol_class : class.</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a><span class="sd">            The protocol class from which the methods should be expanded.</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">protocol_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stepper</span><span class="p">))</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>                
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a><span class="sd">        First determine which protocol version the uC firmware is running.</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a><span class="sd">        Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>                <span class="n">protocol_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_protocol_methods</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a><span class="s2">                                    ----------------</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a><span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a><span class="s2">                                    Please power cycle the robot and try again.</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a><span class="s2">                                    ----------------</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a><span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a><span class="s2">                    ----------------</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a><span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a><span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a><span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a><span class="s2">                    Disabling device.</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a><span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a><span class="s2">                    ----------------</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a><span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</span></pre></div>


            </section>
                <section id="StepperBase">
                            <input id="StepperBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StepperBase</span><wbr>(<span class="base"><a href="device.html#Device">stretch_body.device.Device</a></span>):

                <label class="view-source-button" for="StepperBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase-16"><a href="#StepperBase-16"><span class="linenos">  16</span></a><span class="k">class</span> <span class="nc">StepperBase</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="StepperBase-17"><a href="#StepperBase-17"><span class="linenos">  17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase-18"><a href="#StepperBase-18"><span class="linenos">  18</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="StepperBase-19"><a href="#StepperBase-19"><span class="linenos">  19</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="StepperBase-20"><a href="#StepperBase-20"><span class="linenos">  20</span></a>    <span class="n">RPC_SET_COMMAND</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-21"><a href="#StepperBase-21"><span class="linenos">  21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-22"><a href="#StepperBase-22"><span class="linenos">  22</span></a>    <span class="n">RPC_REPLY_COMMAND</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-23"><a href="#StepperBase-23"><span class="linenos">  23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-24"><a href="#StepperBase-24"><span class="linenos">  24</span></a>    <span class="n">RPC_GET_STATUS</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="StepperBase-25"><a href="#StepperBase-25"><span class="linenos">  25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-26"><a href="#StepperBase-26"><span class="linenos">  26</span></a>    <span class="n">RPC_REPLY_STATUS</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="StepperBase-27"><a href="#StepperBase-27"><span class="linenos">  27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-28"><a href="#StepperBase-28"><span class="linenos">  28</span></a>    <span class="n">RPC_SET_GAINS</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="StepperBase-29"><a href="#StepperBase-29"><span class="linenos">  29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-30"><a href="#StepperBase-30"><span class="linenos">  30</span></a>    <span class="n">RPC_REPLY_GAINS</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="StepperBase-31"><a href="#StepperBase-31"><span class="linenos">  31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-32"><a href="#StepperBase-32"><span class="linenos">  32</span></a>    <span class="n">RPC_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="StepperBase-33"><a href="#StepperBase-33"><span class="linenos">  33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-34"><a href="#StepperBase-34"><span class="linenos">  34</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="StepperBase-35"><a href="#StepperBase-35"><span class="linenos">  35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-36"><a href="#StepperBase-36"><span class="linenos">  36</span></a>    <span class="n">RPC_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">9</span>
</span><span id="StepperBase-37"><a href="#StepperBase-37"><span class="linenos">  37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-38"><a href="#StepperBase-38"><span class="linenos">  38</span></a>    <span class="n">RPC_REPLY_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="StepperBase-39"><a href="#StepperBase-39"><span class="linenos">  39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-40"><a href="#StepperBase-40"><span class="linenos">  40</span></a>    <span class="n">RPC_SET_ENC_CALIB</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="StepperBase-41"><a href="#StepperBase-41"><span class="linenos">  41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-42"><a href="#StepperBase-42"><span class="linenos">  42</span></a>    <span class="n">RPC_REPLY_ENC_CALIB</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="StepperBase-43"><a href="#StepperBase-43"><span class="linenos">  43</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-44"><a href="#StepperBase-44"><span class="linenos">  44</span></a>    <span class="n">RPC_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="StepperBase-45"><a href="#StepperBase-45"><span class="linenos">  45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-46"><a href="#StepperBase-46"><span class="linenos">  46</span></a>    <span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="StepperBase-47"><a href="#StepperBase-47"><span class="linenos">  47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-48"><a href="#StepperBase-48"><span class="linenos">  48</span></a>    <span class="n">RPC_SET_MENU_ON</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="StepperBase-49"><a href="#StepperBase-49"><span class="linenos">  49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-50"><a href="#StepperBase-50"><span class="linenos">  50</span></a>    <span class="n">RPC_REPLY_MENU_ON</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="StepperBase-51"><a href="#StepperBase-51"><span class="linenos">  51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-52"><a href="#StepperBase-52"><span class="linenos">  52</span></a>    <span class="n">RPC_GET_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="StepperBase-53"><a href="#StepperBase-53"><span class="linenos">  53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-54"><a href="#StepperBase-54"><span class="linenos">  54</span></a>    <span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="StepperBase-55"><a href="#StepperBase-55"><span class="linenos">  55</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-56"><a href="#StepperBase-56"><span class="linenos">  56</span></a>    <span class="n">RPC_SET_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">19</span>
</span><span id="StepperBase-57"><a href="#StepperBase-57"><span class="linenos">  57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-58"><a href="#StepperBase-58"><span class="linenos">  58</span></a>    <span class="n">RPC_REPLY_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="StepperBase-59"><a href="#StepperBase-59"><span class="linenos">  59</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-60"><a href="#StepperBase-60"><span class="linenos">  60</span></a>    <span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">21</span>
</span><span id="StepperBase-61"><a href="#StepperBase-61"><span class="linenos">  61</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-62"><a href="#StepperBase-62"><span class="linenos">  62</span></a>    <span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">22</span>
</span><span id="StepperBase-63"><a href="#StepperBase-63"><span class="linenos">  63</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-64"><a href="#StepperBase-64"><span class="linenos">  64</span></a>    <span class="n">RPC_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">23</span>
</span><span id="StepperBase-65"><a href="#StepperBase-65"><span class="linenos">  65</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-66"><a href="#StepperBase-66"><span class="linenos">  66</span></a>    <span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">24</span>
</span><span id="StepperBase-67"><a href="#StepperBase-67"><span class="linenos">  67</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-68"><a href="#StepperBase-68"><span class="linenos">  68</span></a>    <span class="n">RPC_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">25</span>
</span><span id="StepperBase-69"><a href="#StepperBase-69"><span class="linenos">  69</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-70"><a href="#StepperBase-70"><span class="linenos">  70</span></a>    <span class="n">RPC_REPLY_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">26</span>
</span><span id="StepperBase-71"><a href="#StepperBase-71"><span class="linenos">  71</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-72"><a href="#StepperBase-72"><span class="linenos">  72</span></a>    <span class="n">RPC_READ_TRACE</span> <span class="o">=</span><span class="mi">27</span>
</span><span id="StepperBase-73"><a href="#StepperBase-73"><span class="linenos">  73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-74"><a href="#StepperBase-74"><span class="linenos">  74</span></a>    <span class="n">RPC_REPLY_READ_TRACE</span> <span class="o">=</span><span class="mi">28</span>
</span><span id="StepperBase-75"><a href="#StepperBase-75"><span class="linenos">  75</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-76"><a href="#StepperBase-76"><span class="linenos">  76</span></a>    <span class="n">RPC_GET_STATUS_AUX</span> <span class="o">=</span> <span class="mi">29</span>
</span><span id="StepperBase-77"><a href="#StepperBase-77"><span class="linenos">  77</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-78"><a href="#StepperBase-78"><span class="linenos">  78</span></a>    <span class="n">RPC_REPLY_STATUS_AUX</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="StepperBase-79"><a href="#StepperBase-79"><span class="linenos">  79</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-80"><a href="#StepperBase-80"><span class="linenos">  80</span></a>    <span class="n">RPC_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">31</span>
</span><span id="StepperBase-81"><a href="#StepperBase-81"><span class="linenos">  81</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-82"><a href="#StepperBase-82"><span class="linenos">  82</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="StepperBase-83"><a href="#StepperBase-83"><span class="linenos">  83</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-84"><a href="#StepperBase-84"><span class="linenos">  84</span></a>
</span><span id="StepperBase-85"><a href="#StepperBase-85"><span class="linenos">  85</span></a>    <span class="n">MODE_SAFETY</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-86"><a href="#StepperBase-86"><span class="linenos">  86</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-87"><a href="#StepperBase-87"><span class="linenos">  87</span></a>    <span class="n">MODE_FREEWHEEL</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-88"><a href="#StepperBase-88"><span class="linenos">  88</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-89"><a href="#StepperBase-89"><span class="linenos">  89</span></a>    <span class="n">MODE_HOLD</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-90"><a href="#StepperBase-90"><span class="linenos">  90</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-91"><a href="#StepperBase-91"><span class="linenos">  91</span></a>    <span class="n">MODE_POS_PID</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="StepperBase-92"><a href="#StepperBase-92"><span class="linenos">  92</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-93"><a href="#StepperBase-93"><span class="linenos">  93</span></a>    <span class="n">MODE_VEL_PID</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="StepperBase-94"><a href="#StepperBase-94"><span class="linenos">  94</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-95"><a href="#StepperBase-95"><span class="linenos">  95</span></a>    <span class="n">MODE_POS_TRAJ</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="StepperBase-96"><a href="#StepperBase-96"><span class="linenos">  96</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-97"><a href="#StepperBase-97"><span class="linenos">  97</span></a>    <span class="n">MODE_VEL_TRAJ</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="StepperBase-98"><a href="#StepperBase-98"><span class="linenos">  98</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-99"><a href="#StepperBase-99"><span class="linenos">  99</span></a>    <span class="n">MODE_CURRENT</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="StepperBase-100"><a href="#StepperBase-100"><span class="linenos"> 100</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-101"><a href="#StepperBase-101"><span class="linenos"> 101</span></a>    <span class="n">MODE_POS_TRAJ_INCR</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="StepperBase-102"><a href="#StepperBase-102"><span class="linenos"> 102</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-103"><a href="#StepperBase-103"><span class="linenos"> 103</span></a>    <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="o">=</span><span class="mi">9</span>
</span><span id="StepperBase-104"><a href="#StepperBase-104"><span class="linenos"> 104</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-105"><a href="#StepperBase-105"><span class="linenos"> 105</span></a>    
</span><span id="StepperBase-106"><a href="#StepperBase-106"><span class="linenos"> 106</span></a>    <span class="n">MODE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="StepperBase-107"><a href="#StepperBase-107"><span class="linenos"> 107</span></a>        <span class="n">MODE_SAFETY</span><span class="p">:</span> <span class="s1">&#39;MODE_SAFETY&#39;</span><span class="p">,</span>
</span><span id="StepperBase-108"><a href="#StepperBase-108"><span class="linenos"> 108</span></a>        <span class="n">MODE_FREEWHEEL</span><span class="p">:</span> <span class="s1">&#39;MODE_FREEWHEEL&#39;</span><span class="p">,</span>
</span><span id="StepperBase-109"><a href="#StepperBase-109"><span class="linenos"> 109</span></a>        <span class="n">MODE_HOLD</span><span class="p">:</span> <span class="s1">&#39;MODE_HOLD&#39;</span><span class="p">,</span>
</span><span id="StepperBase-110"><a href="#StepperBase-110"><span class="linenos"> 110</span></a>        <span class="n">MODE_POS_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_PID&#39;</span><span class="p">,</span>
</span><span id="StepperBase-111"><a href="#StepperBase-111"><span class="linenos"> 111</span></a>        <span class="n">MODE_VEL_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_PID&#39;</span><span class="p">,</span>
</span><span id="StepperBase-112"><a href="#StepperBase-112"><span class="linenos"> 112</span></a>        <span class="n">MODE_POS_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ&#39;</span><span class="p">,</span>
</span><span id="StepperBase-113"><a href="#StepperBase-113"><span class="linenos"> 113</span></a>        <span class="n">MODE_VEL_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_TRAJ&#39;</span><span class="p">,</span>
</span><span id="StepperBase-114"><a href="#StepperBase-114"><span class="linenos"> 114</span></a>        <span class="n">MODE_CURRENT</span><span class="p">:</span> <span class="s1">&#39;MODE_CURRENT&#39;</span><span class="p">,</span>
</span><span id="StepperBase-115"><a href="#StepperBase-115"><span class="linenos"> 115</span></a>        <span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_INCR&#39;</span><span class="p">,</span>
</span><span id="StepperBase-116"><a href="#StepperBase-116"><span class="linenos"> 116</span></a>        <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_WAYPOINT&#39;</span><span class="p">,</span>
</span><span id="StepperBase-117"><a href="#StepperBase-117"><span class="linenos"> 117</span></a>    <span class="p">}</span>
</span><span id="StepperBase-118"><a href="#StepperBase-118"><span class="linenos"> 118</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-119"><a href="#StepperBase-119"><span class="linenos"> 119</span></a>
</span><span id="StepperBase-120"><a href="#StepperBase-120"><span class="linenos"> 120</span></a>    <span class="n">DIAG_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Has a pos zero RPC been received since powerup</span>
</span><span id="StepperBase-121"><a href="#StepperBase-121"><span class="linenos"> 121</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-122"><a href="#StepperBase-122"><span class="linenos"> 122</span></a>    <span class="n">DIAG_RUNSTOP_ON</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Is controller in runstop mode</span>
</span><span id="StepperBase-123"><a href="#StepperBase-123"><span class="linenos"> 123</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-124"><a href="#StepperBase-124"><span class="linenos"> 124</span></a>    <span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Is pos controller within gains.pAs_d of setpoint</span>
</span><span id="StepperBase-125"><a href="#StepperBase-125"><span class="linenos"> 125</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-126"><a href="#StepperBase-126"><span class="linenos"> 126</span></a>    <span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Is vel controller within gains.vAs_d of setpoint</span>
</span><span id="StepperBase-127"><a href="#StepperBase-127"><span class="linenos"> 127</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-128"><a href="#StepperBase-128"><span class="linenos"> 128</span></a>    <span class="n">DIAG_IS_MOVING</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># Is measured velocity greater than gains.vAs_d</span>
</span><span id="StepperBase-129"><a href="#StepperBase-129"><span class="linenos"> 129</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-130"><a href="#StepperBase-130"><span class="linenos"> 130</span></a>    <span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># Is controller current saturated</span>
</span><span id="StepperBase-131"><a href="#StepperBase-131"><span class="linenos"> 131</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-132"><a href="#StepperBase-132"><span class="linenos"> 132</span></a>    <span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">=</span> <span class="mi">64</span>  <span class="c1"># Is controller motion generator acceleration non-zero</span>
</span><span id="StepperBase-133"><a href="#StepperBase-133"><span class="linenos"> 133</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-134"><a href="#StepperBase-134"><span class="linenos"> 134</span></a>    <span class="n">DIAG_IS_MG_MOVING</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># Is controller motion generator velocity non-zero</span>
</span><span id="StepperBase-135"><a href="#StepperBase-135"><span class="linenos"> 135</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-136"><a href="#StepperBase-136"><span class="linenos"> 136</span></a>    <span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># Is calibration table in flash</span>
</span><span id="StepperBase-137"><a href="#StepperBase-137"><span class="linenos"> 137</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-138"><a href="#StepperBase-138"><span class="linenos"> 138</span></a>    <span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Guarded event occurred during motion</span>
</span><span id="StepperBase-139"><a href="#StepperBase-139"><span class="linenos"> 139</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-140"><a href="#StepperBase-140"><span class="linenos"> 140</span></a>    <span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># Is it forced into safety mode</span>
</span><span id="StepperBase-141"><a href="#StepperBase-141"><span class="linenos"> 141</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-142"><a href="#StepperBase-142"><span class="linenos"> 142</span></a>    <span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">2048</span>  <span class="c1"># Command received but no sync yet</span>
</span><span id="StepperBase-143"><a href="#StepperBase-143"><span class="linenos"> 143</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-144"><a href="#StepperBase-144"><span class="linenos"> 144</span></a>    <span class="n">DIAG_TRAJ_ACTIVE</span>     <span class="o">=</span> <span class="mi">4096</span>     <span class="c1"># Whether a waypoint trajectory is actively executing</span>
</span><span id="StepperBase-145"><a href="#StepperBase-145"><span class="linenos"> 145</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-146"><a href="#StepperBase-146"><span class="linenos"> 146</span></a>    <span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">8192</span> <span class="c1"># Currently waiting on a sync signal before starting trajectory</span>
</span><span id="StepperBase-147"><a href="#StepperBase-147"><span class="linenos"> 147</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-148"><a href="#StepperBase-148"><span class="linenos"> 148</span></a>    <span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">=</span> <span class="mi">16384</span>        <span class="c1"># Currently running in sync mode</span>
</span><span id="StepperBase-149"><a href="#StepperBase-149"><span class="linenos"> 149</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-150"><a href="#StepperBase-150"><span class="linenos"> 150</span></a>    <span class="n">DIAG_IS_TRACE_ON</span> <span class="o">=</span> <span class="mi">32768</span>   <span class="c1">#Is trace recording</span>
</span><span id="StepperBase-151"><a href="#StepperBase-151"><span class="linenos"> 151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-152"><a href="#StepperBase-152"><span class="linenos"> 152</span></a>
</span><span id="StepperBase-153"><a href="#StepperBase-153"><span class="linenos"> 153</span></a>    <span class="n">CONFIG_SAFETY_HOLD</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Hold position in safety mode? Otherwise freewheel</span>
</span><span id="StepperBase-154"><a href="#StepperBase-154"><span class="linenos"> 154</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-155"><a href="#StepperBase-155"><span class="linenos"> 155</span></a>    <span class="n">CONFIG_ENABLE_RUNSTOP</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Recognize runstop signal?</span>
</span><span id="StepperBase-156"><a href="#StepperBase-156"><span class="linenos"> 156</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-157"><a href="#StepperBase-157"><span class="linenos"> 157</span></a>    <span class="n">CONFIG_ENABLE_SYNC_MODE</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Commands are synchronized from digital trigger</span>
</span><span id="StepperBase-158"><a href="#StepperBase-158"><span class="linenos"> 158</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-159"><a href="#StepperBase-159"><span class="linenos"> 159</span></a>    <span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Stops on current threshold</span>
</span><span id="StepperBase-160"><a href="#StepperBase-160"><span class="linenos"> 160</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-161"><a href="#StepperBase-161"><span class="linenos"> 161</span></a>    <span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="StepperBase-162"><a href="#StepperBase-162"><span class="linenos"> 162</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-163"><a href="#StepperBase-163"><span class="linenos"> 163</span></a>    <span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="StepperBase-164"><a href="#StepperBase-164"><span class="linenos"> 164</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-165"><a href="#StepperBase-165"><span class="linenos"> 165</span></a>    <span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">=</span> <span class="mi">64</span> <span class="c1">#Timeout velocity commands</span>
</span><span id="StepperBase-166"><a href="#StepperBase-166"><span class="linenos"> 166</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-167"><a href="#StepperBase-167"><span class="linenos"> 167</span></a>
</span><span id="StepperBase-168"><a href="#StepperBase-168"><span class="linenos"> 168</span></a>    <span class="n">TRIGGER_MARK_POS</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-169"><a href="#StepperBase-169"><span class="linenos"> 169</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-170"><a href="#StepperBase-170"><span class="linenos"> 170</span></a>    <span class="n">TRIGGER_RESET_MOTION_GEN</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-171"><a href="#StepperBase-171"><span class="linenos"> 171</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-172"><a href="#StepperBase-172"><span class="linenos"> 172</span></a>    <span class="n">TRIGGER_BOARD_RESET</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="StepperBase-173"><a href="#StepperBase-173"><span class="linenos"> 173</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-174"><a href="#StepperBase-174"><span class="linenos"> 174</span></a>    <span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="StepperBase-175"><a href="#StepperBase-175"><span class="linenos"> 175</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-176"><a href="#StepperBase-176"><span class="linenos"> 176</span></a>    <span class="n">TRIGGER_RESET_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="StepperBase-177"><a href="#StepperBase-177"><span class="linenos"> 177</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-178"><a href="#StepperBase-178"><span class="linenos"> 178</span></a>    <span class="n">TRIGGER_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="StepperBase-179"><a href="#StepperBase-179"><span class="linenos"> 179</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-180"><a href="#StepperBase-180"><span class="linenos"> 180</span></a>    <span class="n">TRIGGER_MARK_POS_ON_CONTACT</span><span class="o">=</span><span class="mi">64</span>
</span><span id="StepperBase-181"><a href="#StepperBase-181"><span class="linenos"> 181</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-182"><a href="#StepperBase-182"><span class="linenos"> 182</span></a>    <span class="n">TRIGGER_ENABLE_TRACE</span><span class="o">=</span><span class="mi">128</span>
</span><span id="StepperBase-183"><a href="#StepperBase-183"><span class="linenos"> 183</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-184"><a href="#StepperBase-184"><span class="linenos"> 184</span></a>    <span class="n">TRIGGER_DISABLE_TRACE</span><span class="o">=</span><span class="mi">256</span>
</span><span id="StepperBase-185"><a href="#StepperBase-185"><span class="linenos"> 185</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-186"><a href="#StepperBase-186"><span class="linenos"> 186</span></a>
</span><span id="StepperBase-187"><a href="#StepperBase-187"><span class="linenos"> 187</span></a>    <span class="n">TRACE_TYPE_STATUS</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-188"><a href="#StepperBase-188"><span class="linenos"> 188</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-189"><a href="#StepperBase-189"><span class="linenos"> 189</span></a>    <span class="n">TRACE_TYPE_DEBUG</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-190"><a href="#StepperBase-190"><span class="linenos"> 190</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-191"><a href="#StepperBase-191"><span class="linenos"> 191</span></a>    <span class="n">TRACE_TYPE_PRINT</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-192"><a href="#StepperBase-192"><span class="linenos"> 192</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-193"><a href="#StepperBase-193"><span class="linenos"> 193</span></a>
</span><span id="StepperBase-194"><a href="#StepperBase-194"><span class="linenos"> 194</span></a>
</span><span id="StepperBase-195"><a href="#StepperBase-195"><span class="linenos"> 195</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase-196"><a href="#StepperBase-196"><span class="linenos"> 196</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-197"><a href="#StepperBase-197"><span class="linenos"> 197</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="c1">#Pull from usb device name</span>
</span><span id="StepperBase-198"><a href="#StepperBase-198"><span class="linenos"> 198</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="StepperBase-199"><a href="#StepperBase-199"><span class="linenos"> 199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span>
</span><span id="StepperBase-200"><a href="#StepperBase-200"><span class="linenos"> 200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">Transport</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="StepperBase-201"><a href="#StepperBase-201"><span class="linenos"> 201</span></a>
</span><span id="StepperBase-202"><a href="#StepperBase-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;a_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stiffness&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase-203"><a href="#StepperBase-203"><span class="linenos"> 203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_pct&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;current&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-204"><a href="#StepperBase-204"><span class="linenos"> 204</span></a>                       <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-205"><a href="#StepperBase-205"><span class="linenos"> 205</span></a>                       <span class="s1">&#39;is_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-206"><a href="#StepperBase-206"><span class="linenos"> 206</span></a>                       <span class="s1">&#39;in_safety_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;trace_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-207"><a href="#StepperBase-207"><span class="linenos"> 207</span></a>                       <span class="s1">&#39;waypoint_traj&#39;</span><span class="p">:{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="s1">&#39;setpoint&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;segment_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,}}</span>
</span><span id="StepperBase-208"><a href="#StepperBase-208"><span class="linenos"> 208</span></a>
</span><span id="StepperBase-209"><a href="#StepperBase-209"><span class="linenos"> 209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase-210"><a href="#StepperBase-210"><span class="linenos"> 210</span></a>
</span><span id="StepperBase-211"><a href="#StepperBase-211"><span class="linenos"> 211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase-212"><a href="#StepperBase-212"><span class="linenos"> 212</span></a>
</span><span id="StepperBase-213"><a href="#StepperBase-213"><span class="linenos"> 213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;board_variant&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;firmware_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase-214"><a href="#StepperBase-214"><span class="linenos"> 214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="StepperBase-215"><a href="#StepperBase-215"><span class="linenos"> 215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="StepperBase-216"><a href="#StepperBase-216"><span class="linenos"> 216</span></a>
</span><span id="StepperBase-217"><a href="#StepperBase-217"><span class="linenos"> 217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="StepperBase-218"><a href="#StepperBase-218"><span class="linenos"> 218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-219"><a href="#StepperBase-219"><span class="linenos"> 219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-220"><a href="#StepperBase-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase-221"><a href="#StepperBase-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase-222"><a href="#StepperBase-222"><span class="linenos"> 222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StepperBase-223"><a href="#StepperBase-223"><span class="linenos"> 223</span></a>
</span><span id="StepperBase-224"><a href="#StepperBase-224"><span class="linenos"> 224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-225"><a href="#StepperBase-225"><span class="linenos"> 225</span></a>
</span><span id="StepperBase-226"><a href="#StepperBase-226"><span class="linenos"> 226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-227"><a href="#StepperBase-227"><span class="linenos"> 227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-228"><a href="#StepperBase-228"><span class="linenos"> 228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-229"><a href="#StepperBase-229"><span class="linenos"> 229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase-230"><a href="#StepperBase-230"><span class="linenos"> 230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-231"><a href="#StepperBase-231"><span class="linenos"> 231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-232"><a href="#StepperBase-232"><span class="linenos"> 232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</span><span id="StepperBase-233"><a href="#StepperBase-233"><span class="linenos"> 233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase-234"><a href="#StepperBase-234"><span class="linenos"> 234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase-235"><a href="#StepperBase-235"><span class="linenos"> 235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StepperBase-236"><a href="#StepperBase-236"><span class="linenos"> 236</span></a>
</span><span id="StepperBase-237"><a href="#StepperBase-237"><span class="linenos"> 237</span></a>
</span><span id="StepperBase-238"><a href="#StepperBase-238"><span class="linenos"> 238</span></a>    <span class="c1"># ###########  Device Methods #############</span>
</span><span id="StepperBase-239"><a href="#StepperBase-239"><span class="linenos"> 239</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-240"><a href="#StepperBase-240"><span class="linenos"> 240</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="StepperBase-241"><a href="#StepperBase-241"><span class="linenos"> 241</span></a>            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="StepperBase-242"><a href="#StepperBase-242"><span class="linenos"> 242</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
</span><span id="StepperBase-243"><a href="#StepperBase-243"><span class="linenos"> 243</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-244"><a href="#StepperBase-244"><span class="linenos"> 244</span></a>                <span class="c1"># Pull board info</span>
</span><span id="StepperBase-245"><a href="#StepperBase-245"><span class="linenos"> 245</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STEPPER_BOARD_INFO</span><span class="p">])</span>
</span><span id="StepperBase-246"><a href="#StepperBase-246"><span class="linenos"> 246</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_board_info_reply</span><span class="p">)</span>
</span><span id="StepperBase-247"><a href="#StepperBase-247"><span class="linenos"> 247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">configure_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="StepperBase-248"><a href="#StepperBase-248"><span class="linenos"> 248</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="StepperBase-249"><a href="#StepperBase-249"><span class="linenos"> 249</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="StepperBase-250"><a href="#StepperBase-250"><span class="linenos"> 250</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="StepperBase-251"><a href="#StepperBase-251"><span class="linenos"> 251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase-252"><a href="#StepperBase-252"><span class="linenos"> 252</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="StepperBase-253"><a href="#StepperBase-253"><span class="linenos"> 253</span></a>
</span><span id="StepperBase-254"><a href="#StepperBase-254"><span class="linenos"> 254</span></a>    <span class="c1">#Configure control mode prior to calling this on process shutdown (or default to freewheel)</span>
</span><span id="StepperBase-255"><a href="#StepperBase-255"><span class="linenos"> 255</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-256"><a href="#StepperBase-256"><span class="linenos"> 256</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="StepperBase-257"><a href="#StepperBase-257"><span class="linenos"> 257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-258"><a href="#StepperBase-258"><span class="linenos"> 258</span></a>            <span class="k">return</span>
</span><span id="StepperBase-259"><a href="#StepperBase-259"><span class="linenos"> 259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down Stepper on: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase-260"><a href="#StepperBase-260"><span class="linenos"> 260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="StepperBase-261"><a href="#StepperBase-261"><span class="linenos"> 261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">exiting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="StepperBase-262"><a href="#StepperBase-262"><span class="linenos"> 262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="StepperBase-263"><a href="#StepperBase-263"><span class="linenos"> 263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-264"><a href="#StepperBase-264"><span class="linenos"> 264</span></a>
</span><span id="StepperBase-265"><a href="#StepperBase-265"><span class="linenos"> 265</span></a>    <span class="k">def</span> <span class="nf">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_last_sync</span><span class="p">):</span>
</span><span id="StepperBase-266"><a href="#StepperBase-266"><span class="linenos"> 266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines if synchronization is required base on current the status.</span>
</span><span id="StepperBase-267"><a href="#StepperBase-267"><span class="linenos"> 267</span></a>
</span><span id="StepperBase-268"><a href="#StepperBase-268"><span class="linenos"> 268</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-269"><a href="#StepperBase-269"><span class="linenos"> 269</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-270"><a href="#StepperBase-270"><span class="linenos"> 270</span></a><span class="sd">        ts_last_sync : float.</span>
</span><span id="StepperBase-271"><a href="#StepperBase-271"><span class="linenos"> 271</span></a><span class="sd">            The timestamp of the last synchronized motion.</span>
</span><span id="StepperBase-272"><a href="#StepperBase-272"><span class="linenos"> 272</span></a>
</span><span id="StepperBase-273"><a href="#StepperBase-273"><span class="linenos"> 273</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-274"><a href="#StepperBase-274"><span class="linenos"> 274</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-275"><a href="#StepperBase-275"><span class="linenos"> 275</span></a><span class="sd">        bool:</span>
</span><span id="StepperBase-276"><a href="#StepperBase-276"><span class="linenos"> 276</span></a><span class="sd">            True if synchronization is required, False otherwise.</span>
</span><span id="StepperBase-277"><a href="#StepperBase-277"><span class="linenos"> 277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-278"><a href="#StepperBase-278"><span class="linenos"> 278</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="n">ts_last_sync</span>
</span><span id="StepperBase-279"><a href="#StepperBase-279"><span class="linenos"> 279</span></a>
</span><span id="StepperBase-280"><a href="#StepperBase-280"><span class="linenos"> 280</span></a>    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-281"><a href="#StepperBase-281"><span class="linenos"> 281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current commands to the robot&#39;s hardware</span>
</span><span id="StepperBase-282"><a href="#StepperBase-282"><span class="linenos"> 282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-283"><a href="#StepperBase-283"><span class="linenos"> 283</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-284"><a href="#StepperBase-284"><span class="linenos"> 284</span></a>            <span class="k">return</span>
</span><span id="StepperBase-285"><a href="#StepperBase-285"><span class="linenos"> 285</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-286"><a href="#StepperBase-286"><span class="linenos"> 286</span></a>
</span><span id="StepperBase-287"><a href="#StepperBase-287"><span class="linenos"> 287</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase-288"><a href="#StepperBase-288"><span class="linenos"> 288</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase-289"><a href="#StepperBase-289"><span class="linenos"> 289</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-290"><a href="#StepperBase-290"><span class="linenos"> 290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-291"><a href="#StepperBase-291"><span class="linenos"> 291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-292"><a href="#StepperBase-292"><span class="linenos"> 292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-293"><a href="#StepperBase-293"><span class="linenos"> 293</span></a>
</span><span id="StepperBase-294"><a href="#StepperBase-294"><span class="linenos"> 294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase-295"><a href="#StepperBase-295"><span class="linenos"> 295</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase-296"><a href="#StepperBase-296"><span class="linenos"> 296</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-297"><a href="#StepperBase-297"><span class="linenos"> 297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-298"><a href="#StepperBase-298"><span class="linenos"> 298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-299"><a href="#StepperBase-299"><span class="linenos"> 299</span></a>
</span><span id="StepperBase-300"><a href="#StepperBase-300"><span class="linenos"> 300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase-301"><a href="#StepperBase-301"><span class="linenos"> 301</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span>  <span class="c1"># Mark the time of latest new motion command sent</span>
</span><span id="StepperBase-302"><a href="#StepperBase-302"><span class="linenos"> 302</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-303"><a href="#StepperBase-303"><span class="linenos"> 303</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-304"><a href="#StepperBase-304"><span class="linenos"> 304</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-305"><a href="#StepperBase-305"><span class="linenos"> 305</span></a>
</span><span id="StepperBase-306"><a href="#StepperBase-306"><span class="linenos"> 306</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase-307"><a href="#StepperBase-307"><span class="linenos"> 307</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-308"><a href="#StepperBase-308"><span class="linenos"> 308</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-309"><a href="#StepperBase-309"><span class="linenos"> 309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-310"><a href="#StepperBase-310"><span class="linenos"> 310</span></a>
</span><span id="StepperBase-311"><a href="#StepperBase-311"><span class="linenos"> 311</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-312"><a href="#StepperBase-312"><span class="linenos"> 312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current commands to the robot&#39;s hardware in an asynchronous way</span>
</span><span id="StepperBase-313"><a href="#StepperBase-313"><span class="linenos"> 313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-314"><a href="#StepperBase-314"><span class="linenos"> 314</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-315"><a href="#StepperBase-315"><span class="linenos"> 315</span></a>            <span class="k">return</span>
</span><span id="StepperBase-316"><a href="#StepperBase-316"><span class="linenos"> 316</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-317"><a href="#StepperBase-317"><span class="linenos"> 317</span></a>
</span><span id="StepperBase-318"><a href="#StepperBase-318"><span class="linenos"> 318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase-319"><a href="#StepperBase-319"><span class="linenos"> 319</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase-320"><a href="#StepperBase-320"><span class="linenos"> 320</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-321"><a href="#StepperBase-321"><span class="linenos"> 321</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-322"><a href="#StepperBase-322"><span class="linenos"> 322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-323"><a href="#StepperBase-323"><span class="linenos"> 323</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-324"><a href="#StepperBase-324"><span class="linenos"> 324</span></a>
</span><span id="StepperBase-325"><a href="#StepperBase-325"><span class="linenos"> 325</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase-326"><a href="#StepperBase-326"><span class="linenos"> 326</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase-327"><a href="#StepperBase-327"><span class="linenos"> 327</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-328"><a href="#StepperBase-328"><span class="linenos"> 328</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-329"><a href="#StepperBase-329"><span class="linenos"> 329</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-330"><a href="#StepperBase-330"><span class="linenos"> 330</span></a>
</span><span id="StepperBase-331"><a href="#StepperBase-331"><span class="linenos"> 331</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase-332"><a href="#StepperBase-332"><span class="linenos"> 332</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span> <span class="c1">#Mark the time of latest new motion command sent</span>
</span><span id="StepperBase-333"><a href="#StepperBase-333"><span class="linenos"> 333</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-334"><a href="#StepperBase-334"><span class="linenos"> 334</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-335"><a href="#StepperBase-335"><span class="linenos"> 335</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-336"><a href="#StepperBase-336"><span class="linenos"> 336</span></a>
</span><span id="StepperBase-337"><a href="#StepperBase-337"><span class="linenos"> 337</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase-338"><a href="#StepperBase-338"><span class="linenos"> 338</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-339"><a href="#StepperBase-339"><span class="linenos"> 339</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-340"><a href="#StepperBase-340"><span class="linenos"> 340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-341"><a href="#StepperBase-341"><span class="linenos"> 341</span></a>
</span><span id="StepperBase-342"><a href="#StepperBase-342"><span class="linenos"> 342</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-343"><a href="#StepperBase-343"><span class="linenos"> 343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the current status of the robot&#39;s hardware</span>
</span><span id="StepperBase-344"><a href="#StepperBase-344"><span class="linenos"> 344</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-345"><a href="#StepperBase-345"><span class="linenos"> 345</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-346"><a href="#StepperBase-346"><span class="linenos"> 346</span></a>            <span class="k">return</span>
</span><span id="StepperBase-347"><a href="#StepperBase-347"><span class="linenos"> 347</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase-348"><a href="#StepperBase-348"><span class="linenos"> 348</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase-349"><a href="#StepperBase-349"><span class="linenos"> 349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">)</span>
</span><span id="StepperBase-350"><a href="#StepperBase-350"><span class="linenos"> 350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-351"><a href="#StepperBase-351"><span class="linenos"> 351</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase-352"><a href="#StepperBase-352"><span class="linenos"> 352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-353"><a href="#StepperBase-353"><span class="linenos"> 353</span></a>
</span><span id="StepperBase-354"><a href="#StepperBase-354"><span class="linenos"> 354</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-355"><a href="#StepperBase-355"><span class="linenos"> 355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the current status of the robot&#39;s hardware in an asynchronous way</span>
</span><span id="StepperBase-356"><a href="#StepperBase-356"><span class="linenos"> 356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-357"><a href="#StepperBase-357"><span class="linenos"> 357</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-358"><a href="#StepperBase-358"><span class="linenos"> 358</span></a>            <span class="k">return</span>
</span><span id="StepperBase-359"><a href="#StepperBase-359"><span class="linenos"> 359</span></a>
</span><span id="StepperBase-360"><a href="#StepperBase-360"><span class="linenos"> 360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase-361"><a href="#StepperBase-361"><span class="linenos"> 361</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase-362"><a href="#StepperBase-362"><span class="linenos"> 362</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-363"><a href="#StepperBase-363"><span class="linenos"> 363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-364"><a href="#StepperBase-364"><span class="linenos"> 364</span></a>
</span><span id="StepperBase-365"><a href="#StepperBase-365"><span class="linenos"> 365</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase-366"><a href="#StepperBase-366"><span class="linenos"> 366</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-367"><a href="#StepperBase-367"><span class="linenos"> 367</span></a>
</span><span id="StepperBase-368"><a href="#StepperBase-368"><span class="linenos"> 368</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-369"><a href="#StepperBase-369"><span class="linenos"> 369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-370"><a href="#StepperBase-370"><span class="linenos"> 370</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-371"><a href="#StepperBase-371"><span class="linenos"> 371</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-372"><a href="#StepperBase-372"><span class="linenos"> 372</span></a>
</span><span id="StepperBase-373"><a href="#StepperBase-373"><span class="linenos"> 373</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-374"><a href="#StepperBase-374"><span class="linenos"> 374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-375"><a href="#StepperBase-375"><span class="linenos"> 375</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-376"><a href="#StepperBase-376"><span class="linenos"> 376</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-377"><a href="#StepperBase-377"><span class="linenos"> 377</span></a>
</span><span id="StepperBase-378"><a href="#StepperBase-378"><span class="linenos"> 378</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-379"><a href="#StepperBase-379"><span class="linenos"> 379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-380"><a href="#StepperBase-380"><span class="linenos"> 380</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-381"><a href="#StepperBase-381"><span class="linenos"> 381</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-382"><a href="#StepperBase-382"><span class="linenos"> 382</span></a>
</span><span id="StepperBase-383"><a href="#StepperBase-383"><span class="linenos"> 383</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="StepperBase-384"><a href="#StepperBase-384"><span class="linenos"> 384</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;stepper_is_moving_filter&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-385"><a href="#StepperBase-385"><span class="linenos"> 385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-386"><a href="#StepperBase-386"><span class="linenos"> 386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="StepperBase-387"><a href="#StepperBase-387"><span class="linenos"> 387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="StepperBase-388"><a href="#StepperBase-388"><span class="linenos"> 388</span></a>
</span><span id="StepperBase-389"><a href="#StepperBase-389"><span class="linenos"> 389</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="StepperBase-390"><a href="#StepperBase-390"><span class="linenos"> 390</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="StepperBase-391"><a href="#StepperBase-391"><span class="linenos"> 391</span></a>
</span><span id="StepperBase-392"><a href="#StepperBase-392"><span class="linenos"> 392</span></a>
</span><span id="StepperBase-393"><a href="#StepperBase-393"><span class="linenos"> 393</span></a>    <span class="k">def</span> <span class="nf">set_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">):</span>
</span><span id="StepperBase-394"><a href="#StepperBase-394"><span class="linenos"> 394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set motion limits for the robot&#39;s motion range</span>
</span><span id="StepperBase-395"><a href="#StepperBase-395"><span class="linenos"> 395</span></a>
</span><span id="StepperBase-396"><a href="#StepperBase-396"><span class="linenos"> 396</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-397"><a href="#StepperBase-397"><span class="linenos"> 397</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-398"><a href="#StepperBase-398"><span class="linenos"> 398</span></a><span class="sd">        limit_neg : float.</span>
</span><span id="StepperBase-399"><a href="#StepperBase-399"><span class="linenos"> 399</span></a><span class="sd">            The new negative motion limit</span>
</span><span id="StepperBase-400"><a href="#StepperBase-400"><span class="linenos"> 400</span></a><span class="sd">        limit_pos : float.</span>
</span><span id="StepperBase-401"><a href="#StepperBase-401"><span class="linenos"> 401</span></a><span class="sd">            The new positive motion limit</span>
</span><span id="StepperBase-402"><a href="#StepperBase-402"><span class="linenos"> 402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-403"><a href="#StepperBase-403"><span class="linenos"> 403</span></a>        <span class="k">if</span> <span class="n">limit_neg</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">limit_pos</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="StepperBase-404"><a href="#StepperBase-404"><span class="linenos"> 404</span></a>            <span class="c1">#Push out immediately</span>
</span><span id="StepperBase-405"><a href="#StepperBase-405"><span class="linenos"> 405</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">]</span>
</span><span id="StepperBase-406"><a href="#StepperBase-406"><span class="linenos"> 406</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-407"><a href="#StepperBase-407"><span class="linenos"> 407</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MOTION_LIMITS</span>
</span><span id="StepperBase-408"><a href="#StepperBase-408"><span class="linenos"> 408</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_motion_limits</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-409"><a href="#StepperBase-409"><span class="linenos"> 409</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_motion_limits_reply</span><span class="p">)</span>
</span><span id="StepperBase-410"><a href="#StepperBase-410"><span class="linenos"> 410</span></a>
</span><span id="StepperBase-411"><a href="#StepperBase-411"><span class="linenos"> 411</span></a>    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
</span><span id="StepperBase-412"><a href="#StepperBase-412"><span class="linenos"> 412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the gains</span>
</span><span id="StepperBase-413"><a href="#StepperBase-413"><span class="linenos"> 413</span></a>
</span><span id="StepperBase-414"><a href="#StepperBase-414"><span class="linenos"> 414</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-415"><a href="#StepperBase-415"><span class="linenos"> 415</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-416"><a href="#StepperBase-416"><span class="linenos"> 416</span></a><span class="sd">        g : array?</span>
</span><span id="StepperBase-417"><a href="#StepperBase-417"><span class="linenos"> 417</span></a><span class="sd">            An array containing the new gains to set.</span>
</span><span id="StepperBase-418"><a href="#StepperBase-418"><span class="linenos"> 418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-419"><a href="#StepperBase-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase-420"><a href="#StepperBase-420"><span class="linenos"> 420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-421"><a href="#StepperBase-421"><span class="linenos"> 421</span></a>
</span><span id="StepperBase-422"><a href="#StepperBase-422"><span class="linenos"> 422</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-423"><a href="#StepperBase-423"><span class="linenos"> 423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-424"><a href="#StepperBase-424"><span class="linenos"> 424</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;This method has been deprecated since v0.3.0&#39;</span><span class="p">)</span>
</span><span id="StepperBase-425"><a href="#StepperBase-425"><span class="linenos"> 425</span></a>
</span><span id="StepperBase-426"><a href="#StepperBase-426"><span class="linenos"> 426</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-427"><a href="#StepperBase-427"><span class="linenos"> 427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger writing gains to flash memory.</span>
</span><span id="StepperBase-428"><a href="#StepperBase-428"><span class="linenos"> 428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-429"><a href="#StepperBase-429"><span class="linenos"> 429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span>
</span><span id="StepperBase-430"><a href="#StepperBase-430"><span class="linenos"> 430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-431"><a href="#StepperBase-431"><span class="linenos"> 431</span></a>
</span><span id="StepperBase-432"><a href="#StepperBase-432"><span class="linenos"> 432</span></a>    <span class="k">def</span> <span class="nf">read_gains_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-433"><a href="#StepperBase-433"><span class="linenos"> 433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gains should be read from flash memory.</span>
</span><span id="StepperBase-434"><a href="#StepperBase-434"><span class="linenos"> 434</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-435"><a href="#StepperBase-435"><span class="linenos"> 435</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-436"><a href="#StepperBase-436"><span class="linenos"> 436</span></a>
</span><span id="StepperBase-437"><a href="#StepperBase-437"><span class="linenos"> 437</span></a>    <span class="k">def</span> <span class="nf">board_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-438"><a href="#StepperBase-438"><span class="linenos"> 438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a board reset.</span>
</span><span id="StepperBase-439"><a href="#StepperBase-439"><span class="linenos"> 439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-440"><a href="#StepperBase-440"><span class="linenos"> 440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_BOARD_RESET</span>
</span><span id="StepperBase-441"><a href="#StepperBase-441"><span class="linenos"> 441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-442"><a href="#StepperBase-442"><span class="linenos"> 442</span></a>
</span><span id="StepperBase-443"><a href="#StepperBase-443"><span class="linenos"> 443</span></a>    <span class="k">def</span> <span class="nf">mark_position_on_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase-444"><a href="#StepperBase-444"><span class="linenos"> 444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger mark a position on contact.</span>
</span><span id="StepperBase-445"><a href="#StepperBase-445"><span class="linenos"> 445</span></a>
</span><span id="StepperBase-446"><a href="#StepperBase-446"><span class="linenos"> 446</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-447"><a href="#StepperBase-447"><span class="linenos"> 447</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-448"><a href="#StepperBase-448"><span class="linenos"> 448</span></a><span class="sd">        x : float.</span>
</span><span id="StepperBase-449"><a href="#StepperBase-449"><span class="linenos"> 449</span></a><span class="sd">            The position of the mark contact.</span>
</span><span id="StepperBase-450"><a href="#StepperBase-450"><span class="linenos"> 450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-451"><a href="#StepperBase-451"><span class="linenos"> 451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="StepperBase-452"><a href="#StepperBase-452"><span class="linenos"> 452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS_ON_CONTACT</span>
</span><span id="StepperBase-453"><a href="#StepperBase-453"><span class="linenos"> 453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-454"><a href="#StepperBase-454"><span class="linenos"> 454</span></a>
</span><span id="StepperBase-455"><a href="#StepperBase-455"><span class="linenos"> 455</span></a>    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase-456"><a href="#StepperBase-456"><span class="linenos"> 456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark a position.</span>
</span><span id="StepperBase-457"><a href="#StepperBase-457"><span class="linenos"> 457</span></a>
</span><span id="StepperBase-458"><a href="#StepperBase-458"><span class="linenos"> 458</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-459"><a href="#StepperBase-459"><span class="linenos"> 459</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-460"><a href="#StepperBase-460"><span class="linenos"> 460</span></a><span class="sd">        x : float.</span>
</span><span id="StepperBase-461"><a href="#StepperBase-461"><span class="linenos"> 461</span></a><span class="sd">            The position to mark.</span>
</span><span id="StepperBase-462"><a href="#StepperBase-462"><span class="linenos"> 462</span></a><span class="sd">        </span>
</span><span id="StepperBase-463"><a href="#StepperBase-463"><span class="linenos"> 463</span></a><span class="sd">        Notes:</span>
</span><span id="StepperBase-464"><a href="#StepperBase-464"><span class="linenos"> 464</span></a><span class="sd">        ------</span>
</span><span id="StepperBase-465"><a href="#StepperBase-465"><span class="linenos"> 465</span></a><span class="sd">        This method only performs the operation if the mode is MODE_SAFETY.</span>
</span><span id="StepperBase-466"><a href="#StepperBase-466"><span class="linenos"> 466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-467"><a href="#StepperBase-467"><span class="linenos"> 467</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">:</span>
</span><span id="StepperBase-468"><a href="#StepperBase-468"><span class="linenos"> 468</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not mark position. Must be in MODE_SAFETY for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase-469"><a href="#StepperBase-469"><span class="linenos"> 469</span></a>            <span class="k">return</span>
</span><span id="StepperBase-470"><a href="#StepperBase-470"><span class="linenos"> 470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="n">x</span>
</span><span id="StepperBase-471"><a href="#StepperBase-471"><span class="linenos"> 471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS</span>
</span><span id="StepperBase-472"><a href="#StepperBase-472"><span class="linenos"> 472</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-473"><a href="#StepperBase-473"><span class="linenos"> 473</span></a>
</span><span id="StepperBase-474"><a href="#StepperBase-474"><span class="linenos"> 474</span></a>    <span class="k">def</span> <span class="nf">reset_motion_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-475"><a href="#StepperBase-475"><span class="linenos"> 475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a reset of the motion generator.</span>
</span><span id="StepperBase-476"><a href="#StepperBase-476"><span class="linenos"> 476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-477"><a href="#StepperBase-477"><span class="linenos"> 477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_MOTION_GEN</span>
</span><span id="StepperBase-478"><a href="#StepperBase-478"><span class="linenos"> 478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-479"><a href="#StepperBase-479"><span class="linenos"> 479</span></a>
</span><span id="StepperBase-480"><a href="#StepperBase-480"><span class="linenos"> 480</span></a>    <span class="k">def</span> <span class="nf">reset_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-481"><a href="#StepperBase-481"><span class="linenos"> 481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a reset of the calibrated position.  </span>
</span><span id="StepperBase-482"><a href="#StepperBase-482"><span class="linenos"> 482</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-483"><a href="#StepperBase-483"><span class="linenos"> 483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_POS_CALIBRATED</span>
</span><span id="StepperBase-484"><a href="#StepperBase-484"><span class="linenos"> 484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-485"><a href="#StepperBase-485"><span class="linenos"> 485</span></a>
</span><span id="StepperBase-486"><a href="#StepperBase-486"><span class="linenos"> 486</span></a>    <span class="k">def</span> <span class="nf">set_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-487"><a href="#StepperBase-487"><span class="linenos"> 487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger seting the calibrated position.</span>
</span><span id="StepperBase-488"><a href="#StepperBase-488"><span class="linenos"> 488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-489"><a href="#StepperBase-489"><span class="linenos"> 489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_POS_CALIBRATED</span>
</span><span id="StepperBase-490"><a href="#StepperBase-490"><span class="linenos"> 490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-491"><a href="#StepperBase-491"><span class="linenos"> 491</span></a>
</span><span id="StepperBase-492"><a href="#StepperBase-492"><span class="linenos"> 492</span></a>
</span><span id="StepperBase-493"><a href="#StepperBase-493"><span class="linenos"> 493</span></a>
</span><span id="StepperBase-494"><a href="#StepperBase-494"><span class="linenos"> 494</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="StepperBase-495"><a href="#StepperBase-495"><span class="linenos"> 495</span></a>    <span class="k">def</span> <span class="nf">enable_safety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-496"><a href="#StepperBase-496"><span class="linenos"> 496</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Enable safety mode</span>
</span><span id="StepperBase-497"><a href="#StepperBase-497"><span class="linenos"> 497</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="StepperBase-498"><a href="#StepperBase-498"><span class="linenos"> 498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">)</span>
</span><span id="StepperBase-499"><a href="#StepperBase-499"><span class="linenos"> 499</span></a>
</span><span id="StepperBase-500"><a href="#StepperBase-500"><span class="linenos"> 500</span></a>    <span class="k">def</span> <span class="nf">enable_freewheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-501"><a href="#StepperBase-501"><span class="linenos"> 501</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Enable freewheel mode.</span>
</span><span id="StepperBase-502"><a href="#StepperBase-502"><span class="linenos"> 502</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="StepperBase-503"><a href="#StepperBase-503"><span class="linenos"> 503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_FREEWHEEL</span><span class="p">)</span>
</span><span id="StepperBase-504"><a href="#StepperBase-504"><span class="linenos"> 504</span></a>
</span><span id="StepperBase-505"><a href="#StepperBase-505"><span class="linenos"> 505</span></a>    <span class="k">def</span> <span class="nf">enable_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-506"><a href="#StepperBase-506"><span class="linenos"> 506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable hold mode.</span>
</span><span id="StepperBase-507"><a href="#StepperBase-507"><span class="linenos"> 507</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-508"><a href="#StepperBase-508"><span class="linenos"> 508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_HOLD</span><span class="p">)</span>
</span><span id="StepperBase-509"><a href="#StepperBase-509"><span class="linenos"> 509</span></a>
</span><span id="StepperBase-510"><a href="#StepperBase-510"><span class="linenos"> 510</span></a>    <span class="k">def</span> <span class="nf">enable_vel_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-511"><a href="#StepperBase-511"><span class="linenos"> 511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable velocity PID control mode.</span>
</span><span id="StepperBase-512"><a href="#StepperBase-512"><span class="linenos"> 512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-513"><a href="#StepperBase-513"><span class="linenos"> 513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-514"><a href="#StepperBase-514"><span class="linenos"> 514</span></a>
</span><span id="StepperBase-515"><a href="#StepperBase-515"><span class="linenos"> 515</span></a>    <span class="k">def</span> <span class="nf">enable_pos_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-516"><a href="#StepperBase-516"><span class="linenos"> 516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position PID control mode.</span>
</span><span id="StepperBase-517"><a href="#StepperBase-517"><span class="linenos"> 517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-518"><a href="#StepperBase-518"><span class="linenos"> 518</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_PID</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase-519"><a href="#StepperBase-519"><span class="linenos"> 519</span></a>
</span><span id="StepperBase-520"><a href="#StepperBase-520"><span class="linenos"> 520</span></a>    <span class="k">def</span> <span class="nf">enable_vel_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-521"><a href="#StepperBase-521"><span class="linenos"> 521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable velocity trajectory control mode.</span>
</span><span id="StepperBase-522"><a href="#StepperBase-522"><span class="linenos"> 522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-523"><a href="#StepperBase-523"><span class="linenos"> 523</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-524"><a href="#StepperBase-524"><span class="linenos"> 524</span></a>
</span><span id="StepperBase-525"><a href="#StepperBase-525"><span class="linenos"> 525</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-526"><a href="#StepperBase-526"><span class="linenos"> 526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position trajectory control mode.</span>
</span><span id="StepperBase-527"><a href="#StepperBase-527"><span class="linenos"> 527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-528"><a href="#StepperBase-528"><span class="linenos"> 528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase-529"><a href="#StepperBase-529"><span class="linenos"> 529</span></a>
</span><span id="StepperBase-530"><a href="#StepperBase-530"><span class="linenos"> 530</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-531"><a href="#StepperBase-531"><span class="linenos"> 531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-532"><a href="#StepperBase-532"><span class="linenos"> 532</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-533"><a href="#StepperBase-533"><span class="linenos"> 533</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-534"><a href="#StepperBase-534"><span class="linenos"> 534</span></a>
</span><span id="StepperBase-535"><a href="#StepperBase-535"><span class="linenos"> 535</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-536"><a href="#StepperBase-536"><span class="linenos"> 536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable incremental position trajectory control mode.</span>
</span><span id="StepperBase-537"><a href="#StepperBase-537"><span class="linenos"> 537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-538"><a href="#StepperBase-538"><span class="linenos"> 538</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-539"><a href="#StepperBase-539"><span class="linenos"> 539</span></a>
</span><span id="StepperBase-540"><a href="#StepperBase-540"><span class="linenos"> 540</span></a>    <span class="k">def</span> <span class="nf">enable_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-541"><a href="#StepperBase-541"><span class="linenos"> 541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable current mode.</span>
</span><span id="StepperBase-542"><a href="#StepperBase-542"><span class="linenos"> 542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-543"><a href="#StepperBase-543"><span class="linenos"> 543</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">,</span> <span class="n">i_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-544"><a href="#StepperBase-544"><span class="linenos"> 544</span></a>
</span><span id="StepperBase-545"><a href="#StepperBase-545"><span class="linenos"> 545</span></a>    <span class="k">def</span> <span class="nf">enable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-546"><a href="#StepperBase-546"><span class="linenos"> 546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable synchrous mode.</span>
</span><span id="StepperBase-547"><a href="#StepperBase-547"><span class="linenos"> 547</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-548"><a href="#StepperBase-548"><span class="linenos"> 548</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-549"><a href="#StepperBase-549"><span class="linenos"> 549</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-550"><a href="#StepperBase-550"><span class="linenos"> 550</span></a>
</span><span id="StepperBase-551"><a href="#StepperBase-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="nf">disable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-552"><a href="#StepperBase-552"><span class="linenos"> 552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable asynchronous mode.</span>
</span><span id="StepperBase-553"><a href="#StepperBase-553"><span class="linenos"> 553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-554"><a href="#StepperBase-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-555"><a href="#StepperBase-555"><span class="linenos"> 555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase-556"><a href="#StepperBase-556"><span class="linenos"> 556</span></a>
</span><span id="StepperBase-557"><a href="#StepperBase-557"><span class="linenos"> 557</span></a>    <span class="k">def</span> <span class="nf">enable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-558"><a href="#StepperBase-558"><span class="linenos"> 558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable runstop mode.</span>
</span><span id="StepperBase-559"><a href="#StepperBase-559"><span class="linenos"> 559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-560"><a href="#StepperBase-560"><span class="linenos"> 560</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-561"><a href="#StepperBase-561"><span class="linenos"> 561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-562"><a href="#StepperBase-562"><span class="linenos"> 562</span></a>
</span><span id="StepperBase-563"><a href="#StepperBase-563"><span class="linenos"> 563</span></a>    <span class="k">def</span> <span class="nf">disable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-564"><a href="#StepperBase-564"><span class="linenos"> 564</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable runstop mode.</span>
</span><span id="StepperBase-565"><a href="#StepperBase-565"><span class="linenos"> 565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-566"><a href="#StepperBase-566"><span class="linenos"> 566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-567"><a href="#StepperBase-567"><span class="linenos"> 567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase-568"><a href="#StepperBase-568"><span class="linenos"> 568</span></a>
</span><span id="StepperBase-569"><a href="#StepperBase-569"><span class="linenos"> 569</span></a>    <span class="k">def</span> <span class="nf">enable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-570"><a href="#StepperBase-570"><span class="linenos"> 570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable guarded mode.</span>
</span><span id="StepperBase-571"><a href="#StepperBase-571"><span class="linenos"> 571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-572"><a href="#StepperBase-572"><span class="linenos"> 572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-573"><a href="#StepperBase-573"><span class="linenos"> 573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-574"><a href="#StepperBase-574"><span class="linenos"> 574</span></a>
</span><span id="StepperBase-575"><a href="#StepperBase-575"><span class="linenos"> 575</span></a>    <span class="k">def</span> <span class="nf">disable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-576"><a href="#StepperBase-576"><span class="linenos"> 576</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable guarded mode.</span>
</span><span id="StepperBase-577"><a href="#StepperBase-577"><span class="linenos"> 577</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-578"><a href="#StepperBase-578"><span class="linenos"> 578</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-579"><a href="#StepperBase-579"><span class="linenos"> 579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-580"><a href="#StepperBase-580"><span class="linenos"> 580</span></a>
</span><span id="StepperBase-581"><a href="#StepperBase-581"><span class="linenos"> 581</span></a>
</span><span id="StepperBase-582"><a href="#StepperBase-582"><span class="linenos"> 582</span></a>
</span><span id="StepperBase-583"><a href="#StepperBase-583"><span class="linenos"> 583</span></a>    <span class="c1"># ######################################################################</span>
</span><span id="StepperBase-584"><a href="#StepperBase-584"><span class="linenos"> 584</span></a>    <span class="c1">#Primary interface to controlling the stepper</span>
</span><span id="StepperBase-585"><a href="#StepperBase-585"><span class="linenos"> 585</span></a>    <span class="c1">#YAML defaults are used if values not provided</span>
</span><span id="StepperBase-586"><a href="#StepperBase-586"><span class="linenos"> 586</span></a>    <span class="c1">#This allows user to override defaults every control cycle and then easily revert to defaults</span>
</span><span id="StepperBase-587"><a href="#StepperBase-587"><span class="linenos"> 587</span></a>    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span>  <span class="p">):</span>
</span><span id="StepperBase-588"><a href="#StepperBase-588"><span class="linenos"> 588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a command.</span>
</span><span id="StepperBase-589"><a href="#StepperBase-589"><span class="linenos"> 589</span></a>
</span><span id="StepperBase-590"><a href="#StepperBase-590"><span class="linenos"> 590</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-591"><a href="#StepperBase-591"><span class="linenos"> 591</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-592"><a href="#StepperBase-592"><span class="linenos"> 592</span></a><span class="sd">        mode : int or None, optional.</span>
</span><span id="StepperBase-593"><a href="#StepperBase-593"><span class="linenos"> 593</span></a><span class="sd">            The command mode to set, if not provided the current mode remains unchanged, by default None.</span>
</span><span id="StepperBase-594"><a href="#StepperBase-594"><span class="linenos"> 594</span></a><span class="sd">        </span>
</span><span id="StepperBase-595"><a href="#StepperBase-595"><span class="linenos"> 595</span></a><span class="sd">        x_des : float or None, optional.</span>
</span><span id="StepperBase-596"><a href="#StepperBase-596"><span class="linenos"> 596</span></a><span class="sd">            The desired position to change, if not provided the position remains unchanged. If the mode is MODE_POS_TRAJ_INCR, this parameter</span>
</span><span id="StepperBase-597"><a href="#StepperBase-597"><span class="linenos"> 597</span></a><span class="sd">        increments the &#39;incr_trigger&#39; value, by default None.</span>
</span><span id="StepperBase-598"><a href="#StepperBase-598"><span class="linenos"> 598</span></a><span class="sd">        </span>
</span><span id="StepperBase-599"><a href="#StepperBase-599"><span class="linenos"> 599</span></a><span class="sd">        v_des : float or None, optional.</span>
</span><span id="StepperBase-600"><a href="#StepperBase-600"><span class="linenos"> 600</span></a><span class="sd">            The desired velocity set, if not provided the value is determined based on the current mode or set 0 if the mode is velocity-based, by default None.</span>
</span><span id="StepperBase-601"><a href="#StepperBase-601"><span class="linenos"> 601</span></a><span class="sd">        </span>
</span><span id="StepperBase-602"><a href="#StepperBase-602"><span class="linenos"> 602</span></a><span class="sd">        a_des : float or None, optional.</span>
</span><span id="StepperBase-603"><a href="#StepperBase-603"><span class="linenos"> 603</span></a><span class="sd">            The desired acceleration to set, if not provided the value is determined based on the current motion configuration, by default None.</span>
</span><span id="StepperBase-604"><a href="#StepperBase-604"><span class="linenos"> 604</span></a><span class="sd">        </span>
</span><span id="StepperBase-605"><a href="#StepperBase-605"><span class="linenos"> 605</span></a><span class="sd">        i_des : float or None, optional.</span>
</span><span id="StepperBase-606"><a href="#StepperBase-606"><span class="linenos"> 606</span></a><span class="sd">            The desired current to set, if not provided the current value remains unchanged unless the mode is MODE_CURRENT, in which case it updates the `i_feedforward` value, by default None.</span>
</span><span id="StepperBase-607"><a href="#StepperBase-607"><span class="linenos"> 607</span></a><span class="sd">        </span>
</span><span id="StepperBase-608"><a href="#StepperBase-608"><span class="linenos"> 608</span></a><span class="sd">        stiffness : float or None, optional.</span>
</span><span id="StepperBase-609"><a href="#StepperBase-609"><span class="linenos"> 609</span></a><span class="sd">            The stiffnes value to set. If not provided it remains unchanged, by default None.</span>
</span><span id="StepperBase-610"><a href="#StepperBase-610"><span class="linenos"> 610</span></a><span class="sd">        </span>
</span><span id="StepperBase-611"><a href="#StepperBase-611"><span class="linenos"> 611</span></a><span class="sd">        i_feedforward : float or None, optional.</span>
</span><span id="StepperBase-612"><a href="#StepperBase-612"><span class="linenos"> 612</span></a><span class="sd">            The feedforward current to set, if not provided it remains unchanged unless the mode is `MODE_CURRENT`, by default None.</span>
</span><span id="StepperBase-613"><a href="#StepperBase-613"><span class="linenos"> 613</span></a><span class="sd">        </span>
</span><span id="StepperBase-614"><a href="#StepperBase-614"><span class="linenos"> 614</span></a><span class="sd">        i_contact_pos : float or None, optional.</span>
</span><span id="StepperBase-615"><a href="#StepperBase-615"><span class="linenos"> 615</span></a><span class="sd">            The positive contact current to set, if not provided it is determined based on the current gains configuration, by default None.</span>
</span><span id="StepperBase-616"><a href="#StepperBase-616"><span class="linenos"> 616</span></a><span class="sd">        </span>
</span><span id="StepperBase-617"><a href="#StepperBase-617"><span class="linenos"> 617</span></a><span class="sd">        i_contact_neg : float or None, optional.</span>
</span><span id="StepperBase-618"><a href="#StepperBase-618"><span class="linenos"> 618</span></a><span class="sd">            The negative contact current to set, if not provided it is determined based on the current gains configuration, by default None.</span>
</span><span id="StepperBase-619"><a href="#StepperBase-619"><span class="linenos"> 619</span></a>
</span><span id="StepperBase-620"><a href="#StepperBase-620"><span class="linenos"> 620</span></a><span class="sd">        Notes:</span>
</span><span id="StepperBase-621"><a href="#StepperBase-621"><span class="linenos"> 621</span></a><span class="sd">        ------</span>
</span><span id="StepperBase-622"><a href="#StepperBase-622"><span class="linenos"> 622</span></a><span class="sd">        This method updates the internal command dictionary and marks it as dirty,</span>
</span><span id="StepperBase-623"><a href="#StepperBase-623"><span class="linenos"> 623</span></a><span class="sd">        indicating that it has been modified.</span>
</span><span id="StepperBase-624"><a href="#StepperBase-624"><span class="linenos"> 624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-625"><a href="#StepperBase-625"><span class="linenos"> 625</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-626"><a href="#StepperBase-626"><span class="linenos"> 626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="StepperBase-627"><a href="#StepperBase-627"><span class="linenos"> 627</span></a>
</span><span id="StepperBase-628"><a href="#StepperBase-628"><span class="linenos"> 628</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-629"><a href="#StepperBase-629"><span class="linenos"> 629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="StepperBase-630"><a href="#StepperBase-630"><span class="linenos"> 630</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span>
</span><span id="StepperBase-631"><a href="#StepperBase-631"><span class="linenos"> 631</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">255</span>
</span><span id="StepperBase-632"><a href="#StepperBase-632"><span class="linenos"> 632</span></a>
</span><span id="StepperBase-633"><a href="#StepperBase-633"><span class="linenos"> 633</span></a>        <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-634"><a href="#StepperBase-634"><span class="linenos"> 634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="StepperBase-635"><a href="#StepperBase-635"><span class="linenos"> 635</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-636"><a href="#StepperBase-636"><span class="linenos"> 636</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">:</span>
</span><span id="StepperBase-637"><a href="#StepperBase-637"><span class="linenos"> 637</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-638"><a href="#StepperBase-638"><span class="linenos"> 638</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-639"><a href="#StepperBase-639"><span class="linenos"> 639</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="StepperBase-640"><a href="#StepperBase-640"><span class="linenos"> 640</span></a>
</span><span id="StepperBase-641"><a href="#StepperBase-641"><span class="linenos"> 641</span></a>        <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-642"><a href="#StepperBase-642"><span class="linenos"> 642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="StepperBase-643"><a href="#StepperBase-643"><span class="linenos"> 643</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-644"><a href="#StepperBase-644"><span class="linenos"> 644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="StepperBase-645"><a href="#StepperBase-645"><span class="linenos"> 645</span></a>
</span><span id="StepperBase-646"><a href="#StepperBase-646"><span class="linenos"> 646</span></a>        <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-647"><a href="#StepperBase-647"><span class="linenos"> 647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span>
</span><span id="StepperBase-648"><a href="#StepperBase-648"><span class="linenos"> 648</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-649"><a href="#StepperBase-649"><span class="linenos"> 649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase-650"><a href="#StepperBase-650"><span class="linenos"> 650</span></a>
</span><span id="StepperBase-651"><a href="#StepperBase-651"><span class="linenos"> 651</span></a>        <span class="k">if</span> <span class="n">i_feedforward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-652"><a href="#StepperBase-652"><span class="linenos"> 652</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_feedforward</span>
</span><span id="StepperBase-653"><a href="#StepperBase-653"><span class="linenos"> 653</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-654"><a href="#StepperBase-654"><span class="linenos"> 654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-655"><a href="#StepperBase-655"><span class="linenos"> 655</span></a>
</span><span id="StepperBase-656"><a href="#StepperBase-656"><span class="linenos"> 656</span></a>        <span class="k">if</span> <span class="n">i_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">:</span>
</span><span id="StepperBase-657"><a href="#StepperBase-657"><span class="linenos"> 657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">i_des</span>
</span><span id="StepperBase-658"><a href="#StepperBase-658"><span class="linenos"> 658</span></a>
</span><span id="StepperBase-659"><a href="#StepperBase-659"><span class="linenos"> 659</span></a>
</span><span id="StepperBase-660"><a href="#StepperBase-660"><span class="linenos"> 660</span></a>        <span class="k">if</span> <span class="n">i_contact_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-661"><a href="#StepperBase-661"><span class="linenos"> 661</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_pos</span>
</span><span id="StepperBase-662"><a href="#StepperBase-662"><span class="linenos"> 662</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-663"><a href="#StepperBase-663"><span class="linenos"> 663</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase-664"><a href="#StepperBase-664"><span class="linenos"> 664</span></a>
</span><span id="StepperBase-665"><a href="#StepperBase-665"><span class="linenos"> 665</span></a>        <span class="k">if</span> <span class="n">i_contact_neg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-666"><a href="#StepperBase-666"><span class="linenos"> 666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_neg</span>
</span><span id="StepperBase-667"><a href="#StepperBase-667"><span class="linenos"> 667</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-668"><a href="#StepperBase-668"><span class="linenos"> 668</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span>
</span><span id="StepperBase-669"><a href="#StepperBase-669"><span class="linenos"> 669</span></a>        <span class="c1">#print(time.time(), i_des, self._command[&#39;i_feedforward&#39;],mode == self.MODE_CURRENT)</span>
</span><span id="StepperBase-670"><a href="#StepperBase-670"><span class="linenos"> 670</span></a>        <span class="c1">#print(time.time(),self._command[&#39;x_des&#39;],self._command[&#39;incr_trigger&#39;],self._command[&#39;v_des&#39;],self._command[&#39;a_des&#39;])</span>
</span><span id="StepperBase-671"><a href="#StepperBase-671"><span class="linenos"> 671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-672"><a href="#StepperBase-672"><span class="linenos"> 672</span></a>
</span><span id="StepperBase-673"><a href="#StepperBase-673"><span class="linenos"> 673</span></a>
</span><span id="StepperBase-674"><a href="#StepperBase-674"><span class="linenos"> 674</span></a>    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase-675"><a href="#StepperBase-675"><span class="linenos"> 675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase-676"><a href="#StepperBase-676"><span class="linenos"> 676</span></a><span class="sd">        Poll until is moving flag is false.</span>
</span><span id="StepperBase-677"><a href="#StepperBase-677"><span class="linenos"> 677</span></a><span class="sd">        </span>
</span><span id="StepperBase-678"><a href="#StepperBase-678"><span class="linenos"> 678</span></a><span class="sd">        Return True if success.</span>
</span><span id="StepperBase-679"><a href="#StepperBase-679"><span class="linenos"> 679</span></a><span class="sd">        </span>
</span><span id="StepperBase-680"><a href="#StepperBase-680"><span class="linenos"> 680</span></a><span class="sd">        Return False if timeout.</span>
</span><span id="StepperBase-681"><a href="#StepperBase-681"><span class="linenos"> 681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-682"><a href="#StepperBase-682"><span class="linenos"> 682</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-683"><a href="#StepperBase-683"><span class="linenos"> 683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-684"><a href="#StepperBase-684"><span class="linenos"> 684</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase-685"><a href="#StepperBase-685"><span class="linenos"> 685</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-686"><a href="#StepperBase-686"><span class="linenos"> 686</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-687"><a href="#StepperBase-687"><span class="linenos"> 687</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span>
</span><span id="StepperBase-688"><a href="#StepperBase-688"><span class="linenos"> 688</span></a>
</span><span id="StepperBase-689"><a href="#StepperBase-689"><span class="linenos"> 689</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase-690"><a href="#StepperBase-690"><span class="linenos"> 690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase-691"><a href="#StepperBase-691"><span class="linenos"> 691</span></a><span class="sd">        Poll until near setpoint.</span>
</span><span id="StepperBase-692"><a href="#StepperBase-692"><span class="linenos"> 692</span></a><span class="sd">        </span>
</span><span id="StepperBase-693"><a href="#StepperBase-693"><span class="linenos"> 693</span></a><span class="sd">        Return True if success.</span>
</span><span id="StepperBase-694"><a href="#StepperBase-694"><span class="linenos"> 694</span></a><span class="sd">        </span>
</span><span id="StepperBase-695"><a href="#StepperBase-695"><span class="linenos"> 695</span></a><span class="sd">        Return False if timeout.</span>
</span><span id="StepperBase-696"><a href="#StepperBase-696"><span class="linenos"> 696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-697"><a href="#StepperBase-697"><span class="linenos"> 697</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-698"><a href="#StepperBase-698"><span class="linenos"> 698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-699"><a href="#StepperBase-699"><span class="linenos"> 699</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase-700"><a href="#StepperBase-700"><span class="linenos"> 700</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-701"><a href="#StepperBase-701"><span class="linenos"> 701</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-702"><a href="#StepperBase-702"><span class="linenos"> 702</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span>
</span><span id="StepperBase-703"><a href="#StepperBase-703"><span class="linenos"> 703</span></a>
</span><span id="StepperBase-704"><a href="#StepperBase-704"><span class="linenos"> 704</span></a>    <span class="c1">########### Handle current and effort conversions  ###########</span>
</span><span id="StepperBase-705"><a href="#StepperBase-705"><span class="linenos"> 705</span></a>
</span><span id="StepperBase-706"><a href="#StepperBase-706"><span class="linenos"> 706</span></a>    <span class="c1">#Effort_ticks are in the units of the uC current controller (0-255 8 bit)</span>
</span><span id="StepperBase-707"><a href="#StepperBase-707"><span class="linenos"> 707</span></a>    <span class="c1">#Conversion to A is based on the sense resistor and motor driver (see firmware)</span>
</span><span id="StepperBase-708"><a href="#StepperBase-708"><span class="linenos"> 708</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase-709"><a href="#StepperBase-709"><span class="linenos"> 709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert current to motor effort ticks.</span>
</span><span id="StepperBase-710"><a href="#StepperBase-710"><span class="linenos"> 710</span></a>
</span><span id="StepperBase-711"><a href="#StepperBase-711"><span class="linenos"> 711</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-712"><a href="#StepperBase-712"><span class="linenos"> 712</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-713"><a href="#StepperBase-713"><span class="linenos"> 713</span></a><span class="sd">        i_A : float.</span>
</span><span id="StepperBase-714"><a href="#StepperBase-714"><span class="linenos"> 714</span></a><span class="sd">            The current in amperes to convert.</span>
</span><span id="StepperBase-715"><a href="#StepperBase-715"><span class="linenos"> 715</span></a>
</span><span id="StepperBase-716"><a href="#StepperBase-716"><span class="linenos"> 716</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-717"><a href="#StepperBase-717"><span class="linenos"> 717</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-718"><a href="#StepperBase-718"><span class="linenos"> 718</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-719"><a href="#StepperBase-719"><span class="linenos"> 719</span></a><span class="sd">            The motor effort values in ticks, between -255 to 255.</span>
</span><span id="StepperBase-720"><a href="#StepperBase-720"><span class="linenos"> 720</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-721"><a href="#StepperBase-721"><span class="linenos"> 721</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase-722"><a href="#StepperBase-722"><span class="linenos"> 722</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-723"><a href="#StepperBase-723"><span class="linenos"> 723</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase-724"><a href="#StepperBase-724"><span class="linenos"> 724</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase-725"><a href="#StepperBase-725"><span class="linenos"> 725</span></a>        <span class="n">effort_ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_A</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mA_per_tick</span>
</span><span id="StepperBase-726"><a href="#StepperBase-726"><span class="linenos"> 726</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">255</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">effort_ticks</span><span class="p">)))</span>
</span><span id="StepperBase-727"><a href="#StepperBase-727"><span class="linenos"> 727</span></a>
</span><span id="StepperBase-728"><a href="#StepperBase-728"><span class="linenos"> 728</span></a>    <span class="k">def</span> <span class="nf">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase-729"><a href="#StepperBase-729"><span class="linenos"> 729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert motor effort ticks to current.</span>
</span><span id="StepperBase-730"><a href="#StepperBase-730"><span class="linenos"> 730</span></a>
</span><span id="StepperBase-731"><a href="#StepperBase-731"><span class="linenos"> 731</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-732"><a href="#StepperBase-732"><span class="linenos"> 732</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-733"><a href="#StepperBase-733"><span class="linenos"> 733</span></a><span class="sd">        e : int.</span>
</span><span id="StepperBase-734"><a href="#StepperBase-734"><span class="linenos"> 734</span></a><span class="sd">            The motor effort value in ticks to convert.</span>
</span><span id="StepperBase-735"><a href="#StepperBase-735"><span class="linenos"> 735</span></a>
</span><span id="StepperBase-736"><a href="#StepperBase-736"><span class="linenos"> 736</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-737"><a href="#StepperBase-737"><span class="linenos"> 737</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-738"><a href="#StepperBase-738"><span class="linenos"> 738</span></a><span class="sd">        float:</span>
</span><span id="StepperBase-739"><a href="#StepperBase-739"><span class="linenos"> 739</span></a><span class="sd">            The current value in amperes.</span>
</span><span id="StepperBase-740"><a href="#StepperBase-740"><span class="linenos"> 740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-741"><a href="#StepperBase-741"><span class="linenos"> 741</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase-742"><a href="#StepperBase-742"><span class="linenos"> 742</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-743"><a href="#StepperBase-743"><span class="linenos"> 743</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase-744"><a href="#StepperBase-744"><span class="linenos"> 744</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase-745"><a href="#StepperBase-745"><span class="linenos"> 745</span></a>        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="n">mA_per_tick</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="StepperBase-746"><a href="#StepperBase-746"><span class="linenos"> 746</span></a>
</span><span id="StepperBase-747"><a href="#StepperBase-747"><span class="linenos"> 747</span></a>    <span class="c1"># Effort_pct is defined as a percentage of the maximum allowable motor winding current</span>
</span><span id="StepperBase-748"><a href="#StepperBase-748"><span class="linenos"> 748</span></a>    <span class="c1"># Range is -100.0 to 100.0</span>
</span><span id="StepperBase-749"><a href="#StepperBase-749"><span class="linenos"> 749</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase-750"><a href="#StepperBase-750"><span class="linenos"> 750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert current to motor effor percentage.</span>
</span><span id="StepperBase-751"><a href="#StepperBase-751"><span class="linenos"> 751</span></a>
</span><span id="StepperBase-752"><a href="#StepperBase-752"><span class="linenos"> 752</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-753"><a href="#StepperBase-753"><span class="linenos"> 753</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-754"><a href="#StepperBase-754"><span class="linenos"> 754</span></a><span class="sd">        i_A : float.</span>
</span><span id="StepperBase-755"><a href="#StepperBase-755"><span class="linenos"> 755</span></a><span class="sd">            The current in amperes to convert.</span>
</span><span id="StepperBase-756"><a href="#StepperBase-756"><span class="linenos"> 756</span></a>
</span><span id="StepperBase-757"><a href="#StepperBase-757"><span class="linenos"> 757</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-758"><a href="#StepperBase-758"><span class="linenos"> 758</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-759"><a href="#StepperBase-759"><span class="linenos"> 759</span></a><span class="sd">        float:</span>
</span><span id="StepperBase-760"><a href="#StepperBase-760"><span class="linenos"> 760</span></a><span class="sd">            The motor effort percentage.</span>
</span><span id="StepperBase-761"><a href="#StepperBase-761"><span class="linenos"> 761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-762"><a href="#StepperBase-762"><span class="linenos"> 762</span></a>        <span class="k">if</span> <span class="n">i_A</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase-763"><a href="#StepperBase-763"><span class="linenos"> 763</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i_A</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-764"><a href="#StepperBase-764"><span class="linenos"> 764</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-765"><a href="#StepperBase-765"><span class="linenos"> 765</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i_A</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])))</span>
</span><span id="StepperBase-766"><a href="#StepperBase-766"><span class="linenos"> 766</span></a>
</span><span id="StepperBase-767"><a href="#StepperBase-767"><span class="linenos"> 767</span></a>    <span class="k">def</span> <span class="nf">effort_pct_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
</span><span id="StepperBase-768"><a href="#StepperBase-768"><span class="linenos"> 768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert motor effort percentage to current.</span>
</span><span id="StepperBase-769"><a href="#StepperBase-769"><span class="linenos"> 769</span></a>
</span><span id="StepperBase-770"><a href="#StepperBase-770"><span class="linenos"> 770</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-771"><a href="#StepperBase-771"><span class="linenos"> 771</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-772"><a href="#StepperBase-772"><span class="linenos"> 772</span></a><span class="sd">        e_pct : float.</span>
</span><span id="StepperBase-773"><a href="#StepperBase-773"><span class="linenos"> 773</span></a><span class="sd">            The motor effort percentage to convert.</span>
</span><span id="StepperBase-774"><a href="#StepperBase-774"><span class="linenos"> 774</span></a>
</span><span id="StepperBase-775"><a href="#StepperBase-775"><span class="linenos"> 775</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-776"><a href="#StepperBase-776"><span class="linenos"> 776</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-777"><a href="#StepperBase-777"><span class="linenos"> 777</span></a><span class="sd">        float:</span>
</span><span id="StepperBase-778"><a href="#StepperBase-778"><span class="linenos"> 778</span></a><span class="sd">            The current value in amperes.</span>
</span><span id="StepperBase-779"><a href="#StepperBase-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-780"><a href="#StepperBase-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="n">e_pct</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase-781"><a href="#StepperBase-781"><span class="linenos"> 781</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase-782"><a href="#StepperBase-782"><span class="linenos"> 782</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-783"><a href="#StepperBase-783"><span class="linenos"> 783</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])</span>
</span><span id="StepperBase-784"><a href="#StepperBase-784"><span class="linenos"> 784</span></a>
</span><span id="StepperBase-785"><a href="#StepperBase-785"><span class="linenos"> 785</span></a>    <span class="k">def</span> <span class="nf">current_to_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="StepperBase-786"><a href="#StepperBase-786"><span class="linenos"> 786</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-787"><a href="#StepperBase-787"><span class="linenos"> 787</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method current_to_torque has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="StepperBase-788"><a href="#StepperBase-788"><span class="linenos"> 788</span></a>
</span><span id="StepperBase-789"><a href="#StepperBase-789"><span class="linenos"> 789</span></a>    <span class="k">def</span> <span class="nf">torque_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tq</span><span class="p">):</span>
</span><span id="StepperBase-790"><a href="#StepperBase-790"><span class="linenos"> 790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-791"><a href="#StepperBase-791"><span class="linenos"> 791</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method torque_to_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="StepperBase-792"><a href="#StepperBase-792"><span class="linenos"> 792</span></a>
</span><span id="StepperBase-793"><a href="#StepperBase-793"><span class="linenos"> 793</span></a>
</span><span id="StepperBase-794"><a href="#StepperBase-794"><span class="linenos"> 794</span></a>        <span class="c1"># ####################### Encoder Calibration ######################</span>
</span><span id="StepperBase-795"><a href="#StepperBase-795"><span class="linenos"> 795</span></a>
</span><span id="StepperBase-796"><a href="#StepperBase-796"><span class="linenos"> 796</span></a>    <span class="k">def</span> <span class="nf">get_chip_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-797"><a href="#StepperBase-797"><span class="linenos"> 797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the chip ID.</span>
</span><span id="StepperBase-798"><a href="#StepperBase-798"><span class="linenos"> 798</span></a>
</span><span id="StepperBase-799"><a href="#StepperBase-799"><span class="linenos"> 799</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-800"><a href="#StepperBase-800"><span class="linenos"> 800</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-801"><a href="#StepperBase-801"><span class="linenos"> 801</span></a><span class="sd">        str:</span>
</span><span id="StepperBase-802"><a href="#StepperBase-802"><span class="linenos"> 802</span></a><span class="sd">            The chip ID as a UTF-8 decoded string.</span>
</span><span id="StepperBase-803"><a href="#StepperBase-803"><span class="linenos"> 803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-804"><a href="#StepperBase-804"><span class="linenos"> 804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-805"><a href="#StepperBase-805"><span class="linenos"> 805</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-806"><a href="#StepperBase-806"><span class="linenos"> 806</span></a>        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="StepperBase-807"><a href="#StepperBase-807"><span class="linenos"> 807</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-808"><a href="#StepperBase-808"><span class="linenos"> 808</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-809"><a href="#StepperBase-809"><span class="linenos"> 809</span></a>        <span class="k">return</span> <span class="n">cid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="StepperBase-810"><a href="#StepperBase-810"><span class="linenos"> 810</span></a>
</span><span id="StepperBase-811"><a href="#StepperBase-811"><span class="linenos"> 811</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-812"><a href="#StepperBase-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read enconder calibration from YAML.</span>
</span><span id="StepperBase-813"><a href="#StepperBase-813"><span class="linenos"> 813</span></a>
</span><span id="StepperBase-814"><a href="#StepperBase-814"><span class="linenos"> 814</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-815"><a href="#StepperBase-815"><span class="linenos"> 815</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-816"><a href="#StepperBase-816"><span class="linenos"> 816</span></a><span class="sd">        dict:</span>
</span><span id="StepperBase-817"><a href="#StepperBase-817"><span class="linenos"> 817</span></a><span class="sd">            The encoder calibration data read from the YAML file.</span>
</span><span id="StepperBase-818"><a href="#StepperBase-818"><span class="linenos"> 818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-819"><a href="#StepperBase-819"><span class="linenos"> 819</span></a>        <span class="n">device_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase-820"><a href="#StepperBase-820"><span class="linenos"> 820</span></a>        <span class="n">sn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase-821"><a href="#StepperBase-821"><span class="linenos"> 821</span></a>        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">sn</span><span class="o">+</span><span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase-822"><a href="#StepperBase-822"><span class="linenos"> 822</span></a>        <span class="n">enc_data</span><span class="o">=</span><span class="n">read_fleet_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="StepperBase-823"><a href="#StepperBase-823"><span class="linenos"> 823</span></a>        <span class="k">return</span> <span class="n">enc_data</span>
</span><span id="StepperBase-824"><a href="#StepperBase-824"><span class="linenos"> 824</span></a>
</span><span id="StepperBase-825"><a href="#StepperBase-825"><span class="linenos"> 825</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase-826"><a href="#StepperBase-826"><span class="linenos"> 826</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write encoder calibration data to YAML file.</span>
</span><span id="StepperBase-827"><a href="#StepperBase-827"><span class="linenos"> 827</span></a>
</span><span id="StepperBase-828"><a href="#StepperBase-828"><span class="linenos"> 828</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-829"><a href="#StepperBase-829"><span class="linenos"> 829</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-830"><a href="#StepperBase-830"><span class="linenos"> 830</span></a><span class="sd">        data : dict.</span>
</span><span id="StepperBase-831"><a href="#StepperBase-831"><span class="linenos"> 831</span></a><span class="sd">            The encoder data to write.</span>
</span><span id="StepperBase-832"><a href="#StepperBase-832"><span class="linenos"> 832</span></a><span class="sd">        </span>
</span><span id="StepperBase-833"><a href="#StepperBase-833"><span class="linenos"> 833</span></a><span class="sd">        filename : str or None, optional.</span>
</span><span id="StepperBase-834"><a href="#StepperBase-834"><span class="linenos"> 834</span></a><span class="sd">            The filename of the YAML file. If not provided, it is constructed based on the device name and serial number, by default None.</span>
</span><span id="StepperBase-835"><a href="#StepperBase-835"><span class="linenos"> 835</span></a><span class="sd">        </span>
</span><span id="StepperBase-836"><a href="#StepperBase-836"><span class="linenos"> 836</span></a><span class="sd">        fleet_dir : str or None, optional.</span>
</span><span id="StepperBase-837"><a href="#StepperBase-837"><span class="linenos"> 837</span></a><span class="sd">            The directory where the file should be saved, if not provided the default directory is used, by default None.</span>
</span><span id="StepperBase-838"><a href="#StepperBase-838"><span class="linenos"> 838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-839"><a href="#StepperBase-839"><span class="linenos"> 839</span></a>        <span class="n">device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase-840"><a href="#StepperBase-840"><span class="linenos"> 840</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-841"><a href="#StepperBase-841"><span class="linenos"> 841</span></a>            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase-842"><a href="#StepperBase-842"><span class="linenos"> 842</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">sn</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase-843"><a href="#StepperBase-843"><span class="linenos"> 843</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</span><span id="StepperBase-844"><a href="#StepperBase-844"><span class="linenos"> 844</span></a>        <span class="n">write_fleet_yaml</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">fleet_dir</span><span class="o">=</span><span class="n">fleet_dir</span><span class="p">)</span>
</span><span id="StepperBase-845"><a href="#StepperBase-845"><span class="linenos"> 845</span></a>
</span><span id="StepperBase-846"><a href="#StepperBase-846"><span class="linenos"> 846</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-847"><a href="#StepperBase-847"><span class="linenos"> 847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read encoder calibration data from flash memory.</span>
</span><span id="StepperBase-848"><a href="#StepperBase-848"><span class="linenos"> 848</span></a>
</span><span id="StepperBase-849"><a href="#StepperBase-849"><span class="linenos"> 849</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-850"><a href="#StepperBase-850"><span class="linenos"> 850</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-851"><a href="#StepperBase-851"><span class="linenos"> 851</span></a><span class="sd">        list:</span>
</span><span id="StepperBase-852"><a href="#StepperBase-852"><span class="linenos"> 852</span></a><span class="sd">            The encoder calibration data as a list of floats.</span>
</span><span id="StepperBase-853"><a href="#StepperBase-853"><span class="linenos"> 853</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-854"><a href="#StepperBase-854"><span class="linenos"> 854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-855"><a href="#StepperBase-855"><span class="linenos"> 855</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-856"><a href="#StepperBase-856"><span class="linenos"> 856</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-857"><a href="#StepperBase-857"><span class="linenos"> 857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase-858"><a href="#StepperBase-858"><span class="linenos"> 858</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">19</span><span class="p">]</span>
</span><span id="StepperBase-859"><a href="#StepperBase-859"><span class="linenos"> 859</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-860"><a href="#StepperBase-860"><span class="linenos"> 860</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase-861"><a href="#StepperBase-861"><span class="linenos"> 861</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reseting board&#39;</span><span class="p">)</span>
</span><span id="StepperBase-862"><a href="#StepperBase-862"><span class="linenos"> 862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_reset</span><span class="p">()</span>
</span><span id="StepperBase-863"><a href="#StepperBase-863"><span class="linenos"> 863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase-864"><a href="#StepperBase-864"><span class="linenos"> 864</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># We now have string of floats, convert to list of floats</span>
</span><span id="StepperBase-865"><a href="#StepperBase-865"><span class="linenos"> 865</span></a>        <span class="n">enc_calib</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase-866"><a href="#StepperBase-866"><span class="linenos"> 866</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase-867"><a href="#StepperBase-867"><span class="linenos"> 867</span></a>            <span class="n">ff</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="StepperBase-868"><a href="#StepperBase-868"><span class="linenos"> 868</span></a>            <span class="k">if</span> <span class="n">ff</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="StepperBase-869"><a href="#StepperBase-869"><span class="linenos"> 869</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ff</span><span class="p">]))</span>
</span><span id="StepperBase-870"><a href="#StepperBase-870"><span class="linenos"> 870</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="StepperBase-871"><a href="#StepperBase-871"><span class="linenos"> 871</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-872"><a href="#StepperBase-872"><span class="linenos"> 872</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="StepperBase-873"><a href="#StepperBase-873"><span class="linenos"> 873</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase-874"><a href="#StepperBase-874"><span class="linenos"> 874</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_calib</span><span class="p">)</span><span class="o">==</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase-875"><a href="#StepperBase-875"><span class="linenos"> 875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Successful read of encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase-876"><a href="#StepperBase-876"><span class="linenos"> 876</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-877"><a href="#StepperBase-877"><span class="linenos"> 877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Failed to read encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase-878"><a href="#StepperBase-878"><span class="linenos"> 878</span></a>        <span class="k">return</span> <span class="n">enc_calib</span>
</span><span id="StepperBase-879"><a href="#StepperBase-879"><span class="linenos"> 879</span></a>
</span><span id="StepperBase-880"><a href="#StepperBase-880"><span class="linenos"> 880</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
</span><span id="StepperBase-881"><a href="#StepperBase-881"><span class="linenos"> 881</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write encoder calibration data to flash memory.</span>
</span><span id="StepperBase-882"><a href="#StepperBase-882"><span class="linenos"> 882</span></a>
</span><span id="StepperBase-883"><a href="#StepperBase-883"><span class="linenos"> 883</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-884"><a href="#StepperBase-884"><span class="linenos"> 884</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-885"><a href="#StepperBase-885"><span class="linenos"> 885</span></a><span class="sd">        data : list.</span>
</span><span id="StepperBase-886"><a href="#StepperBase-886"><span class="linenos"> 886</span></a><span class="sd">            The encoder calirbation data to write.</span>
</span><span id="StepperBase-887"><a href="#StepperBase-887"><span class="linenos"> 887</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-888"><a href="#StepperBase-888"><span class="linenos"> 888</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-889"><a href="#StepperBase-889"><span class="linenos"> 889</span></a>            <span class="k">return</span>
</span><span id="StepperBase-890"><a href="#StepperBase-890"><span class="linenos"> 890</span></a>        <span class="c1">#This will take a few seconds. Blocks until complete.</span>
</span><span id="StepperBase-891"><a href="#StepperBase-891"><span class="linenos"> 891</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">!=</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase-892"><a href="#StepperBase-892"><span class="linenos"> 892</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad encoder data&#39;</span><span class="p">)</span>
</span><span id="StepperBase-893"><a href="#StepperBase-893"><span class="linenos"> 893</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-894"><a href="#StepperBase-894"><span class="linenos"> 894</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase-895"><a href="#StepperBase-895"><span class="linenos"> 895</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-896"><a href="#StepperBase-896"><span class="linenos"> 896</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span><span id="StepperBase-897"><a href="#StepperBase-897"><span class="linenos"> 897</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase-898"><a href="#StepperBase-898"><span class="linenos"> 898</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="StepperBase-899"><a href="#StepperBase-899"><span class="linenos"> 899</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="StepperBase-900"><a href="#StepperBase-900"><span class="linenos"> 900</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_ENC_CALIB</span>
</span><span id="StepperBase-901"><a href="#StepperBase-901"><span class="linenos"> 901</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="StepperBase-902"><a href="#StepperBase-902"><span class="linenos"> 902</span></a>                <span class="n">sidx</span><span class="o">=</span><span class="mi">2</span>
</span><span id="StepperBase-903"><a href="#StepperBase-903"><span class="linenos"> 903</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span><span id="StepperBase-904"><a href="#StepperBase-904"><span class="linenos"> 904</span></a>                    <span class="n">pack_float_t</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">64</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
</span><span id="StepperBase-905"><a href="#StepperBase-905"><span class="linenos"> 905</span></a>                    <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-906"><a href="#StepperBase-906"><span class="linenos"> 906</span></a>                <span class="c1"># self.logger.debug(&#39;Sending encoder calibration rpc of size&#39;,sidx)</span>
</span><span id="StepperBase-907"><a href="#StepperBase-907"><span class="linenos"> 907</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_enc_calib_reply</span><span class="p">)</span>
</span><span id="StepperBase-908"><a href="#StepperBase-908"><span class="linenos"> 908</span></a>
</span><span id="StepperBase-909"><a href="#StepperBase-909"><span class="linenos"> 909</span></a>    <span class="k">def</span> <span class="nf">rpc_enc_calib_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-910"><a href="#StepperBase-910"><span class="linenos"> 910</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the rpc reply for encoder calibration.</span>
</span><span id="StepperBase-911"><a href="#StepperBase-911"><span class="linenos"> 911</span></a>
</span><span id="StepperBase-912"><a href="#StepperBase-912"><span class="linenos"> 912</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-913"><a href="#StepperBase-913"><span class="linenos"> 913</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-914"><a href="#StepperBase-914"><span class="linenos"> 914</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-915"><a href="#StepperBase-915"><span class="linenos"> 915</span></a><span class="sd">            The RPC reply message.</span>
</span><span id="StepperBase-916"><a href="#StepperBase-916"><span class="linenos"> 916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-917"><a href="#StepperBase-917"><span class="linenos"> 917</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_ENC_CALIB</span><span class="p">:</span>
</span><span id="StepperBase-918"><a href="#StepperBase-918"><span class="linenos"> 918</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_ENC_CALIB&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-919"><a href="#StepperBase-919"><span class="linenos"> 919</span></a>
</span><span id="StepperBase-920"><a href="#StepperBase-920"><span class="linenos"> 920</span></a>    <span class="c1"># ######################Menu Interface ################################3</span>
</span><span id="StepperBase-921"><a href="#StepperBase-921"><span class="linenos"> 921</span></a>
</span><span id="StepperBase-922"><a href="#StepperBase-922"><span class="linenos"> 922</span></a>
</span><span id="StepperBase-923"><a href="#StepperBase-923"><span class="linenos"> 923</span></a>    <span class="k">def</span> <span class="nf">turn_rpc_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-924"><a href="#StepperBase-924"><span class="linenos"> 924</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn on the RPC interface.</span>
</span><span id="StepperBase-925"><a href="#StepperBase-925"><span class="linenos"> 925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-926"><a href="#StepperBase-926"><span class="linenos"> 926</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;zyx&#39;</span><span class="p">)</span>
</span><span id="StepperBase-927"><a href="#StepperBase-927"><span class="linenos"> 927</span></a>
</span><span id="StepperBase-928"><a href="#StepperBase-928"><span class="linenos"> 928</span></a>
</span><span id="StepperBase-929"><a href="#StepperBase-929"><span class="linenos"> 929</span></a>    <span class="k">def</span> <span class="nf">turn_menu_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-930"><a href="#StepperBase-930"><span class="linenos"> 930</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn on the menu interface.</span>
</span><span id="StepperBase-931"><a href="#StepperBase-931"><span class="linenos"> 931</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-932"><a href="#StepperBase-932"><span class="linenos"> 932</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-933"><a href="#StepperBase-933"><span class="linenos"> 933</span></a>            <span class="k">return</span>
</span><span id="StepperBase-934"><a href="#StepperBase-934"><span class="linenos"> 934</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MENU_ON</span><span class="p">])</span>
</span><span id="StepperBase-935"><a href="#StepperBase-935"><span class="linenos"> 935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_menu_on_reply</span><span class="p">)</span>
</span><span id="StepperBase-936"><a href="#StepperBase-936"><span class="linenos"> 936</span></a>
</span><span id="StepperBase-937"><a href="#StepperBase-937"><span class="linenos"> 937</span></a>
</span><span id="StepperBase-938"><a href="#StepperBase-938"><span class="linenos"> 938</span></a>    <span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-939"><a href="#StepperBase-939"><span class="linenos"> 939</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the menu</span>
</span><span id="StepperBase-940"><a href="#StepperBase-940"><span class="linenos"> 940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-941"><a href="#StepperBase-941"><span class="linenos"> 941</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span><span id="StepperBase-942"><a href="#StepperBase-942"><span class="linenos"> 942</span></a>
</span><span id="StepperBase-943"><a href="#StepperBase-943"><span class="linenos"> 943</span></a>    <span class="k">def</span> <span class="nf">menu_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="StepperBase-944"><a href="#StepperBase-944"><span class="linenos"> 944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a menu transaction.</span>
</span><span id="StepperBase-945"><a href="#StepperBase-945"><span class="linenos"> 945</span></a>
</span><span id="StepperBase-946"><a href="#StepperBase-946"><span class="linenos"> 946</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-947"><a href="#StepperBase-947"><span class="linenos"> 947</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-948"><a href="#StepperBase-948"><span class="linenos"> 948</span></a><span class="sd">        x : bytes.</span>
</span><span id="StepperBase-949"><a href="#StepperBase-949"><span class="linenos"> 949</span></a><span class="sd">            The command to send for the menu transaction.</span>
</span><span id="StepperBase-950"><a href="#StepperBase-950"><span class="linenos"> 950</span></a><span class="sd">        </span>
</span><span id="StepperBase-951"><a href="#StepperBase-951"><span class="linenos"> 951</span></a><span class="sd">        do_print : bool, optional</span>
</span><span id="StepperBase-952"><a href="#StepperBase-952"><span class="linenos"> 952</span></a><span class="sd">            A flag to control whether to print the reply in the console, by default True</span>
</span><span id="StepperBase-953"><a href="#StepperBase-953"><span class="linenos"> 953</span></a>
</span><span id="StepperBase-954"><a href="#StepperBase-954"><span class="linenos"> 954</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-955"><a href="#StepperBase-955"><span class="linenos"> 955</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-956"><a href="#StepperBase-956"><span class="linenos"> 956</span></a><span class="sd">        list:</span>
</span><span id="StepperBase-957"><a href="#StepperBase-957"><span class="linenos"> 957</span></a><span class="sd">            A list containing the reply messages received during the transaction.</span>
</span><span id="StepperBase-958"><a href="#StepperBase-958"><span class="linenos"> 958</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-959"><a href="#StepperBase-959"><span class="linenos"> 959</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-960"><a href="#StepperBase-960"><span class="linenos"> 960</span></a>            <span class="k">return</span>
</span><span id="StepperBase-961"><a href="#StepperBase-961"><span class="linenos"> 961</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="StepperBase-962"><a href="#StepperBase-962"><span class="linenos"> 962</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-963"><a href="#StepperBase-963"><span class="linenos"> 963</span></a>        <span class="n">reply</span><span class="o">=</span><span class="p">[]</span>
</span><span id="StepperBase-964"><a href="#StepperBase-964"><span class="linenos"> 964</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
</span><span id="StepperBase-965"><a href="#StepperBase-965"><span class="linenos"> 965</span></a>            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="StepperBase-966"><a href="#StepperBase-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">do_print</span><span class="p">:</span>
</span><span id="StepperBase-967"><a href="#StepperBase-967"><span class="linenos"> 967</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span><span class="p">:</span>
</span><span id="StepperBase-968"><a href="#StepperBase-968"><span class="linenos"> 968</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase-969"><a href="#StepperBase-969"><span class="linenos"> 969</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-970"><a href="#StepperBase-970"><span class="linenos"> 970</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase-971"><a href="#StepperBase-971"><span class="linenos"> 971</span></a>            <span class="n">reply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="StepperBase-972"><a href="#StepperBase-972"><span class="linenos"> 972</span></a>        <span class="k">return</span> <span class="n">reply</span>
</span><span id="StepperBase-973"><a href="#StepperBase-973"><span class="linenos"> 973</span></a>
</span><span id="StepperBase-974"><a href="#StepperBase-974"><span class="linenos"> 974</span></a>    <span class="c1"># ################Waypoint Trajectory Interface #####################</span>
</span><span id="StepperBase-975"><a href="#StepperBase-975"><span class="linenos"> 975</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="StepperBase-976"><a href="#StepperBase-976"><span class="linenos"> 976</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-977"><a href="#StepperBase-977"><span class="linenos"> 977</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-978"><a href="#StepperBase-978"><span class="linenos"> 978</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-979"><a href="#StepperBase-979"><span class="linenos"> 979</span></a>
</span><span id="StepperBase-980"><a href="#StepperBase-980"><span class="linenos"> 980</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="StepperBase-981"><a href="#StepperBase-981"><span class="linenos"> 981</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-982"><a href="#StepperBase-982"><span class="linenos"> 982</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-983"><a href="#StepperBase-983"><span class="linenos"> 983</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-984"><a href="#StepperBase-984"><span class="linenos"> 984</span></a>
</span><span id="StepperBase-985"><a href="#StepperBase-985"><span class="linenos"> 985</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-986"><a href="#StepperBase-986"><span class="linenos"> 986</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-987"><a href="#StepperBase-987"><span class="linenos"> 987</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-988"><a href="#StepperBase-988"><span class="linenos"> 988</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-989"><a href="#StepperBase-989"><span class="linenos"> 989</span></a>
</span><span id="StepperBase-990"><a href="#StepperBase-990"><span class="linenos"> 990</span></a>    <span class="c1"># ################Transport Callbacks #####################</span>
</span><span id="StepperBase-991"><a href="#StepperBase-991"><span class="linenos"> 991</span></a>    <span class="k">def</span> <span class="nf">unpack_board_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase-992"><a href="#StepperBase-992"><span class="linenos"> 992</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack board information and updates the `self.board_info`.</span>
</span><span id="StepperBase-993"><a href="#StepperBase-993"><span class="linenos"> 993</span></a>
</span><span id="StepperBase-994"><a href="#StepperBase-994"><span class="linenos"> 994</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-995"><a href="#StepperBase-995"><span class="linenos"> 995</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-996"><a href="#StepperBase-996"><span class="linenos"> 996</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase-997"><a href="#StepperBase-997"><span class="linenos"> 997</span></a><span class="sd">            A byte string containing packed board information.</span>
</span><span id="StepperBase-998"><a href="#StepperBase-998"><span class="linenos"> 998</span></a>
</span><span id="StepperBase-999"><a href="#StepperBase-999"><span class="linenos"> 999</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-1000"><a href="#StepperBase-1000"><span class="linenos">1000</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-1001"><a href="#StepperBase-1001"><span class="linenos">1001</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-1002"><a href="#StepperBase-1002"><span class="linenos">1002</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="StepperBase-1003"><a href="#StepperBase-1003"><span class="linenos">1003</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1004"><a href="#StepperBase-1004"><span class="linenos">1004</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-1005"><a href="#StepperBase-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase-1006"><a href="#StepperBase-1006"><span class="linenos">1006</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-1007"><a href="#StepperBase-1007"><span class="linenos">1007</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span> <span class="c1">#New format of Stepper.x  Older format of Stepper.BoardName.Vx&#39; If older format,default to 0</span>
</span><span id="StepperBase-1008"><a href="#StepperBase-1008"><span class="linenos">1008</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase-1009"><a href="#StepperBase-1009"><span class="linenos">1009</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase-1010"><a href="#StepperBase-1010"><span class="linenos">1010</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase-1011"><a href="#StepperBase-1011"><span class="linenos">1011</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):]</span>
</span><span id="StepperBase-1012"><a href="#StepperBase-1012"><span class="linenos">1012</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase-1013"><a href="#StepperBase-1013"><span class="linenos">1013</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-1014"><a href="#StepperBase-1014"><span class="linenos">1014</span></a>
</span><span id="StepperBase-1015"><a href="#StepperBase-1015"><span class="linenos">1015</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase-1016"><a href="#StepperBase-1016"><span class="linenos">1016</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1017"><a href="#StepperBase-1017"><span class="linenos">1017</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1018"><a href="#StepperBase-1018"><span class="linenos">1018</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1019"><a href="#StepperBase-1019"><span class="linenos">1019</span></a>
</span><span id="StepperBase-1020"><a href="#StepperBase-1020"><span class="linenos">1020</span></a>    <span class="k">def</span> <span class="nf">unpack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase-1021"><a href="#StepperBase-1021"><span class="linenos">1021</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack gains data from a byte string and updates the `self.gains_flash` dictionary.</span>
</span><span id="StepperBase-1022"><a href="#StepperBase-1022"><span class="linenos">1022</span></a>
</span><span id="StepperBase-1023"><a href="#StepperBase-1023"><span class="linenos">1023</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1024"><a href="#StepperBase-1024"><span class="linenos">1024</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1025"><a href="#StepperBase-1025"><span class="linenos">1025</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase-1026"><a href="#StepperBase-1026"><span class="linenos">1026</span></a><span class="sd">            A byte string containing packed gains data.</span>
</span><span id="StepperBase-1027"><a href="#StepperBase-1027"><span class="linenos">1027</span></a>
</span><span id="StepperBase-1028"><a href="#StepperBase-1028"><span class="linenos">1028</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-1029"><a href="#StepperBase-1029"><span class="linenos">1029</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-1030"><a href="#StepperBase-1030"><span class="linenos">1030</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-1031"><a href="#StepperBase-1031"><span class="linenos">1031</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="StepperBase-1032"><a href="#StepperBase-1032"><span class="linenos">1032</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1033"><a href="#StepperBase-1033"><span class="linenos">1033</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-1034"><a href="#StepperBase-1034"><span class="linenos">1034</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="StepperBase-1035"><a href="#StepperBase-1035"><span class="linenos">1035</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1036"><a href="#StepperBase-1036"><span class="linenos">1036</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1037"><a href="#StepperBase-1037"><span class="linenos">1037</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1038"><a href="#StepperBase-1038"><span class="linenos">1038</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1039"><a href="#StepperBase-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1040"><a href="#StepperBase-1040"><span class="linenos">1040</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1041"><a href="#StepperBase-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1042"><a href="#StepperBase-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1043"><a href="#StepperBase-1043"><span class="linenos">1043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1044"><a href="#StepperBase-1044"><span class="linenos">1044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1045"><a href="#StepperBase-1045"><span class="linenos">1045</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1046"><a href="#StepperBase-1046"><span class="linenos">1046</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1047"><a href="#StepperBase-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1048"><a href="#StepperBase-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1049"><a href="#StepperBase-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1050"><a href="#StepperBase-1050"><span class="linenos">1050</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1051"><a href="#StepperBase-1051"><span class="linenos">1051</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1052"><a href="#StepperBase-1052"><span class="linenos">1052</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1053"><a href="#StepperBase-1053"><span class="linenos">1053</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1054"><a href="#StepperBase-1054"><span class="linenos">1054</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-1055"><a href="#StepperBase-1055"><span class="linenos">1055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1056"><a href="#StepperBase-1056"><span class="linenos">1056</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1057"><a href="#StepperBase-1057"><span class="linenos">1057</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1058"><a href="#StepperBase-1058"><span class="linenos">1058</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1059"><a href="#StepperBase-1059"><span class="linenos">1059</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1060"><a href="#StepperBase-1060"><span class="linenos">1060</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1061"><a href="#StepperBase-1061"><span class="linenos">1061</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-1062"><a href="#StepperBase-1062"><span class="linenos">1062</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-1063"><a href="#StepperBase-1063"><span class="linenos">1063</span></a>
</span><span id="StepperBase-1064"><a href="#StepperBase-1064"><span class="linenos">1064</span></a>    <span class="k">def</span> <span class="nf">pack_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-1065"><a href="#StepperBase-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs motion limits data starting at index sidx.</span>
</span><span id="StepperBase-1066"><a href="#StepperBase-1066"><span class="linenos">1066</span></a>
</span><span id="StepperBase-1067"><a href="#StepperBase-1067"><span class="linenos">1067</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1068"><a href="#StepperBase-1068"><span class="linenos">1068</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1069"><a href="#StepperBase-1069"><span class="linenos">1069</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase-1070"><a href="#StepperBase-1070"><span class="linenos">1070</span></a><span class="sd">            A byte string to which motion limits data will be packed.</span>
</span><span id="StepperBase-1071"><a href="#StepperBase-1071"><span class="linenos">1071</span></a><span class="sd">        </span>
</span><span id="StepperBase-1072"><a href="#StepperBase-1072"><span class="linenos">1072</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase-1073"><a href="#StepperBase-1073"><span class="linenos">1073</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase-1074"><a href="#StepperBase-1074"><span class="linenos">1074</span></a>
</span><span id="StepperBase-1075"><a href="#StepperBase-1075"><span class="linenos">1075</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-1076"><a href="#StepperBase-1076"><span class="linenos">1076</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-1077"><a href="#StepperBase-1077"><span class="linenos">1077</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-1078"><a href="#StepperBase-1078"><span class="linenos">1078</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase-1079"><a href="#StepperBase-1079"><span class="linenos">1079</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1080"><a href="#StepperBase-1080"><span class="linenos">1080</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1081"><a href="#StepperBase-1081"><span class="linenos">1081</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1082"><a href="#StepperBase-1082"><span class="linenos">1082</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase-1083"><a href="#StepperBase-1083"><span class="linenos">1083</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1084"><a href="#StepperBase-1084"><span class="linenos">1084</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-1085"><a href="#StepperBase-1085"><span class="linenos">1085</span></a>
</span><span id="StepperBase-1086"><a href="#StepperBase-1086"><span class="linenos">1086</span></a>    <span class="k">def</span> <span class="nf">pack_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-1087"><a href="#StepperBase-1087"><span class="linenos">1087</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs command data starting at index sidx.</span>
</span><span id="StepperBase-1088"><a href="#StepperBase-1088"><span class="linenos">1088</span></a>
</span><span id="StepperBase-1089"><a href="#StepperBase-1089"><span class="linenos">1089</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1090"><a href="#StepperBase-1090"><span class="linenos">1090</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1091"><a href="#StepperBase-1091"><span class="linenos">1091</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase-1092"><a href="#StepperBase-1092"><span class="linenos">1092</span></a><span class="sd">            A byte string to which command data will be packed.</span>
</span><span id="StepperBase-1093"><a href="#StepperBase-1093"><span class="linenos">1093</span></a><span class="sd">        </span>
</span><span id="StepperBase-1094"><a href="#StepperBase-1094"><span class="linenos">1094</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase-1095"><a href="#StepperBase-1095"><span class="linenos">1095</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase-1096"><a href="#StepperBase-1096"><span class="linenos">1096</span></a>
</span><span id="StepperBase-1097"><a href="#StepperBase-1097"><span class="linenos">1097</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-1098"><a href="#StepperBase-1098"><span class="linenos">1098</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-1099"><a href="#StepperBase-1099"><span class="linenos">1099</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-1100"><a href="#StepperBase-1100"><span class="linenos">1100</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase-1101"><a href="#StepperBase-1101"><span class="linenos">1101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1102"><a href="#StepperBase-1102"><span class="linenos">1102</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1103"><a href="#StepperBase-1103"><span class="linenos">1103</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-1104"><a href="#StepperBase-1104"><span class="linenos">1104</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1105"><a href="#StepperBase-1105"><span class="linenos">1105</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1106"><a href="#StepperBase-1106"><span class="linenos">1106</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1107"><a href="#StepperBase-1107"><span class="linenos">1107</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1108"><a href="#StepperBase-1108"><span class="linenos">1108</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1109"><a href="#StepperBase-1109"><span class="linenos">1109</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1110"><a href="#StepperBase-1110"><span class="linenos">1110</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1111"><a href="#StepperBase-1111"><span class="linenos">1111</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1112"><a href="#StepperBase-1112"><span class="linenos">1112</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1113"><a href="#StepperBase-1113"><span class="linenos">1113</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1114"><a href="#StepperBase-1114"><span class="linenos">1114</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1115"><a href="#StepperBase-1115"><span class="linenos">1115</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1116"><a href="#StepperBase-1116"><span class="linenos">1116</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1117"><a href="#StepperBase-1117"><span class="linenos">1117</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1118"><a href="#StepperBase-1118"><span class="linenos">1118</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">])</span>
</span><span id="StepperBase-1119"><a href="#StepperBase-1119"><span class="linenos">1119</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-1120"><a href="#StepperBase-1120"><span class="linenos">1120</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-1121"><a href="#StepperBase-1121"><span class="linenos">1121</span></a>
</span><span id="StepperBase-1122"><a href="#StepperBase-1122"><span class="linenos">1122</span></a>    <span class="k">def</span> <span class="nf">pack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-1123"><a href="#StepperBase-1123"><span class="linenos">1123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs gains data starting at index sidx.</span>
</span><span id="StepperBase-1124"><a href="#StepperBase-1124"><span class="linenos">1124</span></a>
</span><span id="StepperBase-1125"><a href="#StepperBase-1125"><span class="linenos">1125</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1126"><a href="#StepperBase-1126"><span class="linenos">1126</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1127"><a href="#StepperBase-1127"><span class="linenos">1127</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase-1128"><a href="#StepperBase-1128"><span class="linenos">1128</span></a><span class="sd">            A byte string to which gains data will be packed.</span>
</span><span id="StepperBase-1129"><a href="#StepperBase-1129"><span class="linenos">1129</span></a><span class="sd">        </span>
</span><span id="StepperBase-1130"><a href="#StepperBase-1130"><span class="linenos">1130</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase-1131"><a href="#StepperBase-1131"><span class="linenos">1131</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase-1132"><a href="#StepperBase-1132"><span class="linenos">1132</span></a>
</span><span id="StepperBase-1133"><a href="#StepperBase-1133"><span class="linenos">1133</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-1134"><a href="#StepperBase-1134"><span class="linenos">1134</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-1135"><a href="#StepperBase-1135"><span class="linenos">1135</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-1136"><a href="#StepperBase-1136"><span class="linenos">1136</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase-1137"><a href="#StepperBase-1137"><span class="linenos">1137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1138"><a href="#StepperBase-1138"><span class="linenos">1138</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1139"><a href="#StepperBase-1139"><span class="linenos">1139</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1140"><a href="#StepperBase-1140"><span class="linenos">1140</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1141"><a href="#StepperBase-1141"><span class="linenos">1141</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1142"><a href="#StepperBase-1142"><span class="linenos">1142</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1143"><a href="#StepperBase-1143"><span class="linenos">1143</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1144"><a href="#StepperBase-1144"><span class="linenos">1144</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1145"><a href="#StepperBase-1145"><span class="linenos">1145</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1146"><a href="#StepperBase-1146"><span class="linenos">1146</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1147"><a href="#StepperBase-1147"><span class="linenos">1147</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1148"><a href="#StepperBase-1148"><span class="linenos">1148</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1149"><a href="#StepperBase-1149"><span class="linenos">1149</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1150"><a href="#StepperBase-1150"><span class="linenos">1150</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1151"><a href="#StepperBase-1151"><span class="linenos">1151</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1152"><a href="#StepperBase-1152"><span class="linenos">1152</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1153"><a href="#StepperBase-1153"><span class="linenos">1153</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1154"><a href="#StepperBase-1154"><span class="linenos">1154</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1155"><a href="#StepperBase-1155"><span class="linenos">1155</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1156"><a href="#StepperBase-1156"><span class="linenos">1156</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1157"><a href="#StepperBase-1157"><span class="linenos">1157</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1158"><a href="#StepperBase-1158"><span class="linenos">1158</span></a>        <span class="n">config</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-1159"><a href="#StepperBase-1159"><span class="linenos">1159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1160"><a href="#StepperBase-1160"><span class="linenos">1160</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span>
</span><span id="StepperBase-1161"><a href="#StepperBase-1161"><span class="linenos">1161</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1162"><a href="#StepperBase-1162"><span class="linenos">1162</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span>
</span><span id="StepperBase-1163"><a href="#StepperBase-1163"><span class="linenos">1163</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1164"><a href="#StepperBase-1164"><span class="linenos">1164</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span>
</span><span id="StepperBase-1165"><a href="#StepperBase-1165"><span class="linenos">1165</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1166"><a href="#StepperBase-1166"><span class="linenos">1166</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span>
</span><span id="StepperBase-1167"><a href="#StepperBase-1167"><span class="linenos">1167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1168"><a href="#StepperBase-1168"><span class="linenos">1168</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span>
</span><span id="StepperBase-1169"><a href="#StepperBase-1169"><span class="linenos">1169</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1170"><a href="#StepperBase-1170"><span class="linenos">1170</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span>
</span><span id="StepperBase-1171"><a href="#StepperBase-1171"><span class="linenos">1171</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-1172"><a href="#StepperBase-1172"><span class="linenos">1172</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span>
</span><span id="StepperBase-1173"><a href="#StepperBase-1173"><span class="linenos">1173</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-1174"><a href="#StepperBase-1174"><span class="linenos">1174</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-1175"><a href="#StepperBase-1175"><span class="linenos">1175</span></a>
</span><span id="StepperBase-1176"><a href="#StepperBase-1176"><span class="linenos">1176</span></a>    <span class="k">def</span> <span class="nf">pack_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-1177"><a href="#StepperBase-1177"><span class="linenos">1177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs trigger data starting at index sidx.</span>
</span><span id="StepperBase-1178"><a href="#StepperBase-1178"><span class="linenos">1178</span></a>
</span><span id="StepperBase-1179"><a href="#StepperBase-1179"><span class="linenos">1179</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1180"><a href="#StepperBase-1180"><span class="linenos">1180</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1181"><a href="#StepperBase-1181"><span class="linenos">1181</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase-1182"><a href="#StepperBase-1182"><span class="linenos">1182</span></a><span class="sd">            A byte string to which trigger data will be packed.</span>
</span><span id="StepperBase-1183"><a href="#StepperBase-1183"><span class="linenos">1183</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase-1184"><a href="#StepperBase-1184"><span class="linenos">1184</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase-1185"><a href="#StepperBase-1185"><span class="linenos">1185</span></a>
</span><span id="StepperBase-1186"><a href="#StepperBase-1186"><span class="linenos">1186</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase-1187"><a href="#StepperBase-1187"><span class="linenos">1187</span></a><span class="sd">        -------</span>
</span><span id="StepperBase-1188"><a href="#StepperBase-1188"><span class="linenos">1188</span></a><span class="sd">        int:</span>
</span><span id="StepperBase-1189"><a href="#StepperBase-1189"><span class="linenos">1189</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase-1190"><a href="#StepperBase-1190"><span class="linenos">1190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1191"><a href="#StepperBase-1191"><span class="linenos">1191</span></a>        <span class="n">pack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">)</span>
</span><span id="StepperBase-1192"><a href="#StepperBase-1192"><span class="linenos">1192</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1193"><a href="#StepperBase-1193"><span class="linenos">1193</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="p">)</span>
</span><span id="StepperBase-1194"><a href="#StepperBase-1194"><span class="linenos">1194</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-1195"><a href="#StepperBase-1195"><span class="linenos">1195</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-1196"><a href="#StepperBase-1196"><span class="linenos">1196</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-1197"><a href="#StepperBase-1197"><span class="linenos">1197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1198"><a href="#StepperBase-1198"><span class="linenos">1198</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1199"><a href="#StepperBase-1199"><span class="linenos">1199</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1200"><a href="#StepperBase-1200"><span class="linenos">1200</span></a>
</span><span id="StepperBase-1201"><a href="#StepperBase-1201"><span class="linenos">1201</span></a>    <span class="k">def</span> <span class="nf">rpc_board_info_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1202"><a href="#StepperBase-1202"><span class="linenos">1202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for board information.</span>
</span><span id="StepperBase-1203"><a href="#StepperBase-1203"><span class="linenos">1203</span></a>
</span><span id="StepperBase-1204"><a href="#StepperBase-1204"><span class="linenos">1204</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1205"><a href="#StepperBase-1205"><span class="linenos">1205</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1206"><a href="#StepperBase-1206"><span class="linenos">1206</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1207"><a href="#StepperBase-1207"><span class="linenos">1207</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1208"><a href="#StepperBase-1208"><span class="linenos">1208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1209"><a href="#StepperBase-1209"><span class="linenos">1209</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span><span class="p">:</span>
</span><span id="StepperBase-1210"><a href="#StepperBase-1210"><span class="linenos">1210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unpack_board_info</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase-1211"><a href="#StepperBase-1211"><span class="linenos">1211</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-1212"><a href="#StepperBase-1212"><span class="linenos">1212</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STEPPER_BOARD_INFO&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1213"><a href="#StepperBase-1213"><span class="linenos">1213</span></a>
</span><span id="StepperBase-1214"><a href="#StepperBase-1214"><span class="linenos">1214</span></a>    <span class="k">def</span> <span class="nf">rpc_gains_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1215"><a href="#StepperBase-1215"><span class="linenos">1215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for gains.</span>
</span><span id="StepperBase-1216"><a href="#StepperBase-1216"><span class="linenos">1216</span></a>
</span><span id="StepperBase-1217"><a href="#StepperBase-1217"><span class="linenos">1217</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1218"><a href="#StepperBase-1218"><span class="linenos">1218</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1219"><a href="#StepperBase-1219"><span class="linenos">1219</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1220"><a href="#StepperBase-1220"><span class="linenos">1220</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1221"><a href="#StepperBase-1221"><span class="linenos">1221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1222"><a href="#StepperBase-1222"><span class="linenos">1222</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_GAINS</span><span class="p">:</span>
</span><span id="StepperBase-1223"><a href="#StepperBase-1223"><span class="linenos">1223</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_GAINS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1224"><a href="#StepperBase-1224"><span class="linenos">1224</span></a>
</span><span id="StepperBase-1225"><a href="#StepperBase-1225"><span class="linenos">1225</span></a>    <span class="k">def</span> <span class="nf">rpc_trigger_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1226"><a href="#StepperBase-1226"><span class="linenos">1226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for trigger.</span>
</span><span id="StepperBase-1227"><a href="#StepperBase-1227"><span class="linenos">1227</span></a>
</span><span id="StepperBase-1228"><a href="#StepperBase-1228"><span class="linenos">1228</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1229"><a href="#StepperBase-1229"><span class="linenos">1229</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1230"><a href="#StepperBase-1230"><span class="linenos">1230</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1231"><a href="#StepperBase-1231"><span class="linenos">1231</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1232"><a href="#StepperBase-1232"><span class="linenos">1232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1233"><a href="#StepperBase-1233"><span class="linenos">1233</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_TRIGGER</span><span class="p">:</span>
</span><span id="StepperBase-1234"><a href="#StepperBase-1234"><span class="linenos">1234</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_SET_TRIGGER&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1235"><a href="#StepperBase-1235"><span class="linenos">1235</span></a>
</span><span id="StepperBase-1236"><a href="#StepperBase-1236"><span class="linenos">1236</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1237"><a href="#StepperBase-1237"><span class="linenos">1237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for command.</span>
</span><span id="StepperBase-1238"><a href="#StepperBase-1238"><span class="linenos">1238</span></a>
</span><span id="StepperBase-1239"><a href="#StepperBase-1239"><span class="linenos">1239</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1240"><a href="#StepperBase-1240"><span class="linenos">1240</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1241"><a href="#StepperBase-1241"><span class="linenos">1241</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1242"><a href="#StepperBase-1242"><span class="linenos">1242</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1243"><a href="#StepperBase-1243"><span class="linenos">1243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1244"><a href="#StepperBase-1244"><span class="linenos">1244</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="StepperBase-1245"><a href="#StepperBase-1245"><span class="linenos">1245</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1246"><a href="#StepperBase-1246"><span class="linenos">1246</span></a>
</span><span id="StepperBase-1247"><a href="#StepperBase-1247"><span class="linenos">1247</span></a>    <span class="k">def</span> <span class="nf">rpc_motion_limits_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1248"><a href="#StepperBase-1248"><span class="linenos">1248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for motion limits.</span>
</span><span id="StepperBase-1249"><a href="#StepperBase-1249"><span class="linenos">1249</span></a>
</span><span id="StepperBase-1250"><a href="#StepperBase-1250"><span class="linenos">1250</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1251"><a href="#StepperBase-1251"><span class="linenos">1251</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1252"><a href="#StepperBase-1252"><span class="linenos">1252</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1253"><a href="#StepperBase-1253"><span class="linenos">1253</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1254"><a href="#StepperBase-1254"><span class="linenos">1254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1255"><a href="#StepperBase-1255"><span class="linenos">1255</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MOTION_LIMITS</span><span class="p">:</span>
</span><span id="StepperBase-1256"><a href="#StepperBase-1256"><span class="linenos">1256</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MOTION_LIMITS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1257"><a href="#StepperBase-1257"><span class="linenos">1257</span></a>
</span><span id="StepperBase-1258"><a href="#StepperBase-1258"><span class="linenos">1258</span></a>    <span class="k">def</span> <span class="nf">rpc_menu_on_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1259"><a href="#StepperBase-1259"><span class="linenos">1259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for menu activation.</span>
</span><span id="StepperBase-1260"><a href="#StepperBase-1260"><span class="linenos">1260</span></a>
</span><span id="StepperBase-1261"><a href="#StepperBase-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1262"><a href="#StepperBase-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1263"><a href="#StepperBase-1263"><span class="linenos">1263</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1264"><a href="#StepperBase-1264"><span class="linenos">1264</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1265"><a href="#StepperBase-1265"><span class="linenos">1265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1266"><a href="#StepperBase-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MENU_ON</span><span class="p">:</span>
</span><span id="StepperBase-1267"><a href="#StepperBase-1267"><span class="linenos">1267</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MENU_ON&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1268"><a href="#StepperBase-1268"><span class="linenos">1268</span></a>
</span><span id="StepperBase-1269"><a href="#StepperBase-1269"><span class="linenos">1269</span></a>    <span class="k">def</span> <span class="nf">rpc_status_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1270"><a href="#StepperBase-1270"><span class="linenos">1270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for status.</span>
</span><span id="StepperBase-1271"><a href="#StepperBase-1271"><span class="linenos">1271</span></a>
</span><span id="StepperBase-1272"><a href="#StepperBase-1272"><span class="linenos">1272</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1273"><a href="#StepperBase-1273"><span class="linenos">1273</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1274"><a href="#StepperBase-1274"><span class="linenos">1274</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1275"><a href="#StepperBase-1275"><span class="linenos">1275</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1276"><a href="#StepperBase-1276"><span class="linenos">1276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1277"><a href="#StepperBase-1277"><span class="linenos">1277</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS</span><span class="p">:</span>
</span><span id="StepperBase-1278"><a href="#StepperBase-1278"><span class="linenos">1278</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase-1279"><a href="#StepperBase-1279"><span class="linenos">1279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-1280"><a href="#StepperBase-1280"><span class="linenos">1280</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1281"><a href="#StepperBase-1281"><span class="linenos">1281</span></a>
</span><span id="StepperBase-1282"><a href="#StepperBase-1282"><span class="linenos">1282</span></a>    <span class="k">def</span> <span class="nf">rpc_read_gains_from_flash_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1283"><a href="#StepperBase-1283"><span class="linenos">1283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for reading gains from flash.</span>
</span><span id="StepperBase-1284"><a href="#StepperBase-1284"><span class="linenos">1284</span></a>
</span><span id="StepperBase-1285"><a href="#StepperBase-1285"><span class="linenos">1285</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase-1286"><a href="#StepperBase-1286"><span class="linenos">1286</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase-1287"><a href="#StepperBase-1287"><span class="linenos">1287</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase-1288"><a href="#StepperBase-1288"><span class="linenos">1288</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase-1289"><a href="#StepperBase-1289"><span class="linenos">1289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-1290"><a href="#StepperBase-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span><span class="p">:</span>
</span><span id="StepperBase-1291"><a href="#StepperBase-1291"><span class="linenos">1291</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_gains</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase-1292"><a href="#StepperBase-1292"><span class="linenos">1292</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-1293"><a href="#StepperBase-1293"><span class="linenos">1293</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_GAINS_FROM_FLASH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-1294"><a href="#StepperBase-1294"><span class="linenos">1294</span></a>
</span><span id="StepperBase-1295"><a href="#StepperBase-1295"><span class="linenos">1295</span></a>
</span><span id="StepperBase-1296"><a href="#StepperBase-1296"><span class="linenos">1296</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1297"><a href="#StepperBase-1297"><span class="linenos">1297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1298"><a href="#StepperBase-1298"><span class="linenos">1298</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1299"><a href="#StepperBase-1299"><span class="linenos">1299</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1300"><a href="#StepperBase-1300"><span class="linenos">1300</span></a>
</span><span id="StepperBase-1301"><a href="#StepperBase-1301"><span class="linenos">1301</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1302"><a href="#StepperBase-1302"><span class="linenos">1302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1303"><a href="#StepperBase-1303"><span class="linenos">1303</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1304"><a href="#StepperBase-1304"><span class="linenos">1304</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1305"><a href="#StepperBase-1305"><span class="linenos">1305</span></a>
</span><span id="StepperBase-1306"><a href="#StepperBase-1306"><span class="linenos">1306</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1307"><a href="#StepperBase-1307"><span class="linenos">1307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1308"><a href="#StepperBase-1308"><span class="linenos">1308</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1309"><a href="#StepperBase-1309"><span class="linenos">1309</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1310"><a href="#StepperBase-1310"><span class="linenos">1310</span></a>
</span><span id="StepperBase-1311"><a href="#StepperBase-1311"><span class="linenos">1311</span></a>
</span><span id="StepperBase-1312"><a href="#StepperBase-1312"><span class="linenos">1312</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-1313"><a href="#StepperBase-1313"><span class="linenos">1313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1314"><a href="#StepperBase-1314"><span class="linenos">1314</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1315"><a href="#StepperBase-1315"><span class="linenos">1315</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1316"><a href="#StepperBase-1316"><span class="linenos">1316</span></a>
</span><span id="StepperBase-1317"><a href="#StepperBase-1317"><span class="linenos">1317</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-1318"><a href="#StepperBase-1318"><span class="linenos">1318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1319"><a href="#StepperBase-1319"><span class="linenos">1319</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1320"><a href="#StepperBase-1320"><span class="linenos">1320</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1321"><a href="#StepperBase-1321"><span class="linenos">1321</span></a>
</span><span id="StepperBase-1322"><a href="#StepperBase-1322"><span class="linenos">1322</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-1323"><a href="#StepperBase-1323"><span class="linenos">1323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1324"><a href="#StepperBase-1324"><span class="linenos">1324</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1325"><a href="#StepperBase-1325"><span class="linenos">1325</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-1326"><a href="#StepperBase-1326"><span class="linenos">1326</span></a>
</span><span id="StepperBase-1327"><a href="#StepperBase-1327"><span class="linenos">1327</span></a>
</span><span id="StepperBase-1328"><a href="#StepperBase-1328"><span class="linenos">1328</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-1329"><a href="#StepperBase-1329"><span class="linenos">1329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;@private&quot;&quot;&quot;</span>
</span><span id="StepperBase-1330"><a href="#StepperBase-1330"><span class="linenos">1330</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-1331"><a href="#StepperBase-1331"><span class="linenos">1331</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="StepperBase.__init__" class="classattr">
                                        <input id="StepperBase.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">StepperBase</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">usb</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="StepperBase.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.__init__-195"><a href="#StepperBase.__init__-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase.__init__-196"><a href="#StepperBase.__init__-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.__init__-197"><a href="#StepperBase.__init__-197"><span class="linenos">197</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="c1">#Pull from usb device name</span>
</span><span id="StepperBase.__init__-198"><a href="#StepperBase.__init__-198"><span class="linenos">198</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="StepperBase.__init__-199"><a href="#StepperBase.__init__-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span>
</span><span id="StepperBase.__init__-200"><a href="#StepperBase.__init__-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">Transport</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="StepperBase.__init__-201"><a href="#StepperBase.__init__-201"><span class="linenos">201</span></a>
</span><span id="StepperBase.__init__-202"><a href="#StepperBase.__init__-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;a_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stiffness&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase.__init__-203"><a href="#StepperBase.__init__-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_pct&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;current&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-204"><a href="#StepperBase.__init__-204"><span class="linenos">204</span></a>                       <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-205"><a href="#StepperBase.__init__-205"><span class="linenos">205</span></a>                       <span class="s1">&#39;is_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-206"><a href="#StepperBase.__init__-206"><span class="linenos">206</span></a>                       <span class="s1">&#39;in_safety_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;trace_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-207"><a href="#StepperBase.__init__-207"><span class="linenos">207</span></a>                       <span class="s1">&#39;waypoint_traj&#39;</span><span class="p">:{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="s1">&#39;setpoint&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;segment_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,}}</span>
</span><span id="StepperBase.__init__-208"><a href="#StepperBase.__init__-208"><span class="linenos">208</span></a>
</span><span id="StepperBase.__init__-209"><a href="#StepperBase.__init__-209"><span class="linenos">209</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase.__init__-210"><a href="#StepperBase.__init__-210"><span class="linenos">210</span></a>
</span><span id="StepperBase.__init__-211"><a href="#StepperBase.__init__-211"><span class="linenos">211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase.__init__-212"><a href="#StepperBase.__init__-212"><span class="linenos">212</span></a>
</span><span id="StepperBase.__init__-213"><a href="#StepperBase.__init__-213"><span class="linenos">213</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;board_variant&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;firmware_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase.__init__-214"><a href="#StepperBase.__init__-214"><span class="linenos">214</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="StepperBase.__init__-215"><a href="#StepperBase.__init__-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="StepperBase.__init__-216"><a href="#StepperBase.__init__-216"><span class="linenos">216</span></a>
</span><span id="StepperBase.__init__-217"><a href="#StepperBase.__init__-217"><span class="linenos">217</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="StepperBase.__init__-218"><a href="#StepperBase.__init__-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-219"><a href="#StepperBase.__init__-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-220"><a href="#StepperBase.__init__-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase.__init__-221"><a href="#StepperBase.__init__-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase.__init__-222"><a href="#StepperBase.__init__-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StepperBase.__init__-223"><a href="#StepperBase.__init__-223"><span class="linenos">223</span></a>
</span><span id="StepperBase.__init__-224"><a href="#StepperBase.__init__-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.__init__-225"><a href="#StepperBase.__init__-225"><span class="linenos">225</span></a>
</span><span id="StepperBase.__init__-226"><a href="#StepperBase.__init__-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-227"><a href="#StepperBase.__init__-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-228"><a href="#StepperBase.__init__-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-229"><a href="#StepperBase.__init__-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase.__init__-230"><a href="#StepperBase.__init__-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.__init__-231"><a href="#StepperBase.__init__-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.__init__-232"><a href="#StepperBase.__init__-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</span><span id="StepperBase.__init__-233"><a href="#StepperBase.__init__-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase.__init__-234"><a href="#StepperBase.__init__-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase.__init__-235"><a href="#StepperBase.__init__-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.usb" class="classattr">
                                <div class="attr variable">
            <span class="name">usb</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.usb"></a>
    
    

                            </div>
                            <div id="StepperBase.transport" class="classattr">
                                <div class="attr variable">
            <span class="name">transport</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.transport"></a>
    
    

                            </div>
                            <div id="StepperBase.status" class="classattr">
                                <div class="attr variable">
            <span class="name">status</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.status"></a>
    
    

                            </div>
                            <div id="StepperBase.status_aux" class="classattr">
                                <div class="attr variable">
            <span class="name">status_aux</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.status_aux"></a>
    
    

                            </div>
                            <div id="StepperBase.status_zero" class="classattr">
                                <div class="attr variable">
            <span class="name">status_zero</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.status_zero"></a>
    
    

                            </div>
                            <div id="StepperBase.board_info" class="classattr">
                                <div class="attr variable">
            <span class="name">board_info</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.board_info"></a>
    
    

                            </div>
                            <div id="StepperBase.motion_limits" class="classattr">
                                <div class="attr variable">
            <span class="name">motion_limits</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.motion_limits"></a>
    
    

                            </div>
                            <div id="StepperBase.is_moving_history" class="classattr">
                                <div class="attr variable">
            <span class="name">is_moving_history</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.is_moving_history"></a>
    
    

                            </div>
                            <div id="StepperBase.ts_last_syncd_motion" class="classattr">
                                <div class="attr variable">
            <span class="name">ts_last_syncd_motion</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.ts_last_syncd_motion"></a>
    
    

                            </div>
                            <div id="StepperBase.load_test_payload" class="classattr">
                                <div class="attr variable">
            <span class="name">load_test_payload</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.load_test_payload"></a>
    
    

                            </div>
                            <div id="StepperBase.hw_valid" class="classattr">
                                <div class="attr variable">
            <span class="name">hw_valid</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.hw_valid"></a>
    
    

                            </div>
                            <div id="StepperBase.gains" class="classattr">
                                <div class="attr variable">
            <span class="name">gains</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.gains"></a>
    
    

                            </div>
                            <div id="StepperBase.gains_flash" class="classattr">
                                <div class="attr variable">
            <span class="name">gains_flash</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.gains_flash"></a>
    
    

                            </div>
                            <div id="StepperBase.startup" class="classattr">
                                        <input id="StepperBase.startup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">startup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.startup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.startup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.startup-239"><a href="#StepperBase.startup-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.startup-240"><a href="#StepperBase.startup-240"><span class="linenos">240</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="StepperBase.startup-241"><a href="#StepperBase.startup-241"><span class="linenos">241</span></a>            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="StepperBase.startup-242"><a href="#StepperBase.startup-242"><span class="linenos">242</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
</span><span id="StepperBase.startup-243"><a href="#StepperBase.startup-243"><span class="linenos">243</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.startup-244"><a href="#StepperBase.startup-244"><span class="linenos">244</span></a>                <span class="c1"># Pull board info</span>
</span><span id="StepperBase.startup-245"><a href="#StepperBase.startup-245"><span class="linenos">245</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STEPPER_BOARD_INFO</span><span class="p">])</span>
</span><span id="StepperBase.startup-246"><a href="#StepperBase.startup-246"><span class="linenos">246</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_board_info_reply</span><span class="p">)</span>
</span><span id="StepperBase.startup-247"><a href="#StepperBase.startup-247"><span class="linenos">247</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">configure_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="StepperBase.startup-248"><a href="#StepperBase.startup-248"><span class="linenos">248</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="StepperBase.startup-249"><a href="#StepperBase.startup-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="StepperBase.startup-250"><a href="#StepperBase.startup-250"><span class="linenos">250</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="StepperBase.startup-251"><a href="#StepperBase.startup-251"><span class="linenos">251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase.startup-252"><a href="#StepperBase.startup-252"><span class="linenos">252</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Starts machinery required to interface with this device</p>

<h2 id="parameters">Parameters</h2>

<p>threaded : bool.
    Whether a thread manages hardware polling/pushing in the background</p>

<h2 id="returns">Returns</h2>

<p>bool:
    Whether the startup procedure succeeded</p>
</div>


                            </div>
                            <div id="StepperBase.stop" class="classattr">
                                        <input id="StepperBase.stop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.stop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.stop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.stop-255"><a href="#StepperBase.stop-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.stop-256"><a href="#StepperBase.stop-256"><span class="linenos">256</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="StepperBase.stop-257"><a href="#StepperBase.stop-257"><span class="linenos">257</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.stop-258"><a href="#StepperBase.stop-258"><span class="linenos">258</span></a>            <span class="k">return</span>
</span><span id="StepperBase.stop-259"><a href="#StepperBase.stop-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down Stepper on: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase.stop-260"><a href="#StepperBase.stop-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="StepperBase.stop-261"><a href="#StepperBase.stop-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">exiting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="StepperBase.stop-262"><a href="#StepperBase.stop-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="StepperBase.stop-263"><a href="#StepperBase.stop-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Shuts down machinery started in <code><a href="#StepperBase.startup">startup()</a></code></p>
</div>


                            </div>
                            <div id="StepperBase.is_sync_required" class="classattr">
                                        <input id="StepperBase.is_sync_required-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_sync_required</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ts_last_sync</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.is_sync_required-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.is_sync_required"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.is_sync_required-265"><a href="#StepperBase.is_sync_required-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_last_sync</span><span class="p">):</span>
</span><span id="StepperBase.is_sync_required-266"><a href="#StepperBase.is_sync_required-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines if synchronization is required base on current the status.</span>
</span><span id="StepperBase.is_sync_required-267"><a href="#StepperBase.is_sync_required-267"><span class="linenos">267</span></a>
</span><span id="StepperBase.is_sync_required-268"><a href="#StepperBase.is_sync_required-268"><span class="linenos">268</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.is_sync_required-269"><a href="#StepperBase.is_sync_required-269"><span class="linenos">269</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.is_sync_required-270"><a href="#StepperBase.is_sync_required-270"><span class="linenos">270</span></a><span class="sd">        ts_last_sync : float.</span>
</span><span id="StepperBase.is_sync_required-271"><a href="#StepperBase.is_sync_required-271"><span class="linenos">271</span></a><span class="sd">            The timestamp of the last synchronized motion.</span>
</span><span id="StepperBase.is_sync_required-272"><a href="#StepperBase.is_sync_required-272"><span class="linenos">272</span></a>
</span><span id="StepperBase.is_sync_required-273"><a href="#StepperBase.is_sync_required-273"><span class="linenos">273</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.is_sync_required-274"><a href="#StepperBase.is_sync_required-274"><span class="linenos">274</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.is_sync_required-275"><a href="#StepperBase.is_sync_required-275"><span class="linenos">275</span></a><span class="sd">        bool:</span>
</span><span id="StepperBase.is_sync_required-276"><a href="#StepperBase.is_sync_required-276"><span class="linenos">276</span></a><span class="sd">            True if synchronization is required, False otherwise.</span>
</span><span id="StepperBase.is_sync_required-277"><a href="#StepperBase.is_sync_required-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.is_sync_required-278"><a href="#StepperBase.is_sync_required-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="n">ts_last_sync</span>
</span></pre></div>


            <div class="docstring"><p>Determines if synchronization is required base on current the status.</p>

<h2 id="parameters">Parameters</h2>

<p>ts_last_sync : float.
    The timestamp of the last synchronized motion.</p>

<h2 id="returns">Returns</h2>

<p>bool:
    True if synchronization is required, False otherwise.</p>
</div>


                            </div>
                            <div id="StepperBase.push_command" class="classattr">
                                        <input id="StepperBase.push_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">push_command</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.push_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.push_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.push_command-280"><a href="#StepperBase.push_command-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.push_command-281"><a href="#StepperBase.push_command-281"><span class="linenos">281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current commands to the robot&#39;s hardware</span>
</span><span id="StepperBase.push_command-282"><a href="#StepperBase.push_command-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.push_command-283"><a href="#StepperBase.push_command-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.push_command-284"><a href="#StepperBase.push_command-284"><span class="linenos">284</span></a>            <span class="k">return</span>
</span><span id="StepperBase.push_command-285"><a href="#StepperBase.push_command-285"><span class="linenos">285</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.push_command-286"><a href="#StepperBase.push_command-286"><span class="linenos">286</span></a>
</span><span id="StepperBase.push_command-287"><a href="#StepperBase.push_command-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase.push_command-288"><a href="#StepperBase.push_command-288"><span class="linenos">288</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase.push_command-289"><a href="#StepperBase.push_command-289"><span class="linenos">289</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command-290"><a href="#StepperBase.push_command-290"><span class="linenos">290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command-291"><a href="#StepperBase.push_command-291"><span class="linenos">291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.push_command-292"><a href="#StepperBase.push_command-292"><span class="linenos">292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command-293"><a href="#StepperBase.push_command-293"><span class="linenos">293</span></a>
</span><span id="StepperBase.push_command-294"><a href="#StepperBase.push_command-294"><span class="linenos">294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase.push_command-295"><a href="#StepperBase.push_command-295"><span class="linenos">295</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase.push_command-296"><a href="#StepperBase.push_command-296"><span class="linenos">296</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command-297"><a href="#StepperBase.push_command-297"><span class="linenos">297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command-298"><a href="#StepperBase.push_command-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command-299"><a href="#StepperBase.push_command-299"><span class="linenos">299</span></a>
</span><span id="StepperBase.push_command-300"><a href="#StepperBase.push_command-300"><span class="linenos">300</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase.push_command-301"><a href="#StepperBase.push_command-301"><span class="linenos">301</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span>  <span class="c1"># Mark the time of latest new motion command sent</span>
</span><span id="StepperBase.push_command-302"><a href="#StepperBase.push_command-302"><span class="linenos">302</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.push_command-303"><a href="#StepperBase.push_command-303"><span class="linenos">303</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.push_command-304"><a href="#StepperBase.push_command-304"><span class="linenos">304</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.push_command-305"><a href="#StepperBase.push_command-305"><span class="linenos">305</span></a>
</span><span id="StepperBase.push_command-306"><a href="#StepperBase.push_command-306"><span class="linenos">306</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase.push_command-307"><a href="#StepperBase.push_command-307"><span class="linenos">307</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command-308"><a href="#StepperBase.push_command-308"><span class="linenos">308</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command-309"><a href="#StepperBase.push_command-309"><span class="linenos">309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Push the current commands to the robot's hardware</p>
</div>


                            </div>
                            <div id="StepperBase.push_command_async" class="classattr">
                                        <input id="StepperBase.push_command_async-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">push_command_async</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.push_command_async-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.push_command_async"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.push_command_async-311"><a href="#StepperBase.push_command_async-311"><span class="linenos">311</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.push_command_async-312"><a href="#StepperBase.push_command_async-312"><span class="linenos">312</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the current commands to the robot&#39;s hardware in an asynchronous way</span>
</span><span id="StepperBase.push_command_async-313"><a href="#StepperBase.push_command_async-313"><span class="linenos">313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.push_command_async-314"><a href="#StepperBase.push_command_async-314"><span class="linenos">314</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-315"><a href="#StepperBase.push_command_async-315"><span class="linenos">315</span></a>            <span class="k">return</span>
</span><span id="StepperBase.push_command_async-316"><a href="#StepperBase.push_command_async-316"><span class="linenos">316</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.push_command_async-317"><a href="#StepperBase.push_command_async-317"><span class="linenos">317</span></a>
</span><span id="StepperBase.push_command_async-318"><a href="#StepperBase.push_command_async-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-319"><a href="#StepperBase.push_command_async-319"><span class="linenos">319</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase.push_command_async-320"><a href="#StepperBase.push_command_async-320"><span class="linenos">320</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-321"><a href="#StepperBase.push_command_async-321"><span class="linenos">321</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-322"><a href="#StepperBase.push_command_async-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.push_command_async-323"><a href="#StepperBase.push_command_async-323"><span class="linenos">323</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command_async-324"><a href="#StepperBase.push_command_async-324"><span class="linenos">324</span></a>
</span><span id="StepperBase.push_command_async-325"><a href="#StepperBase.push_command_async-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-326"><a href="#StepperBase.push_command_async-326"><span class="linenos">326</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase.push_command_async-327"><a href="#StepperBase.push_command_async-327"><span class="linenos">327</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-328"><a href="#StepperBase.push_command_async-328"><span class="linenos">328</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-329"><a href="#StepperBase.push_command_async-329"><span class="linenos">329</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command_async-330"><a href="#StepperBase.push_command_async-330"><span class="linenos">330</span></a>
</span><span id="StepperBase.push_command_async-331"><a href="#StepperBase.push_command_async-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-332"><a href="#StepperBase.push_command_async-332"><span class="linenos">332</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span> <span class="c1">#Mark the time of latest new motion command sent</span>
</span><span id="StepperBase.push_command_async-333"><a href="#StepperBase.push_command_async-333"><span class="linenos">333</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.push_command_async-334"><a href="#StepperBase.push_command_async-334"><span class="linenos">334</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-335"><a href="#StepperBase.push_command_async-335"><span class="linenos">335</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.push_command_async-336"><a href="#StepperBase.push_command_async-336"><span class="linenos">336</span></a>
</span><span id="StepperBase.push_command_async-337"><a href="#StepperBase.push_command_async-337"><span class="linenos">337</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase.push_command_async-338"><a href="#StepperBase.push_command_async-338"><span class="linenos">338</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-339"><a href="#StepperBase.push_command_async-339"><span class="linenos">339</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-340"><a href="#StepperBase.push_command_async-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Push the current commands to the robot's hardware in an asynchronous way</p>
</div>


                            </div>
                            <div id="StepperBase.pull_status" class="classattr">
                                        <input id="StepperBase.pull_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pull_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pull_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pull_status-342"><a href="#StepperBase.pull_status-342"><span class="linenos">342</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.pull_status-343"><a href="#StepperBase.pull_status-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the current status of the robot&#39;s hardware</span>
</span><span id="StepperBase.pull_status-344"><a href="#StepperBase.pull_status-344"><span class="linenos">344</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.pull_status-345"><a href="#StepperBase.pull_status-345"><span class="linenos">345</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.pull_status-346"><a href="#StepperBase.pull_status-346"><span class="linenos">346</span></a>            <span class="k">return</span>
</span><span id="StepperBase.pull_status-347"><a href="#StepperBase.pull_status-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase.pull_status-348"><a href="#StepperBase.pull_status-348"><span class="linenos">348</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase.pull_status-349"><a href="#StepperBase.pull_status-349"><span class="linenos">349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">)</span>
</span><span id="StepperBase.pull_status-350"><a href="#StepperBase.pull_status-350"><span class="linenos">350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.pull_status-351"><a href="#StepperBase.pull_status-351"><span class="linenos">351</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase.pull_status-352"><a href="#StepperBase.pull_status-352"><span class="linenos">352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pull the current status of the robot's hardware</p>
</div>


                            </div>
                            <div id="StepperBase.pull_status_async" class="classattr">
                                        <input id="StepperBase.pull_status_async-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">pull_status_async</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pull_status_async-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pull_status_async"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pull_status_async-354"><a href="#StepperBase.pull_status_async-354"><span class="linenos">354</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.pull_status_async-355"><a href="#StepperBase.pull_status_async-355"><span class="linenos">355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the current status of the robot&#39;s hardware in an asynchronous way</span>
</span><span id="StepperBase.pull_status_async-356"><a href="#StepperBase.pull_status_async-356"><span class="linenos">356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.pull_status_async-357"><a href="#StepperBase.pull_status_async-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.pull_status_async-358"><a href="#StepperBase.pull_status_async-358"><span class="linenos">358</span></a>            <span class="k">return</span>
</span><span id="StepperBase.pull_status_async-359"><a href="#StepperBase.pull_status_async-359"><span class="linenos">359</span></a>
</span><span id="StepperBase.pull_status_async-360"><a href="#StepperBase.pull_status_async-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase.pull_status_async-361"><a href="#StepperBase.pull_status_async-361"><span class="linenos">361</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase.pull_status_async-362"><a href="#StepperBase.pull_status_async-362"><span class="linenos">362</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.pull_status_async-363"><a href="#StepperBase.pull_status_async-363"><span class="linenos">363</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.pull_status_async-364"><a href="#StepperBase.pull_status_async-364"><span class="linenos">364</span></a>
</span><span id="StepperBase.pull_status_async-365"><a href="#StepperBase.pull_status_async-365"><span class="linenos">365</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase.pull_status_async-366"><a href="#StepperBase.pull_status_async-366"><span class="linenos">366</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pull the current status of the robot's hardware in an asynchronous way</p>
</div>


                            </div>
                            <div id="StepperBase.step_sentry" class="classattr">
                                        <input id="StepperBase.step_sentry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">step_sentry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">robot</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.step_sentry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.step_sentry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.step_sentry-383"><a href="#StepperBase.step_sentry-383"><span class="linenos">383</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="StepperBase.step_sentry-384"><a href="#StepperBase.step_sentry-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;stepper_is_moving_filter&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.step_sentry-385"><a href="#StepperBase.step_sentry-385"><span class="linenos">385</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.step_sentry-386"><a href="#StepperBase.step_sentry-386"><span class="linenos">386</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="StepperBase.step_sentry-387"><a href="#StepperBase.step_sentry-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform a step in the sentry routine.</p>
</div>


                            </div>
                            <div id="StepperBase.set_motion_limits" class="classattr">
                                        <input id="StepperBase.set_motion_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_motion_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">limit_neg</span>, </span><span class="param"><span class="n">limit_pos</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_motion_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_motion_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_motion_limits-393"><a href="#StepperBase.set_motion_limits-393"><span class="linenos">393</span></a>    <span class="k">def</span> <span class="nf">set_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">):</span>
</span><span id="StepperBase.set_motion_limits-394"><a href="#StepperBase.set_motion_limits-394"><span class="linenos">394</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set motion limits for the robot&#39;s motion range</span>
</span><span id="StepperBase.set_motion_limits-395"><a href="#StepperBase.set_motion_limits-395"><span class="linenos">395</span></a>
</span><span id="StepperBase.set_motion_limits-396"><a href="#StepperBase.set_motion_limits-396"><span class="linenos">396</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.set_motion_limits-397"><a href="#StepperBase.set_motion_limits-397"><span class="linenos">397</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.set_motion_limits-398"><a href="#StepperBase.set_motion_limits-398"><span class="linenos">398</span></a><span class="sd">        limit_neg : float.</span>
</span><span id="StepperBase.set_motion_limits-399"><a href="#StepperBase.set_motion_limits-399"><span class="linenos">399</span></a><span class="sd">            The new negative motion limit</span>
</span><span id="StepperBase.set_motion_limits-400"><a href="#StepperBase.set_motion_limits-400"><span class="linenos">400</span></a><span class="sd">        limit_pos : float.</span>
</span><span id="StepperBase.set_motion_limits-401"><a href="#StepperBase.set_motion_limits-401"><span class="linenos">401</span></a><span class="sd">            The new positive motion limit</span>
</span><span id="StepperBase.set_motion_limits-402"><a href="#StepperBase.set_motion_limits-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.set_motion_limits-403"><a href="#StepperBase.set_motion_limits-403"><span class="linenos">403</span></a>        <span class="k">if</span> <span class="n">limit_neg</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">limit_pos</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="StepperBase.set_motion_limits-404"><a href="#StepperBase.set_motion_limits-404"><span class="linenos">404</span></a>            <span class="c1">#Push out immediately</span>
</span><span id="StepperBase.set_motion_limits-405"><a href="#StepperBase.set_motion_limits-405"><span class="linenos">405</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">]</span>
</span><span id="StepperBase.set_motion_limits-406"><a href="#StepperBase.set_motion_limits-406"><span class="linenos">406</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.set_motion_limits-407"><a href="#StepperBase.set_motion_limits-407"><span class="linenos">407</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MOTION_LIMITS</span>
</span><span id="StepperBase.set_motion_limits-408"><a href="#StepperBase.set_motion_limits-408"><span class="linenos">408</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_motion_limits</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.set_motion_limits-409"><a href="#StepperBase.set_motion_limits-409"><span class="linenos">409</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_motion_limits_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set motion limits for the robot's motion range</p>

<h2 id="parameters">Parameters</h2>

<p>limit_neg : float.
    The new negative motion limit
limit_pos : float.
    The new positive motion limit</p>
</div>


                            </div>
                            <div id="StepperBase.set_gains" class="classattr">
                                        <input id="StepperBase.set_gains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_gains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">g</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_gains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_gains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_gains-411"><a href="#StepperBase.set_gains-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
</span><span id="StepperBase.set_gains-412"><a href="#StepperBase.set_gains-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the gains</span>
</span><span id="StepperBase.set_gains-413"><a href="#StepperBase.set_gains-413"><span class="linenos">413</span></a>
</span><span id="StepperBase.set_gains-414"><a href="#StepperBase.set_gains-414"><span class="linenos">414</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.set_gains-415"><a href="#StepperBase.set_gains-415"><span class="linenos">415</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.set_gains-416"><a href="#StepperBase.set_gains-416"><span class="linenos">416</span></a><span class="sd">        g : array?</span>
</span><span id="StepperBase.set_gains-417"><a href="#StepperBase.set_gains-417"><span class="linenos">417</span></a><span class="sd">            An array containing the new gains to set.</span>
</span><span id="StepperBase.set_gains-418"><a href="#StepperBase.set_gains-418"><span class="linenos">418</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.set_gains-419"><a href="#StepperBase.set_gains-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase.set_gains-420"><a href="#StepperBase.set_gains-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Set the gains</p>

<h2 id="parameters">Parameters</h2>

<p>g : array?
    An array containing the new gains to set.</p>
</div>


                            </div>
                            <div id="StepperBase.write_gains_to_flash" class="classattr">
                                        <input id="StepperBase.write_gains_to_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_gains_to_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_gains_to_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_gains_to_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_gains_to_flash-426"><a href="#StepperBase.write_gains_to_flash-426"><span class="linenos">426</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.write_gains_to_flash-427"><a href="#StepperBase.write_gains_to_flash-427"><span class="linenos">427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger writing gains to flash memory.</span>
</span><span id="StepperBase.write_gains_to_flash-428"><a href="#StepperBase.write_gains_to_flash-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.write_gains_to_flash-429"><a href="#StepperBase.write_gains_to_flash-429"><span class="linenos">429</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span>
</span><span id="StepperBase.write_gains_to_flash-430"><a href="#StepperBase.write_gains_to_flash-430"><span class="linenos">430</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Trigger writing gains to flash memory.</p>
</div>


                            </div>
                            <div id="StepperBase.read_gains_from_flash" class="classattr">
                                        <input id="StepperBase.read_gains_from_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_gains_from_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.read_gains_from_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.read_gains_from_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.read_gains_from_flash-432"><a href="#StepperBase.read_gains_from_flash-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">read_gains_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.read_gains_from_flash-433"><a href="#StepperBase.read_gains_from_flash-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gains should be read from flash memory.</span>
</span><span id="StepperBase.read_gains_from_flash-434"><a href="#StepperBase.read_gains_from_flash-434"><span class="linenos">434</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.read_gains_from_flash-435"><a href="#StepperBase.read_gains_from_flash-435"><span class="linenos">435</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Gains should be read from flash memory.</p>
</div>


                            </div>
                            <div id="StepperBase.board_reset" class="classattr">
                                        <input id="StepperBase.board_reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">board_reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.board_reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.board_reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.board_reset-437"><a href="#StepperBase.board_reset-437"><span class="linenos">437</span></a>    <span class="k">def</span> <span class="nf">board_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.board_reset-438"><a href="#StepperBase.board_reset-438"><span class="linenos">438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a board reset.</span>
</span><span id="StepperBase.board_reset-439"><a href="#StepperBase.board_reset-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.board_reset-440"><a href="#StepperBase.board_reset-440"><span class="linenos">440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_BOARD_RESET</span>
</span><span id="StepperBase.board_reset-441"><a href="#StepperBase.board_reset-441"><span class="linenos">441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Trigger a board reset.</p>
</div>


                            </div>
                            <div id="StepperBase.mark_position_on_contact" class="classattr">
                                        <input id="StepperBase.mark_position_on_contact-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_position_on_contact</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.mark_position_on_contact-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.mark_position_on_contact"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.mark_position_on_contact-443"><a href="#StepperBase.mark_position_on_contact-443"><span class="linenos">443</span></a>    <span class="k">def</span> <span class="nf">mark_position_on_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase.mark_position_on_contact-444"><a href="#StepperBase.mark_position_on_contact-444"><span class="linenos">444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger mark a position on contact.</span>
</span><span id="StepperBase.mark_position_on_contact-445"><a href="#StepperBase.mark_position_on_contact-445"><span class="linenos">445</span></a>
</span><span id="StepperBase.mark_position_on_contact-446"><a href="#StepperBase.mark_position_on_contact-446"><span class="linenos">446</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.mark_position_on_contact-447"><a href="#StepperBase.mark_position_on_contact-447"><span class="linenos">447</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.mark_position_on_contact-448"><a href="#StepperBase.mark_position_on_contact-448"><span class="linenos">448</span></a><span class="sd">        x : float.</span>
</span><span id="StepperBase.mark_position_on_contact-449"><a href="#StepperBase.mark_position_on_contact-449"><span class="linenos">449</span></a><span class="sd">            The position of the mark contact.</span>
</span><span id="StepperBase.mark_position_on_contact-450"><a href="#StepperBase.mark_position_on_contact-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.mark_position_on_contact-451"><a href="#StepperBase.mark_position_on_contact-451"><span class="linenos">451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="StepperBase.mark_position_on_contact-452"><a href="#StepperBase.mark_position_on_contact-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS_ON_CONTACT</span>
</span><span id="StepperBase.mark_position_on_contact-453"><a href="#StepperBase.mark_position_on_contact-453"><span class="linenos">453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Trigger mark a position on contact.</p>

<h2 id="parameters">Parameters</h2>

<p>x : float.
    The position of the mark contact.</p>
</div>


                            </div>
                            <div id="StepperBase.mark_position" class="classattr">
                                        <input id="StepperBase.mark_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.mark_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.mark_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.mark_position-455"><a href="#StepperBase.mark_position-455"><span class="linenos">455</span></a>    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase.mark_position-456"><a href="#StepperBase.mark_position-456"><span class="linenos">456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark a position.</span>
</span><span id="StepperBase.mark_position-457"><a href="#StepperBase.mark_position-457"><span class="linenos">457</span></a>
</span><span id="StepperBase.mark_position-458"><a href="#StepperBase.mark_position-458"><span class="linenos">458</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.mark_position-459"><a href="#StepperBase.mark_position-459"><span class="linenos">459</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.mark_position-460"><a href="#StepperBase.mark_position-460"><span class="linenos">460</span></a><span class="sd">        x : float.</span>
</span><span id="StepperBase.mark_position-461"><a href="#StepperBase.mark_position-461"><span class="linenos">461</span></a><span class="sd">            The position to mark.</span>
</span><span id="StepperBase.mark_position-462"><a href="#StepperBase.mark_position-462"><span class="linenos">462</span></a><span class="sd">        </span>
</span><span id="StepperBase.mark_position-463"><a href="#StepperBase.mark_position-463"><span class="linenos">463</span></a><span class="sd">        Notes:</span>
</span><span id="StepperBase.mark_position-464"><a href="#StepperBase.mark_position-464"><span class="linenos">464</span></a><span class="sd">        ------</span>
</span><span id="StepperBase.mark_position-465"><a href="#StepperBase.mark_position-465"><span class="linenos">465</span></a><span class="sd">        This method only performs the operation if the mode is MODE_SAFETY.</span>
</span><span id="StepperBase.mark_position-466"><a href="#StepperBase.mark_position-466"><span class="linenos">466</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.mark_position-467"><a href="#StepperBase.mark_position-467"><span class="linenos">467</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">:</span>
</span><span id="StepperBase.mark_position-468"><a href="#StepperBase.mark_position-468"><span class="linenos">468</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not mark position. Must be in MODE_SAFETY for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase.mark_position-469"><a href="#StepperBase.mark_position-469"><span class="linenos">469</span></a>            <span class="k">return</span>
</span><span id="StepperBase.mark_position-470"><a href="#StepperBase.mark_position-470"><span class="linenos">470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="n">x</span>
</span><span id="StepperBase.mark_position-471"><a href="#StepperBase.mark_position-471"><span class="linenos">471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS</span>
</span><span id="StepperBase.mark_position-472"><a href="#StepperBase.mark_position-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Mark a position.</p>

<h2 id="parameters">Parameters</h2>

<p>x : float.
    The position to mark.</p>

<h2 id="notes">Notes:</h2>

<p>This method only performs the operation if the mode is MODE_SAFETY.</p>
</div>


                            </div>
                            <div id="StepperBase.reset_motion_gen" class="classattr">
                                        <input id="StepperBase.reset_motion_gen-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_motion_gen</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.reset_motion_gen-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.reset_motion_gen"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.reset_motion_gen-474"><a href="#StepperBase.reset_motion_gen-474"><span class="linenos">474</span></a>    <span class="k">def</span> <span class="nf">reset_motion_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.reset_motion_gen-475"><a href="#StepperBase.reset_motion_gen-475"><span class="linenos">475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a reset of the motion generator.</span>
</span><span id="StepperBase.reset_motion_gen-476"><a href="#StepperBase.reset_motion_gen-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.reset_motion_gen-477"><a href="#StepperBase.reset_motion_gen-477"><span class="linenos">477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_MOTION_GEN</span>
</span><span id="StepperBase.reset_motion_gen-478"><a href="#StepperBase.reset_motion_gen-478"><span class="linenos">478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Trigger a reset of the motion generator.</p>
</div>


                            </div>
                            <div id="StepperBase.reset_pos_calibrated" class="classattr">
                                        <input id="StepperBase.reset_pos_calibrated-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_pos_calibrated</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.reset_pos_calibrated-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.reset_pos_calibrated"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.reset_pos_calibrated-480"><a href="#StepperBase.reset_pos_calibrated-480"><span class="linenos">480</span></a>    <span class="k">def</span> <span class="nf">reset_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.reset_pos_calibrated-481"><a href="#StepperBase.reset_pos_calibrated-481"><span class="linenos">481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger a reset of the calibrated position.  </span>
</span><span id="StepperBase.reset_pos_calibrated-482"><a href="#StepperBase.reset_pos_calibrated-482"><span class="linenos">482</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.reset_pos_calibrated-483"><a href="#StepperBase.reset_pos_calibrated-483"><span class="linenos">483</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_POS_CALIBRATED</span>
</span><span id="StepperBase.reset_pos_calibrated-484"><a href="#StepperBase.reset_pos_calibrated-484"><span class="linenos">484</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Trigger a reset of the calibrated position.</p>
</div>


                            </div>
                            <div id="StepperBase.set_pos_calibrated" class="classattr">
                                        <input id="StepperBase.set_pos_calibrated-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pos_calibrated</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_pos_calibrated-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_pos_calibrated"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_pos_calibrated-486"><a href="#StepperBase.set_pos_calibrated-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">set_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.set_pos_calibrated-487"><a href="#StepperBase.set_pos_calibrated-487"><span class="linenos">487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger seting the calibrated position.</span>
</span><span id="StepperBase.set_pos_calibrated-488"><a href="#StepperBase.set_pos_calibrated-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.set_pos_calibrated-489"><a href="#StepperBase.set_pos_calibrated-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_POS_CALIBRATED</span>
</span><span id="StepperBase.set_pos_calibrated-490"><a href="#StepperBase.set_pos_calibrated-490"><span class="linenos">490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Trigger seting the calibrated position.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_safety" class="classattr">
                                        <input id="StepperBase.enable_safety-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_safety</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_safety-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_safety"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_safety-495"><a href="#StepperBase.enable_safety-495"><span class="linenos">495</span></a>    <span class="k">def</span> <span class="nf">enable_safety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_safety-496"><a href="#StepperBase.enable_safety-496"><span class="linenos">496</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Enable safety mode</span>
</span><span id="StepperBase.enable_safety-497"><a href="#StepperBase.enable_safety-497"><span class="linenos">497</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_safety-498"><a href="#StepperBase.enable_safety-498"><span class="linenos">498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable safety mode</p>
</div>


                            </div>
                            <div id="StepperBase.enable_freewheel" class="classattr">
                                        <input id="StepperBase.enable_freewheel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_freewheel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_freewheel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_freewheel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_freewheel-500"><a href="#StepperBase.enable_freewheel-500"><span class="linenos">500</span></a>    <span class="k">def</span> <span class="nf">enable_freewheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_freewheel-501"><a href="#StepperBase.enable_freewheel-501"><span class="linenos">501</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Enable freewheel mode.</span>
</span><span id="StepperBase.enable_freewheel-502"><a href="#StepperBase.enable_freewheel-502"><span class="linenos">502</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_freewheel-503"><a href="#StepperBase.enable_freewheel-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_FREEWHEEL</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable freewheel mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_hold" class="classattr">
                                        <input id="StepperBase.enable_hold-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_hold</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_hold-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_hold"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_hold-505"><a href="#StepperBase.enable_hold-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="nf">enable_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_hold-506"><a href="#StepperBase.enable_hold-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable hold mode.</span>
</span><span id="StepperBase.enable_hold-507"><a href="#StepperBase.enable_hold-507"><span class="linenos">507</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_hold-508"><a href="#StepperBase.enable_hold-508"><span class="linenos">508</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_HOLD</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable hold mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_vel_pid" class="classattr">
                                        <input id="StepperBase.enable_vel_pid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_vel_pid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_vel_pid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_vel_pid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_vel_pid-510"><a href="#StepperBase.enable_vel_pid-510"><span class="linenos">510</span></a>    <span class="k">def</span> <span class="nf">enable_vel_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_vel_pid-511"><a href="#StepperBase.enable_vel_pid-511"><span class="linenos">511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable velocity PID control mode.</span>
</span><span id="StepperBase.enable_vel_pid-512"><a href="#StepperBase.enable_vel_pid-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_vel_pid-513"><a href="#StepperBase.enable_vel_pid-513"><span class="linenos">513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable velocity PID control mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_pos_pid" class="classattr">
                                        <input id="StepperBase.enable_pos_pid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_pid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_pid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_pid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_pid-515"><a href="#StepperBase.enable_pos_pid-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="nf">enable_pos_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_pid-516"><a href="#StepperBase.enable_pos_pid-516"><span class="linenos">516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position PID control mode.</span>
</span><span id="StepperBase.enable_pos_pid-517"><a href="#StepperBase.enable_pos_pid-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_pos_pid-518"><a href="#StepperBase.enable_pos_pid-518"><span class="linenos">518</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_PID</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Enable position PID control mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_vel_traj" class="classattr">
                                        <input id="StepperBase.enable_vel_traj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_vel_traj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_vel_traj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_vel_traj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_vel_traj-520"><a href="#StepperBase.enable_vel_traj-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">enable_vel_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_vel_traj-521"><a href="#StepperBase.enable_vel_traj-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable velocity trajectory control mode.</span>
</span><span id="StepperBase.enable_vel_traj-522"><a href="#StepperBase.enable_vel_traj-522"><span class="linenos">522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_vel_traj-523"><a href="#StepperBase.enable_vel_traj-523"><span class="linenos">523</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable velocity trajectory control mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_pos_traj" class="classattr">
                                        <input id="StepperBase.enable_pos_traj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_traj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_traj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_traj-525"><a href="#StepperBase.enable_pos_traj-525"><span class="linenos">525</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_traj-526"><a href="#StepperBase.enable_pos_traj-526"><span class="linenos">526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position trajectory control mode.</span>
</span><span id="StepperBase.enable_pos_traj-527"><a href="#StepperBase.enable_pos_traj-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_pos_traj-528"><a href="#StepperBase.enable_pos_traj-528"><span class="linenos">528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Enable position trajectory control mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_pos_traj_incr" class="classattr">
                                        <input id="StepperBase.enable_pos_traj_incr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj_incr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_traj_incr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_traj_incr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_traj_incr-535"><a href="#StepperBase.enable_pos_traj_incr-535"><span class="linenos">535</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_traj_incr-536"><a href="#StepperBase.enable_pos_traj_incr-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable incremental position trajectory control mode.</span>
</span><span id="StepperBase.enable_pos_traj_incr-537"><a href="#StepperBase.enable_pos_traj_incr-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_pos_traj_incr-538"><a href="#StepperBase.enable_pos_traj_incr-538"><span class="linenos">538</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable incremental position trajectory control mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_current" class="classattr">
                                        <input id="StepperBase.enable_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_current-540"><a href="#StepperBase.enable_current-540"><span class="linenos">540</span></a>    <span class="k">def</span> <span class="nf">enable_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_current-541"><a href="#StepperBase.enable_current-541"><span class="linenos">541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable current mode.</span>
</span><span id="StepperBase.enable_current-542"><a href="#StepperBase.enable_current-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_current-543"><a href="#StepperBase.enable_current-543"><span class="linenos">543</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">,</span> <span class="n">i_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable current mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_sync_mode" class="classattr">
                                        <input id="StepperBase.enable_sync_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_sync_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_sync_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_sync_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_sync_mode-545"><a href="#StepperBase.enable_sync_mode-545"><span class="linenos">545</span></a>    <span class="k">def</span> <span class="nf">enable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_sync_mode-546"><a href="#StepperBase.enable_sync_mode-546"><span class="linenos">546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable synchrous mode.</span>
</span><span id="StepperBase.enable_sync_mode-547"><a href="#StepperBase.enable_sync_mode-547"><span class="linenos">547</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_sync_mode-548"><a href="#StepperBase.enable_sync_mode-548"><span class="linenos">548</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase.enable_sync_mode-549"><a href="#StepperBase.enable_sync_mode-549"><span class="linenos">549</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Enable synchrous mode.</p>
</div>


                            </div>
                            <div id="StepperBase.disable_sync_mode" class="classattr">
                                        <input id="StepperBase.disable_sync_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_sync_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_sync_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_sync_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_sync_mode-551"><a href="#StepperBase.disable_sync_mode-551"><span class="linenos">551</span></a>    <span class="k">def</span> <span class="nf">disable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_sync_mode-552"><a href="#StepperBase.disable_sync_mode-552"><span class="linenos">552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable asynchronous mode.</span>
</span><span id="StepperBase.disable_sync_mode-553"><a href="#StepperBase.disable_sync_mode-553"><span class="linenos">553</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.disable_sync_mode-554"><a href="#StepperBase.disable_sync_mode-554"><span class="linenos">554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.disable_sync_mode-555"><a href="#StepperBase.disable_sync_mode-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Disable asynchronous mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_runstop" class="classattr">
                                        <input id="StepperBase.enable_runstop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_runstop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_runstop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_runstop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_runstop-557"><a href="#StepperBase.enable_runstop-557"><span class="linenos">557</span></a>    <span class="k">def</span> <span class="nf">enable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_runstop-558"><a href="#StepperBase.enable_runstop-558"><span class="linenos">558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable runstop mode.</span>
</span><span id="StepperBase.enable_runstop-559"><a href="#StepperBase.enable_runstop-559"><span class="linenos">559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_runstop-560"><a href="#StepperBase.enable_runstop-560"><span class="linenos">560</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase.enable_runstop-561"><a href="#StepperBase.enable_runstop-561"><span class="linenos">561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Enable runstop mode.</p>
</div>


                            </div>
                            <div id="StepperBase.disable_runstop" class="classattr">
                                        <input id="StepperBase.disable_runstop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_runstop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_runstop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_runstop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_runstop-563"><a href="#StepperBase.disable_runstop-563"><span class="linenos">563</span></a>    <span class="k">def</span> <span class="nf">disable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_runstop-564"><a href="#StepperBase.disable_runstop-564"><span class="linenos">564</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable runstop mode.</span>
</span><span id="StepperBase.disable_runstop-565"><a href="#StepperBase.disable_runstop-565"><span class="linenos">565</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.disable_runstop-566"><a href="#StepperBase.disable_runstop-566"><span class="linenos">566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.disable_runstop-567"><a href="#StepperBase.disable_runstop-567"><span class="linenos">567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Disable runstop mode.</p>
</div>


                            </div>
                            <div id="StepperBase.enable_guarded_mode" class="classattr">
                                        <input id="StepperBase.enable_guarded_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_guarded_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_guarded_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_guarded_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_guarded_mode-569"><a href="#StepperBase.enable_guarded_mode-569"><span class="linenos">569</span></a>    <span class="k">def</span> <span class="nf">enable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_guarded_mode-570"><a href="#StepperBase.enable_guarded_mode-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable guarded mode.</span>
</span><span id="StepperBase.enable_guarded_mode-571"><a href="#StepperBase.enable_guarded_mode-571"><span class="linenos">571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.enable_guarded_mode-572"><a href="#StepperBase.enable_guarded_mode-572"><span class="linenos">572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase.enable_guarded_mode-573"><a href="#StepperBase.enable_guarded_mode-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Enable guarded mode.</p>
</div>


                            </div>
                            <div id="StepperBase.disable_guarded_mode" class="classattr">
                                        <input id="StepperBase.disable_guarded_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_guarded_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_guarded_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_guarded_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_guarded_mode-575"><a href="#StepperBase.disable_guarded_mode-575"><span class="linenos">575</span></a>    <span class="k">def</span> <span class="nf">disable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_guarded_mode-576"><a href="#StepperBase.disable_guarded_mode-576"><span class="linenos">576</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable guarded mode.</span>
</span><span id="StepperBase.disable_guarded_mode-577"><a href="#StepperBase.disable_guarded_mode-577"><span class="linenos">577</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.disable_guarded_mode-578"><a href="#StepperBase.disable_guarded_mode-578"><span class="linenos">578</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.disable_guarded_mode-579"><a href="#StepperBase.disable_guarded_mode-579"><span class="linenos">579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Disable guarded mode.</p>
</div>


                            </div>
                            <div id="StepperBase.set_command" class="classattr">
                                        <input id="StepperBase.set_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_command</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">x_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">v_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">a_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_command-587"><a href="#StepperBase.set_command-587"><span class="linenos">587</span></a>    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span>  <span class="p">):</span>
</span><span id="StepperBase.set_command-588"><a href="#StepperBase.set_command-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a command.</span>
</span><span id="StepperBase.set_command-589"><a href="#StepperBase.set_command-589"><span class="linenos">589</span></a>
</span><span id="StepperBase.set_command-590"><a href="#StepperBase.set_command-590"><span class="linenos">590</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.set_command-591"><a href="#StepperBase.set_command-591"><span class="linenos">591</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.set_command-592"><a href="#StepperBase.set_command-592"><span class="linenos">592</span></a><span class="sd">        mode : int or None, optional.</span>
</span><span id="StepperBase.set_command-593"><a href="#StepperBase.set_command-593"><span class="linenos">593</span></a><span class="sd">            The command mode to set, if not provided the current mode remains unchanged, by default None.</span>
</span><span id="StepperBase.set_command-594"><a href="#StepperBase.set_command-594"><span class="linenos">594</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-595"><a href="#StepperBase.set_command-595"><span class="linenos">595</span></a><span class="sd">        x_des : float or None, optional.</span>
</span><span id="StepperBase.set_command-596"><a href="#StepperBase.set_command-596"><span class="linenos">596</span></a><span class="sd">            The desired position to change, if not provided the position remains unchanged. If the mode is MODE_POS_TRAJ_INCR, this parameter</span>
</span><span id="StepperBase.set_command-597"><a href="#StepperBase.set_command-597"><span class="linenos">597</span></a><span class="sd">        increments the &#39;incr_trigger&#39; value, by default None.</span>
</span><span id="StepperBase.set_command-598"><a href="#StepperBase.set_command-598"><span class="linenos">598</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-599"><a href="#StepperBase.set_command-599"><span class="linenos">599</span></a><span class="sd">        v_des : float or None, optional.</span>
</span><span id="StepperBase.set_command-600"><a href="#StepperBase.set_command-600"><span class="linenos">600</span></a><span class="sd">            The desired velocity set, if not provided the value is determined based on the current mode or set 0 if the mode is velocity-based, by default None.</span>
</span><span id="StepperBase.set_command-601"><a href="#StepperBase.set_command-601"><span class="linenos">601</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-602"><a href="#StepperBase.set_command-602"><span class="linenos">602</span></a><span class="sd">        a_des : float or None, optional.</span>
</span><span id="StepperBase.set_command-603"><a href="#StepperBase.set_command-603"><span class="linenos">603</span></a><span class="sd">            The desired acceleration to set, if not provided the value is determined based on the current motion configuration, by default None.</span>
</span><span id="StepperBase.set_command-604"><a href="#StepperBase.set_command-604"><span class="linenos">604</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-605"><a href="#StepperBase.set_command-605"><span class="linenos">605</span></a><span class="sd">        i_des : float or None, optional.</span>
</span><span id="StepperBase.set_command-606"><a href="#StepperBase.set_command-606"><span class="linenos">606</span></a><span class="sd">            The desired current to set, if not provided the current value remains unchanged unless the mode is MODE_CURRENT, in which case it updates the `i_feedforward` value, by default None.</span>
</span><span id="StepperBase.set_command-607"><a href="#StepperBase.set_command-607"><span class="linenos">607</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-608"><a href="#StepperBase.set_command-608"><span class="linenos">608</span></a><span class="sd">        stiffness : float or None, optional.</span>
</span><span id="StepperBase.set_command-609"><a href="#StepperBase.set_command-609"><span class="linenos">609</span></a><span class="sd">            The stiffnes value to set. If not provided it remains unchanged, by default None.</span>
</span><span id="StepperBase.set_command-610"><a href="#StepperBase.set_command-610"><span class="linenos">610</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-611"><a href="#StepperBase.set_command-611"><span class="linenos">611</span></a><span class="sd">        i_feedforward : float or None, optional.</span>
</span><span id="StepperBase.set_command-612"><a href="#StepperBase.set_command-612"><span class="linenos">612</span></a><span class="sd">            The feedforward current to set, if not provided it remains unchanged unless the mode is `MODE_CURRENT`, by default None.</span>
</span><span id="StepperBase.set_command-613"><a href="#StepperBase.set_command-613"><span class="linenos">613</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-614"><a href="#StepperBase.set_command-614"><span class="linenos">614</span></a><span class="sd">        i_contact_pos : float or None, optional.</span>
</span><span id="StepperBase.set_command-615"><a href="#StepperBase.set_command-615"><span class="linenos">615</span></a><span class="sd">            The positive contact current to set, if not provided it is determined based on the current gains configuration, by default None.</span>
</span><span id="StepperBase.set_command-616"><a href="#StepperBase.set_command-616"><span class="linenos">616</span></a><span class="sd">        </span>
</span><span id="StepperBase.set_command-617"><a href="#StepperBase.set_command-617"><span class="linenos">617</span></a><span class="sd">        i_contact_neg : float or None, optional.</span>
</span><span id="StepperBase.set_command-618"><a href="#StepperBase.set_command-618"><span class="linenos">618</span></a><span class="sd">            The negative contact current to set, if not provided it is determined based on the current gains configuration, by default None.</span>
</span><span id="StepperBase.set_command-619"><a href="#StepperBase.set_command-619"><span class="linenos">619</span></a>
</span><span id="StepperBase.set_command-620"><a href="#StepperBase.set_command-620"><span class="linenos">620</span></a><span class="sd">        Notes:</span>
</span><span id="StepperBase.set_command-621"><a href="#StepperBase.set_command-621"><span class="linenos">621</span></a><span class="sd">        ------</span>
</span><span id="StepperBase.set_command-622"><a href="#StepperBase.set_command-622"><span class="linenos">622</span></a><span class="sd">        This method updates the internal command dictionary and marks it as dirty,</span>
</span><span id="StepperBase.set_command-623"><a href="#StepperBase.set_command-623"><span class="linenos">623</span></a><span class="sd">        indicating that it has been modified.</span>
</span><span id="StepperBase.set_command-624"><a href="#StepperBase.set_command-624"><span class="linenos">624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.set_command-625"><a href="#StepperBase.set_command-625"><span class="linenos">625</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-626"><a href="#StepperBase.set_command-626"><span class="linenos">626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="StepperBase.set_command-627"><a href="#StepperBase.set_command-627"><span class="linenos">627</span></a>
</span><span id="StepperBase.set_command-628"><a href="#StepperBase.set_command-628"><span class="linenos">628</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-629"><a href="#StepperBase.set_command-629"><span class="linenos">629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="StepperBase.set_command-630"><a href="#StepperBase.set_command-630"><span class="linenos">630</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span>
</span><span id="StepperBase.set_command-631"><a href="#StepperBase.set_command-631"><span class="linenos">631</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">255</span>
</span><span id="StepperBase.set_command-632"><a href="#StepperBase.set_command-632"><span class="linenos">632</span></a>
</span><span id="StepperBase.set_command-633"><a href="#StepperBase.set_command-633"><span class="linenos">633</span></a>        <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-634"><a href="#StepperBase.set_command-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="StepperBase.set_command-635"><a href="#StepperBase.set_command-635"><span class="linenos">635</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-636"><a href="#StepperBase.set_command-636"><span class="linenos">636</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">:</span>
</span><span id="StepperBase.set_command-637"><a href="#StepperBase.set_command-637"><span class="linenos">637</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.set_command-638"><a href="#StepperBase.set_command-638"><span class="linenos">638</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-639"><a href="#StepperBase.set_command-639"><span class="linenos">639</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-640"><a href="#StepperBase.set_command-640"><span class="linenos">640</span></a>
</span><span id="StepperBase.set_command-641"><a href="#StepperBase.set_command-641"><span class="linenos">641</span></a>        <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-642"><a href="#StepperBase.set_command-642"><span class="linenos">642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="StepperBase.set_command-643"><a href="#StepperBase.set_command-643"><span class="linenos">643</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-644"><a href="#StepperBase.set_command-644"><span class="linenos">644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-645"><a href="#StepperBase.set_command-645"><span class="linenos">645</span></a>
</span><span id="StepperBase.set_command-646"><a href="#StepperBase.set_command-646"><span class="linenos">646</span></a>        <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-647"><a href="#StepperBase.set_command-647"><span class="linenos">647</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span>
</span><span id="StepperBase.set_command-648"><a href="#StepperBase.set_command-648"><span class="linenos">648</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-649"><a href="#StepperBase.set_command-649"><span class="linenos">649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase.set_command-650"><a href="#StepperBase.set_command-650"><span class="linenos">650</span></a>
</span><span id="StepperBase.set_command-651"><a href="#StepperBase.set_command-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">i_feedforward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-652"><a href="#StepperBase.set_command-652"><span class="linenos">652</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_feedforward</span>
</span><span id="StepperBase.set_command-653"><a href="#StepperBase.set_command-653"><span class="linenos">653</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-654"><a href="#StepperBase.set_command-654"><span class="linenos">654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.set_command-655"><a href="#StepperBase.set_command-655"><span class="linenos">655</span></a>
</span><span id="StepperBase.set_command-656"><a href="#StepperBase.set_command-656"><span class="linenos">656</span></a>        <span class="k">if</span> <span class="n">i_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">:</span>
</span><span id="StepperBase.set_command-657"><a href="#StepperBase.set_command-657"><span class="linenos">657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">i_des</span>
</span><span id="StepperBase.set_command-658"><a href="#StepperBase.set_command-658"><span class="linenos">658</span></a>
</span><span id="StepperBase.set_command-659"><a href="#StepperBase.set_command-659"><span class="linenos">659</span></a>
</span><span id="StepperBase.set_command-660"><a href="#StepperBase.set_command-660"><span class="linenos">660</span></a>        <span class="k">if</span> <span class="n">i_contact_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-661"><a href="#StepperBase.set_command-661"><span class="linenos">661</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_pos</span>
</span><span id="StepperBase.set_command-662"><a href="#StepperBase.set_command-662"><span class="linenos">662</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-663"><a href="#StepperBase.set_command-663"><span class="linenos">663</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-664"><a href="#StepperBase.set_command-664"><span class="linenos">664</span></a>
</span><span id="StepperBase.set_command-665"><a href="#StepperBase.set_command-665"><span class="linenos">665</span></a>        <span class="k">if</span> <span class="n">i_contact_neg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-666"><a href="#StepperBase.set_command-666"><span class="linenos">666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_neg</span>
</span><span id="StepperBase.set_command-667"><a href="#StepperBase.set_command-667"><span class="linenos">667</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-668"><a href="#StepperBase.set_command-668"><span class="linenos">668</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-669"><a href="#StepperBase.set_command-669"><span class="linenos">669</span></a>        <span class="c1">#print(time.time(), i_des, self._command[&#39;i_feedforward&#39;],mode == self.MODE_CURRENT)</span>
</span><span id="StepperBase.set_command-670"><a href="#StepperBase.set_command-670"><span class="linenos">670</span></a>        <span class="c1">#print(time.time(),self._command[&#39;x_des&#39;],self._command[&#39;incr_trigger&#39;],self._command[&#39;v_des&#39;],self._command[&#39;a_des&#39;])</span>
</span><span id="StepperBase.set_command-671"><a href="#StepperBase.set_command-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Set a command.</p>

<h2 id="parameters">Parameters</h2>

<p>mode : int or None, optional.
    The command mode to set, if not provided the current mode remains unchanged, by default None.</p>

<p>x_des : float or None, optional.
    The desired position to change, if not provided the position remains unchanged. If the mode is MODE_POS_TRAJ_INCR, this parameter
increments the 'incr_trigger' value, by default None.</p>

<p>v_des : float or None, optional.
    The desired velocity set, if not provided the value is determined based on the current mode or set 0 if the mode is velocity-based, by default None.</p>

<p>a_des : float or None, optional.
    The desired acceleration to set, if not provided the value is determined based on the current motion configuration, by default None.</p>

<p>i_des : float or None, optional.
    The desired current to set, if not provided the current value remains unchanged unless the mode is MODE_CURRENT, in which case it updates the <code>i_feedforward</code> value, by default None.</p>

<p>stiffness : float or None, optional.
    The stiffnes value to set. If not provided it remains unchanged, by default None.</p>

<p>i_feedforward : float or None, optional.
    The feedforward current to set, if not provided it remains unchanged unless the mode is <code>MODE_CURRENT</code>, by default None.</p>

<p>i_contact_pos : float or None, optional.
    The positive contact current to set, if not provided it is determined based on the current gains configuration, by default None.</p>

<p>i_contact_neg : float or None, optional.
    The negative contact current to set, if not provided it is determined based on the current gains configuration, by default None.</p>

<h2 id="notes">Notes:</h2>

<p>This method updates the internal command dictionary and marks it as dirty,
indicating that it has been modified.</p>
</div>


                            </div>
                            <div id="StepperBase.wait_while_is_moving" class="classattr">
                                        <input id="StepperBase.wait_while_is_moving-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wait_while_is_moving</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.wait_while_is_moving-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.wait_while_is_moving"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.wait_while_is_moving-674"><a href="#StepperBase.wait_while_is_moving-674"><span class="linenos">674</span></a>    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase.wait_while_is_moving-675"><a href="#StepperBase.wait_while_is_moving-675"><span class="linenos">675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_while_is_moving-676"><a href="#StepperBase.wait_while_is_moving-676"><span class="linenos">676</span></a><span class="sd">        Poll until is moving flag is false.</span>
</span><span id="StepperBase.wait_while_is_moving-677"><a href="#StepperBase.wait_while_is_moving-677"><span class="linenos">677</span></a><span class="sd">        </span>
</span><span id="StepperBase.wait_while_is_moving-678"><a href="#StepperBase.wait_while_is_moving-678"><span class="linenos">678</span></a><span class="sd">        Return True if success.</span>
</span><span id="StepperBase.wait_while_is_moving-679"><a href="#StepperBase.wait_while_is_moving-679"><span class="linenos">679</span></a><span class="sd">        </span>
</span><span id="StepperBase.wait_while_is_moving-680"><a href="#StepperBase.wait_while_is_moving-680"><span class="linenos">680</span></a><span class="sd">        Return False if timeout.</span>
</span><span id="StepperBase.wait_while_is_moving-681"><a href="#StepperBase.wait_while_is_moving-681"><span class="linenos">681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_while_is_moving-682"><a href="#StepperBase.wait_while_is_moving-682"><span class="linenos">682</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.wait_while_is_moving-683"><a href="#StepperBase.wait_while_is_moving-683"><span class="linenos">683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_while_is_moving-684"><a href="#StepperBase.wait_while_is_moving-684"><span class="linenos">684</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase.wait_while_is_moving-685"><a href="#StepperBase.wait_while_is_moving-685"><span class="linenos">685</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.wait_while_is_moving-686"><a href="#StepperBase.wait_while_is_moving-686"><span class="linenos">686</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_while_is_moving-687"><a href="#StepperBase.wait_while_is_moving-687"><span class="linenos">687</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Poll until is moving flag is false.</p>

<p>Return True if success.</p>

<p>Return False if timeout.</p>
</div>


                            </div>
                            <div id="StepperBase.wait_until_at_setpoint" class="classattr">
                                        <input id="StepperBase.wait_until_at_setpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wait_until_at_setpoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.wait_until_at_setpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.wait_until_at_setpoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.wait_until_at_setpoint-689"><a href="#StepperBase.wait_until_at_setpoint-689"><span class="linenos">689</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase.wait_until_at_setpoint-690"><a href="#StepperBase.wait_until_at_setpoint-690"><span class="linenos">690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_until_at_setpoint-691"><a href="#StepperBase.wait_until_at_setpoint-691"><span class="linenos">691</span></a><span class="sd">        Poll until near setpoint.</span>
</span><span id="StepperBase.wait_until_at_setpoint-692"><a href="#StepperBase.wait_until_at_setpoint-692"><span class="linenos">692</span></a><span class="sd">        </span>
</span><span id="StepperBase.wait_until_at_setpoint-693"><a href="#StepperBase.wait_until_at_setpoint-693"><span class="linenos">693</span></a><span class="sd">        Return True if success.</span>
</span><span id="StepperBase.wait_until_at_setpoint-694"><a href="#StepperBase.wait_until_at_setpoint-694"><span class="linenos">694</span></a><span class="sd">        </span>
</span><span id="StepperBase.wait_until_at_setpoint-695"><a href="#StepperBase.wait_until_at_setpoint-695"><span class="linenos">695</span></a><span class="sd">        Return False if timeout.</span>
</span><span id="StepperBase.wait_until_at_setpoint-696"><a href="#StepperBase.wait_until_at_setpoint-696"><span class="linenos">696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_until_at_setpoint-697"><a href="#StepperBase.wait_until_at_setpoint-697"><span class="linenos">697</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.wait_until_at_setpoint-698"><a href="#StepperBase.wait_until_at_setpoint-698"><span class="linenos">698</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_until_at_setpoint-699"><a href="#StepperBase.wait_until_at_setpoint-699"><span class="linenos">699</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase.wait_until_at_setpoint-700"><a href="#StepperBase.wait_until_at_setpoint-700"><span class="linenos">700</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.wait_until_at_setpoint-701"><a href="#StepperBase.wait_until_at_setpoint-701"><span class="linenos">701</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_until_at_setpoint-702"><a href="#StepperBase.wait_until_at_setpoint-702"><span class="linenos">702</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Poll until near setpoint.</p>

<p>Return True if success.</p>

<p>Return False if timeout.</p>
</div>


                            </div>
                            <div id="StepperBase.current_to_effort_ticks" class="classattr">
                                        <input id="StepperBase.current_to_effort_ticks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_to_effort_ticks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i_A</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.current_to_effort_ticks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.current_to_effort_ticks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.current_to_effort_ticks-708"><a href="#StepperBase.current_to_effort_ticks-708"><span class="linenos">708</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase.current_to_effort_ticks-709"><a href="#StepperBase.current_to_effort_ticks-709"><span class="linenos">709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert current to motor effort ticks.</span>
</span><span id="StepperBase.current_to_effort_ticks-710"><a href="#StepperBase.current_to_effort_ticks-710"><span class="linenos">710</span></a>
</span><span id="StepperBase.current_to_effort_ticks-711"><a href="#StepperBase.current_to_effort_ticks-711"><span class="linenos">711</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.current_to_effort_ticks-712"><a href="#StepperBase.current_to_effort_ticks-712"><span class="linenos">712</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.current_to_effort_ticks-713"><a href="#StepperBase.current_to_effort_ticks-713"><span class="linenos">713</span></a><span class="sd">        i_A : float.</span>
</span><span id="StepperBase.current_to_effort_ticks-714"><a href="#StepperBase.current_to_effort_ticks-714"><span class="linenos">714</span></a><span class="sd">            The current in amperes to convert.</span>
</span><span id="StepperBase.current_to_effort_ticks-715"><a href="#StepperBase.current_to_effort_ticks-715"><span class="linenos">715</span></a>
</span><span id="StepperBase.current_to_effort_ticks-716"><a href="#StepperBase.current_to_effort_ticks-716"><span class="linenos">716</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.current_to_effort_ticks-717"><a href="#StepperBase.current_to_effort_ticks-717"><span class="linenos">717</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.current_to_effort_ticks-718"><a href="#StepperBase.current_to_effort_ticks-718"><span class="linenos">718</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.current_to_effort_ticks-719"><a href="#StepperBase.current_to_effort_ticks-719"><span class="linenos">719</span></a><span class="sd">            The motor effort values in ticks, between -255 to 255.</span>
</span><span id="StepperBase.current_to_effort_ticks-720"><a href="#StepperBase.current_to_effort_ticks-720"><span class="linenos">720</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.current_to_effort_ticks-721"><a href="#StepperBase.current_to_effort_ticks-721"><span class="linenos">721</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase.current_to_effort_ticks-722"><a href="#StepperBase.current_to_effort_ticks-722"><span class="linenos">722</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.current_to_effort_ticks-723"><a href="#StepperBase.current_to_effort_ticks-723"><span class="linenos">723</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase.current_to_effort_ticks-724"><a href="#StepperBase.current_to_effort_ticks-724"><span class="linenos">724</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase.current_to_effort_ticks-725"><a href="#StepperBase.current_to_effort_ticks-725"><span class="linenos">725</span></a>        <span class="n">effort_ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_A</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mA_per_tick</span>
</span><span id="StepperBase.current_to_effort_ticks-726"><a href="#StepperBase.current_to_effort_ticks-726"><span class="linenos">726</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">255</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">effort_ticks</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Convert current to motor effort ticks.</p>

<h2 id="parameters">Parameters</h2>

<p>i_A : float.
    The current in amperes to convert.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The motor effort values in ticks, between -255 to 255.</p>
</div>


                            </div>
                            <div id="StepperBase.effort_ticks_to_current" class="classattr">
                                        <input id="StepperBase.effort_ticks_to_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">effort_ticks_to_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">e</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.effort_ticks_to_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.effort_ticks_to_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.effort_ticks_to_current-728"><a href="#StepperBase.effort_ticks_to_current-728"><span class="linenos">728</span></a>    <span class="k">def</span> <span class="nf">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase.effort_ticks_to_current-729"><a href="#StepperBase.effort_ticks_to_current-729"><span class="linenos">729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert motor effort ticks to current.</span>
</span><span id="StepperBase.effort_ticks_to_current-730"><a href="#StepperBase.effort_ticks_to_current-730"><span class="linenos">730</span></a>
</span><span id="StepperBase.effort_ticks_to_current-731"><a href="#StepperBase.effort_ticks_to_current-731"><span class="linenos">731</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.effort_ticks_to_current-732"><a href="#StepperBase.effort_ticks_to_current-732"><span class="linenos">732</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.effort_ticks_to_current-733"><a href="#StepperBase.effort_ticks_to_current-733"><span class="linenos">733</span></a><span class="sd">        e : int.</span>
</span><span id="StepperBase.effort_ticks_to_current-734"><a href="#StepperBase.effort_ticks_to_current-734"><span class="linenos">734</span></a><span class="sd">            The motor effort value in ticks to convert.</span>
</span><span id="StepperBase.effort_ticks_to_current-735"><a href="#StepperBase.effort_ticks_to_current-735"><span class="linenos">735</span></a>
</span><span id="StepperBase.effort_ticks_to_current-736"><a href="#StepperBase.effort_ticks_to_current-736"><span class="linenos">736</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.effort_ticks_to_current-737"><a href="#StepperBase.effort_ticks_to_current-737"><span class="linenos">737</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.effort_ticks_to_current-738"><a href="#StepperBase.effort_ticks_to_current-738"><span class="linenos">738</span></a><span class="sd">        float:</span>
</span><span id="StepperBase.effort_ticks_to_current-739"><a href="#StepperBase.effort_ticks_to_current-739"><span class="linenos">739</span></a><span class="sd">            The current value in amperes.</span>
</span><span id="StepperBase.effort_ticks_to_current-740"><a href="#StepperBase.effort_ticks_to_current-740"><span class="linenos">740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.effort_ticks_to_current-741"><a href="#StepperBase.effort_ticks_to_current-741"><span class="linenos">741</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase.effort_ticks_to_current-742"><a href="#StepperBase.effort_ticks_to_current-742"><span class="linenos">742</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.effort_ticks_to_current-743"><a href="#StepperBase.effort_ticks_to_current-743"><span class="linenos">743</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase.effort_ticks_to_current-744"><a href="#StepperBase.effort_ticks_to_current-744"><span class="linenos">744</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase.effort_ticks_to_current-745"><a href="#StepperBase.effort_ticks_to_current-745"><span class="linenos">745</span></a>        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="n">mA_per_tick</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span></pre></div>


            <div class="docstring"><p>Convert motor effort ticks to current.</p>

<h2 id="parameters">Parameters</h2>

<p>e : int.
    The motor effort value in ticks to convert.</p>

<h2 id="returns">Returns</h2>

<p>float:
    The current value in amperes.</p>
</div>


                            </div>
                            <div id="StepperBase.current_to_effort_pct" class="classattr">
                                        <input id="StepperBase.current_to_effort_pct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_to_effort_pct</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i_A</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.current_to_effort_pct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.current_to_effort_pct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.current_to_effort_pct-749"><a href="#StepperBase.current_to_effort_pct-749"><span class="linenos">749</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase.current_to_effort_pct-750"><a href="#StepperBase.current_to_effort_pct-750"><span class="linenos">750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert current to motor effor percentage.</span>
</span><span id="StepperBase.current_to_effort_pct-751"><a href="#StepperBase.current_to_effort_pct-751"><span class="linenos">751</span></a>
</span><span id="StepperBase.current_to_effort_pct-752"><a href="#StepperBase.current_to_effort_pct-752"><span class="linenos">752</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.current_to_effort_pct-753"><a href="#StepperBase.current_to_effort_pct-753"><span class="linenos">753</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.current_to_effort_pct-754"><a href="#StepperBase.current_to_effort_pct-754"><span class="linenos">754</span></a><span class="sd">        i_A : float.</span>
</span><span id="StepperBase.current_to_effort_pct-755"><a href="#StepperBase.current_to_effort_pct-755"><span class="linenos">755</span></a><span class="sd">            The current in amperes to convert.</span>
</span><span id="StepperBase.current_to_effort_pct-756"><a href="#StepperBase.current_to_effort_pct-756"><span class="linenos">756</span></a>
</span><span id="StepperBase.current_to_effort_pct-757"><a href="#StepperBase.current_to_effort_pct-757"><span class="linenos">757</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.current_to_effort_pct-758"><a href="#StepperBase.current_to_effort_pct-758"><span class="linenos">758</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.current_to_effort_pct-759"><a href="#StepperBase.current_to_effort_pct-759"><span class="linenos">759</span></a><span class="sd">        float:</span>
</span><span id="StepperBase.current_to_effort_pct-760"><a href="#StepperBase.current_to_effort_pct-760"><span class="linenos">760</span></a><span class="sd">            The motor effort percentage.</span>
</span><span id="StepperBase.current_to_effort_pct-761"><a href="#StepperBase.current_to_effort_pct-761"><span class="linenos">761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.current_to_effort_pct-762"><a href="#StepperBase.current_to_effort_pct-762"><span class="linenos">762</span></a>        <span class="k">if</span> <span class="n">i_A</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase.current_to_effort_pct-763"><a href="#StepperBase.current_to_effort_pct-763"><span class="linenos">763</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i_A</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]))</span>
</span><span id="StepperBase.current_to_effort_pct-764"><a href="#StepperBase.current_to_effort_pct-764"><span class="linenos">764</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.current_to_effort_pct-765"><a href="#StepperBase.current_to_effort_pct-765"><span class="linenos">765</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i_A</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])))</span>
</span></pre></div>


            <div class="docstring"><p>Convert current to motor effor percentage.</p>

<h2 id="parameters">Parameters</h2>

<p>i_A : float.
    The current in amperes to convert.</p>

<h2 id="returns">Returns</h2>

<p>float:
    The motor effort percentage.</p>
</div>


                            </div>
                            <div id="StepperBase.effort_pct_to_current" class="classattr">
                                        <input id="StepperBase.effort_pct_to_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">effort_pct_to_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">e_pct</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.effort_pct_to_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.effort_pct_to_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.effort_pct_to_current-767"><a href="#StepperBase.effort_pct_to_current-767"><span class="linenos">767</span></a>    <span class="k">def</span> <span class="nf">effort_pct_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
</span><span id="StepperBase.effort_pct_to_current-768"><a href="#StepperBase.effort_pct_to_current-768"><span class="linenos">768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert motor effort percentage to current.</span>
</span><span id="StepperBase.effort_pct_to_current-769"><a href="#StepperBase.effort_pct_to_current-769"><span class="linenos">769</span></a>
</span><span id="StepperBase.effort_pct_to_current-770"><a href="#StepperBase.effort_pct_to_current-770"><span class="linenos">770</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.effort_pct_to_current-771"><a href="#StepperBase.effort_pct_to_current-771"><span class="linenos">771</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.effort_pct_to_current-772"><a href="#StepperBase.effort_pct_to_current-772"><span class="linenos">772</span></a><span class="sd">        e_pct : float.</span>
</span><span id="StepperBase.effort_pct_to_current-773"><a href="#StepperBase.effort_pct_to_current-773"><span class="linenos">773</span></a><span class="sd">            The motor effort percentage to convert.</span>
</span><span id="StepperBase.effort_pct_to_current-774"><a href="#StepperBase.effort_pct_to_current-774"><span class="linenos">774</span></a>
</span><span id="StepperBase.effort_pct_to_current-775"><a href="#StepperBase.effort_pct_to_current-775"><span class="linenos">775</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.effort_pct_to_current-776"><a href="#StepperBase.effort_pct_to_current-776"><span class="linenos">776</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.effort_pct_to_current-777"><a href="#StepperBase.effort_pct_to_current-777"><span class="linenos">777</span></a><span class="sd">        float:</span>
</span><span id="StepperBase.effort_pct_to_current-778"><a href="#StepperBase.effort_pct_to_current-778"><span class="linenos">778</span></a><span class="sd">            The current value in amperes.</span>
</span><span id="StepperBase.effort_pct_to_current-779"><a href="#StepperBase.effort_pct_to_current-779"><span class="linenos">779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.effort_pct_to_current-780"><a href="#StepperBase.effort_pct_to_current-780"><span class="linenos">780</span></a>        <span class="k">if</span> <span class="n">e_pct</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase.effort_pct_to_current-781"><a href="#StepperBase.effort_pct_to_current-781"><span class="linenos">781</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase.effort_pct_to_current-782"><a href="#StepperBase.effort_pct_to_current-782"><span class="linenos">782</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.effort_pct_to_current-783"><a href="#StepperBase.effort_pct_to_current-783"><span class="linenos">783</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Convert motor effort percentage to current.</p>

<h2 id="parameters">Parameters</h2>

<p>e_pct : float.
    The motor effort percentage to convert.</p>

<h2 id="returns">Returns</h2>

<p>float:
    The current value in amperes.</p>
</div>


                            </div>
                            <div id="StepperBase.get_chip_id" class="classattr">
                                        <input id="StepperBase.get_chip_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_chip_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.get_chip_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.get_chip_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.get_chip_id-796"><a href="#StepperBase.get_chip_id-796"><span class="linenos">796</span></a>    <span class="k">def</span> <span class="nf">get_chip_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.get_chip_id-797"><a href="#StepperBase.get_chip_id-797"><span class="linenos">797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the chip ID.</span>
</span><span id="StepperBase.get_chip_id-798"><a href="#StepperBase.get_chip_id-798"><span class="linenos">798</span></a>
</span><span id="StepperBase.get_chip_id-799"><a href="#StepperBase.get_chip_id-799"><span class="linenos">799</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.get_chip_id-800"><a href="#StepperBase.get_chip_id-800"><span class="linenos">800</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.get_chip_id-801"><a href="#StepperBase.get_chip_id-801"><span class="linenos">801</span></a><span class="sd">        str:</span>
</span><span id="StepperBase.get_chip_id-802"><a href="#StepperBase.get_chip_id-802"><span class="linenos">802</span></a><span class="sd">            The chip ID as a UTF-8 decoded string.</span>
</span><span id="StepperBase.get_chip_id-803"><a href="#StepperBase.get_chip_id-803"><span class="linenos">803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.get_chip_id-804"><a href="#StepperBase.get_chip_id-804"><span class="linenos">804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.get_chip_id-805"><a href="#StepperBase.get_chip_id-805"><span class="linenos">805</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.get_chip_id-806"><a href="#StepperBase.get_chip_id-806"><span class="linenos">806</span></a>        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="StepperBase.get_chip_id-807"><a href="#StepperBase.get_chip_id-807"><span class="linenos">807</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.get_chip_id-808"><a href="#StepperBase.get_chip_id-808"><span class="linenos">808</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.get_chip_id-809"><a href="#StepperBase.get_chip_id-809"><span class="linenos">809</span></a>        <span class="k">return</span> <span class="n">cid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the chip ID.</p>

<h2 id="returns">Returns</h2>

<p>str:
    The chip ID as a UTF-8 decoded string.</p>
</div>


                            </div>
                            <div id="StepperBase.read_encoder_calibration_from_YAML" class="classattr">
                                        <input id="StepperBase.read_encoder_calibration_from_YAML-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_encoder_calibration_from_YAML</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.read_encoder_calibration_from_YAML-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.read_encoder_calibration_from_YAML"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.read_encoder_calibration_from_YAML-811"><a href="#StepperBase.read_encoder_calibration_from_YAML-811"><span class="linenos">811</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-812"><a href="#StepperBase.read_encoder_calibration_from_YAML-812"><span class="linenos">812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read enconder calibration from YAML.</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-813"><a href="#StepperBase.read_encoder_calibration_from_YAML-813"><span class="linenos">813</span></a>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-814"><a href="#StepperBase.read_encoder_calibration_from_YAML-814"><span class="linenos">814</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-815"><a href="#StepperBase.read_encoder_calibration_from_YAML-815"><span class="linenos">815</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-816"><a href="#StepperBase.read_encoder_calibration_from_YAML-816"><span class="linenos">816</span></a><span class="sd">        dict:</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-817"><a href="#StepperBase.read_encoder_calibration_from_YAML-817"><span class="linenos">817</span></a><span class="sd">            The encoder calibration data read from the YAML file.</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-818"><a href="#StepperBase.read_encoder_calibration_from_YAML-818"><span class="linenos">818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-819"><a href="#StepperBase.read_encoder_calibration_from_YAML-819"><span class="linenos">819</span></a>        <span class="n">device_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-820"><a href="#StepperBase.read_encoder_calibration_from_YAML-820"><span class="linenos">820</span></a>        <span class="n">sn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-821"><a href="#StepperBase.read_encoder_calibration_from_YAML-821"><span class="linenos">821</span></a>        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">sn</span><span class="o">+</span><span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-822"><a href="#StepperBase.read_encoder_calibration_from_YAML-822"><span class="linenos">822</span></a>        <span class="n">enc_data</span><span class="o">=</span><span class="n">read_fleet_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-823"><a href="#StepperBase.read_encoder_calibration_from_YAML-823"><span class="linenos">823</span></a>        <span class="k">return</span> <span class="n">enc_data</span>
</span></pre></div>


            <div class="docstring"><p>Read enconder calibration from YAML.</p>

<h2 id="returns">Returns</h2>

<p>dict:
    The encoder calibration data read from the YAML file.</p>
</div>


                            </div>
                            <div id="StepperBase.write_encoder_calibration_to_YAML" class="classattr">
                                        <input id="StepperBase.write_encoder_calibration_to_YAML-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_encoder_calibration_to_YAML</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">filename</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_encoder_calibration_to_YAML-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_encoder_calibration_to_YAML"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_encoder_calibration_to_YAML-825"><a href="#StepperBase.write_encoder_calibration_to_YAML-825"><span class="linenos">825</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-826"><a href="#StepperBase.write_encoder_calibration_to_YAML-826"><span class="linenos">826</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write encoder calibration data to YAML file.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-827"><a href="#StepperBase.write_encoder_calibration_to_YAML-827"><span class="linenos">827</span></a>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-828"><a href="#StepperBase.write_encoder_calibration_to_YAML-828"><span class="linenos">828</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-829"><a href="#StepperBase.write_encoder_calibration_to_YAML-829"><span class="linenos">829</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-830"><a href="#StepperBase.write_encoder_calibration_to_YAML-830"><span class="linenos">830</span></a><span class="sd">        data : dict.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-831"><a href="#StepperBase.write_encoder_calibration_to_YAML-831"><span class="linenos">831</span></a><span class="sd">            The encoder data to write.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-832"><a href="#StepperBase.write_encoder_calibration_to_YAML-832"><span class="linenos">832</span></a><span class="sd">        </span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-833"><a href="#StepperBase.write_encoder_calibration_to_YAML-833"><span class="linenos">833</span></a><span class="sd">        filename : str or None, optional.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-834"><a href="#StepperBase.write_encoder_calibration_to_YAML-834"><span class="linenos">834</span></a><span class="sd">            The filename of the YAML file. If not provided, it is constructed based on the device name and serial number, by default None.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-835"><a href="#StepperBase.write_encoder_calibration_to_YAML-835"><span class="linenos">835</span></a><span class="sd">        </span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-836"><a href="#StepperBase.write_encoder_calibration_to_YAML-836"><span class="linenos">836</span></a><span class="sd">        fleet_dir : str or None, optional.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-837"><a href="#StepperBase.write_encoder_calibration_to_YAML-837"><span class="linenos">837</span></a><span class="sd">            The directory where the file should be saved, if not provided the default directory is used, by default None.</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-838"><a href="#StepperBase.write_encoder_calibration_to_YAML-838"><span class="linenos">838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-839"><a href="#StepperBase.write_encoder_calibration_to_YAML-839"><span class="linenos">839</span></a>        <span class="n">device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-840"><a href="#StepperBase.write_encoder_calibration_to_YAML-840"><span class="linenos">840</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-841"><a href="#StepperBase.write_encoder_calibration_to_YAML-841"><span class="linenos">841</span></a>            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-842"><a href="#StepperBase.write_encoder_calibration_to_YAML-842"><span class="linenos">842</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">sn</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-843"><a href="#StepperBase.write_encoder_calibration_to_YAML-843"><span class="linenos">843</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-844"><a href="#StepperBase.write_encoder_calibration_to_YAML-844"><span class="linenos">844</span></a>        <span class="n">write_fleet_yaml</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">fleet_dir</span><span class="o">=</span><span class="n">fleet_dir</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write encoder calibration data to YAML file.</p>

<h2 id="parameters">Parameters</h2>

<p>data : dict.
    The encoder data to write.</p>

<p>filename : str or None, optional.
    The filename of the YAML file. If not provided, it is constructed based on the device name and serial number, by default None.</p>

<p>fleet_dir : str or None, optional.
    The directory where the file should be saved, if not provided the default directory is used, by default None.</p>
</div>


                            </div>
                            <div id="StepperBase.read_encoder_calibration_from_flash" class="classattr">
                                        <input id="StepperBase.read_encoder_calibration_from_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_encoder_calibration_from_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.read_encoder_calibration_from_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.read_encoder_calibration_from_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.read_encoder_calibration_from_flash-846"><a href="#StepperBase.read_encoder_calibration_from_flash-846"><span class="linenos">846</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-847"><a href="#StepperBase.read_encoder_calibration_from_flash-847"><span class="linenos">847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read encoder calibration data from flash memory.</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-848"><a href="#StepperBase.read_encoder_calibration_from_flash-848"><span class="linenos">848</span></a>
</span><span id="StepperBase.read_encoder_calibration_from_flash-849"><a href="#StepperBase.read_encoder_calibration_from_flash-849"><span class="linenos">849</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-850"><a href="#StepperBase.read_encoder_calibration_from_flash-850"><span class="linenos">850</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-851"><a href="#StepperBase.read_encoder_calibration_from_flash-851"><span class="linenos">851</span></a><span class="sd">        list:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-852"><a href="#StepperBase.read_encoder_calibration_from_flash-852"><span class="linenos">852</span></a><span class="sd">            The encoder calibration data as a list of floats.</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-853"><a href="#StepperBase.read_encoder_calibration_from_flash-853"><span class="linenos">853</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-854"><a href="#StepperBase.read_encoder_calibration_from_flash-854"><span class="linenos">854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-855"><a href="#StepperBase.read_encoder_calibration_from_flash-855"><span class="linenos">855</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-856"><a href="#StepperBase.read_encoder_calibration_from_flash-856"><span class="linenos">856</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-857"><a href="#StepperBase.read_encoder_calibration_from_flash-857"><span class="linenos">857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-858"><a href="#StepperBase.read_encoder_calibration_from_flash-858"><span class="linenos">858</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">19</span><span class="p">]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-859"><a href="#StepperBase.read_encoder_calibration_from_flash-859"><span class="linenos">859</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-860"><a href="#StepperBase.read_encoder_calibration_from_flash-860"><span class="linenos">860</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-861"><a href="#StepperBase.read_encoder_calibration_from_flash-861"><span class="linenos">861</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reseting board&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-862"><a href="#StepperBase.read_encoder_calibration_from_flash-862"><span class="linenos">862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_reset</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-863"><a href="#StepperBase.read_encoder_calibration_from_flash-863"><span class="linenos">863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-864"><a href="#StepperBase.read_encoder_calibration_from_flash-864"><span class="linenos">864</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># We now have string of floats, convert to list of floats</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-865"><a href="#StepperBase.read_encoder_calibration_from_flash-865"><span class="linenos">865</span></a>        <span class="n">enc_calib</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-866"><a href="#StepperBase.read_encoder_calibration_from_flash-866"><span class="linenos">866</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-867"><a href="#StepperBase.read_encoder_calibration_from_flash-867"><span class="linenos">867</span></a>            <span class="n">ff</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-868"><a href="#StepperBase.read_encoder_calibration_from_flash-868"><span class="linenos">868</span></a>            <span class="k">if</span> <span class="n">ff</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-869"><a href="#StepperBase.read_encoder_calibration_from_flash-869"><span class="linenos">869</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ff</span><span class="p">]))</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-870"><a href="#StepperBase.read_encoder_calibration_from_flash-870"><span class="linenos">870</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-871"><a href="#StepperBase.read_encoder_calibration_from_flash-871"><span class="linenos">871</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-872"><a href="#StepperBase.read_encoder_calibration_from_flash-872"><span class="linenos">872</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-873"><a href="#StepperBase.read_encoder_calibration_from_flash-873"><span class="linenos">873</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-874"><a href="#StepperBase.read_encoder_calibration_from_flash-874"><span class="linenos">874</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_calib</span><span class="p">)</span><span class="o">==</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-875"><a href="#StepperBase.read_encoder_calibration_from_flash-875"><span class="linenos">875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Successful read of encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-876"><a href="#StepperBase.read_encoder_calibration_from_flash-876"><span class="linenos">876</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-877"><a href="#StepperBase.read_encoder_calibration_from_flash-877"><span class="linenos">877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Failed to read encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-878"><a href="#StepperBase.read_encoder_calibration_from_flash-878"><span class="linenos">878</span></a>        <span class="k">return</span> <span class="n">enc_calib</span>
</span></pre></div>


            <div class="docstring"><p>Read encoder calibration data from flash memory.</p>

<h2 id="returns">Returns</h2>

<p>list:
    The encoder calibration data as a list of floats.</p>
</div>


                            </div>
                            <div id="StepperBase.write_encoder_calibration_to_flash" class="classattr">
                                        <input id="StepperBase.write_encoder_calibration_to_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_encoder_calibration_to_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_encoder_calibration_to_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_encoder_calibration_to_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_encoder_calibration_to_flash-880"><a href="#StepperBase.write_encoder_calibration_to_flash-880"><span class="linenos">880</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-881"><a href="#StepperBase.write_encoder_calibration_to_flash-881"><span class="linenos">881</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write encoder calibration data to flash memory.</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-882"><a href="#StepperBase.write_encoder_calibration_to_flash-882"><span class="linenos">882</span></a>
</span><span id="StepperBase.write_encoder_calibration_to_flash-883"><a href="#StepperBase.write_encoder_calibration_to_flash-883"><span class="linenos">883</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-884"><a href="#StepperBase.write_encoder_calibration_to_flash-884"><span class="linenos">884</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-885"><a href="#StepperBase.write_encoder_calibration_to_flash-885"><span class="linenos">885</span></a><span class="sd">        data : list.</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-886"><a href="#StepperBase.write_encoder_calibration_to_flash-886"><span class="linenos">886</span></a><span class="sd">            The encoder calirbation data to write.</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-887"><a href="#StepperBase.write_encoder_calibration_to_flash-887"><span class="linenos">887</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-888"><a href="#StepperBase.write_encoder_calibration_to_flash-888"><span class="linenos">888</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-889"><a href="#StepperBase.write_encoder_calibration_to_flash-889"><span class="linenos">889</span></a>            <span class="k">return</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-890"><a href="#StepperBase.write_encoder_calibration_to_flash-890"><span class="linenos">890</span></a>        <span class="c1">#This will take a few seconds. Blocks until complete.</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-891"><a href="#StepperBase.write_encoder_calibration_to_flash-891"><span class="linenos">891</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">!=</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-892"><a href="#StepperBase.write_encoder_calibration_to_flash-892"><span class="linenos">892</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad encoder data&#39;</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-893"><a href="#StepperBase.write_encoder_calibration_to_flash-893"><span class="linenos">893</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-894"><a href="#StepperBase.write_encoder_calibration_to_flash-894"><span class="linenos">894</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-895"><a href="#StepperBase.write_encoder_calibration_to_flash-895"><span class="linenos">895</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-896"><a href="#StepperBase.write_encoder_calibration_to_flash-896"><span class="linenos">896</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-897"><a href="#StepperBase.write_encoder_calibration_to_flash-897"><span class="linenos">897</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-898"><a href="#StepperBase.write_encoder_calibration_to_flash-898"><span class="linenos">898</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-899"><a href="#StepperBase.write_encoder_calibration_to_flash-899"><span class="linenos">899</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-900"><a href="#StepperBase.write_encoder_calibration_to_flash-900"><span class="linenos">900</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_ENC_CALIB</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-901"><a href="#StepperBase.write_encoder_calibration_to_flash-901"><span class="linenos">901</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-902"><a href="#StepperBase.write_encoder_calibration_to_flash-902"><span class="linenos">902</span></a>                <span class="n">sidx</span><span class="o">=</span><span class="mi">2</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-903"><a href="#StepperBase.write_encoder_calibration_to_flash-903"><span class="linenos">903</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-904"><a href="#StepperBase.write_encoder_calibration_to_flash-904"><span class="linenos">904</span></a>                    <span class="n">pack_float_t</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">64</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-905"><a href="#StepperBase.write_encoder_calibration_to_flash-905"><span class="linenos">905</span></a>                    <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-906"><a href="#StepperBase.write_encoder_calibration_to_flash-906"><span class="linenos">906</span></a>                <span class="c1"># self.logger.debug(&#39;Sending encoder calibration rpc of size&#39;,sidx)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-907"><a href="#StepperBase.write_encoder_calibration_to_flash-907"><span class="linenos">907</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_enc_calib_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write encoder calibration data to flash memory.</p>

<h2 id="parameters">Parameters</h2>

<p>data : list.
    The encoder calirbation data to write.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_enc_calib_reply" class="classattr">
                                        <input id="StepperBase.rpc_enc_calib_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_enc_calib_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_enc_calib_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_enc_calib_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_enc_calib_reply-909"><a href="#StepperBase.rpc_enc_calib_reply-909"><span class="linenos">909</span></a>    <span class="k">def</span> <span class="nf">rpc_enc_calib_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_enc_calib_reply-910"><a href="#StepperBase.rpc_enc_calib_reply-910"><span class="linenos">910</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the rpc reply for encoder calibration.</span>
</span><span id="StepperBase.rpc_enc_calib_reply-911"><a href="#StepperBase.rpc_enc_calib_reply-911"><span class="linenos">911</span></a>
</span><span id="StepperBase.rpc_enc_calib_reply-912"><a href="#StepperBase.rpc_enc_calib_reply-912"><span class="linenos">912</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_enc_calib_reply-913"><a href="#StepperBase.rpc_enc_calib_reply-913"><span class="linenos">913</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_enc_calib_reply-914"><a href="#StepperBase.rpc_enc_calib_reply-914"><span class="linenos">914</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_enc_calib_reply-915"><a href="#StepperBase.rpc_enc_calib_reply-915"><span class="linenos">915</span></a><span class="sd">            The RPC reply message.</span>
</span><span id="StepperBase.rpc_enc_calib_reply-916"><a href="#StepperBase.rpc_enc_calib_reply-916"><span class="linenos">916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_enc_calib_reply-917"><a href="#StepperBase.rpc_enc_calib_reply-917"><span class="linenos">917</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_ENC_CALIB</span><span class="p">:</span>
</span><span id="StepperBase.rpc_enc_calib_reply-918"><a href="#StepperBase.rpc_enc_calib_reply-918"><span class="linenos">918</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_ENC_CALIB&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the rpc reply for encoder calibration.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The RPC reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.turn_rpc_interface_on" class="classattr">
                                        <input id="StepperBase.turn_rpc_interface_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">turn_rpc_interface_on</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.turn_rpc_interface_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.turn_rpc_interface_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.turn_rpc_interface_on-923"><a href="#StepperBase.turn_rpc_interface_on-923"><span class="linenos">923</span></a>    <span class="k">def</span> <span class="nf">turn_rpc_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.turn_rpc_interface_on-924"><a href="#StepperBase.turn_rpc_interface_on-924"><span class="linenos">924</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn on the RPC interface.</span>
</span><span id="StepperBase.turn_rpc_interface_on-925"><a href="#StepperBase.turn_rpc_interface_on-925"><span class="linenos">925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.turn_rpc_interface_on-926"><a href="#StepperBase.turn_rpc_interface_on-926"><span class="linenos">926</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;zyx&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Turn on the RPC interface.</p>
</div>


                            </div>
                            <div id="StepperBase.turn_menu_interface_on" class="classattr">
                                        <input id="StepperBase.turn_menu_interface_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">turn_menu_interface_on</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.turn_menu_interface_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.turn_menu_interface_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.turn_menu_interface_on-929"><a href="#StepperBase.turn_menu_interface_on-929"><span class="linenos">929</span></a>    <span class="k">def</span> <span class="nf">turn_menu_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.turn_menu_interface_on-930"><a href="#StepperBase.turn_menu_interface_on-930"><span class="linenos">930</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turn on the menu interface.</span>
</span><span id="StepperBase.turn_menu_interface_on-931"><a href="#StepperBase.turn_menu_interface_on-931"><span class="linenos">931</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.turn_menu_interface_on-932"><a href="#StepperBase.turn_menu_interface_on-932"><span class="linenos">932</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.turn_menu_interface_on-933"><a href="#StepperBase.turn_menu_interface_on-933"><span class="linenos">933</span></a>            <span class="k">return</span>
</span><span id="StepperBase.turn_menu_interface_on-934"><a href="#StepperBase.turn_menu_interface_on-934"><span class="linenos">934</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MENU_ON</span><span class="p">])</span>
</span><span id="StepperBase.turn_menu_interface_on-935"><a href="#StepperBase.turn_menu_interface_on-935"><span class="linenos">935</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_menu_on_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Turn on the menu interface.</p>
</div>


                            </div>
                            <div id="StepperBase.print_menu" class="classattr">
                                        <input id="StepperBase.print_menu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_menu</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.print_menu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.print_menu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.print_menu-938"><a href="#StepperBase.print_menu-938"><span class="linenos">938</span></a>    <span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.print_menu-939"><a href="#StepperBase.print_menu-939"><span class="linenos">939</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the menu</span>
</span><span id="StepperBase.print_menu-940"><a href="#StepperBase.print_menu-940"><span class="linenos">940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.print_menu-941"><a href="#StepperBase.print_menu-941"><span class="linenos">941</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print the menu</p>
</div>


                            </div>
                            <div id="StepperBase.menu_transaction" class="classattr">
                                        <input id="StepperBase.menu_transaction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">menu_transaction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.menu_transaction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.menu_transaction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.menu_transaction-943"><a href="#StepperBase.menu_transaction-943"><span class="linenos">943</span></a>    <span class="k">def</span> <span class="nf">menu_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="StepperBase.menu_transaction-944"><a href="#StepperBase.menu_transaction-944"><span class="linenos">944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a menu transaction.</span>
</span><span id="StepperBase.menu_transaction-945"><a href="#StepperBase.menu_transaction-945"><span class="linenos">945</span></a>
</span><span id="StepperBase.menu_transaction-946"><a href="#StepperBase.menu_transaction-946"><span class="linenos">946</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.menu_transaction-947"><a href="#StepperBase.menu_transaction-947"><span class="linenos">947</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.menu_transaction-948"><a href="#StepperBase.menu_transaction-948"><span class="linenos">948</span></a><span class="sd">        x : bytes.</span>
</span><span id="StepperBase.menu_transaction-949"><a href="#StepperBase.menu_transaction-949"><span class="linenos">949</span></a><span class="sd">            The command to send for the menu transaction.</span>
</span><span id="StepperBase.menu_transaction-950"><a href="#StepperBase.menu_transaction-950"><span class="linenos">950</span></a><span class="sd">        </span>
</span><span id="StepperBase.menu_transaction-951"><a href="#StepperBase.menu_transaction-951"><span class="linenos">951</span></a><span class="sd">        do_print : bool, optional</span>
</span><span id="StepperBase.menu_transaction-952"><a href="#StepperBase.menu_transaction-952"><span class="linenos">952</span></a><span class="sd">            A flag to control whether to print the reply in the console, by default True</span>
</span><span id="StepperBase.menu_transaction-953"><a href="#StepperBase.menu_transaction-953"><span class="linenos">953</span></a>
</span><span id="StepperBase.menu_transaction-954"><a href="#StepperBase.menu_transaction-954"><span class="linenos">954</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.menu_transaction-955"><a href="#StepperBase.menu_transaction-955"><span class="linenos">955</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.menu_transaction-956"><a href="#StepperBase.menu_transaction-956"><span class="linenos">956</span></a><span class="sd">        list:</span>
</span><span id="StepperBase.menu_transaction-957"><a href="#StepperBase.menu_transaction-957"><span class="linenos">957</span></a><span class="sd">            A list containing the reply messages received during the transaction.</span>
</span><span id="StepperBase.menu_transaction-958"><a href="#StepperBase.menu_transaction-958"><span class="linenos">958</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.menu_transaction-959"><a href="#StepperBase.menu_transaction-959"><span class="linenos">959</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-960"><a href="#StepperBase.menu_transaction-960"><span class="linenos">960</span></a>            <span class="k">return</span>
</span><span id="StepperBase.menu_transaction-961"><a href="#StepperBase.menu_transaction-961"><span class="linenos">961</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-962"><a href="#StepperBase.menu_transaction-962"><span class="linenos">962</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-963"><a href="#StepperBase.menu_transaction-963"><span class="linenos">963</span></a>        <span class="n">reply</span><span class="o">=</span><span class="p">[]</span>
</span><span id="StepperBase.menu_transaction-964"><a href="#StepperBase.menu_transaction-964"><span class="linenos">964</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
</span><span id="StepperBase.menu_transaction-965"><a href="#StepperBase.menu_transaction-965"><span class="linenos">965</span></a>            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="StepperBase.menu_transaction-966"><a href="#StepperBase.menu_transaction-966"><span class="linenos">966</span></a>            <span class="k">if</span> <span class="n">do_print</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-967"><a href="#StepperBase.menu_transaction-967"><span class="linenos">967</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-968"><a href="#StepperBase.menu_transaction-968"><span class="linenos">968</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-969"><a href="#StepperBase.menu_transaction-969"><span class="linenos">969</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-970"><a href="#StepperBase.menu_transaction-970"><span class="linenos">970</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-971"><a href="#StepperBase.menu_transaction-971"><span class="linenos">971</span></a>            <span class="n">reply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-972"><a href="#StepperBase.menu_transaction-972"><span class="linenos">972</span></a>        <span class="k">return</span> <span class="n">reply</span>
</span></pre></div>


            <div class="docstring"><p>Perform a menu transaction.</p>

<h2 id="parameters">Parameters</h2>

<p>x : bytes.
    The command to send for the menu transaction.</p>

<p>do_print : bool, optional
    A flag to control whether to print the reply in the console, by default True</p>

<h2 id="returns">Returns</h2>

<p>list:
    A list containing the reply messages received during the transaction.</p>
</div>


                            </div>
                            <div id="StepperBase.unpack_board_info" class="classattr">
                                        <input id="StepperBase.unpack_board_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_board_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.unpack_board_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.unpack_board_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.unpack_board_info-991"><a href="#StepperBase.unpack_board_info-991"><span class="linenos"> 991</span></a>    <span class="k">def</span> <span class="nf">unpack_board_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase.unpack_board_info-992"><a href="#StepperBase.unpack_board_info-992"><span class="linenos"> 992</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack board information and updates the `self.board_info`.</span>
</span><span id="StepperBase.unpack_board_info-993"><a href="#StepperBase.unpack_board_info-993"><span class="linenos"> 993</span></a>
</span><span id="StepperBase.unpack_board_info-994"><a href="#StepperBase.unpack_board_info-994"><span class="linenos"> 994</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.unpack_board_info-995"><a href="#StepperBase.unpack_board_info-995"><span class="linenos"> 995</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.unpack_board_info-996"><a href="#StepperBase.unpack_board_info-996"><span class="linenos"> 996</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase.unpack_board_info-997"><a href="#StepperBase.unpack_board_info-997"><span class="linenos"> 997</span></a><span class="sd">            A byte string containing packed board information.</span>
</span><span id="StepperBase.unpack_board_info-998"><a href="#StepperBase.unpack_board_info-998"><span class="linenos"> 998</span></a>
</span><span id="StepperBase.unpack_board_info-999"><a href="#StepperBase.unpack_board_info-999"><span class="linenos"> 999</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.unpack_board_info-1000"><a href="#StepperBase.unpack_board_info-1000"><span class="linenos">1000</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.unpack_board_info-1001"><a href="#StepperBase.unpack_board_info-1001"><span class="linenos">1001</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.unpack_board_info-1002"><a href="#StepperBase.unpack_board_info-1002"><span class="linenos">1002</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="StepperBase.unpack_board_info-1003"><a href="#StepperBase.unpack_board_info-1003"><span class="linenos">1003</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.unpack_board_info-1004"><a href="#StepperBase.unpack_board_info-1004"><span class="linenos">1004</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.unpack_board_info-1005"><a href="#StepperBase.unpack_board_info-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase.unpack_board_info-1006"><a href="#StepperBase.unpack_board_info-1006"><span class="linenos">1006</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.unpack_board_info-1007"><a href="#StepperBase.unpack_board_info-1007"><span class="linenos">1007</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span> <span class="c1">#New format of Stepper.x  Older format of Stepper.BoardName.Vx&#39; If older format,default to 0</span>
</span><span id="StepperBase.unpack_board_info-1008"><a href="#StepperBase.unpack_board_info-1008"><span class="linenos">1008</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase.unpack_board_info-1009"><a href="#StepperBase.unpack_board_info-1009"><span class="linenos">1009</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase.unpack_board_info-1010"><a href="#StepperBase.unpack_board_info-1010"><span class="linenos">1010</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase.unpack_board_info-1011"><a href="#StepperBase.unpack_board_info-1011"><span class="linenos">1011</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):]</span>
</span><span id="StepperBase.unpack_board_info-1012"><a href="#StepperBase.unpack_board_info-1012"><span class="linenos">1012</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase.unpack_board_info-1013"><a href="#StepperBase.unpack_board_info-1013"><span class="linenos">1013</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpack board information and updates the <code>self.board_info</code>.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string containing packed board information.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="StepperBase.unpack_gains" class="classattr">
                                        <input id="StepperBase.unpack_gains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_gains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.unpack_gains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.unpack_gains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.unpack_gains-1020"><a href="#StepperBase.unpack_gains-1020"><span class="linenos">1020</span></a>    <span class="k">def</span> <span class="nf">unpack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase.unpack_gains-1021"><a href="#StepperBase.unpack_gains-1021"><span class="linenos">1021</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack gains data from a byte string and updates the `self.gains_flash` dictionary.</span>
</span><span id="StepperBase.unpack_gains-1022"><a href="#StepperBase.unpack_gains-1022"><span class="linenos">1022</span></a>
</span><span id="StepperBase.unpack_gains-1023"><a href="#StepperBase.unpack_gains-1023"><span class="linenos">1023</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.unpack_gains-1024"><a href="#StepperBase.unpack_gains-1024"><span class="linenos">1024</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.unpack_gains-1025"><a href="#StepperBase.unpack_gains-1025"><span class="linenos">1025</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase.unpack_gains-1026"><a href="#StepperBase.unpack_gains-1026"><span class="linenos">1026</span></a><span class="sd">            A byte string containing packed gains data.</span>
</span><span id="StepperBase.unpack_gains-1027"><a href="#StepperBase.unpack_gains-1027"><span class="linenos">1027</span></a>
</span><span id="StepperBase.unpack_gains-1028"><a href="#StepperBase.unpack_gains-1028"><span class="linenos">1028</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.unpack_gains-1029"><a href="#StepperBase.unpack_gains-1029"><span class="linenos">1029</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.unpack_gains-1030"><a href="#StepperBase.unpack_gains-1030"><span class="linenos">1030</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.unpack_gains-1031"><a href="#StepperBase.unpack_gains-1031"><span class="linenos">1031</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="StepperBase.unpack_gains-1032"><a href="#StepperBase.unpack_gains-1032"><span class="linenos">1032</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.unpack_gains-1033"><a href="#StepperBase.unpack_gains-1033"><span class="linenos">1033</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.unpack_gains-1034"><a href="#StepperBase.unpack_gains-1034"><span class="linenos">1034</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1035"><a href="#StepperBase.unpack_gains-1035"><span class="linenos">1035</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1036"><a href="#StepperBase.unpack_gains-1036"><span class="linenos">1036</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1037"><a href="#StepperBase.unpack_gains-1037"><span class="linenos">1037</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1038"><a href="#StepperBase.unpack_gains-1038"><span class="linenos">1038</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1039"><a href="#StepperBase.unpack_gains-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1040"><a href="#StepperBase.unpack_gains-1040"><span class="linenos">1040</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1041"><a href="#StepperBase.unpack_gains-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1042"><a href="#StepperBase.unpack_gains-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1043"><a href="#StepperBase.unpack_gains-1043"><span class="linenos">1043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1044"><a href="#StepperBase.unpack_gains-1044"><span class="linenos">1044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1045"><a href="#StepperBase.unpack_gains-1045"><span class="linenos">1045</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1046"><a href="#StepperBase.unpack_gains-1046"><span class="linenos">1046</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1047"><a href="#StepperBase.unpack_gains-1047"><span class="linenos">1047</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1048"><a href="#StepperBase.unpack_gains-1048"><span class="linenos">1048</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1049"><a href="#StepperBase.unpack_gains-1049"><span class="linenos">1049</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1050"><a href="#StepperBase.unpack_gains-1050"><span class="linenos">1050</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1051"><a href="#StepperBase.unpack_gains-1051"><span class="linenos">1051</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1052"><a href="#StepperBase.unpack_gains-1052"><span class="linenos">1052</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1053"><a href="#StepperBase.unpack_gains-1053"><span class="linenos">1053</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-1054"><a href="#StepperBase.unpack_gains-1054"><span class="linenos">1054</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.unpack_gains-1055"><a href="#StepperBase.unpack_gains-1055"><span class="linenos">1055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1056"><a href="#StepperBase.unpack_gains-1056"><span class="linenos">1056</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1057"><a href="#StepperBase.unpack_gains-1057"><span class="linenos">1057</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1058"><a href="#StepperBase.unpack_gains-1058"><span class="linenos">1058</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1059"><a href="#StepperBase.unpack_gains-1059"><span class="linenos">1059</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1060"><a href="#StepperBase.unpack_gains-1060"><span class="linenos">1060</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1061"><a href="#StepperBase.unpack_gains-1061"><span class="linenos">1061</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-1062"><a href="#StepperBase.unpack_gains-1062"><span class="linenos">1062</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpack gains data from a byte string and updates the <code>self.gains_flash</code> dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string containing packed gains data.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="StepperBase.pack_motion_limits" class="classattr">
                                        <input id="StepperBase.pack_motion_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_motion_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_motion_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_motion_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_motion_limits-1064"><a href="#StepperBase.pack_motion_limits-1064"><span class="linenos">1064</span></a>    <span class="k">def</span> <span class="nf">pack_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_motion_limits-1065"><a href="#StepperBase.pack_motion_limits-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs motion limits data starting at index sidx.</span>
</span><span id="StepperBase.pack_motion_limits-1066"><a href="#StepperBase.pack_motion_limits-1066"><span class="linenos">1066</span></a>
</span><span id="StepperBase.pack_motion_limits-1067"><a href="#StepperBase.pack_motion_limits-1067"><span class="linenos">1067</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.pack_motion_limits-1068"><a href="#StepperBase.pack_motion_limits-1068"><span class="linenos">1068</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.pack_motion_limits-1069"><a href="#StepperBase.pack_motion_limits-1069"><span class="linenos">1069</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase.pack_motion_limits-1070"><a href="#StepperBase.pack_motion_limits-1070"><span class="linenos">1070</span></a><span class="sd">            A byte string to which motion limits data will be packed.</span>
</span><span id="StepperBase.pack_motion_limits-1071"><a href="#StepperBase.pack_motion_limits-1071"><span class="linenos">1071</span></a><span class="sd">        </span>
</span><span id="StepperBase.pack_motion_limits-1072"><a href="#StepperBase.pack_motion_limits-1072"><span class="linenos">1072</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase.pack_motion_limits-1073"><a href="#StepperBase.pack_motion_limits-1073"><span class="linenos">1073</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase.pack_motion_limits-1074"><a href="#StepperBase.pack_motion_limits-1074"><span class="linenos">1074</span></a>
</span><span id="StepperBase.pack_motion_limits-1075"><a href="#StepperBase.pack_motion_limits-1075"><span class="linenos">1075</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.pack_motion_limits-1076"><a href="#StepperBase.pack_motion_limits-1076"><span class="linenos">1076</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.pack_motion_limits-1077"><a href="#StepperBase.pack_motion_limits-1077"><span class="linenos">1077</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.pack_motion_limits-1078"><a href="#StepperBase.pack_motion_limits-1078"><span class="linenos">1078</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase.pack_motion_limits-1079"><a href="#StepperBase.pack_motion_limits-1079"><span class="linenos">1079</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.pack_motion_limits-1080"><a href="#StepperBase.pack_motion_limits-1080"><span class="linenos">1080</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase.pack_motion_limits-1081"><a href="#StepperBase.pack_motion_limits-1081"><span class="linenos">1081</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_motion_limits-1082"><a href="#StepperBase.pack_motion_limits-1082"><span class="linenos">1082</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase.pack_motion_limits-1083"><a href="#StepperBase.pack_motion_limits-1083"><span class="linenos">1083</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_motion_limits-1084"><a href="#StepperBase.pack_motion_limits-1084"><span class="linenos">1084</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Packs motion limits data starting at index sidx.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string to which motion limits data will be packed.</p>

<p>sidx : int.
    The starting index in the byte string <code>s</code>.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index of the next unused byte in the byte string <code>s</code> after packing.</p>
</div>


                            </div>
                            <div id="StepperBase.pack_command" class="classattr">
                                        <input id="StepperBase.pack_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_command</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_command-1086"><a href="#StepperBase.pack_command-1086"><span class="linenos">1086</span></a>    <span class="k">def</span> <span class="nf">pack_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_command-1087"><a href="#StepperBase.pack_command-1087"><span class="linenos">1087</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs command data starting at index sidx.</span>
</span><span id="StepperBase.pack_command-1088"><a href="#StepperBase.pack_command-1088"><span class="linenos">1088</span></a>
</span><span id="StepperBase.pack_command-1089"><a href="#StepperBase.pack_command-1089"><span class="linenos">1089</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.pack_command-1090"><a href="#StepperBase.pack_command-1090"><span class="linenos">1090</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.pack_command-1091"><a href="#StepperBase.pack_command-1091"><span class="linenos">1091</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase.pack_command-1092"><a href="#StepperBase.pack_command-1092"><span class="linenos">1092</span></a><span class="sd">            A byte string to which command data will be packed.</span>
</span><span id="StepperBase.pack_command-1093"><a href="#StepperBase.pack_command-1093"><span class="linenos">1093</span></a><span class="sd">        </span>
</span><span id="StepperBase.pack_command-1094"><a href="#StepperBase.pack_command-1094"><span class="linenos">1094</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase.pack_command-1095"><a href="#StepperBase.pack_command-1095"><span class="linenos">1095</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase.pack_command-1096"><a href="#StepperBase.pack_command-1096"><span class="linenos">1096</span></a>
</span><span id="StepperBase.pack_command-1097"><a href="#StepperBase.pack_command-1097"><span class="linenos">1097</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.pack_command-1098"><a href="#StepperBase.pack_command-1098"><span class="linenos">1098</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.pack_command-1099"><a href="#StepperBase.pack_command-1099"><span class="linenos">1099</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.pack_command-1100"><a href="#StepperBase.pack_command-1100"><span class="linenos">1100</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase.pack_command-1101"><a href="#StepperBase.pack_command-1101"><span class="linenos">1101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.pack_command-1102"><a href="#StepperBase.pack_command-1102"><span class="linenos">1102</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1103"><a href="#StepperBase.pack_command-1103"><span class="linenos">1103</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.pack_command-1104"><a href="#StepperBase.pack_command-1104"><span class="linenos">1104</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1105"><a href="#StepperBase.pack_command-1105"><span class="linenos">1105</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1106"><a href="#StepperBase.pack_command-1106"><span class="linenos">1106</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1107"><a href="#StepperBase.pack_command-1107"><span class="linenos">1107</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1108"><a href="#StepperBase.pack_command-1108"><span class="linenos">1108</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1109"><a href="#StepperBase.pack_command-1109"><span class="linenos">1109</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1110"><a href="#StepperBase.pack_command-1110"><span class="linenos">1110</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1111"><a href="#StepperBase.pack_command-1111"><span class="linenos">1111</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1112"><a href="#StepperBase.pack_command-1112"><span class="linenos">1112</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1113"><a href="#StepperBase.pack_command-1113"><span class="linenos">1113</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1114"><a href="#StepperBase.pack_command-1114"><span class="linenos">1114</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1115"><a href="#StepperBase.pack_command-1115"><span class="linenos">1115</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1116"><a href="#StepperBase.pack_command-1116"><span class="linenos">1116</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1117"><a href="#StepperBase.pack_command-1117"><span class="linenos">1117</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-1118"><a href="#StepperBase.pack_command-1118"><span class="linenos">1118</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-1119"><a href="#StepperBase.pack_command-1119"><span class="linenos">1119</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.pack_command-1120"><a href="#StepperBase.pack_command-1120"><span class="linenos">1120</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Packs command data starting at index sidx.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string to which command data will be packed.</p>

<p>sidx : int.
    The starting index in the byte string <code>s</code>.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index of the next unused byte in the byte string <code>s</code> after packing.</p>
</div>


                            </div>
                            <div id="StepperBase.pack_gains" class="classattr">
                                        <input id="StepperBase.pack_gains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_gains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_gains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_gains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_gains-1122"><a href="#StepperBase.pack_gains-1122"><span class="linenos">1122</span></a>    <span class="k">def</span> <span class="nf">pack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_gains-1123"><a href="#StepperBase.pack_gains-1123"><span class="linenos">1123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs gains data starting at index sidx.</span>
</span><span id="StepperBase.pack_gains-1124"><a href="#StepperBase.pack_gains-1124"><span class="linenos">1124</span></a>
</span><span id="StepperBase.pack_gains-1125"><a href="#StepperBase.pack_gains-1125"><span class="linenos">1125</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.pack_gains-1126"><a href="#StepperBase.pack_gains-1126"><span class="linenos">1126</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.pack_gains-1127"><a href="#StepperBase.pack_gains-1127"><span class="linenos">1127</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase.pack_gains-1128"><a href="#StepperBase.pack_gains-1128"><span class="linenos">1128</span></a><span class="sd">            A byte string to which gains data will be packed.</span>
</span><span id="StepperBase.pack_gains-1129"><a href="#StepperBase.pack_gains-1129"><span class="linenos">1129</span></a><span class="sd">        </span>
</span><span id="StepperBase.pack_gains-1130"><a href="#StepperBase.pack_gains-1130"><span class="linenos">1130</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase.pack_gains-1131"><a href="#StepperBase.pack_gains-1131"><span class="linenos">1131</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase.pack_gains-1132"><a href="#StepperBase.pack_gains-1132"><span class="linenos">1132</span></a>
</span><span id="StepperBase.pack_gains-1133"><a href="#StepperBase.pack_gains-1133"><span class="linenos">1133</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.pack_gains-1134"><a href="#StepperBase.pack_gains-1134"><span class="linenos">1134</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.pack_gains-1135"><a href="#StepperBase.pack_gains-1135"><span class="linenos">1135</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.pack_gains-1136"><a href="#StepperBase.pack_gains-1136"><span class="linenos">1136</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase.pack_gains-1137"><a href="#StepperBase.pack_gains-1137"><span class="linenos">1137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.pack_gains-1138"><a href="#StepperBase.pack_gains-1138"><span class="linenos">1138</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1139"><a href="#StepperBase.pack_gains-1139"><span class="linenos">1139</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1140"><a href="#StepperBase.pack_gains-1140"><span class="linenos">1140</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1141"><a href="#StepperBase.pack_gains-1141"><span class="linenos">1141</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1142"><a href="#StepperBase.pack_gains-1142"><span class="linenos">1142</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1143"><a href="#StepperBase.pack_gains-1143"><span class="linenos">1143</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1144"><a href="#StepperBase.pack_gains-1144"><span class="linenos">1144</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1145"><a href="#StepperBase.pack_gains-1145"><span class="linenos">1145</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1146"><a href="#StepperBase.pack_gains-1146"><span class="linenos">1146</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1147"><a href="#StepperBase.pack_gains-1147"><span class="linenos">1147</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1148"><a href="#StepperBase.pack_gains-1148"><span class="linenos">1148</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1149"><a href="#StepperBase.pack_gains-1149"><span class="linenos">1149</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1150"><a href="#StepperBase.pack_gains-1150"><span class="linenos">1150</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1151"><a href="#StepperBase.pack_gains-1151"><span class="linenos">1151</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1152"><a href="#StepperBase.pack_gains-1152"><span class="linenos">1152</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1153"><a href="#StepperBase.pack_gains-1153"><span class="linenos">1153</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1154"><a href="#StepperBase.pack_gains-1154"><span class="linenos">1154</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1155"><a href="#StepperBase.pack_gains-1155"><span class="linenos">1155</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1156"><a href="#StepperBase.pack_gains-1156"><span class="linenos">1156</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1157"><a href="#StepperBase.pack_gains-1157"><span class="linenos">1157</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-1158"><a href="#StepperBase.pack_gains-1158"><span class="linenos">1158</span></a>        <span class="n">config</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.pack_gains-1159"><a href="#StepperBase.pack_gains-1159"><span class="linenos">1159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1160"><a href="#StepperBase.pack_gains-1160"><span class="linenos">1160</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span>
</span><span id="StepperBase.pack_gains-1161"><a href="#StepperBase.pack_gains-1161"><span class="linenos">1161</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1162"><a href="#StepperBase.pack_gains-1162"><span class="linenos">1162</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span>
</span><span id="StepperBase.pack_gains-1163"><a href="#StepperBase.pack_gains-1163"><span class="linenos">1163</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1164"><a href="#StepperBase.pack_gains-1164"><span class="linenos">1164</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span>
</span><span id="StepperBase.pack_gains-1165"><a href="#StepperBase.pack_gains-1165"><span class="linenos">1165</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1166"><a href="#StepperBase.pack_gains-1166"><span class="linenos">1166</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span>
</span><span id="StepperBase.pack_gains-1167"><a href="#StepperBase.pack_gains-1167"><span class="linenos">1167</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1168"><a href="#StepperBase.pack_gains-1168"><span class="linenos">1168</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span>
</span><span id="StepperBase.pack_gains-1169"><a href="#StepperBase.pack_gains-1169"><span class="linenos">1169</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1170"><a href="#StepperBase.pack_gains-1170"><span class="linenos">1170</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span>
</span><span id="StepperBase.pack_gains-1171"><a href="#StepperBase.pack_gains-1171"><span class="linenos">1171</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-1172"><a href="#StepperBase.pack_gains-1172"><span class="linenos">1172</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span>
</span><span id="StepperBase.pack_gains-1173"><a href="#StepperBase.pack_gains-1173"><span class="linenos">1173</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.pack_gains-1174"><a href="#StepperBase.pack_gains-1174"><span class="linenos">1174</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Packs gains data starting at index sidx.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string to which gains data will be packed.</p>

<p>sidx : int.
    The starting index in the byte string <code>s</code>.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index of the next unused byte in the byte string <code>s</code> after packing.</p>
</div>


                            </div>
                            <div id="StepperBase.pack_trigger" class="classattr">
                                        <input id="StepperBase.pack_trigger-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_trigger</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_trigger-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_trigger"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_trigger-1176"><a href="#StepperBase.pack_trigger-1176"><span class="linenos">1176</span></a>    <span class="k">def</span> <span class="nf">pack_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_trigger-1177"><a href="#StepperBase.pack_trigger-1177"><span class="linenos">1177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs trigger data starting at index sidx.</span>
</span><span id="StepperBase.pack_trigger-1178"><a href="#StepperBase.pack_trigger-1178"><span class="linenos">1178</span></a>
</span><span id="StepperBase.pack_trigger-1179"><a href="#StepperBase.pack_trigger-1179"><span class="linenos">1179</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.pack_trigger-1180"><a href="#StepperBase.pack_trigger-1180"><span class="linenos">1180</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.pack_trigger-1181"><a href="#StepperBase.pack_trigger-1181"><span class="linenos">1181</span></a><span class="sd">        s : bytes.</span>
</span><span id="StepperBase.pack_trigger-1182"><a href="#StepperBase.pack_trigger-1182"><span class="linenos">1182</span></a><span class="sd">            A byte string to which trigger data will be packed.</span>
</span><span id="StepperBase.pack_trigger-1183"><a href="#StepperBase.pack_trigger-1183"><span class="linenos">1183</span></a><span class="sd">        sidx : int.</span>
</span><span id="StepperBase.pack_trigger-1184"><a href="#StepperBase.pack_trigger-1184"><span class="linenos">1184</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="StepperBase.pack_trigger-1185"><a href="#StepperBase.pack_trigger-1185"><span class="linenos">1185</span></a>
</span><span id="StepperBase.pack_trigger-1186"><a href="#StepperBase.pack_trigger-1186"><span class="linenos">1186</span></a><span class="sd">        Returns</span>
</span><span id="StepperBase.pack_trigger-1187"><a href="#StepperBase.pack_trigger-1187"><span class="linenos">1187</span></a><span class="sd">        -------</span>
</span><span id="StepperBase.pack_trigger-1188"><a href="#StepperBase.pack_trigger-1188"><span class="linenos">1188</span></a><span class="sd">        int:</span>
</span><span id="StepperBase.pack_trigger-1189"><a href="#StepperBase.pack_trigger-1189"><span class="linenos">1189</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="StepperBase.pack_trigger-1190"><a href="#StepperBase.pack_trigger-1190"><span class="linenos">1190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.pack_trigger-1191"><a href="#StepperBase.pack_trigger-1191"><span class="linenos">1191</span></a>        <span class="n">pack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">)</span>
</span><span id="StepperBase.pack_trigger-1192"><a href="#StepperBase.pack_trigger-1192"><span class="linenos">1192</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_trigger-1193"><a href="#StepperBase.pack_trigger-1193"><span class="linenos">1193</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="p">)</span>
</span><span id="StepperBase.pack_trigger-1194"><a href="#StepperBase.pack_trigger-1194"><span class="linenos">1194</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_trigger-1195"><a href="#StepperBase.pack_trigger-1195"><span class="linenos">1195</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Packs trigger data starting at index sidx.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string to which trigger data will be packed.
sidx : int.
    The starting index in the byte string <code>s</code>.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index of the next unused byte in the byte string <code>s</code> after packing.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_board_info_reply" class="classattr">
                                        <input id="StepperBase.rpc_board_info_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_board_info_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_board_info_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_board_info_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_board_info_reply-1201"><a href="#StepperBase.rpc_board_info_reply-1201"><span class="linenos">1201</span></a>    <span class="k">def</span> <span class="nf">rpc_board_info_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_board_info_reply-1202"><a href="#StepperBase.rpc_board_info_reply-1202"><span class="linenos">1202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for board information.</span>
</span><span id="StepperBase.rpc_board_info_reply-1203"><a href="#StepperBase.rpc_board_info_reply-1203"><span class="linenos">1203</span></a>
</span><span id="StepperBase.rpc_board_info_reply-1204"><a href="#StepperBase.rpc_board_info_reply-1204"><span class="linenos">1204</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_board_info_reply-1205"><a href="#StepperBase.rpc_board_info_reply-1205"><span class="linenos">1205</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_board_info_reply-1206"><a href="#StepperBase.rpc_board_info_reply-1206"><span class="linenos">1206</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_board_info_reply-1207"><a href="#StepperBase.rpc_board_info_reply-1207"><span class="linenos">1207</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_board_info_reply-1208"><a href="#StepperBase.rpc_board_info_reply-1208"><span class="linenos">1208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_board_info_reply-1209"><a href="#StepperBase.rpc_board_info_reply-1209"><span class="linenos">1209</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span><span class="p">:</span>
</span><span id="StepperBase.rpc_board_info_reply-1210"><a href="#StepperBase.rpc_board_info_reply-1210"><span class="linenos">1210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unpack_board_info</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase.rpc_board_info_reply-1211"><a href="#StepperBase.rpc_board_info_reply-1211"><span class="linenos">1211</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.rpc_board_info_reply-1212"><a href="#StepperBase.rpc_board_info_reply-1212"><span class="linenos">1212</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STEPPER_BOARD_INFO&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for board information.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_gains_reply" class="classattr">
                                        <input id="StepperBase.rpc_gains_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_gains_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_gains_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_gains_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_gains_reply-1214"><a href="#StepperBase.rpc_gains_reply-1214"><span class="linenos">1214</span></a>    <span class="k">def</span> <span class="nf">rpc_gains_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_gains_reply-1215"><a href="#StepperBase.rpc_gains_reply-1215"><span class="linenos">1215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for gains.</span>
</span><span id="StepperBase.rpc_gains_reply-1216"><a href="#StepperBase.rpc_gains_reply-1216"><span class="linenos">1216</span></a>
</span><span id="StepperBase.rpc_gains_reply-1217"><a href="#StepperBase.rpc_gains_reply-1217"><span class="linenos">1217</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_gains_reply-1218"><a href="#StepperBase.rpc_gains_reply-1218"><span class="linenos">1218</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_gains_reply-1219"><a href="#StepperBase.rpc_gains_reply-1219"><span class="linenos">1219</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_gains_reply-1220"><a href="#StepperBase.rpc_gains_reply-1220"><span class="linenos">1220</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_gains_reply-1221"><a href="#StepperBase.rpc_gains_reply-1221"><span class="linenos">1221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_gains_reply-1222"><a href="#StepperBase.rpc_gains_reply-1222"><span class="linenos">1222</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_GAINS</span><span class="p">:</span>
</span><span id="StepperBase.rpc_gains_reply-1223"><a href="#StepperBase.rpc_gains_reply-1223"><span class="linenos">1223</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_GAINS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for gains.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_trigger_reply" class="classattr">
                                        <input id="StepperBase.rpc_trigger_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_trigger_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_trigger_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_trigger_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_trigger_reply-1225"><a href="#StepperBase.rpc_trigger_reply-1225"><span class="linenos">1225</span></a>    <span class="k">def</span> <span class="nf">rpc_trigger_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_trigger_reply-1226"><a href="#StepperBase.rpc_trigger_reply-1226"><span class="linenos">1226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for trigger.</span>
</span><span id="StepperBase.rpc_trigger_reply-1227"><a href="#StepperBase.rpc_trigger_reply-1227"><span class="linenos">1227</span></a>
</span><span id="StepperBase.rpc_trigger_reply-1228"><a href="#StepperBase.rpc_trigger_reply-1228"><span class="linenos">1228</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_trigger_reply-1229"><a href="#StepperBase.rpc_trigger_reply-1229"><span class="linenos">1229</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_trigger_reply-1230"><a href="#StepperBase.rpc_trigger_reply-1230"><span class="linenos">1230</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_trigger_reply-1231"><a href="#StepperBase.rpc_trigger_reply-1231"><span class="linenos">1231</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_trigger_reply-1232"><a href="#StepperBase.rpc_trigger_reply-1232"><span class="linenos">1232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_trigger_reply-1233"><a href="#StepperBase.rpc_trigger_reply-1233"><span class="linenos">1233</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_TRIGGER</span><span class="p">:</span>
</span><span id="StepperBase.rpc_trigger_reply-1234"><a href="#StepperBase.rpc_trigger_reply-1234"><span class="linenos">1234</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_SET_TRIGGER&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for trigger.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_command_reply" class="classattr">
                                        <input id="StepperBase.rpc_command_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_command_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_command_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_command_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_command_reply-1236"><a href="#StepperBase.rpc_command_reply-1236"><span class="linenos">1236</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_command_reply-1237"><a href="#StepperBase.rpc_command_reply-1237"><span class="linenos">1237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for command.</span>
</span><span id="StepperBase.rpc_command_reply-1238"><a href="#StepperBase.rpc_command_reply-1238"><span class="linenos">1238</span></a>
</span><span id="StepperBase.rpc_command_reply-1239"><a href="#StepperBase.rpc_command_reply-1239"><span class="linenos">1239</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_command_reply-1240"><a href="#StepperBase.rpc_command_reply-1240"><span class="linenos">1240</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_command_reply-1241"><a href="#StepperBase.rpc_command_reply-1241"><span class="linenos">1241</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_command_reply-1242"><a href="#StepperBase.rpc_command_reply-1242"><span class="linenos">1242</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_command_reply-1243"><a href="#StepperBase.rpc_command_reply-1243"><span class="linenos">1243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_command_reply-1244"><a href="#StepperBase.rpc_command_reply-1244"><span class="linenos">1244</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="StepperBase.rpc_command_reply-1245"><a href="#StepperBase.rpc_command_reply-1245"><span class="linenos">1245</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for command.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_motion_limits_reply" class="classattr">
                                        <input id="StepperBase.rpc_motion_limits_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_motion_limits_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_motion_limits_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_motion_limits_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_motion_limits_reply-1247"><a href="#StepperBase.rpc_motion_limits_reply-1247"><span class="linenos">1247</span></a>    <span class="k">def</span> <span class="nf">rpc_motion_limits_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1248"><a href="#StepperBase.rpc_motion_limits_reply-1248"><span class="linenos">1248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for motion limits.</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1249"><a href="#StepperBase.rpc_motion_limits_reply-1249"><span class="linenos">1249</span></a>
</span><span id="StepperBase.rpc_motion_limits_reply-1250"><a href="#StepperBase.rpc_motion_limits_reply-1250"><span class="linenos">1250</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1251"><a href="#StepperBase.rpc_motion_limits_reply-1251"><span class="linenos">1251</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1252"><a href="#StepperBase.rpc_motion_limits_reply-1252"><span class="linenos">1252</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1253"><a href="#StepperBase.rpc_motion_limits_reply-1253"><span class="linenos">1253</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1254"><a href="#StepperBase.rpc_motion_limits_reply-1254"><span class="linenos">1254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1255"><a href="#StepperBase.rpc_motion_limits_reply-1255"><span class="linenos">1255</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MOTION_LIMITS</span><span class="p">:</span>
</span><span id="StepperBase.rpc_motion_limits_reply-1256"><a href="#StepperBase.rpc_motion_limits_reply-1256"><span class="linenos">1256</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MOTION_LIMITS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for motion limits.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_menu_on_reply" class="classattr">
                                        <input id="StepperBase.rpc_menu_on_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_menu_on_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_menu_on_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_menu_on_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_menu_on_reply-1258"><a href="#StepperBase.rpc_menu_on_reply-1258"><span class="linenos">1258</span></a>    <span class="k">def</span> <span class="nf">rpc_menu_on_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_menu_on_reply-1259"><a href="#StepperBase.rpc_menu_on_reply-1259"><span class="linenos">1259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for menu activation.</span>
</span><span id="StepperBase.rpc_menu_on_reply-1260"><a href="#StepperBase.rpc_menu_on_reply-1260"><span class="linenos">1260</span></a>
</span><span id="StepperBase.rpc_menu_on_reply-1261"><a href="#StepperBase.rpc_menu_on_reply-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_menu_on_reply-1262"><a href="#StepperBase.rpc_menu_on_reply-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_menu_on_reply-1263"><a href="#StepperBase.rpc_menu_on_reply-1263"><span class="linenos">1263</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_menu_on_reply-1264"><a href="#StepperBase.rpc_menu_on_reply-1264"><span class="linenos">1264</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_menu_on_reply-1265"><a href="#StepperBase.rpc_menu_on_reply-1265"><span class="linenos">1265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_menu_on_reply-1266"><a href="#StepperBase.rpc_menu_on_reply-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MENU_ON</span><span class="p">:</span>
</span><span id="StepperBase.rpc_menu_on_reply-1267"><a href="#StepperBase.rpc_menu_on_reply-1267"><span class="linenos">1267</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MENU_ON&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for menu activation.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_status_reply" class="classattr">
                                        <input id="StepperBase.rpc_status_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_status_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_status_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_status_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_status_reply-1269"><a href="#StepperBase.rpc_status_reply-1269"><span class="linenos">1269</span></a>    <span class="k">def</span> <span class="nf">rpc_status_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_status_reply-1270"><a href="#StepperBase.rpc_status_reply-1270"><span class="linenos">1270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for status.</span>
</span><span id="StepperBase.rpc_status_reply-1271"><a href="#StepperBase.rpc_status_reply-1271"><span class="linenos">1271</span></a>
</span><span id="StepperBase.rpc_status_reply-1272"><a href="#StepperBase.rpc_status_reply-1272"><span class="linenos">1272</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_status_reply-1273"><a href="#StepperBase.rpc_status_reply-1273"><span class="linenos">1273</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_status_reply-1274"><a href="#StepperBase.rpc_status_reply-1274"><span class="linenos">1274</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_status_reply-1275"><a href="#StepperBase.rpc_status_reply-1275"><span class="linenos">1275</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_status_reply-1276"><a href="#StepperBase.rpc_status_reply-1276"><span class="linenos">1276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_status_reply-1277"><a href="#StepperBase.rpc_status_reply-1277"><span class="linenos">1277</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS</span><span class="p">:</span>
</span><span id="StepperBase.rpc_status_reply-1278"><a href="#StepperBase.rpc_status_reply-1278"><span class="linenos">1278</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase.rpc_status_reply-1279"><a href="#StepperBase.rpc_status_reply-1279"><span class="linenos">1279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.rpc_status_reply-1280"><a href="#StepperBase.rpc_status_reply-1280"><span class="linenos">1280</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for status.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div id="StepperBase.rpc_read_gains_from_flash_reply" class="classattr">
                                        <input id="StepperBase.rpc_read_gains_from_flash_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_read_gains_from_flash_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_read_gains_from_flash_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_read_gains_from_flash_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_read_gains_from_flash_reply-1282"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1282"><span class="linenos">1282</span></a>    <span class="k">def</span> <span class="nf">rpc_read_gains_from_flash_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1283"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1283"><span class="linenos">1283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the RPC reply for reading gains from flash.</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1284"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1284"><span class="linenos">1284</span></a>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1285"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1285"><span class="linenos">1285</span></a><span class="sd">        Parameters</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1286"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1286"><span class="linenos">1286</span></a><span class="sd">        ----------</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1287"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1287"><span class="linenos">1287</span></a><span class="sd">        reply : list.</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1288"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1288"><span class="linenos">1288</span></a><span class="sd">            The reply message.</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1289"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1289"><span class="linenos">1289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1290"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span><span class="p">:</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1291"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1291"><span class="linenos">1291</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_gains</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1292"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1292"><span class="linenos">1292</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-1293"><a href="#StepperBase.rpc_read_gains_from_flash_reply-1293"><span class="linenos">1293</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_GAINS_FROM_FLASH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the RPC reply for reading gains from flash.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply message.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="StepperBase.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="StepperBase.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="StepperBase.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="StepperBase.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="StepperBase.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="StepperBase.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="StepperBase.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="StepperBase.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="StepperBase.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="StepperBase.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="StepperBase.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="StepperBase.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="StepperBase.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P0">
                            <input id="Stepper_Protocol_P0-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P0</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P0-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P0"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P0-1335"><a href="#Stepper_Protocol_P0-1335"><span class="linenos">1335</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P0</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0-1336"><a href="#Stepper_Protocol_P0-1336"><span class="linenos">1336</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0-1337"><a href="#Stepper_Protocol_P0-1337"><span class="linenos">1337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack status information and udpates `self.status` dictionary.</span>
</span><span id="Stepper_Protocol_P0-1338"><a href="#Stepper_Protocol_P0-1338"><span class="linenos">1338</span></a>
</span><span id="Stepper_Protocol_P0-1339"><a href="#Stepper_Protocol_P0-1339"><span class="linenos">1339</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P0-1340"><a href="#Stepper_Protocol_P0-1340"><span class="linenos">1340</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P0-1341"><a href="#Stepper_Protocol_P0-1341"><span class="linenos">1341</span></a><span class="sd">        s : bytes</span>
</span><span id="Stepper_Protocol_P0-1342"><a href="#Stepper_Protocol_P0-1342"><span class="linenos">1342</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="Stepper_Protocol_P0-1343"><a href="#Stepper_Protocol_P0-1343"><span class="linenos">1343</span></a>
</span><span id="Stepper_Protocol_P0-1344"><a href="#Stepper_Protocol_P0-1344"><span class="linenos">1344</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P0-1345"><a href="#Stepper_Protocol_P0-1345"><span class="linenos">1345</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P0-1346"><a href="#Stepper_Protocol_P0-1346"><span class="linenos">1346</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P0-1347"><a href="#Stepper_Protocol_P0-1347"><span class="linenos">1347</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P0-1348"><a href="#Stepper_Protocol_P0-1348"><span class="linenos">1348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P0-1349"><a href="#Stepper_Protocol_P0-1349"><span class="linenos">1349</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1350"><a href="#Stepper_Protocol_P0-1350"><span class="linenos">1350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P0-1351"><a href="#Stepper_Protocol_P0-1351"><span class="linenos">1351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1352"><a href="#Stepper_Protocol_P0-1352"><span class="linenos">1352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1353"><a href="#Stepper_Protocol_P0-1353"><span class="linenos">1353</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1354"><a href="#Stepper_Protocol_P0-1354"><span class="linenos">1354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P0-1355"><a href="#Stepper_Protocol_P0-1355"><span class="linenos">1355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1356"><a href="#Stepper_Protocol_P0-1356"><span class="linenos">1356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1357"><a href="#Stepper_Protocol_P0-1357"><span class="linenos">1357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1358"><a href="#Stepper_Protocol_P0-1358"><span class="linenos">1358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1359"><a href="#Stepper_Protocol_P0-1359"><span class="linenos">1359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1360"><a href="#Stepper_Protocol_P0-1360"><span class="linenos">1360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-1361"><a href="#Stepper_Protocol_P0-1361"><span class="linenos">1361</span></a>
</span><span id="Stepper_Protocol_P0-1362"><a href="#Stepper_Protocol_P0-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1363"><a href="#Stepper_Protocol_P0-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1364"><a href="#Stepper_Protocol_P0-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1365"><a href="#Stepper_Protocol_P0-1365"><span class="linenos">1365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1366"><a href="#Stepper_Protocol_P0-1366"><span class="linenos">1366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1367"><a href="#Stepper_Protocol_P0-1367"><span class="linenos">1367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1368"><a href="#Stepper_Protocol_P0-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1369"><a href="#Stepper_Protocol_P0-1369"><span class="linenos">1369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1370"><a href="#Stepper_Protocol_P0-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1371"><a href="#Stepper_Protocol_P0-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1372"><a href="#Stepper_Protocol_P0-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1373"><a href="#Stepper_Protocol_P0-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-1374"><a href="#Stepper_Protocol_P0-1374"><span class="linenos">1374</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P0-1375"><a href="#Stepper_Protocol_P0-1375"><span class="linenos">1375</span></a>
</span><span id="Stepper_Protocol_P0-1376"><a href="#Stepper_Protocol_P0-1376"><span class="linenos">1376</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0-1377"><a href="#Stepper_Protocol_P0-1377"><span class="linenos">1377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a readable representation of the robot&#39;s status</span>
</span><span id="Stepper_Protocol_P0-1378"><a href="#Stepper_Protocol_P0-1378"><span class="linenos">1378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P0-1379"><a href="#Stepper_Protocol_P0-1379"><span class="linenos">1379</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P0-1380"><a href="#Stepper_Protocol_P0-1380"><span class="linenos">1380</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P0-1381"><a href="#Stepper_Protocol_P0-1381"><span class="linenos">1381</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-1382"><a href="#Stepper_Protocol_P0-1382"><span class="linenos">1382</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-1383"><a href="#Stepper_Protocol_P0-1383"><span class="linenos">1383</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-1384"><a href="#Stepper_Protocol_P0-1384"><span class="linenos">1384</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1385"><a href="#Stepper_Protocol_P0-1385"><span class="linenos">1385</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1386"><a href="#Stepper_Protocol_P0-1386"><span class="linenos">1386</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-1387"><a href="#Stepper_Protocol_P0-1387"><span class="linenos">1387</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-1388"><a href="#Stepper_Protocol_P0-1388"><span class="linenos">1388</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1389"><a href="#Stepper_Protocol_P0-1389"><span class="linenos">1389</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1390"><a href="#Stepper_Protocol_P0-1390"><span class="linenos">1390</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1391"><a href="#Stepper_Protocol_P0-1391"><span class="linenos">1391</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-1392"><a href="#Stepper_Protocol_P0-1392"><span class="linenos">1392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1393"><a href="#Stepper_Protocol_P0-1393"><span class="linenos">1393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1394"><a href="#Stepper_Protocol_P0-1394"><span class="linenos">1394</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P0-1395"><a href="#Stepper_Protocol_P0-1395"><span class="linenos">1395</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1396"><a href="#Stepper_Protocol_P0-1396"><span class="linenos">1396</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1397"><a href="#Stepper_Protocol_P0-1397"><span class="linenos">1397</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1398"><a href="#Stepper_Protocol_P0-1398"><span class="linenos">1398</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1399"><a href="#Stepper_Protocol_P0-1399"><span class="linenos">1399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1400"><a href="#Stepper_Protocol_P0-1400"><span class="linenos">1400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1401"><a href="#Stepper_Protocol_P0-1401"><span class="linenos">1401</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1402"><a href="#Stepper_Protocol_P0-1402"><span class="linenos">1402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1403"><a href="#Stepper_Protocol_P0-1403"><span class="linenos">1403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1404"><a href="#Stepper_Protocol_P0-1404"><span class="linenos">1404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1405"><a href="#Stepper_Protocol_P0-1405"><span class="linenos">1405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1406"><a href="#Stepper_Protocol_P0-1406"><span class="linenos">1406</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1407"><a href="#Stepper_Protocol_P0-1407"><span class="linenos">1407</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1408"><a href="#Stepper_Protocol_P0-1408"><span class="linenos">1408</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1409"><a href="#Stepper_Protocol_P0-1409"><span class="linenos">1409</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P0-1410"><a href="#Stepper_Protocol_P0-1410"><span class="linenos">1410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-1411"><a href="#Stepper_Protocol_P0-1411"><span class="linenos">1411</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P0.unpack_status" class="classattr">
                                        <input id="Stepper_Protocol_P0.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P0.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P0.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P0.unpack_status-1336"><a href="#Stepper_Protocol_P0.unpack_status-1336"><span class="linenos">1336</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1337"><a href="#Stepper_Protocol_P0.unpack_status-1337"><span class="linenos">1337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack status information and udpates `self.status` dictionary.</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1338"><a href="#Stepper_Protocol_P0.unpack_status-1338"><span class="linenos">1338</span></a>
</span><span id="Stepper_Protocol_P0.unpack_status-1339"><a href="#Stepper_Protocol_P0.unpack_status-1339"><span class="linenos">1339</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1340"><a href="#Stepper_Protocol_P0.unpack_status-1340"><span class="linenos">1340</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1341"><a href="#Stepper_Protocol_P0.unpack_status-1341"><span class="linenos">1341</span></a><span class="sd">        s : bytes</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1342"><a href="#Stepper_Protocol_P0.unpack_status-1342"><span class="linenos">1342</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1343"><a href="#Stepper_Protocol_P0.unpack_status-1343"><span class="linenos">1343</span></a>
</span><span id="Stepper_Protocol_P0.unpack_status-1344"><a href="#Stepper_Protocol_P0.unpack_status-1344"><span class="linenos">1344</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1345"><a href="#Stepper_Protocol_P0.unpack_status-1345"><span class="linenos">1345</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1346"><a href="#Stepper_Protocol_P0.unpack_status-1346"><span class="linenos">1346</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1347"><a href="#Stepper_Protocol_P0.unpack_status-1347"><span class="linenos">1347</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1348"><a href="#Stepper_Protocol_P0.unpack_status-1348"><span class="linenos">1348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1349"><a href="#Stepper_Protocol_P0.unpack_status-1349"><span class="linenos">1349</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1350"><a href="#Stepper_Protocol_P0.unpack_status-1350"><span class="linenos">1350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1351"><a href="#Stepper_Protocol_P0.unpack_status-1351"><span class="linenos">1351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1352"><a href="#Stepper_Protocol_P0.unpack_status-1352"><span class="linenos">1352</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1353"><a href="#Stepper_Protocol_P0.unpack_status-1353"><span class="linenos">1353</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1354"><a href="#Stepper_Protocol_P0.unpack_status-1354"><span class="linenos">1354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1355"><a href="#Stepper_Protocol_P0.unpack_status-1355"><span class="linenos">1355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1356"><a href="#Stepper_Protocol_P0.unpack_status-1356"><span class="linenos">1356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1357"><a href="#Stepper_Protocol_P0.unpack_status-1357"><span class="linenos">1357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1358"><a href="#Stepper_Protocol_P0.unpack_status-1358"><span class="linenos">1358</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1359"><a href="#Stepper_Protocol_P0.unpack_status-1359"><span class="linenos">1359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1360"><a href="#Stepper_Protocol_P0.unpack_status-1360"><span class="linenos">1360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1361"><a href="#Stepper_Protocol_P0.unpack_status-1361"><span class="linenos">1361</span></a>
</span><span id="Stepper_Protocol_P0.unpack_status-1362"><a href="#Stepper_Protocol_P0.unpack_status-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1363"><a href="#Stepper_Protocol_P0.unpack_status-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1364"><a href="#Stepper_Protocol_P0.unpack_status-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1365"><a href="#Stepper_Protocol_P0.unpack_status-1365"><span class="linenos">1365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1366"><a href="#Stepper_Protocol_P0.unpack_status-1366"><span class="linenos">1366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1367"><a href="#Stepper_Protocol_P0.unpack_status-1367"><span class="linenos">1367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1368"><a href="#Stepper_Protocol_P0.unpack_status-1368"><span class="linenos">1368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1369"><a href="#Stepper_Protocol_P0.unpack_status-1369"><span class="linenos">1369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1370"><a href="#Stepper_Protocol_P0.unpack_status-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1371"><a href="#Stepper_Protocol_P0.unpack_status-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1372"><a href="#Stepper_Protocol_P0.unpack_status-1372"><span class="linenos">1372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1373"><a href="#Stepper_Protocol_P0.unpack_status-1373"><span class="linenos">1373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-1374"><a href="#Stepper_Protocol_P0.unpack_status-1374"><span class="linenos">1374</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpack status information and udpates <code>self.status</code> dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes
    A byte string containing packed status data.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P0.pretty_print" class="classattr">
                                        <input id="Stepper_Protocol_P0.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P0.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P0.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P0.pretty_print-1376"><a href="#Stepper_Protocol_P0.pretty_print-1376"><span class="linenos">1376</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1377"><a href="#Stepper_Protocol_P0.pretty_print-1377"><span class="linenos">1377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a readable representation of the robot&#39;s status</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1378"><a href="#Stepper_Protocol_P0.pretty_print-1378"><span class="linenos">1378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1379"><a href="#Stepper_Protocol_P0.pretty_print-1379"><span class="linenos">1379</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1380"><a href="#Stepper_Protocol_P0.pretty_print-1380"><span class="linenos">1380</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1381"><a href="#Stepper_Protocol_P0.pretty_print-1381"><span class="linenos">1381</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1382"><a href="#Stepper_Protocol_P0.pretty_print-1382"><span class="linenos">1382</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1383"><a href="#Stepper_Protocol_P0.pretty_print-1383"><span class="linenos">1383</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1384"><a href="#Stepper_Protocol_P0.pretty_print-1384"><span class="linenos">1384</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1385"><a href="#Stepper_Protocol_P0.pretty_print-1385"><span class="linenos">1385</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1386"><a href="#Stepper_Protocol_P0.pretty_print-1386"><span class="linenos">1386</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1387"><a href="#Stepper_Protocol_P0.pretty_print-1387"><span class="linenos">1387</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1388"><a href="#Stepper_Protocol_P0.pretty_print-1388"><span class="linenos">1388</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1389"><a href="#Stepper_Protocol_P0.pretty_print-1389"><span class="linenos">1389</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1390"><a href="#Stepper_Protocol_P0.pretty_print-1390"><span class="linenos">1390</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1391"><a href="#Stepper_Protocol_P0.pretty_print-1391"><span class="linenos">1391</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1392"><a href="#Stepper_Protocol_P0.pretty_print-1392"><span class="linenos">1392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1393"><a href="#Stepper_Protocol_P0.pretty_print-1393"><span class="linenos">1393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1394"><a href="#Stepper_Protocol_P0.pretty_print-1394"><span class="linenos">1394</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1395"><a href="#Stepper_Protocol_P0.pretty_print-1395"><span class="linenos">1395</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1396"><a href="#Stepper_Protocol_P0.pretty_print-1396"><span class="linenos">1396</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1397"><a href="#Stepper_Protocol_P0.pretty_print-1397"><span class="linenos">1397</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1398"><a href="#Stepper_Protocol_P0.pretty_print-1398"><span class="linenos">1398</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1399"><a href="#Stepper_Protocol_P0.pretty_print-1399"><span class="linenos">1399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1400"><a href="#Stepper_Protocol_P0.pretty_print-1400"><span class="linenos">1400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1401"><a href="#Stepper_Protocol_P0.pretty_print-1401"><span class="linenos">1401</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1402"><a href="#Stepper_Protocol_P0.pretty_print-1402"><span class="linenos">1402</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1403"><a href="#Stepper_Protocol_P0.pretty_print-1403"><span class="linenos">1403</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1404"><a href="#Stepper_Protocol_P0.pretty_print-1404"><span class="linenos">1404</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1405"><a href="#Stepper_Protocol_P0.pretty_print-1405"><span class="linenos">1405</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1406"><a href="#Stepper_Protocol_P0.pretty_print-1406"><span class="linenos">1406</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1407"><a href="#Stepper_Protocol_P0.pretty_print-1407"><span class="linenos">1407</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1408"><a href="#Stepper_Protocol_P0.pretty_print-1408"><span class="linenos">1408</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1409"><a href="#Stepper_Protocol_P0.pretty_print-1409"><span class="linenos">1409</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1410"><a href="#Stepper_Protocol_P0.pretty_print-1410"><span class="linenos">1410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-1411"><a href="#Stepper_Protocol_P0.pretty_print-1411"><span class="linenos">1411</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Print a readable representation of the robot's status</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P0.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P0.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P0.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P0.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P0.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P0.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P0.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P0.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P0.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P0.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P0.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P0.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P0.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P0.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P0.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P0.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P0.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P0.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P0.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P0.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P0.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P0.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P0.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P0.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P0.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P0.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P0.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P0.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P0.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P0.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P0.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P0.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P0.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P0.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P0.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P0.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P0.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P0.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P0.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P0.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P0.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P0.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P0.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P0.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P0.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P0.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P0.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P0.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P0.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P0.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P0.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P0.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P0.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P0.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P0.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P0.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P0.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P0.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P0.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P0.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P0.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P0.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P0.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P0.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P0.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P0.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P0.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P0.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P0.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P0.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P0.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P0.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P0.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P0.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P0.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P0.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P1">
                            <input id="Stepper_Protocol_P1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P1</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1-1414"><a href="#Stepper_Protocol_P1-1414"><span class="linenos">1414</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P1</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1415"><a href="#Stepper_Protocol_P1-1415"><span class="linenos">1415</span></a>
</span><span id="Stepper_Protocol_P1-1416"><a href="#Stepper_Protocol_P1-1416"><span class="linenos">1416</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1417"><a href="#Stepper_Protocol_P1-1417"><span class="linenos">1417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack status information and udpates `self.status` dictionary.</span>
</span><span id="Stepper_Protocol_P1-1418"><a href="#Stepper_Protocol_P1-1418"><span class="linenos">1418</span></a>
</span><span id="Stepper_Protocol_P1-1419"><a href="#Stepper_Protocol_P1-1419"><span class="linenos">1419</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1420"><a href="#Stepper_Protocol_P1-1420"><span class="linenos">1420</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1421"><a href="#Stepper_Protocol_P1-1421"><span class="linenos">1421</span></a><span class="sd">        s : bytes</span>
</span><span id="Stepper_Protocol_P1-1422"><a href="#Stepper_Protocol_P1-1422"><span class="linenos">1422</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="Stepper_Protocol_P1-1423"><a href="#Stepper_Protocol_P1-1423"><span class="linenos">1423</span></a>
</span><span id="Stepper_Protocol_P1-1424"><a href="#Stepper_Protocol_P1-1424"><span class="linenos">1424</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1-1425"><a href="#Stepper_Protocol_P1-1425"><span class="linenos">1425</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1-1426"><a href="#Stepper_Protocol_P1-1426"><span class="linenos">1426</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P1-1427"><a href="#Stepper_Protocol_P1-1427"><span class="linenos">1427</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P1-1428"><a href="#Stepper_Protocol_P1-1428"><span class="linenos">1428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1429"><a href="#Stepper_Protocol_P1-1429"><span class="linenos">1429</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1430"><a href="#Stepper_Protocol_P1-1430"><span class="linenos">1430</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P1-1431"><a href="#Stepper_Protocol_P1-1431"><span class="linenos">1431</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1432"><a href="#Stepper_Protocol_P1-1432"><span class="linenos">1432</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1433"><a href="#Stepper_Protocol_P1-1433"><span class="linenos">1433</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1434"><a href="#Stepper_Protocol_P1-1434"><span class="linenos">1434</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1435"><a href="#Stepper_Protocol_P1-1435"><span class="linenos">1435</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1436"><a href="#Stepper_Protocol_P1-1436"><span class="linenos">1436</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P1-1437"><a href="#Stepper_Protocol_P1-1437"><span class="linenos">1437</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1438"><a href="#Stepper_Protocol_P1-1438"><span class="linenos">1438</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1439"><a href="#Stepper_Protocol_P1-1439"><span class="linenos">1439</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1440"><a href="#Stepper_Protocol_P1-1440"><span class="linenos">1440</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P1-1441"><a href="#Stepper_Protocol_P1-1441"><span class="linenos">1441</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1442"><a href="#Stepper_Protocol_P1-1442"><span class="linenos">1442</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1443"><a href="#Stepper_Protocol_P1-1443"><span class="linenos">1443</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1444"><a href="#Stepper_Protocol_P1-1444"><span class="linenos">1444</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P1-1445"><a href="#Stepper_Protocol_P1-1445"><span class="linenos">1445</span></a>
</span><span id="Stepper_Protocol_P1-1446"><a href="#Stepper_Protocol_P1-1446"><span class="linenos">1446</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1447"><a href="#Stepper_Protocol_P1-1447"><span class="linenos">1447</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1448"><a href="#Stepper_Protocol_P1-1448"><span class="linenos">1448</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1449"><a href="#Stepper_Protocol_P1-1449"><span class="linenos">1449</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1450"><a href="#Stepper_Protocol_P1-1450"><span class="linenos">1450</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1451"><a href="#Stepper_Protocol_P1-1451"><span class="linenos">1451</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1452"><a href="#Stepper_Protocol_P1-1452"><span class="linenos">1452</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1453"><a href="#Stepper_Protocol_P1-1453"><span class="linenos">1453</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1454"><a href="#Stepper_Protocol_P1-1454"><span class="linenos">1454</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1455"><a href="#Stepper_Protocol_P1-1455"><span class="linenos">1455</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1456"><a href="#Stepper_Protocol_P1-1456"><span class="linenos">1456</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1457"><a href="#Stepper_Protocol_P1-1457"><span class="linenos">1457</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1458"><a href="#Stepper_Protocol_P1-1458"><span class="linenos">1458</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-1459"><a href="#Stepper_Protocol_P1-1459"><span class="linenos">1459</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1460"><a href="#Stepper_Protocol_P1-1460"><span class="linenos">1460</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P1-1461"><a href="#Stepper_Protocol_P1-1461"><span class="linenos">1461</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1462"><a href="#Stepper_Protocol_P1-1462"><span class="linenos">1462</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P1-1463"><a href="#Stepper_Protocol_P1-1463"><span class="linenos">1463</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1464"><a href="#Stepper_Protocol_P1-1464"><span class="linenos">1464</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P1-1465"><a href="#Stepper_Protocol_P1-1465"><span class="linenos">1465</span></a>
</span><span id="Stepper_Protocol_P1-1466"><a href="#Stepper_Protocol_P1-1466"><span class="linenos">1466</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P1-1467"><a href="#Stepper_Protocol_P1-1467"><span class="linenos">1467</span></a>
</span><span id="Stepper_Protocol_P1-1468"><a href="#Stepper_Protocol_P1-1468"><span class="linenos">1468</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1469"><a href="#Stepper_Protocol_P1-1469"><span class="linenos">1469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a readable representation of the robot&#39;s status</span>
</span><span id="Stepper_Protocol_P1-1470"><a href="#Stepper_Protocol_P1-1470"><span class="linenos">1470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1471"><a href="#Stepper_Protocol_P1-1471"><span class="linenos">1471</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1472"><a href="#Stepper_Protocol_P1-1472"><span class="linenos">1472</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P1-1473"><a href="#Stepper_Protocol_P1-1473"><span class="linenos">1473</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1474"><a href="#Stepper_Protocol_P1-1474"><span class="linenos">1474</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1475"><a href="#Stepper_Protocol_P1-1475"><span class="linenos">1475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1476"><a href="#Stepper_Protocol_P1-1476"><span class="linenos">1476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1477"><a href="#Stepper_Protocol_P1-1477"><span class="linenos">1477</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1478"><a href="#Stepper_Protocol_P1-1478"><span class="linenos">1478</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1479"><a href="#Stepper_Protocol_P1-1479"><span class="linenos">1479</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1480"><a href="#Stepper_Protocol_P1-1480"><span class="linenos">1480</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1481"><a href="#Stepper_Protocol_P1-1481"><span class="linenos">1481</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1482"><a href="#Stepper_Protocol_P1-1482"><span class="linenos">1482</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1483"><a href="#Stepper_Protocol_P1-1483"><span class="linenos">1483</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1484"><a href="#Stepper_Protocol_P1-1484"><span class="linenos">1484</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1485"><a href="#Stepper_Protocol_P1-1485"><span class="linenos">1485</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1486"><a href="#Stepper_Protocol_P1-1486"><span class="linenos">1486</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P1-1487"><a href="#Stepper_Protocol_P1-1487"><span class="linenos">1487</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1488"><a href="#Stepper_Protocol_P1-1488"><span class="linenos">1488</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1489"><a href="#Stepper_Protocol_P1-1489"><span class="linenos">1489</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1490"><a href="#Stepper_Protocol_P1-1490"><span class="linenos">1490</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1491"><a href="#Stepper_Protocol_P1-1491"><span class="linenos">1491</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1492"><a href="#Stepper_Protocol_P1-1492"><span class="linenos">1492</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1493"><a href="#Stepper_Protocol_P1-1493"><span class="linenos">1493</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1494"><a href="#Stepper_Protocol_P1-1494"><span class="linenos">1494</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1495"><a href="#Stepper_Protocol_P1-1495"><span class="linenos">1495</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1496"><a href="#Stepper_Protocol_P1-1496"><span class="linenos">1496</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1497"><a href="#Stepper_Protocol_P1-1497"><span class="linenos">1497</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1498"><a href="#Stepper_Protocol_P1-1498"><span class="linenos">1498</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1499"><a href="#Stepper_Protocol_P1-1499"><span class="linenos">1499</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1500"><a href="#Stepper_Protocol_P1-1500"><span class="linenos">1500</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Trace recording:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1501"><a href="#Stepper_Protocol_P1-1501"><span class="linenos">1501</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waypoint Trajectory&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1502"><a href="#Stepper_Protocol_P1-1502"><span class="linenos">1502</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       State:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1503"><a href="#Stepper_Protocol_P1-1503"><span class="linenos">1503</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Setpoint: (rad) </span><span class="si">%s</span><span class="s1"> | (deg) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">],</span>  <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">])))</span>
</span><span id="Stepper_Protocol_P1-1504"><a href="#Stepper_Protocol_P1-1504"><span class="linenos">1504</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Segment ID:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1505"><a href="#Stepper_Protocol_P1-1505"><span class="linenos">1505</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1506"><a href="#Stepper_Protocol_P1-1506"><span class="linenos">1506</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P1-1507"><a href="#Stepper_Protocol_P1-1507"><span class="linenos">1507</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1508"><a href="#Stepper_Protocol_P1-1508"><span class="linenos">1508</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1509"><a href="#Stepper_Protocol_P1-1509"><span class="linenos">1509</span></a>
</span><span id="Stepper_Protocol_P1-1510"><a href="#Stepper_Protocol_P1-1510"><span class="linenos">1510</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1511"><a href="#Stepper_Protocol_P1-1511"><span class="linenos">1511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position trajectory waypoint</span>
</span><span id="Stepper_Protocol_P1-1512"><a href="#Stepper_Protocol_P1-1512"><span class="linenos">1512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1513"><a href="#Stepper_Protocol_P1-1513"><span class="linenos">1513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1514"><a href="#Stepper_Protocol_P1-1514"><span class="linenos">1514</span></a>
</span><span id="Stepper_Protocol_P1-1515"><a href="#Stepper_Protocol_P1-1515"><span class="linenos">1515</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1516"><a href="#Stepper_Protocol_P1-1516"><span class="linenos">1516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts execution of a waypoint trajectory on hardware.</span>
</span><span id="Stepper_Protocol_P1-1517"><a href="#Stepper_Protocol_P1-1517"><span class="linenos">1517</span></a>
</span><span id="Stepper_Protocol_P1-1518"><a href="#Stepper_Protocol_P1-1518"><span class="linenos">1518</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1519"><a href="#Stepper_Protocol_P1-1519"><span class="linenos">1519</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1520"><a href="#Stepper_Protocol_P1-1520"><span class="linenos">1520</span></a><span class="sd">        first_segment : list.</span>
</span><span id="Stepper_Protocol_P1-1521"><a href="#Stepper_Protocol_P1-1521"><span class="linenos">1521</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1-1522"><a href="#Stepper_Protocol_P1-1522"><span class="linenos">1522</span></a><span class="sd">            The hardware begins executing this first segment of a spline. The segment&#39;s duration and</span>
</span><span id="Stepper_Protocol_P1-1523"><a href="#Stepper_Protocol_P1-1523"><span class="linenos">1523</span></a><span class="sd">            six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always</span>
</span><span id="Stepper_Protocol_P1-1524"><a href="#Stepper_Protocol_P1-1524"><span class="linenos">1524</span></a><span class="sd">            2 for the first segment, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1-1525"><a href="#Stepper_Protocol_P1-1525"><span class="linenos">1525</span></a>
</span><span id="Stepper_Protocol_P1-1526"><a href="#Stepper_Protocol_P1-1526"><span class="linenos">1526</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1-1527"><a href="#Stepper_Protocol_P1-1527"><span class="linenos">1527</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1-1528"><a href="#Stepper_Protocol_P1-1528"><span class="linenos">1528</span></a><span class="sd">        bool:</span>
</span><span id="Stepper_Protocol_P1-1529"><a href="#Stepper_Protocol_P1-1529"><span class="linenos">1529</span></a><span class="sd">            True if uC successfully initiated a new trajectory.</span>
</span><span id="Stepper_Protocol_P1-1530"><a href="#Stepper_Protocol_P1-1530"><span class="linenos">1530</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1531"><a href="#Stepper_Protocol_P1-1531"><span class="linenos">1531</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1532"><a href="#Stepper_Protocol_P1-1532"><span class="linenos">1532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1533"><a href="#Stepper_Protocol_P1-1533"><span class="linenos">1533</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1-1534"><a href="#Stepper_Protocol_P1-1534"><span class="linenos">1534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">first_segment</span>
</span><span id="Stepper_Protocol_P1-1535"><a href="#Stepper_Protocol_P1-1535"><span class="linenos">1535</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1-1536"><a href="#Stepper_Protocol_P1-1536"><span class="linenos">1536</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1537"><a href="#Stepper_Protocol_P1-1537"><span class="linenos">1537</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1-1538"><a href="#Stepper_Protocol_P1-1538"><span class="linenos">1538</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_START_NEW_TRAJECTORY</span>
</span><span id="Stepper_Protocol_P1-1539"><a href="#Stepper_Protocol_P1-1539"><span class="linenos">1539</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1540"><a href="#Stepper_Protocol_P1-1540"><span class="linenos">1540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start_new_traj_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1541"><a href="#Stepper_Protocol_P1-1541"><span class="linenos">1541</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1542"><a href="#Stepper_Protocol_P1-1542"><span class="linenos">1542</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1-1543"><a href="#Stepper_Protocol_P1-1543"><span class="linenos">1543</span></a>        <span class="c1"># return self._waypoint_traj_start_success</span>
</span><span id="Stepper_Protocol_P1-1544"><a href="#Stepper_Protocol_P1-1544"><span class="linenos">1544</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span>
</span><span id="Stepper_Protocol_P1-1545"><a href="#Stepper_Protocol_P1-1545"><span class="linenos">1545</span></a>
</span><span id="Stepper_Protocol_P1-1546"><a href="#Stepper_Protocol_P1-1546"><span class="linenos">1546</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1547"><a href="#Stepper_Protocol_P1-1547"><span class="linenos">1547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the next segment for the hardware to execute.</span>
</span><span id="Stepper_Protocol_P1-1548"><a href="#Stepper_Protocol_P1-1548"><span class="linenos">1548</span></a>
</span><span id="Stepper_Protocol_P1-1549"><a href="#Stepper_Protocol_P1-1549"><span class="linenos">1549</span></a><span class="sd">        This method is generally called multiple times while the prior segment is executing. This</span>
</span><span id="Stepper_Protocol_P1-1550"><a href="#Stepper_Protocol_P1-1550"><span class="linenos">1550</span></a><span class="sd">        provides the hardware with the next segment to gracefully transition across the entire spline,</span>
</span><span id="Stepper_Protocol_P1-1551"><a href="#Stepper_Protocol_P1-1551"><span class="linenos">1551</span></a><span class="sd">        while allowing users to preempt or modify the future trajectory in real time.</span>
</span><span id="Stepper_Protocol_P1-1552"><a href="#Stepper_Protocol_P1-1552"><span class="linenos">1552</span></a>
</span><span id="Stepper_Protocol_P1-1553"><a href="#Stepper_Protocol_P1-1553"><span class="linenos">1553</span></a><span class="sd">        This method will return False if there is not already an segment executing on the uC.</span>
</span><span id="Stepper_Protocol_P1-1554"><a href="#Stepper_Protocol_P1-1554"><span class="linenos">1554</span></a>
</span><span id="Stepper_Protocol_P1-1555"><a href="#Stepper_Protocol_P1-1555"><span class="linenos">1555</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1556"><a href="#Stepper_Protocol_P1-1556"><span class="linenos">1556</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1557"><a href="#Stepper_Protocol_P1-1557"><span class="linenos">1557</span></a><span class="sd">        next_segment : list.</span>
</span><span id="Stepper_Protocol_P1-1558"><a href="#Stepper_Protocol_P1-1558"><span class="linenos">1558</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1-1559"><a href="#Stepper_Protocol_P1-1559"><span class="linenos">1559</span></a><span class="sd">            Duration and six coefficients fill the first seven elements of the list. Generally, the</span>
</span><span id="Stepper_Protocol_P1-1560"><a href="#Stepper_Protocol_P1-1560"><span class="linenos">1560</span></a><span class="sd">            coefficients are calculated to smoothly transition across a spline. The segment ID, always</span>
</span><span id="Stepper_Protocol_P1-1561"><a href="#Stepper_Protocol_P1-1561"><span class="linenos">1561</span></a><span class="sd">            1 higher than the prior segment&#39;s ID, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1-1562"><a href="#Stepper_Protocol_P1-1562"><span class="linenos">1562</span></a>
</span><span id="Stepper_Protocol_P1-1563"><a href="#Stepper_Protocol_P1-1563"><span class="linenos">1563</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1-1564"><a href="#Stepper_Protocol_P1-1564"><span class="linenos">1564</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1-1565"><a href="#Stepper_Protocol_P1-1565"><span class="linenos">1565</span></a><span class="sd">        bool:</span>
</span><span id="Stepper_Protocol_P1-1566"><a href="#Stepper_Protocol_P1-1566"><span class="linenos">1566</span></a><span class="sd">            True if uC successfully queued next trajectory.</span>
</span><span id="Stepper_Protocol_P1-1567"><a href="#Stepper_Protocol_P1-1567"><span class="linenos">1567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1568"><a href="#Stepper_Protocol_P1-1568"><span class="linenos">1568</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1569"><a href="#Stepper_Protocol_P1-1569"><span class="linenos">1569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1570"><a href="#Stepper_Protocol_P1-1570"><span class="linenos">1570</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1-1571"><a href="#Stepper_Protocol_P1-1571"><span class="linenos">1571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">next_segment</span>
</span><span id="Stepper_Protocol_P1-1572"><a href="#Stepper_Protocol_P1-1572"><span class="linenos">1572</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1573"><a href="#Stepper_Protocol_P1-1573"><span class="linenos">1573</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1-1574"><a href="#Stepper_Protocol_P1-1574"><span class="linenos">1574</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span>
</span><span id="Stepper_Protocol_P1-1575"><a href="#Stepper_Protocol_P1-1575"><span class="linenos">1575</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1576"><a href="#Stepper_Protocol_P1-1576"><span class="linenos">1576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_set_next_traj_seg_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1577"><a href="#Stepper_Protocol_P1-1577"><span class="linenos">1577</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1578"><a href="#Stepper_Protocol_P1-1578"><span class="linenos">1578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1-1579"><a href="#Stepper_Protocol_P1-1579"><span class="linenos">1579</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span>
</span><span id="Stepper_Protocol_P1-1580"><a href="#Stepper_Protocol_P1-1580"><span class="linenos">1580</span></a>
</span><span id="Stepper_Protocol_P1-1581"><a href="#Stepper_Protocol_P1-1581"><span class="linenos">1581</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1582"><a href="#Stepper_Protocol_P1-1582"><span class="linenos">1582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops execution of the waypoint trajectory.</span>
</span><span id="Stepper_Protocol_P1-1583"><a href="#Stepper_Protocol_P1-1583"><span class="linenos">1583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1584"><a href="#Stepper_Protocol_P1-1584"><span class="linenos">1584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Stepper_Protocol_P1-1585"><a href="#Stepper_Protocol_P1-1585"><span class="linenos">1585</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_RESET_TRAJECTORY</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1586"><a href="#Stepper_Protocol_P1-1586"><span class="linenos">1586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_reset_traj_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1587"><a href="#Stepper_Protocol_P1-1587"><span class="linenos">1587</span></a>
</span><span id="Stepper_Protocol_P1-1588"><a href="#Stepper_Protocol_P1-1588"><span class="linenos">1588</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1589"><a href="#Stepper_Protocol_P1-1589"><span class="linenos">1589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs trajectory segment data starting at index sidx.</span>
</span><span id="Stepper_Protocol_P1-1590"><a href="#Stepper_Protocol_P1-1590"><span class="linenos">1590</span></a>
</span><span id="Stepper_Protocol_P1-1591"><a href="#Stepper_Protocol_P1-1591"><span class="linenos">1591</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1592"><a href="#Stepper_Protocol_P1-1592"><span class="linenos">1592</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1593"><a href="#Stepper_Protocol_P1-1593"><span class="linenos">1593</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P1-1594"><a href="#Stepper_Protocol_P1-1594"><span class="linenos">1594</span></a><span class="sd">            A byte string to which trajectory segment data will be packed.</span>
</span><span id="Stepper_Protocol_P1-1595"><a href="#Stepper_Protocol_P1-1595"><span class="linenos">1595</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P1-1596"><a href="#Stepper_Protocol_P1-1596"><span class="linenos">1596</span></a><span class="sd">        sidx : int.</span>
</span><span id="Stepper_Protocol_P1-1597"><a href="#Stepper_Protocol_P1-1597"><span class="linenos">1597</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="Stepper_Protocol_P1-1598"><a href="#Stepper_Protocol_P1-1598"><span class="linenos">1598</span></a>
</span><span id="Stepper_Protocol_P1-1599"><a href="#Stepper_Protocol_P1-1599"><span class="linenos">1599</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1-1600"><a href="#Stepper_Protocol_P1-1600"><span class="linenos">1600</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1-1601"><a href="#Stepper_Protocol_P1-1601"><span class="linenos">1601</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P1-1602"><a href="#Stepper_Protocol_P1-1602"><span class="linenos">1602</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="Stepper_Protocol_P1-1603"><a href="#Stepper_Protocol_P1-1603"><span class="linenos">1603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1604"><a href="#Stepper_Protocol_P1-1604"><span class="linenos">1604</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1605"><a href="#Stepper_Protocol_P1-1605"><span class="linenos">1605</span></a>            <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1-1606"><a href="#Stepper_Protocol_P1-1606"><span class="linenos">1606</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1607"><a href="#Stepper_Protocol_P1-1607"><span class="linenos">1607</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1-1608"><a href="#Stepper_Protocol_P1-1608"><span class="linenos">1608</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1609"><a href="#Stepper_Protocol_P1-1609"><span class="linenos">1609</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P1-1610"><a href="#Stepper_Protocol_P1-1610"><span class="linenos">1610</span></a>
</span><span id="Stepper_Protocol_P1-1611"><a href="#Stepper_Protocol_P1-1611"><span class="linenos">1611</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1612"><a href="#Stepper_Protocol_P1-1612"><span class="linenos">1612</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for starting a new trajectory.</span>
</span><span id="Stepper_Protocol_P1-1613"><a href="#Stepper_Protocol_P1-1613"><span class="linenos">1613</span></a>
</span><span id="Stepper_Protocol_P1-1614"><a href="#Stepper_Protocol_P1-1614"><span class="linenos">1614</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1615"><a href="#Stepper_Protocol_P1-1615"><span class="linenos">1615</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1616"><a href="#Stepper_Protocol_P1-1616"><span class="linenos">1616</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P1-1617"><a href="#Stepper_Protocol_P1-1617"><span class="linenos">1617</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P1-1618"><a href="#Stepper_Protocol_P1-1618"><span class="linenos">1618</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1619"><a href="#Stepper_Protocol_P1-1619"><span class="linenos">1619</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1620"><a href="#Stepper_Protocol_P1-1620"><span class="linenos">1620</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1621"><a href="#Stepper_Protocol_P1-1621"><span class="linenos">1621</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1-1622"><a href="#Stepper_Protocol_P1-1622"><span class="linenos">1622</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1623"><a href="#Stepper_Protocol_P1-1623"><span class="linenos">1623</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1624"><a href="#Stepper_Protocol_P1-1624"><span class="linenos">1624</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1-1625"><a href="#Stepper_Protocol_P1-1625"><span class="linenos">1625</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1626"><a href="#Stepper_Protocol_P1-1626"><span class="linenos">1626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1627"><a href="#Stepper_Protocol_P1-1627"><span class="linenos">1627</span></a>
</span><span id="Stepper_Protocol_P1-1628"><a href="#Stepper_Protocol_P1-1628"><span class="linenos">1628</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1629"><a href="#Stepper_Protocol_P1-1629"><span class="linenos">1629</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for setting the next trajectory segment.</span>
</span><span id="Stepper_Protocol_P1-1630"><a href="#Stepper_Protocol_P1-1630"><span class="linenos">1630</span></a>
</span><span id="Stepper_Protocol_P1-1631"><a href="#Stepper_Protocol_P1-1631"><span class="linenos">1631</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1632"><a href="#Stepper_Protocol_P1-1632"><span class="linenos">1632</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1633"><a href="#Stepper_Protocol_P1-1633"><span class="linenos">1633</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P1-1634"><a href="#Stepper_Protocol_P1-1634"><span class="linenos">1634</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P1-1635"><a href="#Stepper_Protocol_P1-1635"><span class="linenos">1635</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1636"><a href="#Stepper_Protocol_P1-1636"><span class="linenos">1636</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1637"><a href="#Stepper_Protocol_P1-1637"><span class="linenos">1637</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1638"><a href="#Stepper_Protocol_P1-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1-1639"><a href="#Stepper_Protocol_P1-1639"><span class="linenos">1639</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1640"><a href="#Stepper_Protocol_P1-1640"><span class="linenos">1640</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1641"><a href="#Stepper_Protocol_P1-1641"><span class="linenos">1641</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1-1642"><a href="#Stepper_Protocol_P1-1642"><span class="linenos">1642</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1643"><a href="#Stepper_Protocol_P1-1643"><span class="linenos">1643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1644"><a href="#Stepper_Protocol_P1-1644"><span class="linenos">1644</span></a>
</span><span id="Stepper_Protocol_P1-1645"><a href="#Stepper_Protocol_P1-1645"><span class="linenos">1645</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1646"><a href="#Stepper_Protocol_P1-1646"><span class="linenos">1646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for resetting the trajectory.</span>
</span><span id="Stepper_Protocol_P1-1647"><a href="#Stepper_Protocol_P1-1647"><span class="linenos">1647</span></a>
</span><span id="Stepper_Protocol_P1-1648"><a href="#Stepper_Protocol_P1-1648"><span class="linenos">1648</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1649"><a href="#Stepper_Protocol_P1-1649"><span class="linenos">1649</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1650"><a href="#Stepper_Protocol_P1-1650"><span class="linenos">1650</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P1-1651"><a href="#Stepper_Protocol_P1-1651"><span class="linenos">1651</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P1-1652"><a href="#Stepper_Protocol_P1-1652"><span class="linenos">1652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1653"><a href="#Stepper_Protocol_P1-1653"><span class="linenos">1653</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_RESET_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1654"><a href="#Stepper_Protocol_P1-1654"><span class="linenos">1654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_RESET_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P1.unpack_status" class="classattr">
                                        <input id="Stepper_Protocol_P1.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.unpack_status-1416"><a href="#Stepper_Protocol_P1.unpack_status-1416"><span class="linenos">1416</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1417"><a href="#Stepper_Protocol_P1.unpack_status-1417"><span class="linenos">1417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpack status information and udpates `self.status` dictionary.</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1418"><a href="#Stepper_Protocol_P1.unpack_status-1418"><span class="linenos">1418</span></a>
</span><span id="Stepper_Protocol_P1.unpack_status-1419"><a href="#Stepper_Protocol_P1.unpack_status-1419"><span class="linenos">1419</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1420"><a href="#Stepper_Protocol_P1.unpack_status-1420"><span class="linenos">1420</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1421"><a href="#Stepper_Protocol_P1.unpack_status-1421"><span class="linenos">1421</span></a><span class="sd">        s : bytes</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1422"><a href="#Stepper_Protocol_P1.unpack_status-1422"><span class="linenos">1422</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1423"><a href="#Stepper_Protocol_P1.unpack_status-1423"><span class="linenos">1423</span></a>
</span><span id="Stepper_Protocol_P1.unpack_status-1424"><a href="#Stepper_Protocol_P1.unpack_status-1424"><span class="linenos">1424</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1425"><a href="#Stepper_Protocol_P1.unpack_status-1425"><span class="linenos">1425</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1426"><a href="#Stepper_Protocol_P1.unpack_status-1426"><span class="linenos">1426</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1427"><a href="#Stepper_Protocol_P1.unpack_status-1427"><span class="linenos">1427</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1428"><a href="#Stepper_Protocol_P1.unpack_status-1428"><span class="linenos">1428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1429"><a href="#Stepper_Protocol_P1.unpack_status-1429"><span class="linenos">1429</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1430"><a href="#Stepper_Protocol_P1.unpack_status-1430"><span class="linenos">1430</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1431"><a href="#Stepper_Protocol_P1.unpack_status-1431"><span class="linenos">1431</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1432"><a href="#Stepper_Protocol_P1.unpack_status-1432"><span class="linenos">1432</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1433"><a href="#Stepper_Protocol_P1.unpack_status-1433"><span class="linenos">1433</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1434"><a href="#Stepper_Protocol_P1.unpack_status-1434"><span class="linenos">1434</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1435"><a href="#Stepper_Protocol_P1.unpack_status-1435"><span class="linenos">1435</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1436"><a href="#Stepper_Protocol_P1.unpack_status-1436"><span class="linenos">1436</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1437"><a href="#Stepper_Protocol_P1.unpack_status-1437"><span class="linenos">1437</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1438"><a href="#Stepper_Protocol_P1.unpack_status-1438"><span class="linenos">1438</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1439"><a href="#Stepper_Protocol_P1.unpack_status-1439"><span class="linenos">1439</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1440"><a href="#Stepper_Protocol_P1.unpack_status-1440"><span class="linenos">1440</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1441"><a href="#Stepper_Protocol_P1.unpack_status-1441"><span class="linenos">1441</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1442"><a href="#Stepper_Protocol_P1.unpack_status-1442"><span class="linenos">1442</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1443"><a href="#Stepper_Protocol_P1.unpack_status-1443"><span class="linenos">1443</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1444"><a href="#Stepper_Protocol_P1.unpack_status-1444"><span class="linenos">1444</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1445"><a href="#Stepper_Protocol_P1.unpack_status-1445"><span class="linenos">1445</span></a>
</span><span id="Stepper_Protocol_P1.unpack_status-1446"><a href="#Stepper_Protocol_P1.unpack_status-1446"><span class="linenos">1446</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1447"><a href="#Stepper_Protocol_P1.unpack_status-1447"><span class="linenos">1447</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1448"><a href="#Stepper_Protocol_P1.unpack_status-1448"><span class="linenos">1448</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1449"><a href="#Stepper_Protocol_P1.unpack_status-1449"><span class="linenos">1449</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1450"><a href="#Stepper_Protocol_P1.unpack_status-1450"><span class="linenos">1450</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1451"><a href="#Stepper_Protocol_P1.unpack_status-1451"><span class="linenos">1451</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1452"><a href="#Stepper_Protocol_P1.unpack_status-1452"><span class="linenos">1452</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1453"><a href="#Stepper_Protocol_P1.unpack_status-1453"><span class="linenos">1453</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1454"><a href="#Stepper_Protocol_P1.unpack_status-1454"><span class="linenos">1454</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1455"><a href="#Stepper_Protocol_P1.unpack_status-1455"><span class="linenos">1455</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1456"><a href="#Stepper_Protocol_P1.unpack_status-1456"><span class="linenos">1456</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1457"><a href="#Stepper_Protocol_P1.unpack_status-1457"><span class="linenos">1457</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1458"><a href="#Stepper_Protocol_P1.unpack_status-1458"><span class="linenos">1458</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1459"><a href="#Stepper_Protocol_P1.unpack_status-1459"><span class="linenos">1459</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1460"><a href="#Stepper_Protocol_P1.unpack_status-1460"><span class="linenos">1460</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1461"><a href="#Stepper_Protocol_P1.unpack_status-1461"><span class="linenos">1461</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1462"><a href="#Stepper_Protocol_P1.unpack_status-1462"><span class="linenos">1462</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1463"><a href="#Stepper_Protocol_P1.unpack_status-1463"><span class="linenos">1463</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1464"><a href="#Stepper_Protocol_P1.unpack_status-1464"><span class="linenos">1464</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-1465"><a href="#Stepper_Protocol_P1.unpack_status-1465"><span class="linenos">1465</span></a>
</span><span id="Stepper_Protocol_P1.unpack_status-1466"><a href="#Stepper_Protocol_P1.unpack_status-1466"><span class="linenos">1466</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpack status information and udpates <code>self.status</code> dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes
    A byte string containing packed status data.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.pretty_print" class="classattr">
                                        <input id="Stepper_Protocol_P1.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.pretty_print-1468"><a href="#Stepper_Protocol_P1.pretty_print-1468"><span class="linenos">1468</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1469"><a href="#Stepper_Protocol_P1.pretty_print-1469"><span class="linenos">1469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a readable representation of the robot&#39;s status</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1470"><a href="#Stepper_Protocol_P1.pretty_print-1470"><span class="linenos">1470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1471"><a href="#Stepper_Protocol_P1.pretty_print-1471"><span class="linenos">1471</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1472"><a href="#Stepper_Protocol_P1.pretty_print-1472"><span class="linenos">1472</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1473"><a href="#Stepper_Protocol_P1.pretty_print-1473"><span class="linenos">1473</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1474"><a href="#Stepper_Protocol_P1.pretty_print-1474"><span class="linenos">1474</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1475"><a href="#Stepper_Protocol_P1.pretty_print-1475"><span class="linenos">1475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1476"><a href="#Stepper_Protocol_P1.pretty_print-1476"><span class="linenos">1476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1477"><a href="#Stepper_Protocol_P1.pretty_print-1477"><span class="linenos">1477</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1478"><a href="#Stepper_Protocol_P1.pretty_print-1478"><span class="linenos">1478</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1479"><a href="#Stepper_Protocol_P1.pretty_print-1479"><span class="linenos">1479</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1480"><a href="#Stepper_Protocol_P1.pretty_print-1480"><span class="linenos">1480</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1481"><a href="#Stepper_Protocol_P1.pretty_print-1481"><span class="linenos">1481</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1482"><a href="#Stepper_Protocol_P1.pretty_print-1482"><span class="linenos">1482</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1483"><a href="#Stepper_Protocol_P1.pretty_print-1483"><span class="linenos">1483</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1484"><a href="#Stepper_Protocol_P1.pretty_print-1484"><span class="linenos">1484</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1485"><a href="#Stepper_Protocol_P1.pretty_print-1485"><span class="linenos">1485</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1486"><a href="#Stepper_Protocol_P1.pretty_print-1486"><span class="linenos">1486</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1487"><a href="#Stepper_Protocol_P1.pretty_print-1487"><span class="linenos">1487</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1488"><a href="#Stepper_Protocol_P1.pretty_print-1488"><span class="linenos">1488</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1489"><a href="#Stepper_Protocol_P1.pretty_print-1489"><span class="linenos">1489</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1490"><a href="#Stepper_Protocol_P1.pretty_print-1490"><span class="linenos">1490</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1491"><a href="#Stepper_Protocol_P1.pretty_print-1491"><span class="linenos">1491</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1492"><a href="#Stepper_Protocol_P1.pretty_print-1492"><span class="linenos">1492</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1493"><a href="#Stepper_Protocol_P1.pretty_print-1493"><span class="linenos">1493</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1494"><a href="#Stepper_Protocol_P1.pretty_print-1494"><span class="linenos">1494</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1495"><a href="#Stepper_Protocol_P1.pretty_print-1495"><span class="linenos">1495</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1496"><a href="#Stepper_Protocol_P1.pretty_print-1496"><span class="linenos">1496</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1497"><a href="#Stepper_Protocol_P1.pretty_print-1497"><span class="linenos">1497</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1498"><a href="#Stepper_Protocol_P1.pretty_print-1498"><span class="linenos">1498</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1499"><a href="#Stepper_Protocol_P1.pretty_print-1499"><span class="linenos">1499</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1500"><a href="#Stepper_Protocol_P1.pretty_print-1500"><span class="linenos">1500</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Trace recording:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1501"><a href="#Stepper_Protocol_P1.pretty_print-1501"><span class="linenos">1501</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waypoint Trajectory&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1502"><a href="#Stepper_Protocol_P1.pretty_print-1502"><span class="linenos">1502</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       State:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1503"><a href="#Stepper_Protocol_P1.pretty_print-1503"><span class="linenos">1503</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Setpoint: (rad) </span><span class="si">%s</span><span class="s1"> | (deg) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">],</span>  <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">])))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1504"><a href="#Stepper_Protocol_P1.pretty_print-1504"><span class="linenos">1504</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Segment ID:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1505"><a href="#Stepper_Protocol_P1.pretty_print-1505"><span class="linenos">1505</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1506"><a href="#Stepper_Protocol_P1.pretty_print-1506"><span class="linenos">1506</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1507"><a href="#Stepper_Protocol_P1.pretty_print-1507"><span class="linenos">1507</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-1508"><a href="#Stepper_Protocol_P1.pretty_print-1508"><span class="linenos">1508</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Print a readable representation of the robot's status</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.enable_pos_traj_waypoint" class="classattr">
                                        <input id="Stepper_Protocol_P1.enable_pos_traj_waypoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj_waypoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.enable_pos_traj_waypoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.enable_pos_traj_waypoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.enable_pos_traj_waypoint-1510"><a href="#Stepper_Protocol_P1.enable_pos_traj_waypoint-1510"><span class="linenos">1510</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.enable_pos_traj_waypoint-1511"><a href="#Stepper_Protocol_P1.enable_pos_traj_waypoint-1511"><span class="linenos">1511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable position trajectory waypoint</span>
</span><span id="Stepper_Protocol_P1.enable_pos_traj_waypoint-1512"><a href="#Stepper_Protocol_P1.enable_pos_traj_waypoint-1512"><span class="linenos">1512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.enable_pos_traj_waypoint-1513"><a href="#Stepper_Protocol_P1.enable_pos_traj_waypoint-1513"><span class="linenos">1513</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable position trajectory waypoint</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.start_waypoint_trajectory" class="classattr">
                                        <input id="Stepper_Protocol_P1.start_waypoint_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_waypoint_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">first_segment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.start_waypoint_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.start_waypoint_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1515"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1515"><span class="linenos">1515</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1516"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1516"><span class="linenos">1516</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts execution of a waypoint trajectory on hardware.</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1517"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1517"><span class="linenos">1517</span></a>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1518"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1518"><span class="linenos">1518</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1519"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1519"><span class="linenos">1519</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1520"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1520"><span class="linenos">1520</span></a><span class="sd">        first_segment : list.</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1521"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1521"><span class="linenos">1521</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1522"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1522"><span class="linenos">1522</span></a><span class="sd">            The hardware begins executing this first segment of a spline. The segment&#39;s duration and</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1523"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1523"><span class="linenos">1523</span></a><span class="sd">            six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1524"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1524"><span class="linenos">1524</span></a><span class="sd">            2 for the first segment, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1525"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1525"><span class="linenos">1525</span></a>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1526"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1526"><span class="linenos">1526</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1527"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1527"><span class="linenos">1527</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1528"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1528"><span class="linenos">1528</span></a><span class="sd">        bool:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1529"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1529"><span class="linenos">1529</span></a><span class="sd">            True if uC successfully initiated a new trajectory.</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1530"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1530"><span class="linenos">1530</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1531"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1531"><span class="linenos">1531</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1532"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1532"><span class="linenos">1532</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1533"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1533"><span class="linenos">1533</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1534"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1534"><span class="linenos">1534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">first_segment</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1535"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1535"><span class="linenos">1535</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1536"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1536"><span class="linenos">1536</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1537"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1537"><span class="linenos">1537</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1538"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1538"><span class="linenos">1538</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_START_NEW_TRAJECTORY</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1539"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1539"><span class="linenos">1539</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1540"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1540"><span class="linenos">1540</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start_new_traj_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1541"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1541"><span class="linenos">1541</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1542"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1542"><span class="linenos">1542</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1543"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1543"><span class="linenos">1543</span></a>        <span class="c1"># return self._waypoint_traj_start_success</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1544"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1544"><span class="linenos">1544</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span>
</span></pre></div>


            <div class="docstring"><p>Starts execution of a waypoint trajectory on hardware.</p>

<h2 id="parameters">Parameters</h2>

<p>first_segment : list.
    List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].
    The hardware begins executing this first segment of a spline. The segment's duration and
    six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always
    2 for the first segment, fills the last element of the list.</p>

<h2 id="returns">Returns</h2>

<p>bool:
    True if uC successfully initiated a new trajectory.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.set_next_trajectory_segment" class="classattr">
                                        <input id="Stepper_Protocol_P1.set_next_trajectory_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_next_trajectory_segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">next_segment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.set_next_trajectory_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.set_next_trajectory_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1546"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1546"><span class="linenos">1546</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1547"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1547"><span class="linenos">1547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the next segment for the hardware to execute.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1548"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1548"><span class="linenos">1548</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1549"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1549"><span class="linenos">1549</span></a><span class="sd">        This method is generally called multiple times while the prior segment is executing. This</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1550"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1550"><span class="linenos">1550</span></a><span class="sd">        provides the hardware with the next segment to gracefully transition across the entire spline,</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1551"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1551"><span class="linenos">1551</span></a><span class="sd">        while allowing users to preempt or modify the future trajectory in real time.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1552"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1552"><span class="linenos">1552</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1553"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1553"><span class="linenos">1553</span></a><span class="sd">        This method will return False if there is not already an segment executing on the uC.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1554"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1554"><span class="linenos">1554</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1555"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1555"><span class="linenos">1555</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1556"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1556"><span class="linenos">1556</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1557"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1557"><span class="linenos">1557</span></a><span class="sd">        next_segment : list.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1558"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1558"><span class="linenos">1558</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1559"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1559"><span class="linenos">1559</span></a><span class="sd">            Duration and six coefficients fill the first seven elements of the list. Generally, the</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1560"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1560"><span class="linenos">1560</span></a><span class="sd">            coefficients are calculated to smoothly transition across a spline. The segment ID, always</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1561"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1561"><span class="linenos">1561</span></a><span class="sd">            1 higher than the prior segment&#39;s ID, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1562"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1562"><span class="linenos">1562</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1563"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1563"><span class="linenos">1563</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1564"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1564"><span class="linenos">1564</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1565"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1565"><span class="linenos">1565</span></a><span class="sd">        bool:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1566"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1566"><span class="linenos">1566</span></a><span class="sd">            True if uC successfully queued next trajectory.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1567"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1567"><span class="linenos">1567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1568"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1568"><span class="linenos">1568</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1569"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1569"><span class="linenos">1569</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1570"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1570"><span class="linenos">1570</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1571"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1571"><span class="linenos">1571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">next_segment</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1572"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1572"><span class="linenos">1572</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1573"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1573"><span class="linenos">1573</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1574"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1574"><span class="linenos">1574</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1575"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1575"><span class="linenos">1575</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1576"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1576"><span class="linenos">1576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_set_next_traj_seg_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1577"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1577"><span class="linenos">1577</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1578"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1578"><span class="linenos">1578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1579"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1579"><span class="linenos">1579</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span>
</span></pre></div>


            <div class="docstring"><p>Sets the next segment for the hardware to execute.</p>

<p>This method is generally called multiple times while the prior segment is executing. This
provides the hardware with the next segment to gracefully transition across the entire spline,
while allowing users to preempt or modify the future trajectory in real time.</p>

<p>This method will return False if there is not already an segment executing on the uC.</p>

<h2 id="parameters">Parameters</h2>

<p>next_segment : list.
    List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].
    Duration and six coefficients fill the first seven elements of the list. Generally, the
    coefficients are calculated to smoothly transition across a spline. The segment ID, always
    1 higher than the prior segment's ID, fills the last element of the list.</p>

<h2 id="returns">Returns</h2>

<p>bool:
    True if uC successfully queued next trajectory.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.stop_waypoint_trajectory" class="classattr">
                                        <input id="Stepper_Protocol_P1.stop_waypoint_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_waypoint_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.stop_waypoint_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.stop_waypoint_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1581"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1581"><span class="linenos">1581</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1582"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1582"><span class="linenos">1582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops execution of the waypoint trajectory.</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1583"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1583"><span class="linenos">1583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1584"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1584"><span class="linenos">1584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1585"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1585"><span class="linenos">1585</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_RESET_TRAJECTORY</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1586"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1586"><span class="linenos">1586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_reset_traj_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Stops execution of the waypoint trajectory.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.pack_trajectory_segment" class="classattr">
                                        <input id="Stepper_Protocol_P1.pack_trajectory_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_trajectory_segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.pack_trajectory_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.pack_trajectory_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1588"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1588"><span class="linenos">1588</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1589"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1589"><span class="linenos">1589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Packs trajectory segment data starting at index sidx.</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1590"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1590"><span class="linenos">1590</span></a>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1591"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1591"><span class="linenos">1591</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1592"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1592"><span class="linenos">1592</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1593"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1593"><span class="linenos">1593</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1594"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1594"><span class="linenos">1594</span></a><span class="sd">            A byte string to which trajectory segment data will be packed.</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1595"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1595"><span class="linenos">1595</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1596"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1596"><span class="linenos">1596</span></a><span class="sd">        sidx : int.</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1597"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1597"><span class="linenos">1597</span></a><span class="sd">            The starting index in the byte string `s`.</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1598"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1598"><span class="linenos">1598</span></a>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1599"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1599"><span class="linenos">1599</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1600"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1600"><span class="linenos">1600</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1601"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1601"><span class="linenos">1601</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1602"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1602"><span class="linenos">1602</span></a><span class="sd">            The index of the next unused byte in the byte string `s` after packing.</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1603"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1603"><span class="linenos">1603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1604"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1604"><span class="linenos">1604</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1605"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1605"><span class="linenos">1605</span></a>            <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1606"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1606"><span class="linenos">1606</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1607"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1607"><span class="linenos">1607</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1608"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1608"><span class="linenos">1608</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1609"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1609"><span class="linenos">1609</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Packs trajectory segment data starting at index sidx.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string to which trajectory segment data will be packed.</p>

<p>sidx : int.
    The starting index in the byte string <code>s</code>.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index of the next unused byte in the byte string <code>s</code> after packing.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.rpc_start_new_traj_reply" class="classattr">
                                        <input id="Stepper_Protocol_P1.rpc_start_new_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_start_new_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.rpc_start_new_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.rpc_start_new_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1611"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1611"><span class="linenos">1611</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1612"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1612"><span class="linenos">1612</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for starting a new trajectory.</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1613"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1613"><span class="linenos">1613</span></a>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1614"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1614"><span class="linenos">1614</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1615"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1615"><span class="linenos">1615</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1616"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1616"><span class="linenos">1616</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1617"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1617"><span class="linenos">1617</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1618"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1618"><span class="linenos">1618</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1619"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1619"><span class="linenos">1619</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1620"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1620"><span class="linenos">1620</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1621"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1621"><span class="linenos">1621</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1622"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1622"><span class="linenos">1622</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1623"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1623"><span class="linenos">1623</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1624"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1624"><span class="linenos">1624</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1625"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1625"><span class="linenos">1625</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1626"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1626"><span class="linenos">1626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for starting a new trajectory.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply" class="classattr">
                                        <input id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_set_next_traj_seg_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1628"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1628"><span class="linenos">1628</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1629"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1629"><span class="linenos">1629</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for setting the next trajectory segment.</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1630"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1630"><span class="linenos">1630</span></a>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1631"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1631"><span class="linenos">1631</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1632"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1632"><span class="linenos">1632</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1633"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1633"><span class="linenos">1633</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1634"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1634"><span class="linenos">1634</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1635"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1635"><span class="linenos">1635</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1636"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1636"><span class="linenos">1636</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1637"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1637"><span class="linenos">1637</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1638"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1639"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1639"><span class="linenos">1639</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1640"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1640"><span class="linenos">1640</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1641"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1641"><span class="linenos">1641</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1642"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1642"><span class="linenos">1642</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1643"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1643"><span class="linenos">1643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for setting the next trajectory segment.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.rpc_reset_traj_reply" class="classattr">
                                        <input id="Stepper_Protocol_P1.rpc_reset_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_reset_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.rpc_reset_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.rpc_reset_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1645"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1645"><span class="linenos">1645</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1646"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1646"><span class="linenos">1646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for resetting the trajectory.</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1647"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1647"><span class="linenos">1647</span></a>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1648"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1648"><span class="linenos">1648</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1649"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1649"><span class="linenos">1649</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1650"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1650"><span class="linenos">1650</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1651"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1651"><span class="linenos">1651</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1652"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1652"><span class="linenos">1652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1653"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1653"><span class="linenos">1653</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_RESET_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1654"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1654"><span class="linenos">1654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_RESET_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for resetting the trajectory.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P1.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P1.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P1.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P1.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P1.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P1.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P1.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P1.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P1.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P1.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P1.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P1.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P1.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P1.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P1.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P1.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P1.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P1.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P1.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P1.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P1.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P1.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P1.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P1.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P1.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P1.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P1.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P1.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P1.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P1.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P1.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P1.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P1.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P1.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P1.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P1.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P1.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P1.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P1.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P1.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P1.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P1.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P1.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P1.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P1.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P1.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P1.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P1.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P1.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P1.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P1.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P1.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P1.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P1.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P1.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P1.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P1.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P1.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P1.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P1.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P1.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P1.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P1.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P1.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P1.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P1.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P1.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P1.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P1.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P1.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P1.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P1.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P1.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P1.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P1.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P1.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P1.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P1.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P1.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P2">
                            <input id="Stepper_Protocol_P2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P2</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2-1658"><a href="#Stepper_Protocol_P2-1658"><span class="linenos">1658</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P2</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1659"><a href="#Stepper_Protocol_P2-1659"><span class="linenos">1659</span></a>
</span><span id="Stepper_Protocol_P2-1660"><a href="#Stepper_Protocol_P2-1660"><span class="linenos">1660</span></a>    <span class="k">def</span> <span class="nf">read_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1661"><a href="#Stepper_Protocol_P2-1661"><span class="linenos">1661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads firmware trace data and returns it as a list.</span>
</span><span id="Stepper_Protocol_P2-1662"><a href="#Stepper_Protocol_P2-1662"><span class="linenos">1662</span></a>
</span><span id="Stepper_Protocol_P2-1663"><a href="#Stepper_Protocol_P2-1663"><span class="linenos">1663</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2-1664"><a href="#Stepper_Protocol_P2-1664"><span class="linenos">1664</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2-1665"><a href="#Stepper_Protocol_P2-1665"><span class="linenos">1665</span></a><span class="sd">        list:</span>
</span><span id="Stepper_Protocol_P2-1666"><a href="#Stepper_Protocol_P2-1666"><span class="linenos">1666</span></a><span class="sd">            A list containing the firmware trace data.</span>
</span><span id="Stepper_Protocol_P2-1667"><a href="#Stepper_Protocol_P2-1667"><span class="linenos">1667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1668"><a href="#Stepper_Protocol_P2-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Stepper_Protocol_P2-1669"><a href="#Stepper_Protocol_P2-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1">#Timestamp holds state, reset within lock to avoid threading issues</span>
</span><span id="Stepper_Protocol_P2-1670"><a href="#Stepper_Protocol_P2-1670"><span class="linenos">1670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1671"><a href="#Stepper_Protocol_P2-1671"><span class="linenos">1671</span></a>        <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2-1672"><a href="#Stepper_Protocol_P2-1672"><span class="linenos">1672</span></a>        <span class="k">while</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&lt;</span><span class="mf">60.0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1673"><a href="#Stepper_Protocol_P2-1673"><span class="linenos">1673</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_TRACE</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1674"><a href="#Stepper_Protocol_P2-1674"><span class="linenos">1674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_firmware_trace_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2-1675"><a href="#Stepper_Protocol_P2-1675"><span class="linenos">1675</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2-1676"><a href="#Stepper_Protocol_P2-1676"><span class="linenos">1676</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span>
</span><span id="Stepper_Protocol_P2-1677"><a href="#Stepper_Protocol_P2-1677"><span class="linenos">1677</span></a>    <span class="k">def</span> <span class="nf">unpack_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1678"><a href="#Stepper_Protocol_P2-1678"><span class="linenos">1678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks debug trace data into the `unpack_to` dictionary.</span>
</span><span id="Stepper_Protocol_P2-1679"><a href="#Stepper_Protocol_P2-1679"><span class="linenos">1679</span></a>
</span><span id="Stepper_Protocol_P2-1680"><a href="#Stepper_Protocol_P2-1680"><span class="linenos">1680</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2-1681"><a href="#Stepper_Protocol_P2-1681"><span class="linenos">1681</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2-1682"><a href="#Stepper_Protocol_P2-1682"><span class="linenos">1682</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P2-1683"><a href="#Stepper_Protocol_P2-1683"><span class="linenos">1683</span></a><span class="sd">            The byte string containing debug trace information.</span>
</span><span id="Stepper_Protocol_P2-1684"><a href="#Stepper_Protocol_P2-1684"><span class="linenos">1684</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P2-1685"><a href="#Stepper_Protocol_P2-1685"><span class="linenos">1685</span></a><span class="sd">        unpack_to : dict.</span>
</span><span id="Stepper_Protocol_P2-1686"><a href="#Stepper_Protocol_P2-1686"><span class="linenos">1686</span></a><span class="sd">            A dictionary to store the unpacked information.</span>
</span><span id="Stepper_Protocol_P2-1687"><a href="#Stepper_Protocol_P2-1687"><span class="linenos">1687</span></a>
</span><span id="Stepper_Protocol_P2-1688"><a href="#Stepper_Protocol_P2-1688"><span class="linenos">1688</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2-1689"><a href="#Stepper_Protocol_P2-1689"><span class="linenos">1689</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2-1690"><a href="#Stepper_Protocol_P2-1690"><span class="linenos">1690</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P2-1691"><a href="#Stepper_Protocol_P2-1691"><span class="linenos">1691</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2-1692"><a href="#Stepper_Protocol_P2-1692"><span class="linenos">1692</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1693"><a href="#Stepper_Protocol_P2-1693"><span class="linenos">1693</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1694"><a href="#Stepper_Protocol_P2-1694"><span class="linenos">1694</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1695"><a href="#Stepper_Protocol_P2-1695"><span class="linenos">1695</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1696"><a href="#Stepper_Protocol_P2-1696"><span class="linenos">1696</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1697"><a href="#Stepper_Protocol_P2-1697"><span class="linenos">1697</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1698"><a href="#Stepper_Protocol_P2-1698"><span class="linenos">1698</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1699"><a href="#Stepper_Protocol_P2-1699"><span class="linenos">1699</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P2-1700"><a href="#Stepper_Protocol_P2-1700"><span class="linenos">1700</span></a>
</span><span id="Stepper_Protocol_P2-1701"><a href="#Stepper_Protocol_P2-1701"><span class="linenos">1701</span></a>    <span class="k">def</span> <span class="nf">unpack_print_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1702"><a href="#Stepper_Protocol_P2-1702"><span class="linenos">1702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and prints trace information into the `unpack_to` dictionary.</span>
</span><span id="Stepper_Protocol_P2-1703"><a href="#Stepper_Protocol_P2-1703"><span class="linenos">1703</span></a>
</span><span id="Stepper_Protocol_P2-1704"><a href="#Stepper_Protocol_P2-1704"><span class="linenos">1704</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2-1705"><a href="#Stepper_Protocol_P2-1705"><span class="linenos">1705</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2-1706"><a href="#Stepper_Protocol_P2-1706"><span class="linenos">1706</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P2-1707"><a href="#Stepper_Protocol_P2-1707"><span class="linenos">1707</span></a><span class="sd">            The byte string containing print trace information.</span>
</span><span id="Stepper_Protocol_P2-1708"><a href="#Stepper_Protocol_P2-1708"><span class="linenos">1708</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P2-1709"><a href="#Stepper_Protocol_P2-1709"><span class="linenos">1709</span></a><span class="sd">        unpack_to : dict.</span>
</span><span id="Stepper_Protocol_P2-1710"><a href="#Stepper_Protocol_P2-1710"><span class="linenos">1710</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2-1711"><a href="#Stepper_Protocol_P2-1711"><span class="linenos">1711</span></a>
</span><span id="Stepper_Protocol_P2-1712"><a href="#Stepper_Protocol_P2-1712"><span class="linenos">1712</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2-1713"><a href="#Stepper_Protocol_P2-1713"><span class="linenos">1713</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2-1714"><a href="#Stepper_Protocol_P2-1714"><span class="linenos">1714</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P2-1715"><a href="#Stepper_Protocol_P2-1715"><span class="linenos">1715</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2-1716"><a href="#Stepper_Protocol_P2-1716"><span class="linenos">1716</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1717"><a href="#Stepper_Protocol_P2-1717"><span class="linenos">1717</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1718"><a href="#Stepper_Protocol_P2-1718"><span class="linenos">1718</span></a>        <span class="n">line_len</span><span class="o">=</span><span class="mi">32</span>
</span><span id="Stepper_Protocol_P2-1719"><a href="#Stepper_Protocol_P2-1719"><span class="linenos">1719</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2-1720"><a href="#Stepper_Protocol_P2-1720"><span class="linenos">1720</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="n">line_len</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="n">line_len</span>
</span><span id="Stepper_Protocol_P2-1721"><a href="#Stepper_Protocol_P2-1721"><span class="linenos">1721</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1722"><a href="#Stepper_Protocol_P2-1722"><span class="linenos">1722</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P2-1723"><a href="#Stepper_Protocol_P2-1723"><span class="linenos">1723</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1724"><a href="#Stepper_Protocol_P2-1724"><span class="linenos">1724</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for reading the firmware trace.</span>
</span><span id="Stepper_Protocol_P2-1725"><a href="#Stepper_Protocol_P2-1725"><span class="linenos">1725</span></a>
</span><span id="Stepper_Protocol_P2-1726"><a href="#Stepper_Protocol_P2-1726"><span class="linenos">1726</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2-1727"><a href="#Stepper_Protocol_P2-1727"><span class="linenos">1727</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2-1728"><a href="#Stepper_Protocol_P2-1728"><span class="linenos">1728</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P2-1729"><a href="#Stepper_Protocol_P2-1729"><span class="linenos">1729</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P2-1730"><a href="#Stepper_Protocol_P2-1730"><span class="linenos">1730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1731"><a href="#Stepper_Protocol_P2-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_TRACE</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1732"><a href="#Stepper_Protocol_P2-1732"><span class="linenos">1732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Stepper_Protocol_P2-1733"><a href="#Stepper_Protocol_P2-1733"><span class="linenos">1733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{},</span><span class="s1">&#39;debug&#39;</span><span class="p">:{},</span><span class="s1">&#39;print&#39;</span><span class="p">:{}})</span>
</span><span id="Stepper_Protocol_P2-1734"><a href="#Stepper_Protocol_P2-1734"><span class="linenos">1734</span></a>            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_STATUS</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1735"><a href="#Stepper_Protocol_P2-1735"><span class="linenos">1735</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2-1736"><a href="#Stepper_Protocol_P2-1736"><span class="linenos">1736</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1737"><a href="#Stepper_Protocol_P2-1737"><span class="linenos">1737</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_DEBUG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1738"><a href="#Stepper_Protocol_P2-1738"><span class="linenos">1738</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_debug_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1739"><a href="#Stepper_Protocol_P2-1739"><span class="linenos">1739</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_PRINT</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1740"><a href="#Stepper_Protocol_P2-1740"><span class="linenos">1740</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_print_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;print&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1741"><a href="#Stepper_Protocol_P2-1741"><span class="linenos">1741</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1742"><a href="#Stepper_Protocol_P2-1742"><span class="linenos">1742</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized trace type </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1743"><a href="#Stepper_Protocol_P2-1743"><span class="linenos">1743</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1744"><a href="#Stepper_Protocol_P2-1744"><span class="linenos">1744</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_TRACE&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2-1745"><a href="#Stepper_Protocol_P2-1745"><span class="linenos">1745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1746"><a href="#Stepper_Protocol_P2-1746"><span class="linenos">1746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Stepper_Protocol_P2-1747"><a href="#Stepper_Protocol_P2-1747"><span class="linenos">1747</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1748"><a href="#Stepper_Protocol_P2-1748"><span class="linenos">1748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the trigger to enable firmware trace.</span>
</span><span id="Stepper_Protocol_P2-1749"><a href="#Stepper_Protocol_P2-1749"><span class="linenos">1749</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1750"><a href="#Stepper_Protocol_P2-1750"><span class="linenos">1750</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_ENABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2-1751"><a href="#Stepper_Protocol_P2-1751"><span class="linenos">1751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper_Protocol_P2-1752"><a href="#Stepper_Protocol_P2-1752"><span class="linenos">1752</span></a>
</span><span id="Stepper_Protocol_P2-1753"><a href="#Stepper_Protocol_P2-1753"><span class="linenos">1753</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1754"><a href="#Stepper_Protocol_P2-1754"><span class="linenos">1754</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the trigger to disable firmware trace.</span>
</span><span id="Stepper_Protocol_P2-1755"><a href="#Stepper_Protocol_P2-1755"><span class="linenos">1755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1756"><a href="#Stepper_Protocol_P2-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_DISABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2-1757"><a href="#Stepper_Protocol_P2-1757"><span class="linenos">1757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper_Protocol_P2-1758"><a href="#Stepper_Protocol_P2-1758"><span class="linenos">1758</span></a>
</span><span id="Stepper_Protocol_P2-1759"><a href="#Stepper_Protocol_P2-1759"><span class="linenos">1759</span></a>
</span><span id="Stepper_Protocol_P2-1760"><a href="#Stepper_Protocol_P2-1760"><span class="linenos">1760</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1761"><a href="#Stepper_Protocol_P2-1761"><span class="linenos">1761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks status information and updates the `unpack_to` dictionary.</span>
</span><span id="Stepper_Protocol_P2-1762"><a href="#Stepper_Protocol_P2-1762"><span class="linenos">1762</span></a>
</span><span id="Stepper_Protocol_P2-1763"><a href="#Stepper_Protocol_P2-1763"><span class="linenos">1763</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2-1764"><a href="#Stepper_Protocol_P2-1764"><span class="linenos">1764</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2-1765"><a href="#Stepper_Protocol_P2-1765"><span class="linenos">1765</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P2-1766"><a href="#Stepper_Protocol_P2-1766"><span class="linenos">1766</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="Stepper_Protocol_P2-1767"><a href="#Stepper_Protocol_P2-1767"><span class="linenos">1767</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P2-1768"><a href="#Stepper_Protocol_P2-1768"><span class="linenos">1768</span></a><span class="sd">        unpack_to : dict, optional.</span>
</span><span id="Stepper_Protocol_P2-1769"><a href="#Stepper_Protocol_P2-1769"><span class="linenos">1769</span></a><span class="sd">            A dictionary to store the unpacked status information, by default None.</span>
</span><span id="Stepper_Protocol_P2-1770"><a href="#Stepper_Protocol_P2-1770"><span class="linenos">1770</span></a>
</span><span id="Stepper_Protocol_P2-1771"><a href="#Stepper_Protocol_P2-1771"><span class="linenos">1771</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2-1772"><a href="#Stepper_Protocol_P2-1772"><span class="linenos">1772</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2-1773"><a href="#Stepper_Protocol_P2-1773"><span class="linenos">1773</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P2-1774"><a href="#Stepper_Protocol_P2-1774"><span class="linenos">1774</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2-1775"><a href="#Stepper_Protocol_P2-1775"><span class="linenos">1775</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2-1776"><a href="#Stepper_Protocol_P2-1776"><span class="linenos">1776</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1777"><a href="#Stepper_Protocol_P2-1777"><span class="linenos">1777</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P2-1778"><a href="#Stepper_Protocol_P2-1778"><span class="linenos">1778</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1779"><a href="#Stepper_Protocol_P2-1779"><span class="linenos">1779</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1780"><a href="#Stepper_Protocol_P2-1780"><span class="linenos">1780</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1781"><a href="#Stepper_Protocol_P2-1781"><span class="linenos">1781</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1782"><a href="#Stepper_Protocol_P2-1782"><span class="linenos">1782</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1783"><a href="#Stepper_Protocol_P2-1783"><span class="linenos">1783</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P2-1784"><a href="#Stepper_Protocol_P2-1784"><span class="linenos">1784</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1785"><a href="#Stepper_Protocol_P2-1785"><span class="linenos">1785</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1786"><a href="#Stepper_Protocol_P2-1786"><span class="linenos">1786</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1787"><a href="#Stepper_Protocol_P2-1787"><span class="linenos">1787</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2-1788"><a href="#Stepper_Protocol_P2-1788"><span class="linenos">1788</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1789"><a href="#Stepper_Protocol_P2-1789"><span class="linenos">1789</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1790"><a href="#Stepper_Protocol_P2-1790"><span class="linenos">1790</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1791"><a href="#Stepper_Protocol_P2-1791"><span class="linenos">1791</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P2-1792"><a href="#Stepper_Protocol_P2-1792"><span class="linenos">1792</span></a>
</span><span id="Stepper_Protocol_P2-1793"><a href="#Stepper_Protocol_P2-1793"><span class="linenos">1793</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1794"><a href="#Stepper_Protocol_P2-1794"><span class="linenos">1794</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1795"><a href="#Stepper_Protocol_P2-1795"><span class="linenos">1795</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1796"><a href="#Stepper_Protocol_P2-1796"><span class="linenos">1796</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1797"><a href="#Stepper_Protocol_P2-1797"><span class="linenos">1797</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1798"><a href="#Stepper_Protocol_P2-1798"><span class="linenos">1798</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1799"><a href="#Stepper_Protocol_P2-1799"><span class="linenos">1799</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1800"><a href="#Stepper_Protocol_P2-1800"><span class="linenos">1800</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1801"><a href="#Stepper_Protocol_P2-1801"><span class="linenos">1801</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1802"><a href="#Stepper_Protocol_P2-1802"><span class="linenos">1802</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1803"><a href="#Stepper_Protocol_P2-1803"><span class="linenos">1803</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1804"><a href="#Stepper_Protocol_P2-1804"><span class="linenos">1804</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1805"><a href="#Stepper_Protocol_P2-1805"><span class="linenos">1805</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1806"><a href="#Stepper_Protocol_P2-1806"><span class="linenos">1806</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_TRACE_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1807"><a href="#Stepper_Protocol_P2-1807"><span class="linenos">1807</span></a>
</span><span id="Stepper_Protocol_P2-1808"><a href="#Stepper_Protocol_P2-1808"><span class="linenos">1808</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1809"><a href="#Stepper_Protocol_P2-1809"><span class="linenos">1809</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P2-1810"><a href="#Stepper_Protocol_P2-1810"><span class="linenos">1810</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1811"><a href="#Stepper_Protocol_P2-1811"><span class="linenos">1811</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P2-1812"><a href="#Stepper_Protocol_P2-1812"><span class="linenos">1812</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1813"><a href="#Stepper_Protocol_P2-1813"><span class="linenos">1813</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P2-1814"><a href="#Stepper_Protocol_P2-1814"><span class="linenos">1814</span></a>
</span><span id="Stepper_Protocol_P2-1815"><a href="#Stepper_Protocol_P2-1815"><span class="linenos">1815</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P2.read_firmware_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.read_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.read_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.read_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.read_firmware_trace-1660"><a href="#Stepper_Protocol_P2.read_firmware_trace-1660"><span class="linenos">1660</span></a>    <span class="k">def</span> <span class="nf">read_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1661"><a href="#Stepper_Protocol_P2.read_firmware_trace-1661"><span class="linenos">1661</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads firmware trace data and returns it as a list.</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1662"><a href="#Stepper_Protocol_P2.read_firmware_trace-1662"><span class="linenos">1662</span></a>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1663"><a href="#Stepper_Protocol_P2.read_firmware_trace-1663"><span class="linenos">1663</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1664"><a href="#Stepper_Protocol_P2.read_firmware_trace-1664"><span class="linenos">1664</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1665"><a href="#Stepper_Protocol_P2.read_firmware_trace-1665"><span class="linenos">1665</span></a><span class="sd">        list:</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1666"><a href="#Stepper_Protocol_P2.read_firmware_trace-1666"><span class="linenos">1666</span></a><span class="sd">            A list containing the firmware trace data.</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1667"><a href="#Stepper_Protocol_P2.read_firmware_trace-1667"><span class="linenos">1667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1668"><a href="#Stepper_Protocol_P2.read_firmware_trace-1668"><span class="linenos">1668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1669"><a href="#Stepper_Protocol_P2.read_firmware_trace-1669"><span class="linenos">1669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1">#Timestamp holds state, reset within lock to avoid threading issues</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1670"><a href="#Stepper_Protocol_P2.read_firmware_trace-1670"><span class="linenos">1670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1671"><a href="#Stepper_Protocol_P2.read_firmware_trace-1671"><span class="linenos">1671</span></a>        <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1672"><a href="#Stepper_Protocol_P2.read_firmware_trace-1672"><span class="linenos">1672</span></a>        <span class="k">while</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&lt;</span><span class="mf">60.0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1673"><a href="#Stepper_Protocol_P2.read_firmware_trace-1673"><span class="linenos">1673</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_TRACE</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1674"><a href="#Stepper_Protocol_P2.read_firmware_trace-1674"><span class="linenos">1674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_firmware_trace_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1675"><a href="#Stepper_Protocol_P2.read_firmware_trace-1675"><span class="linenos">1675</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1676"><a href="#Stepper_Protocol_P2.read_firmware_trace-1676"><span class="linenos">1676</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span>
</span></pre></div>


            <div class="docstring"><p>Reads firmware trace data and returns it as a list.</p>

<h2 id="returns">Returns</h2>

<p>list:
    A list containing the firmware trace data.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P2.unpack_debug_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.unpack_debug_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_debug_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.unpack_debug_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.unpack_debug_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.unpack_debug_trace-1677"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1677"><span class="linenos">1677</span></a>    <span class="k">def</span> <span class="nf">unpack_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1678"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1678"><span class="linenos">1678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks debug trace data into the `unpack_to` dictionary.</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1679"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1679"><span class="linenos">1679</span></a>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1680"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1680"><span class="linenos">1680</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1681"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1681"><span class="linenos">1681</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1682"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1682"><span class="linenos">1682</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1683"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1683"><span class="linenos">1683</span></a><span class="sd">            The byte string containing debug trace information.</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1684"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1684"><span class="linenos">1684</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1685"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1685"><span class="linenos">1685</span></a><span class="sd">        unpack_to : dict.</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1686"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1686"><span class="linenos">1686</span></a><span class="sd">            A dictionary to store the unpacked information.</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1687"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1687"><span class="linenos">1687</span></a>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1688"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1688"><span class="linenos">1688</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1689"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1689"><span class="linenos">1689</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1690"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1690"><span class="linenos">1690</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1691"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1691"><span class="linenos">1691</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1692"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1692"><span class="linenos">1692</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1693"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1693"><span class="linenos">1693</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1694"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1694"><span class="linenos">1694</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1695"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1695"><span class="linenos">1695</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1696"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1696"><span class="linenos">1696</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1697"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1697"><span class="linenos">1697</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1698"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1698"><span class="linenos">1698</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1699"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1699"><span class="linenos">1699</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpacks debug trace data into the <code>unpack_to</code> dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    The byte string containing debug trace information.</p>

<p>unpack_to : dict.
    A dictionary to store the unpacked information.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P2.unpack_print_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.unpack_print_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_print_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.unpack_print_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.unpack_print_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.unpack_print_trace-1701"><a href="#Stepper_Protocol_P2.unpack_print_trace-1701"><span class="linenos">1701</span></a>    <span class="k">def</span> <span class="nf">unpack_print_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1702"><a href="#Stepper_Protocol_P2.unpack_print_trace-1702"><span class="linenos">1702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and prints trace information into the `unpack_to` dictionary.</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1703"><a href="#Stepper_Protocol_P2.unpack_print_trace-1703"><span class="linenos">1703</span></a>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1704"><a href="#Stepper_Protocol_P2.unpack_print_trace-1704"><span class="linenos">1704</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1705"><a href="#Stepper_Protocol_P2.unpack_print_trace-1705"><span class="linenos">1705</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1706"><a href="#Stepper_Protocol_P2.unpack_print_trace-1706"><span class="linenos">1706</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1707"><a href="#Stepper_Protocol_P2.unpack_print_trace-1707"><span class="linenos">1707</span></a><span class="sd">            The byte string containing print trace information.</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1708"><a href="#Stepper_Protocol_P2.unpack_print_trace-1708"><span class="linenos">1708</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1709"><a href="#Stepper_Protocol_P2.unpack_print_trace-1709"><span class="linenos">1709</span></a><span class="sd">        unpack_to : dict.</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1710"><a href="#Stepper_Protocol_P2.unpack_print_trace-1710"><span class="linenos">1710</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1711"><a href="#Stepper_Protocol_P2.unpack_print_trace-1711"><span class="linenos">1711</span></a>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1712"><a href="#Stepper_Protocol_P2.unpack_print_trace-1712"><span class="linenos">1712</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1713"><a href="#Stepper_Protocol_P2.unpack_print_trace-1713"><span class="linenos">1713</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1714"><a href="#Stepper_Protocol_P2.unpack_print_trace-1714"><span class="linenos">1714</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1715"><a href="#Stepper_Protocol_P2.unpack_print_trace-1715"><span class="linenos">1715</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1716"><a href="#Stepper_Protocol_P2.unpack_print_trace-1716"><span class="linenos">1716</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1717"><a href="#Stepper_Protocol_P2.unpack_print_trace-1717"><span class="linenos">1717</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1718"><a href="#Stepper_Protocol_P2.unpack_print_trace-1718"><span class="linenos">1718</span></a>        <span class="n">line_len</span><span class="o">=</span><span class="mi">32</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1719"><a href="#Stepper_Protocol_P2.unpack_print_trace-1719"><span class="linenos">1719</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1720"><a href="#Stepper_Protocol_P2.unpack_print_trace-1720"><span class="linenos">1720</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="n">line_len</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="n">line_len</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1721"><a href="#Stepper_Protocol_P2.unpack_print_trace-1721"><span class="linenos">1721</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1722"><a href="#Stepper_Protocol_P2.unpack_print_trace-1722"><span class="linenos">1722</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpacks and prints trace information into the <code>unpack_to</code> dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    The byte string containing print trace information.</p>

<p>unpack_to : dict.
    The index indicating the position in the byte array after unpacking.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply" class="classattr">
                                        <input id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_read_firmware_trace_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1723"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1723"><span class="linenos">1723</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1724"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1724"><span class="linenos">1724</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for reading the firmware trace.</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1725"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1725"><span class="linenos">1725</span></a>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1726"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1726"><span class="linenos">1726</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1727"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1727"><span class="linenos">1727</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1728"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1728"><span class="linenos">1728</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1729"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1729"><span class="linenos">1729</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1730"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1730"><span class="linenos">1730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1731"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_TRACE</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1732"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1732"><span class="linenos">1732</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1733"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1733"><span class="linenos">1733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{},</span><span class="s1">&#39;debug&#39;</span><span class="p">:{},</span><span class="s1">&#39;print&#39;</span><span class="p">:{}})</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1734"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1734"><span class="linenos">1734</span></a>            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_STATUS</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1735"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1735"><span class="linenos">1735</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1736"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1736"><span class="linenos">1736</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1737"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1737"><span class="linenos">1737</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_DEBUG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1738"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1738"><span class="linenos">1738</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_debug_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1739"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1739"><span class="linenos">1739</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_PRINT</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1740"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1740"><span class="linenos">1740</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_print_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;print&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1741"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1741"><span class="linenos">1741</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1742"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1742"><span class="linenos">1742</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized trace type </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1743"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1743"><span class="linenos">1743</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1744"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1744"><span class="linenos">1744</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_TRACE&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1745"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1745"><span class="linenos">1745</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1746"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1746"><span class="linenos">1746</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for reading the firmware trace.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P2.enable_firmware_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.enable_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.enable_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.enable_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.enable_firmware_trace-1747"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1747"><span class="linenos">1747</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.enable_firmware_trace-1748"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1748"><span class="linenos">1748</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the trigger to enable firmware trace.</span>
</span><span id="Stepper_Protocol_P2.enable_firmware_trace-1749"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1749"><span class="linenos">1749</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.enable_firmware_trace-1750"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1750"><span class="linenos">1750</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_ENABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2.enable_firmware_trace-1751"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1751"><span class="linenos">1751</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Sets the trigger to enable firmware trace.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P2.disable_firmware_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.disable_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.disable_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.disable_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.disable_firmware_trace-1753"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1753"><span class="linenos">1753</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.disable_firmware_trace-1754"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1754"><span class="linenos">1754</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the trigger to disable firmware trace.</span>
</span><span id="Stepper_Protocol_P2.disable_firmware_trace-1755"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1755"><span class="linenos">1755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.disable_firmware_trace-1756"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_DISABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2.disable_firmware_trace-1757"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1757"><span class="linenos">1757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Sets the trigger to disable firmware trace.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P2.unpack_status" class="classattr">
                                        <input id="Stepper_Protocol_P2.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.unpack_status-1760"><a href="#Stepper_Protocol_P2.unpack_status-1760"><span class="linenos">1760</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1761"><a href="#Stepper_Protocol_P2.unpack_status-1761"><span class="linenos">1761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks status information and updates the `unpack_to` dictionary.</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1762"><a href="#Stepper_Protocol_P2.unpack_status-1762"><span class="linenos">1762</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1763"><a href="#Stepper_Protocol_P2.unpack_status-1763"><span class="linenos">1763</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1764"><a href="#Stepper_Protocol_P2.unpack_status-1764"><span class="linenos">1764</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1765"><a href="#Stepper_Protocol_P2.unpack_status-1765"><span class="linenos">1765</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1766"><a href="#Stepper_Protocol_P2.unpack_status-1766"><span class="linenos">1766</span></a><span class="sd">            A byte string containing packed status data.</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1767"><a href="#Stepper_Protocol_P2.unpack_status-1767"><span class="linenos">1767</span></a><span class="sd">        </span>
</span><span id="Stepper_Protocol_P2.unpack_status-1768"><a href="#Stepper_Protocol_P2.unpack_status-1768"><span class="linenos">1768</span></a><span class="sd">        unpack_to : dict, optional.</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1769"><a href="#Stepper_Protocol_P2.unpack_status-1769"><span class="linenos">1769</span></a><span class="sd">            A dictionary to store the unpacked status information, by default None.</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1770"><a href="#Stepper_Protocol_P2.unpack_status-1770"><span class="linenos">1770</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1771"><a href="#Stepper_Protocol_P2.unpack_status-1771"><span class="linenos">1771</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1772"><a href="#Stepper_Protocol_P2.unpack_status-1772"><span class="linenos">1772</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1773"><a href="#Stepper_Protocol_P2.unpack_status-1773"><span class="linenos">1773</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1774"><a href="#Stepper_Protocol_P2.unpack_status-1774"><span class="linenos">1774</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1775"><a href="#Stepper_Protocol_P2.unpack_status-1775"><span class="linenos">1775</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1776"><a href="#Stepper_Protocol_P2.unpack_status-1776"><span class="linenos">1776</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1777"><a href="#Stepper_Protocol_P2.unpack_status-1777"><span class="linenos">1777</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1778"><a href="#Stepper_Protocol_P2.unpack_status-1778"><span class="linenos">1778</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1779"><a href="#Stepper_Protocol_P2.unpack_status-1779"><span class="linenos">1779</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1780"><a href="#Stepper_Protocol_P2.unpack_status-1780"><span class="linenos">1780</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1781"><a href="#Stepper_Protocol_P2.unpack_status-1781"><span class="linenos">1781</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1782"><a href="#Stepper_Protocol_P2.unpack_status-1782"><span class="linenos">1782</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1783"><a href="#Stepper_Protocol_P2.unpack_status-1783"><span class="linenos">1783</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1784"><a href="#Stepper_Protocol_P2.unpack_status-1784"><span class="linenos">1784</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1785"><a href="#Stepper_Protocol_P2.unpack_status-1785"><span class="linenos">1785</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1786"><a href="#Stepper_Protocol_P2.unpack_status-1786"><span class="linenos">1786</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1787"><a href="#Stepper_Protocol_P2.unpack_status-1787"><span class="linenos">1787</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1788"><a href="#Stepper_Protocol_P2.unpack_status-1788"><span class="linenos">1788</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1789"><a href="#Stepper_Protocol_P2.unpack_status-1789"><span class="linenos">1789</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1790"><a href="#Stepper_Protocol_P2.unpack_status-1790"><span class="linenos">1790</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1791"><a href="#Stepper_Protocol_P2.unpack_status-1791"><span class="linenos">1791</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1792"><a href="#Stepper_Protocol_P2.unpack_status-1792"><span class="linenos">1792</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1793"><a href="#Stepper_Protocol_P2.unpack_status-1793"><span class="linenos">1793</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1794"><a href="#Stepper_Protocol_P2.unpack_status-1794"><span class="linenos">1794</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1795"><a href="#Stepper_Protocol_P2.unpack_status-1795"><span class="linenos">1795</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1796"><a href="#Stepper_Protocol_P2.unpack_status-1796"><span class="linenos">1796</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1797"><a href="#Stepper_Protocol_P2.unpack_status-1797"><span class="linenos">1797</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1798"><a href="#Stepper_Protocol_P2.unpack_status-1798"><span class="linenos">1798</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1799"><a href="#Stepper_Protocol_P2.unpack_status-1799"><span class="linenos">1799</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1800"><a href="#Stepper_Protocol_P2.unpack_status-1800"><span class="linenos">1800</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1801"><a href="#Stepper_Protocol_P2.unpack_status-1801"><span class="linenos">1801</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1802"><a href="#Stepper_Protocol_P2.unpack_status-1802"><span class="linenos">1802</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1803"><a href="#Stepper_Protocol_P2.unpack_status-1803"><span class="linenos">1803</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1804"><a href="#Stepper_Protocol_P2.unpack_status-1804"><span class="linenos">1804</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1805"><a href="#Stepper_Protocol_P2.unpack_status-1805"><span class="linenos">1805</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1806"><a href="#Stepper_Protocol_P2.unpack_status-1806"><span class="linenos">1806</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_TRACE_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1807"><a href="#Stepper_Protocol_P2.unpack_status-1807"><span class="linenos">1807</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1808"><a href="#Stepper_Protocol_P2.unpack_status-1808"><span class="linenos">1808</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1809"><a href="#Stepper_Protocol_P2.unpack_status-1809"><span class="linenos">1809</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1810"><a href="#Stepper_Protocol_P2.unpack_status-1810"><span class="linenos">1810</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1811"><a href="#Stepper_Protocol_P2.unpack_status-1811"><span class="linenos">1811</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1812"><a href="#Stepper_Protocol_P2.unpack_status-1812"><span class="linenos">1812</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1813"><a href="#Stepper_Protocol_P2.unpack_status-1813"><span class="linenos">1813</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1814"><a href="#Stepper_Protocol_P2.unpack_status-1814"><span class="linenos">1814</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1815"><a href="#Stepper_Protocol_P2.unpack_status-1815"><span class="linenos">1815</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpacks status information and updates the <code>unpack_to</code> dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte string containing packed status data.</p>

<p>unpack_to : dict, optional.
    A dictionary to store the unpacked status information, by default None.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P2.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P2.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P2.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P2.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P2.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P2.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P2.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P2.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P2.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P2.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P2.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P2.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P2.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P2.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P2.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P2.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P2.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P2.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P2.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P2.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P2.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P2.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P2.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P2.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P2.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P2.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P2.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P2.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P2.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P2.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P2.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P2.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P2.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P2.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P2.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P2.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P2.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P2.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P2.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P2.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P2.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P2.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P2.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P2.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P2.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P2.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P2.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P2.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P2.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P2.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P2.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P2.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P2.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P2.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P2.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P2.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P2.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P2.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P2.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P2.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P2.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P2.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P2.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P2.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P2.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P2.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P2.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P2.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P2.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P2.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P2.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P2.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P2.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P2.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P2.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P2.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P3">
                            <input id="Stepper_Protocol_P3-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P3</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P3-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3-1819"><a href="#Stepper_Protocol_P3-1819"><span class="linenos">1819</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P3</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1820"><a href="#Stepper_Protocol_P3-1820"><span class="linenos">1820</span></a>
</span><span id="Stepper_Protocol_P3-1821"><a href="#Stepper_Protocol_P3-1821"><span class="linenos">1821</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1822"><a href="#Stepper_Protocol_P3-1822"><span class="linenos">1822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for starting a new trajectory.</span>
</span><span id="Stepper_Protocol_P3-1823"><a href="#Stepper_Protocol_P3-1823"><span class="linenos">1823</span></a>
</span><span id="Stepper_Protocol_P3-1824"><a href="#Stepper_Protocol_P3-1824"><span class="linenos">1824</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1825"><a href="#Stepper_Protocol_P3-1825"><span class="linenos">1825</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1826"><a href="#Stepper_Protocol_P3-1826"><span class="linenos">1826</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3-1827"><a href="#Stepper_Protocol_P3-1827"><span class="linenos">1827</span></a><span class="sd">            The RPC reply sequence.</span>
</span><span id="Stepper_Protocol_P3-1828"><a href="#Stepper_Protocol_P3-1828"><span class="linenos">1828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1829"><a href="#Stepper_Protocol_P3-1829"><span class="linenos">1829</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1830"><a href="#Stepper_Protocol_P3-1830"><span class="linenos">1830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1831"><a href="#Stepper_Protocol_P3-1831"><span class="linenos">1831</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3-1832"><a href="#Stepper_Protocol_P3-1832"><span class="linenos">1832</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1833"><a href="#Stepper_Protocol_P3-1833"><span class="linenos">1833</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P3-1834"><a href="#Stepper_Protocol_P3-1834"><span class="linenos">1834</span></a>
</span><span id="Stepper_Protocol_P3-1835"><a href="#Stepper_Protocol_P3-1835"><span class="linenos">1835</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1836"><a href="#Stepper_Protocol_P3-1836"><span class="linenos">1836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for setting the next trajectory segment.</span>
</span><span id="Stepper_Protocol_P3-1837"><a href="#Stepper_Protocol_P3-1837"><span class="linenos">1837</span></a>
</span><span id="Stepper_Protocol_P3-1838"><a href="#Stepper_Protocol_P3-1838"><span class="linenos">1838</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1839"><a href="#Stepper_Protocol_P3-1839"><span class="linenos">1839</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1840"><a href="#Stepper_Protocol_P3-1840"><span class="linenos">1840</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3-1841"><a href="#Stepper_Protocol_P3-1841"><span class="linenos">1841</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P3-1842"><a href="#Stepper_Protocol_P3-1842"><span class="linenos">1842</span></a>
</span><span id="Stepper_Protocol_P3-1843"><a href="#Stepper_Protocol_P3-1843"><span class="linenos">1843</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1844"><a href="#Stepper_Protocol_P3-1844"><span class="linenos">1844</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1845"><a href="#Stepper_Protocol_P3-1845"><span class="linenos">1845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1846"><a href="#Stepper_Protocol_P3-1846"><span class="linenos">1846</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3-1847"><a href="#Stepper_Protocol_P3-1847"><span class="linenos">1847</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1848"><a href="#Stepper_Protocol_P3-1848"><span class="linenos">1848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P3-1849"><a href="#Stepper_Protocol_P3-1849"><span class="linenos">1849</span></a>
</span><span id="Stepper_Protocol_P3-1850"><a href="#Stepper_Protocol_P3-1850"><span class="linenos">1850</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1851"><a href="#Stepper_Protocol_P3-1851"><span class="linenos">1851</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push a load test payload to the hardware for testing.</span>
</span><span id="Stepper_Protocol_P3-1852"><a href="#Stepper_Protocol_P3-1852"><span class="linenos">1852</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1853"><a href="#Stepper_Protocol_P3-1853"><span class="linenos">1853</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1854"><a href="#Stepper_Protocol_P3-1854"><span class="linenos">1854</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3-1855"><a href="#Stepper_Protocol_P3-1855"><span class="linenos">1855</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P3-1856"><a href="#Stepper_Protocol_P3-1856"><span class="linenos">1856</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PUSH</span>
</span><span id="Stepper_Protocol_P3-1857"><a href="#Stepper_Protocol_P3-1857"><span class="linenos">1857</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span>
</span><span id="Stepper_Protocol_P3-1858"><a href="#Stepper_Protocol_P3-1858"><span class="linenos">1858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_push_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1859"><a href="#Stepper_Protocol_P3-1859"><span class="linenos">1859</span></a>
</span><span id="Stepper_Protocol_P3-1860"><a href="#Stepper_Protocol_P3-1860"><span class="linenos">1860</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1861"><a href="#Stepper_Protocol_P3-1861"><span class="linenos">1861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the results of a load test.</span>
</span><span id="Stepper_Protocol_P3-1862"><a href="#Stepper_Protocol_P3-1862"><span class="linenos">1862</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1863"><a href="#Stepper_Protocol_P3-1863"><span class="linenos">1863</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1864"><a href="#Stepper_Protocol_P3-1864"><span class="linenos">1864</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3-1865"><a href="#Stepper_Protocol_P3-1865"><span class="linenos">1865</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PULL</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1866"><a href="#Stepper_Protocol_P3-1866"><span class="linenos">1866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_pull_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1867"><a href="#Stepper_Protocol_P3-1867"><span class="linenos">1867</span></a>
</span><span id="Stepper_Protocol_P3-1868"><a href="#Stepper_Protocol_P3-1868"><span class="linenos">1868</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_push_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1869"><a href="#Stepper_Protocol_P3-1869"><span class="linenos">1869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for a load push test.</span>
</span><span id="Stepper_Protocol_P3-1870"><a href="#Stepper_Protocol_P3-1870"><span class="linenos">1870</span></a>
</span><span id="Stepper_Protocol_P3-1871"><a href="#Stepper_Protocol_P3-1871"><span class="linenos">1871</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1872"><a href="#Stepper_Protocol_P3-1872"><span class="linenos">1872</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1873"><a href="#Stepper_Protocol_P3-1873"><span class="linenos">1873</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3-1874"><a href="#Stepper_Protocol_P3-1874"><span class="linenos">1874</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P3-1875"><a href="#Stepper_Protocol_P3-1875"><span class="linenos">1875</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1876"><a href="#Stepper_Protocol_P3-1876"><span class="linenos">1876</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PUSH</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1877"><a href="#Stepper_Protocol_P3-1877"><span class="linenos">1877</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PUSH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1878"><a href="#Stepper_Protocol_P3-1878"><span class="linenos">1878</span></a>
</span><span id="Stepper_Protocol_P3-1879"><a href="#Stepper_Protocol_P3-1879"><span class="linenos">1879</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_pull_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1880"><a href="#Stepper_Protocol_P3-1880"><span class="linenos">1880</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for a load pull test.</span>
</span><span id="Stepper_Protocol_P3-1881"><a href="#Stepper_Protocol_P3-1881"><span class="linenos">1881</span></a>
</span><span id="Stepper_Protocol_P3-1882"><a href="#Stepper_Protocol_P3-1882"><span class="linenos">1882</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1883"><a href="#Stepper_Protocol_P3-1883"><span class="linenos">1883</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1884"><a href="#Stepper_Protocol_P3-1884"><span class="linenos">1884</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3-1885"><a href="#Stepper_Protocol_P3-1885"><span class="linenos">1885</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P3-1886"><a href="#Stepper_Protocol_P3-1886"><span class="linenos">1886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1887"><a href="#Stepper_Protocol_P3-1887"><span class="linenos">1887</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PULL</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1888"><a href="#Stepper_Protocol_P3-1888"><span class="linenos">1888</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Stepper_Protocol_P3-1889"><a href="#Stepper_Protocol_P3-1889"><span class="linenos">1889</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1890"><a href="#Stepper_Protocol_P3-1890"><span class="linenos">1890</span></a>                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">]:</span>
</span><span id="Stepper_Protocol_P3-1891"><a href="#Stepper_Protocol_P3-1891"><span class="linenos">1891</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load test pull bad data&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1892"><a href="#Stepper_Protocol_P3-1892"><span class="linenos">1892</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="Stepper_Protocol_P3-1893"><a href="#Stepper_Protocol_P3-1893"><span class="linenos">1893</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successful load test pull&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1894"><a href="#Stepper_Protocol_P3-1894"><span class="linenos">1894</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1895"><a href="#Stepper_Protocol_P3-1895"><span class="linenos">1895</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PULL&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1896"><a href="#Stepper_Protocol_P3-1896"><span class="linenos">1896</span></a>
</span><span id="Stepper_Protocol_P3-1897"><a href="#Stepper_Protocol_P3-1897"><span class="linenos">1897</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1898"><a href="#Stepper_Protocol_P3-1898"><span class="linenos">1898</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull auxiliary status information.</span>
</span><span id="Stepper_Protocol_P3-1899"><a href="#Stepper_Protocol_P3-1899"><span class="linenos">1899</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1900"><a href="#Stepper_Protocol_P3-1900"><span class="linenos">1900</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1901"><a href="#Stepper_Protocol_P3-1901"><span class="linenos">1901</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3-1902"><a href="#Stepper_Protocol_P3-1902"><span class="linenos">1902</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS_AUX</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1903"><a href="#Stepper_Protocol_P3-1903"><span class="linenos">1903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_aux_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1904"><a href="#Stepper_Protocol_P3-1904"><span class="linenos">1904</span></a>
</span><span id="Stepper_Protocol_P3-1905"><a href="#Stepper_Protocol_P3-1905"><span class="linenos">1905</span></a>    <span class="k">def</span> <span class="nf">unpack_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1906"><a href="#Stepper_Protocol_P3-1906"><span class="linenos">1906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and stores auxiliary status information.</span>
</span><span id="Stepper_Protocol_P3-1907"><a href="#Stepper_Protocol_P3-1907"><span class="linenos">1907</span></a>
</span><span id="Stepper_Protocol_P3-1908"><a href="#Stepper_Protocol_P3-1908"><span class="linenos">1908</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1909"><a href="#Stepper_Protocol_P3-1909"><span class="linenos">1909</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1910"><a href="#Stepper_Protocol_P3-1910"><span class="linenos">1910</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P3-1911"><a href="#Stepper_Protocol_P3-1911"><span class="linenos">1911</span></a><span class="sd">            The byte string containing auxiliary status information.</span>
</span><span id="Stepper_Protocol_P3-1912"><a href="#Stepper_Protocol_P3-1912"><span class="linenos">1912</span></a>
</span><span id="Stepper_Protocol_P3-1913"><a href="#Stepper_Protocol_P3-1913"><span class="linenos">1913</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P3-1914"><a href="#Stepper_Protocol_P3-1914"><span class="linenos">1914</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P3-1915"><a href="#Stepper_Protocol_P3-1915"><span class="linenos">1915</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P3-1916"><a href="#Stepper_Protocol_P3-1916"><span class="linenos">1916</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P3-1917"><a href="#Stepper_Protocol_P3-1917"><span class="linenos">1917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1918"><a href="#Stepper_Protocol_P3-1918"><span class="linenos">1918</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3-1919"><a href="#Stepper_Protocol_P3-1919"><span class="linenos">1919</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1920"><a href="#Stepper_Protocol_P3-1920"><span class="linenos">1920</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1921"><a href="#Stepper_Protocol_P3-1921"><span class="linenos">1921</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1922"><a href="#Stepper_Protocol_P3-1922"><span class="linenos">1922</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1923"><a href="#Stepper_Protocol_P3-1923"><span class="linenos">1923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1924"><a href="#Stepper_Protocol_P3-1924"><span class="linenos">1924</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1925"><a href="#Stepper_Protocol_P3-1925"><span class="linenos">1925</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1926"><a href="#Stepper_Protocol_P3-1926"><span class="linenos">1926</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1927"><a href="#Stepper_Protocol_P3-1927"><span class="linenos">1927</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1928"><a href="#Stepper_Protocol_P3-1928"><span class="linenos">1928</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1929"><a href="#Stepper_Protocol_P3-1929"><span class="linenos">1929</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P3-1930"><a href="#Stepper_Protocol_P3-1930"><span class="linenos">1930</span></a>
</span><span id="Stepper_Protocol_P3-1931"><a href="#Stepper_Protocol_P3-1931"><span class="linenos">1931</span></a>    <span class="k">def</span> <span class="nf">rpc_status_aux_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1932"><a href="#Stepper_Protocol_P3-1932"><span class="linenos">1932</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the reply to the auxiliary status command.</span>
</span><span id="Stepper_Protocol_P3-1933"><a href="#Stepper_Protocol_P3-1933"><span class="linenos">1933</span></a>
</span><span id="Stepper_Protocol_P3-1934"><a href="#Stepper_Protocol_P3-1934"><span class="linenos">1934</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1935"><a href="#Stepper_Protocol_P3-1935"><span class="linenos">1935</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1936"><a href="#Stepper_Protocol_P3-1936"><span class="linenos">1936</span></a><span class="sd">        reply : list.</span>
</span><span id="Stepper_Protocol_P3-1937"><a href="#Stepper_Protocol_P3-1937"><span class="linenos">1937</span></a><span class="sd">            The reply received.</span>
</span><span id="Stepper_Protocol_P3-1938"><a href="#Stepper_Protocol_P3-1938"><span class="linenos">1938</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1939"><a href="#Stepper_Protocol_P3-1939"><span class="linenos">1939</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS_AUX</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1940"><a href="#Stepper_Protocol_P3-1940"><span class="linenos">1940</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status_aux</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1941"><a href="#Stepper_Protocol_P3-1941"><span class="linenos">1941</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1942"><a href="#Stepper_Protocol_P3-1942"><span class="linenos">1942</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1943"><a href="#Stepper_Protocol_P3-1943"><span class="linenos">1943</span></a>
</span><span id="Stepper_Protocol_P3-1944"><a href="#Stepper_Protocol_P3-1944"><span class="linenos">1944</span></a>
</span><span id="Stepper_Protocol_P3-1945"><a href="#Stepper_Protocol_P3-1945"><span class="linenos">1945</span></a>    <span class="k">def</span> <span class="nf">unpack_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1946"><a href="#Stepper_Protocol_P3-1946"><span class="linenos">1946</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and stores command related information </span>
</span><span id="Stepper_Protocol_P3-1947"><a href="#Stepper_Protocol_P3-1947"><span class="linenos">1947</span></a>
</span><span id="Stepper_Protocol_P3-1948"><a href="#Stepper_Protocol_P3-1948"><span class="linenos">1948</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1949"><a href="#Stepper_Protocol_P3-1949"><span class="linenos">1949</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1950"><a href="#Stepper_Protocol_P3-1950"><span class="linenos">1950</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P3-1951"><a href="#Stepper_Protocol_P3-1951"><span class="linenos">1951</span></a><span class="sd">            A byte sequence containing command related information.</span>
</span><span id="Stepper_Protocol_P3-1952"><a href="#Stepper_Protocol_P3-1952"><span class="linenos">1952</span></a>
</span><span id="Stepper_Protocol_P3-1953"><a href="#Stepper_Protocol_P3-1953"><span class="linenos">1953</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P3-1954"><a href="#Stepper_Protocol_P3-1954"><span class="linenos">1954</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P3-1955"><a href="#Stepper_Protocol_P3-1955"><span class="linenos">1955</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P3-1956"><a href="#Stepper_Protocol_P3-1956"><span class="linenos">1956</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P3-1957"><a href="#Stepper_Protocol_P3-1957"><span class="linenos">1957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1958"><a href="#Stepper_Protocol_P3-1958"><span class="linenos">1958</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3-1959"><a href="#Stepper_Protocol_P3-1959"><span class="linenos">1959</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1960"><a href="#Stepper_Protocol_P3-1960"><span class="linenos">1960</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1961"><a href="#Stepper_Protocol_P3-1961"><span class="linenos">1961</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P3-1962"><a href="#Stepper_Protocol_P3-1962"><span class="linenos">1962</span></a>
</span><span id="Stepper_Protocol_P3-1963"><a href="#Stepper_Protocol_P3-1963"><span class="linenos">1963</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1964"><a href="#Stepper_Protocol_P3-1964"><span class="linenos">1964</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the reply for a command-related information.</span>
</span><span id="Stepper_Protocol_P3-1965"><a href="#Stepper_Protocol_P3-1965"><span class="linenos">1965</span></a>
</span><span id="Stepper_Protocol_P3-1966"><a href="#Stepper_Protocol_P3-1966"><span class="linenos">1966</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3-1967"><a href="#Stepper_Protocol_P3-1967"><span class="linenos">1967</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3-1968"><a href="#Stepper_Protocol_P3-1968"><span class="linenos">1968</span></a><span class="sd">        reply : list.</span>
</span><span id="Stepper_Protocol_P3-1969"><a href="#Stepper_Protocol_P3-1969"><span class="linenos">1969</span></a><span class="sd">            A list containing the reply data.</span>
</span><span id="Stepper_Protocol_P3-1970"><a href="#Stepper_Protocol_P3-1970"><span class="linenos">1970</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3-1971"><a href="#Stepper_Protocol_P3-1971"><span class="linenos">1971</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1972"><a href="#Stepper_Protocol_P3-1972"><span class="linenos">1972</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_command_reply</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1973"><a href="#Stepper_Protocol_P3-1973"><span class="linenos">1973</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1974"><a href="#Stepper_Protocol_P3-1974"><span class="linenos">1974</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P3.rpc_start_new_traj_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_start_new_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_start_new_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_start_new_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_start_new_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1821"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1821"><span class="linenos">1821</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1822"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1822"><span class="linenos">1822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for starting a new trajectory.</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1823"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1823"><span class="linenos">1823</span></a>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1824"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1824"><span class="linenos">1824</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1825"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1825"><span class="linenos">1825</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1826"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1826"><span class="linenos">1826</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1827"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1827"><span class="linenos">1827</span></a><span class="sd">            The RPC reply sequence.</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1828"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1828"><span class="linenos">1828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1829"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1829"><span class="linenos">1829</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1830"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1830"><span class="linenos">1830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1831"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1831"><span class="linenos">1831</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1832"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1832"><span class="linenos">1832</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1833"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1833"><span class="linenos">1833</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for starting a new trajectory.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_set_next_traj_seg_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1835"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1835"><span class="linenos">1835</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1836"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1836"><span class="linenos">1836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for setting the next trajectory segment.</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1837"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1837"><span class="linenos">1837</span></a>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1838"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1838"><span class="linenos">1838</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1839"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1839"><span class="linenos">1839</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1840"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1840"><span class="linenos">1840</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1841"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1841"><span class="linenos">1841</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1842"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1842"><span class="linenos">1842</span></a>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1843"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1843"><span class="linenos">1843</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1844"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1844"><span class="linenos">1844</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1845"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1845"><span class="linenos">1845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1846"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1846"><span class="linenos">1846</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1847"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1847"><span class="linenos">1847</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1848"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1848"><span class="linenos">1848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for setting the next trajectory segment.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.push_load_test" class="classattr">
                                        <input id="Stepper_Protocol_P3.push_load_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">push_load_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.push_load_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.push_load_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.push_load_test-1850"><a href="#Stepper_Protocol_P3.push_load_test-1850"><span class="linenos">1850</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1851"><a href="#Stepper_Protocol_P3.push_load_test-1851"><span class="linenos">1851</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Push a load test payload to the hardware for testing.</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1852"><a href="#Stepper_Protocol_P3.push_load_test-1852"><span class="linenos">1852</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1853"><a href="#Stepper_Protocol_P3.push_load_test-1853"><span class="linenos">1853</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1854"><a href="#Stepper_Protocol_P3.push_load_test-1854"><span class="linenos">1854</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1855"><a href="#Stepper_Protocol_P3.push_load_test-1855"><span class="linenos">1855</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1856"><a href="#Stepper_Protocol_P3.push_load_test-1856"><span class="linenos">1856</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PUSH</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1857"><a href="#Stepper_Protocol_P3.push_load_test-1857"><span class="linenos">1857</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1858"><a href="#Stepper_Protocol_P3.push_load_test-1858"><span class="linenos">1858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_push_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Push a load test payload to the hardware for testing.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.pull_load_test" class="classattr">
                                        <input id="Stepper_Protocol_P3.pull_load_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_load_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.pull_load_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.pull_load_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.pull_load_test-1860"><a href="#Stepper_Protocol_P3.pull_load_test-1860"><span class="linenos">1860</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1861"><a href="#Stepper_Protocol_P3.pull_load_test-1861"><span class="linenos">1861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the results of a load test.</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1862"><a href="#Stepper_Protocol_P3.pull_load_test-1862"><span class="linenos">1862</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1863"><a href="#Stepper_Protocol_P3.pull_load_test-1863"><span class="linenos">1863</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1864"><a href="#Stepper_Protocol_P3.pull_load_test-1864"><span class="linenos">1864</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1865"><a href="#Stepper_Protocol_P3.pull_load_test-1865"><span class="linenos">1865</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PULL</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1866"><a href="#Stepper_Protocol_P3.pull_load_test-1866"><span class="linenos">1866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_pull_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pull the results of a load test.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.rpc_load_test_push_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_load_test_push_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_load_test_push_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_load_test_push_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_load_test_push_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1868"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1868"><span class="linenos">1868</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_push_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1869"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1869"><span class="linenos">1869</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for a load push test.</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1870"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1870"><span class="linenos">1870</span></a>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1871"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1871"><span class="linenos">1871</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1872"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1872"><span class="linenos">1872</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1873"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1873"><span class="linenos">1873</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1874"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1874"><span class="linenos">1874</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1875"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1875"><span class="linenos">1875</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1876"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1876"><span class="linenos">1876</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PUSH</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1877"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1877"><span class="linenos">1877</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PUSH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for a load push test.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.rpc_load_test_pull_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_load_test_pull_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_load_test_pull_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_load_test_pull_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_load_test_pull_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1879"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1879"><span class="linenos">1879</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_pull_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1880"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1880"><span class="linenos">1880</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the RPC reply for a load pull test.</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1881"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1881"><span class="linenos">1881</span></a>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1882"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1882"><span class="linenos">1882</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1883"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1883"><span class="linenos">1883</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1884"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1884"><span class="linenos">1884</span></a><span class="sd">        reply : bytes.</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1885"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1885"><span class="linenos">1885</span></a><span class="sd">            The RPC reply byte sequence.</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1886"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1886"><span class="linenos">1886</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1887"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1887"><span class="linenos">1887</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PULL</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1888"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1888"><span class="linenos">1888</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1889"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1889"><span class="linenos">1889</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1890"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1890"><span class="linenos">1890</span></a>                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">]:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1891"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1891"><span class="linenos">1891</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load test pull bad data&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1892"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1892"><span class="linenos">1892</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1893"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1893"><span class="linenos">1893</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successful load test pull&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1894"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1894"><span class="linenos">1894</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1895"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1895"><span class="linenos">1895</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PULL&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Process the RPC reply for a load pull test.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : bytes.
    The RPC reply byte sequence.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.pull_status_aux" class="classattr">
                                        <input id="Stepper_Protocol_P3.pull_status_aux-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_status_aux</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.pull_status_aux-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.pull_status_aux"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.pull_status_aux-1897"><a href="#Stepper_Protocol_P3.pull_status_aux-1897"><span class="linenos">1897</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1898"><a href="#Stepper_Protocol_P3.pull_status_aux-1898"><span class="linenos">1898</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull auxiliary status information.</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1899"><a href="#Stepper_Protocol_P3.pull_status_aux-1899"><span class="linenos">1899</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1900"><a href="#Stepper_Protocol_P3.pull_status_aux-1900"><span class="linenos">1900</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1901"><a href="#Stepper_Protocol_P3.pull_status_aux-1901"><span class="linenos">1901</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1902"><a href="#Stepper_Protocol_P3.pull_status_aux-1902"><span class="linenos">1902</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS_AUX</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1903"><a href="#Stepper_Protocol_P3.pull_status_aux-1903"><span class="linenos">1903</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_aux_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pull auxiliary status information.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.unpack_status_aux" class="classattr">
                                        <input id="Stepper_Protocol_P3.unpack_status_aux-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status_aux</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.unpack_status_aux-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.unpack_status_aux"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.unpack_status_aux-1905"><a href="#Stepper_Protocol_P3.unpack_status_aux-1905"><span class="linenos">1905</span></a>    <span class="k">def</span> <span class="nf">unpack_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1906"><a href="#Stepper_Protocol_P3.unpack_status_aux-1906"><span class="linenos">1906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and stores auxiliary status information.</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1907"><a href="#Stepper_Protocol_P3.unpack_status_aux-1907"><span class="linenos">1907</span></a>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1908"><a href="#Stepper_Protocol_P3.unpack_status_aux-1908"><span class="linenos">1908</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1909"><a href="#Stepper_Protocol_P3.unpack_status_aux-1909"><span class="linenos">1909</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1910"><a href="#Stepper_Protocol_P3.unpack_status_aux-1910"><span class="linenos">1910</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1911"><a href="#Stepper_Protocol_P3.unpack_status_aux-1911"><span class="linenos">1911</span></a><span class="sd">            The byte string containing auxiliary status information.</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1912"><a href="#Stepper_Protocol_P3.unpack_status_aux-1912"><span class="linenos">1912</span></a>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1913"><a href="#Stepper_Protocol_P3.unpack_status_aux-1913"><span class="linenos">1913</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1914"><a href="#Stepper_Protocol_P3.unpack_status_aux-1914"><span class="linenos">1914</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1915"><a href="#Stepper_Protocol_P3.unpack_status_aux-1915"><span class="linenos">1915</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1916"><a href="#Stepper_Protocol_P3.unpack_status_aux-1916"><span class="linenos">1916</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1917"><a href="#Stepper_Protocol_P3.unpack_status_aux-1917"><span class="linenos">1917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1918"><a href="#Stepper_Protocol_P3.unpack_status_aux-1918"><span class="linenos">1918</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1919"><a href="#Stepper_Protocol_P3.unpack_status_aux-1919"><span class="linenos">1919</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1920"><a href="#Stepper_Protocol_P3.unpack_status_aux-1920"><span class="linenos">1920</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1921"><a href="#Stepper_Protocol_P3.unpack_status_aux-1921"><span class="linenos">1921</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1922"><a href="#Stepper_Protocol_P3.unpack_status_aux-1922"><span class="linenos">1922</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1923"><a href="#Stepper_Protocol_P3.unpack_status_aux-1923"><span class="linenos">1923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1924"><a href="#Stepper_Protocol_P3.unpack_status_aux-1924"><span class="linenos">1924</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1925"><a href="#Stepper_Protocol_P3.unpack_status_aux-1925"><span class="linenos">1925</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1926"><a href="#Stepper_Protocol_P3.unpack_status_aux-1926"><span class="linenos">1926</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1927"><a href="#Stepper_Protocol_P3.unpack_status_aux-1927"><span class="linenos">1927</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1928"><a href="#Stepper_Protocol_P3.unpack_status_aux-1928"><span class="linenos">1928</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1929"><a href="#Stepper_Protocol_P3.unpack_status_aux-1929"><span class="linenos">1929</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpacks and stores auxiliary status information.</p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    The byte string containing auxiliary status information.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.rpc_status_aux_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_status_aux_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_status_aux_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_status_aux_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_status_aux_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1931"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1931"><span class="linenos">1931</span></a>    <span class="k">def</span> <span class="nf">rpc_status_aux_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1932"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1932"><span class="linenos">1932</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the reply to the auxiliary status command.</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1933"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1933"><span class="linenos">1933</span></a>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1934"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1934"><span class="linenos">1934</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1935"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1935"><span class="linenos">1935</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1936"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1936"><span class="linenos">1936</span></a><span class="sd">        reply : list.</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1937"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1937"><span class="linenos">1937</span></a><span class="sd">            The reply received.</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1938"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1938"><span class="linenos">1938</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1939"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1939"><span class="linenos">1939</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS_AUX</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1940"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1940"><span class="linenos">1940</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status_aux</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1941"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1941"><span class="linenos">1941</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1942"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1942"><span class="linenos">1942</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Handle the reply to the auxiliary status command.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    The reply received.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.unpack_command_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.unpack_command_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_command_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.unpack_command_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.unpack_command_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.unpack_command_reply-1945"><a href="#Stepper_Protocol_P3.unpack_command_reply-1945"><span class="linenos">1945</span></a>    <span class="k">def</span> <span class="nf">unpack_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1946"><a href="#Stepper_Protocol_P3.unpack_command_reply-1946"><span class="linenos">1946</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unpacks and stores command related information </span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1947"><a href="#Stepper_Protocol_P3.unpack_command_reply-1947"><span class="linenos">1947</span></a>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1948"><a href="#Stepper_Protocol_P3.unpack_command_reply-1948"><span class="linenos">1948</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1949"><a href="#Stepper_Protocol_P3.unpack_command_reply-1949"><span class="linenos">1949</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1950"><a href="#Stepper_Protocol_P3.unpack_command_reply-1950"><span class="linenos">1950</span></a><span class="sd">        s : bytes.</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1951"><a href="#Stepper_Protocol_P3.unpack_command_reply-1951"><span class="linenos">1951</span></a><span class="sd">            A byte sequence containing command related information.</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1952"><a href="#Stepper_Protocol_P3.unpack_command_reply-1952"><span class="linenos">1952</span></a>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1953"><a href="#Stepper_Protocol_P3.unpack_command_reply-1953"><span class="linenos">1953</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1954"><a href="#Stepper_Protocol_P3.unpack_command_reply-1954"><span class="linenos">1954</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1955"><a href="#Stepper_Protocol_P3.unpack_command_reply-1955"><span class="linenos">1955</span></a><span class="sd">        int:</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1956"><a href="#Stepper_Protocol_P3.unpack_command_reply-1956"><span class="linenos">1956</span></a><span class="sd">            The index indicating the position in the byte array after unpacking.</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1957"><a href="#Stepper_Protocol_P3.unpack_command_reply-1957"><span class="linenos">1957</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1958"><a href="#Stepper_Protocol_P3.unpack_command_reply-1958"><span class="linenos">1958</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1959"><a href="#Stepper_Protocol_P3.unpack_command_reply-1959"><span class="linenos">1959</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1960"><a href="#Stepper_Protocol_P3.unpack_command_reply-1960"><span class="linenos">1960</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1961"><a href="#Stepper_Protocol_P3.unpack_command_reply-1961"><span class="linenos">1961</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>Unpacks and stores command related information </p>

<h2 id="parameters">Parameters</h2>

<p>s : bytes.
    A byte sequence containing command related information.</p>

<h2 id="returns">Returns</h2>

<p>int:
    The index indicating the position in the byte array after unpacking.</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P3.rpc_command_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_command_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_command_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_command_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_command_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_command_reply-1963"><a href="#Stepper_Protocol_P3.rpc_command_reply-1963"><span class="linenos">1963</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1964"><a href="#Stepper_Protocol_P3.rpc_command_reply-1964"><span class="linenos">1964</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the reply for a command-related information.</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1965"><a href="#Stepper_Protocol_P3.rpc_command_reply-1965"><span class="linenos">1965</span></a>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1966"><a href="#Stepper_Protocol_P3.rpc_command_reply-1966"><span class="linenos">1966</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1967"><a href="#Stepper_Protocol_P3.rpc_command_reply-1967"><span class="linenos">1967</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1968"><a href="#Stepper_Protocol_P3.rpc_command_reply-1968"><span class="linenos">1968</span></a><span class="sd">        reply : list.</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1969"><a href="#Stepper_Protocol_P3.rpc_command_reply-1969"><span class="linenos">1969</span></a><span class="sd">            A list containing the reply data.</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1970"><a href="#Stepper_Protocol_P3.rpc_command_reply-1970"><span class="linenos">1970</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1971"><a href="#Stepper_Protocol_P3.rpc_command_reply-1971"><span class="linenos">1971</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1972"><a href="#Stepper_Protocol_P3.rpc_command_reply-1972"><span class="linenos">1972</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_command_reply</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1973"><a href="#Stepper_Protocol_P3.rpc_command_reply-1973"><span class="linenos">1973</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1974"><a href="#Stepper_Protocol_P3.rpc_command_reply-1974"><span class="linenos">1974</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Process the reply for a command-related information.</p>

<h2 id="parameters">Parameters</h2>

<p>reply : list.
    A list containing the reply data.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P3.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P3.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P3.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P3.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P3.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P3.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P3.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P3.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P3.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P3.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P3.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P3.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P3.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P3.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P3.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P3.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P3.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P3.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P3.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P3.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P3.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P3.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P3.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P3.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P3.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P3.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P3.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P3.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P3.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P3.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P3.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P3.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P3.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P3.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P3.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P3.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P3.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P3.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P3.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P3.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P3.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P3.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P3.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P3.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P3.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P3.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P3.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P3.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P3.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P3.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P3.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P3.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P3.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P3.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P3.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P3.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P3.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P3.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P3.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P3.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P3.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P3.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P3.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P3.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P3.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P3.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P3.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P3.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P3.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P3.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P3.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P3.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P3.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P3.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P3.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P3.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper">
                            <input id="Stepper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper-1977"><a href="#Stepper-1977"><span class="linenos">1977</span></a><span class="k">class</span> <span class="nc">Stepper</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper-1978"><a href="#Stepper-1978"><span class="linenos">1978</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Stepper-1979"><a href="#Stepper-1979"><span class="linenos">1979</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="Stepper-1980"><a href="#Stepper-1980"><span class="linenos">1980</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Stepper-1981"><a href="#Stepper-1981"><span class="linenos">1981</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper-1982"><a href="#Stepper-1982"><span class="linenos">1982</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper-1983"><a href="#Stepper-1983"><span class="linenos">1983</span></a>        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
</span><span id="Stepper-1984"><a href="#Stepper-1984"><span class="linenos">1984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper-1985"><a href="#Stepper-1985"><span class="linenos">1985</span></a>                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper-1986"><a href="#Stepper-1986"><span class="linenos">1986</span></a>                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper-1987"><a href="#Stepper-1987"><span class="linenos">1987</span></a>                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P3</span><span class="p">,</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,)}</span>
</span><span id="Stepper-1988"><a href="#Stepper-1988"><span class="linenos">1988</span></a>    
</span><span id="Stepper-1989"><a href="#Stepper-1989"><span class="linenos">1989</span></a>    <span class="k">def</span> <span class="nf">expand_protocol_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_class</span><span class="p">):</span>
</span><span id="Stepper-1990"><a href="#Stepper-1990"><span class="linenos">1990</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Expands protocol methods for use.</span>
</span><span id="Stepper-1991"><a href="#Stepper-1991"><span class="linenos">1991</span></a>
</span><span id="Stepper-1992"><a href="#Stepper-1992"><span class="linenos">1992</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper-1993"><a href="#Stepper-1993"><span class="linenos">1993</span></a><span class="sd">        ----------</span>
</span><span id="Stepper-1994"><a href="#Stepper-1994"><span class="linenos">1994</span></a><span class="sd">        protocol_class : class.</span>
</span><span id="Stepper-1995"><a href="#Stepper-1995"><span class="linenos">1995</span></a><span class="sd">            The protocol class from which the methods should be expanded.</span>
</span><span id="Stepper-1996"><a href="#Stepper-1996"><span class="linenos">1996</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper-1997"><a href="#Stepper-1997"><span class="linenos">1997</span></a>        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">protocol_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Stepper-1998"><a href="#Stepper-1998"><span class="linenos">1998</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
</span><span id="Stepper-1999"><a href="#Stepper-1999"><span class="linenos">1999</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stepper</span><span class="p">))</span>
</span><span id="Stepper-2000"><a href="#Stepper-2000"><span class="linenos">2000</span></a>                
</span><span id="Stepper-2001"><a href="#Stepper-2001"><span class="linenos">2001</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Stepper-2002"><a href="#Stepper-2002"><span class="linenos">2002</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Stepper-2003"><a href="#Stepper-2003"><span class="linenos">2003</span></a><span class="sd">        First determine which protocol version the uC firmware is running.</span>
</span><span id="Stepper-2004"><a href="#Stepper-2004"><span class="linenos">2004</span></a><span class="sd">        Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</span>
</span><span id="Stepper-2005"><a href="#Stepper-2005"><span class="linenos">2005</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper-2006"><a href="#Stepper-2006"><span class="linenos">2006</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="Stepper-2007"><a href="#Stepper-2007"><span class="linenos">2007</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper-2008"><a href="#Stepper-2008"><span class="linenos">2008</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
</span><span id="Stepper-2009"><a href="#Stepper-2009"><span class="linenos">2009</span></a>                <span class="n">protocol_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
</span><span id="Stepper-2010"><a href="#Stepper-2010"><span class="linenos">2010</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Stepper-2011"><a href="#Stepper-2011"><span class="linenos">2011</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_protocol_methods</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Stepper-2012"><a href="#Stepper-2012"><span class="linenos">2012</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper-2013"><a href="#Stepper-2013"><span class="linenos">2013</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper-2014"><a href="#Stepper-2014"><span class="linenos">2014</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper-2015"><a href="#Stepper-2015"><span class="linenos">2015</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper-2016"><a href="#Stepper-2016"><span class="linenos">2016</span></a><span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
</span><span id="Stepper-2017"><a href="#Stepper-2017"><span class="linenos">2017</span></a><span class="s2">                                    Please power cycle the robot and try again.</span>
</span><span id="Stepper-2018"><a href="#Stepper-2018"><span class="linenos">2018</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper-2019"><a href="#Stepper-2019"><span class="linenos">2019</span></a><span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper-2020"><a href="#Stepper-2020"><span class="linenos">2020</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper-2021"><a href="#Stepper-2021"><span class="linenos">2021</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper-2022"><a href="#Stepper-2022"><span class="linenos">2022</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper-2023"><a href="#Stepper-2023"><span class="linenos">2023</span></a><span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
</span><span id="Stepper-2024"><a href="#Stepper-2024"><span class="linenos">2024</span></a><span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
</span><span id="Stepper-2025"><a href="#Stepper-2025"><span class="linenos">2025</span></a><span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
</span><span id="Stepper-2026"><a href="#Stepper-2026"><span class="linenos">2026</span></a><span class="s2">                    Disabling device.</span>
</span><span id="Stepper-2027"><a href="#Stepper-2027"><span class="linenos">2027</span></a><span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
</span><span id="Stepper-2028"><a href="#Stepper-2028"><span class="linenos">2028</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper-2029"><a href="#Stepper-2029"><span class="linenos">2029</span></a><span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Stepper-2030"><a href="#Stepper-2030"><span class="linenos">2030</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
</span><span id="Stepper-2031"><a href="#Stepper-2031"><span class="linenos">2031</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Stepper-2032"><a href="#Stepper-2032"><span class="linenos">2032</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Stepper-2033"><a href="#Stepper-2033"><span class="linenos">2033</span></a>
</span><span id="Stepper-2034"><a href="#Stepper-2034"><span class="linenos">2034</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper-2035"><a href="#Stepper-2035"><span class="linenos">2035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="Stepper-2036"><a href="#Stepper-2036"><span class="linenos">2036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper-2037"><a href="#Stepper-2037"><span class="linenos">2037</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="Stepper-2038"><a href="#Stepper-2038"><span class="linenos">2038</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="Stepper-2039"><a href="#Stepper-2039"><span class="linenos">2039</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper.__init__" class="classattr">
                                        <input id="Stepper.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Stepper</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">usb</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Stepper.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper.__init__-1981"><a href="#Stepper.__init__-1981"><span class="linenos">1981</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper.__init__-1982"><a href="#Stepper.__init__-1982"><span class="linenos">1982</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper.__init__-1983"><a href="#Stepper.__init__-1983"><span class="linenos">1983</span></a>        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
</span><span id="Stepper.__init__-1984"><a href="#Stepper.__init__-1984"><span class="linenos">1984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper.__init__-1985"><a href="#Stepper.__init__-1985"><span class="linenos">1985</span></a>                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper.__init__-1986"><a href="#Stepper.__init__-1986"><span class="linenos">1986</span></a>                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper.__init__-1987"><a href="#Stepper.__init__-1987"><span class="linenos">1987</span></a>                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P3</span><span class="p">,</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,)}</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper.supported_protocols" class="classattr">
                                <div class="attr variable">
            <span class="name">supported_protocols</span>

        
    </div>
    <a class="headerlink" href="#Stepper.supported_protocols"></a>
    
    

                            </div>
                            <div id="Stepper.expand_protocol_methods" class="classattr">
                                        <input id="Stepper.expand_protocol_methods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">expand_protocol_methods</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">protocol_class</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper.expand_protocol_methods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper.expand_protocol_methods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper.expand_protocol_methods-1989"><a href="#Stepper.expand_protocol_methods-1989"><span class="linenos">1989</span></a>    <span class="k">def</span> <span class="nf">expand_protocol_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_class</span><span class="p">):</span>
</span><span id="Stepper.expand_protocol_methods-1990"><a href="#Stepper.expand_protocol_methods-1990"><span class="linenos">1990</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Expands protocol methods for use.</span>
</span><span id="Stepper.expand_protocol_methods-1991"><a href="#Stepper.expand_protocol_methods-1991"><span class="linenos">1991</span></a>
</span><span id="Stepper.expand_protocol_methods-1992"><a href="#Stepper.expand_protocol_methods-1992"><span class="linenos">1992</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper.expand_protocol_methods-1993"><a href="#Stepper.expand_protocol_methods-1993"><span class="linenos">1993</span></a><span class="sd">        ----------</span>
</span><span id="Stepper.expand_protocol_methods-1994"><a href="#Stepper.expand_protocol_methods-1994"><span class="linenos">1994</span></a><span class="sd">        protocol_class : class.</span>
</span><span id="Stepper.expand_protocol_methods-1995"><a href="#Stepper.expand_protocol_methods-1995"><span class="linenos">1995</span></a><span class="sd">            The protocol class from which the methods should be expanded.</span>
</span><span id="Stepper.expand_protocol_methods-1996"><a href="#Stepper.expand_protocol_methods-1996"><span class="linenos">1996</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper.expand_protocol_methods-1997"><a href="#Stepper.expand_protocol_methods-1997"><span class="linenos">1997</span></a>        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">protocol_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Stepper.expand_protocol_methods-1998"><a href="#Stepper.expand_protocol_methods-1998"><span class="linenos">1998</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
</span><span id="Stepper.expand_protocol_methods-1999"><a href="#Stepper.expand_protocol_methods-1999"><span class="linenos">1999</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stepper</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Expands protocol methods for use.</p>

<h2 id="parameters">Parameters</h2>

<p>protocol_class : class.
    The protocol class from which the methods should be expanded.</p>
</div>


                            </div>
                            <div id="Stepper.startup" class="classattr">
                                        <input id="Stepper.startup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">startup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper.startup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper.startup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper.startup-2001"><a href="#Stepper.startup-2001"><span class="linenos">2001</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Stepper.startup-2002"><a href="#Stepper.startup-2002"><span class="linenos">2002</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Stepper.startup-2003"><a href="#Stepper.startup-2003"><span class="linenos">2003</span></a><span class="sd">        First determine which protocol version the uC firmware is running.</span>
</span><span id="Stepper.startup-2004"><a href="#Stepper.startup-2004"><span class="linenos">2004</span></a><span class="sd">        Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</span>
</span><span id="Stepper.startup-2005"><a href="#Stepper.startup-2005"><span class="linenos">2005</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper.startup-2006"><a href="#Stepper.startup-2006"><span class="linenos">2006</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="Stepper.startup-2007"><a href="#Stepper.startup-2007"><span class="linenos">2007</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper.startup-2008"><a href="#Stepper.startup-2008"><span class="linenos">2008</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
</span><span id="Stepper.startup-2009"><a href="#Stepper.startup-2009"><span class="linenos">2009</span></a>                <span class="n">protocol_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
</span><span id="Stepper.startup-2010"><a href="#Stepper.startup-2010"><span class="linenos">2010</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Stepper.startup-2011"><a href="#Stepper.startup-2011"><span class="linenos">2011</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_protocol_methods</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Stepper.startup-2012"><a href="#Stepper.startup-2012"><span class="linenos">2012</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper.startup-2013"><a href="#Stepper.startup-2013"><span class="linenos">2013</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper.startup-2014"><a href="#Stepper.startup-2014"><span class="linenos">2014</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper.startup-2015"><a href="#Stepper.startup-2015"><span class="linenos">2015</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper.startup-2016"><a href="#Stepper.startup-2016"><span class="linenos">2016</span></a><span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
</span><span id="Stepper.startup-2017"><a href="#Stepper.startup-2017"><span class="linenos">2017</span></a><span class="s2">                                    Please power cycle the robot and try again.</span>
</span><span id="Stepper.startup-2018"><a href="#Stepper.startup-2018"><span class="linenos">2018</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper.startup-2019"><a href="#Stepper.startup-2019"><span class="linenos">2019</span></a><span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper.startup-2020"><a href="#Stepper.startup-2020"><span class="linenos">2020</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper.startup-2021"><a href="#Stepper.startup-2021"><span class="linenos">2021</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper.startup-2022"><a href="#Stepper.startup-2022"><span class="linenos">2022</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper.startup-2023"><a href="#Stepper.startup-2023"><span class="linenos">2023</span></a><span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
</span><span id="Stepper.startup-2024"><a href="#Stepper.startup-2024"><span class="linenos">2024</span></a><span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
</span><span id="Stepper.startup-2025"><a href="#Stepper.startup-2025"><span class="linenos">2025</span></a><span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
</span><span id="Stepper.startup-2026"><a href="#Stepper.startup-2026"><span class="linenos">2026</span></a><span class="s2">                    Disabling device.</span>
</span><span id="Stepper.startup-2027"><a href="#Stepper.startup-2027"><span class="linenos">2027</span></a><span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
</span><span id="Stepper.startup-2028"><a href="#Stepper.startup-2028"><span class="linenos">2028</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper.startup-2029"><a href="#Stepper.startup-2029"><span class="linenos">2029</span></a><span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Stepper.startup-2030"><a href="#Stepper.startup-2030"><span class="linenos">2030</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
</span><span id="Stepper.startup-2031"><a href="#Stepper.startup-2031"><span class="linenos">2031</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Stepper.startup-2032"><a href="#Stepper.startup-2032"><span class="linenos">2032</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Stepper.startup-2033"><a href="#Stepper.startup-2033"><span class="linenos">2033</span></a>
</span><span id="Stepper.startup-2034"><a href="#Stepper.startup-2034"><span class="linenos">2034</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper.startup-2035"><a href="#Stepper.startup-2035"><span class="linenos">2035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="Stepper.startup-2036"><a href="#Stepper.startup-2036"><span class="linenos">2036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper.startup-2037"><a href="#Stepper.startup-2037"><span class="linenos">2037</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="Stepper.startup-2038"><a href="#Stepper.startup-2038"><span class="linenos">2038</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="Stepper.startup-2039"><a href="#Stepper.startup-2039"><span class="linenos">2039</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</span></pre></div>


            <div class="docstring"><p>First determine which protocol version the uC firmware is running.
Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>
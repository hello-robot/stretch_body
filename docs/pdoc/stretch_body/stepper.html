<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>stretch_body.stepper API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../stretch_body.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;stretch_body</a>

            <img src="../images/banner.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#StepperBase">StepperBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StepperBase.__init__">StepperBase</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_COMMAND">RPC_SET_COMMAND</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_COMMAND">RPC_REPLY_COMMAND</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_GET_STATUS">RPC_GET_STATUS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_STATUS">RPC_REPLY_STATUS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_GAINS">RPC_SET_GAINS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_GAINS">RPC_REPLY_GAINS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_LOAD_TEST_PUSH">RPC_LOAD_TEST_PUSH</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH">RPC_REPLY_LOAD_TEST_PUSH</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_TRIGGER">RPC_SET_TRIGGER</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_SET_TRIGGER">RPC_REPLY_SET_TRIGGER</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_ENC_CALIB">RPC_SET_ENC_CALIB</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_ENC_CALIB">RPC_REPLY_ENC_CALIB</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_READ_GAINS_FROM_FLASH">RPC_READ_GAINS_FROM_FLASH</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH">RPC_REPLY_READ_GAINS_FROM_FLASH</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_MENU_ON">RPC_SET_MENU_ON</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_MENU_ON">RPC_REPLY_MENU_ON</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO">RPC_GET_STEPPER_BOARD_INFO</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO">RPC_REPLY_STEPPER_BOARD_INFO</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_MOTION_LIMITS">RPC_SET_MOTION_LIMITS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_MOTION_LIMITS">RPC_REPLY_MOTION_LIMITS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG">RPC_SET_NEXT_TRAJECTORY_SEG</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_START_NEW_TRAJECTORY">RPC_START_NEW_TRAJECTORY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY">RPC_REPLY_START_NEW_TRAJECTORY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_RESET_TRAJECTORY">RPC_RESET_TRAJECTORY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY">RPC_REPLY_RESET_TRAJECTORY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_READ_TRACE">RPC_READ_TRACE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_READ_TRACE">RPC_REPLY_READ_TRACE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_GET_STATUS_AUX">RPC_GET_STATUS_AUX</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_STATUS_AUX">RPC_REPLY_STATUS_AUX</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_LOAD_TEST_PULL">RPC_LOAD_TEST_PULL</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL">RPC_REPLY_LOAD_TEST_PULL</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_SAFETY">MODE_SAFETY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_FREEWHEEL">MODE_FREEWHEEL</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_HOLD">MODE_HOLD</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_POS_PID">MODE_POS_PID</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_VEL_PID">MODE_VEL_PID</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_POS_TRAJ">MODE_POS_TRAJ</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_VEL_TRAJ">MODE_VEL_TRAJ</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_CURRENT">MODE_CURRENT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_POS_TRAJ_INCR">MODE_POS_TRAJ_INCR</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_POS_TRAJ_WAYPOINT">MODE_POS_TRAJ_WAYPOINT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.MODE_NAMES">MODE_NAMES</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_POS_CALIBRATED">DIAG_POS_CALIBRATED</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_RUNSTOP_ON">DIAG_RUNSTOP_ON</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_NEAR_POS_SETPOINT">DIAG_NEAR_POS_SETPOINT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_NEAR_VEL_SETPOINT">DIAG_NEAR_VEL_SETPOINT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IS_MOVING">DIAG_IS_MOVING</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_AT_CURRENT_LIMIT">DIAG_AT_CURRENT_LIMIT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IS_MG_ACCELERATING">DIAG_IS_MG_ACCELERATING</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IS_MG_MOVING">DIAG_IS_MG_MOVING</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_CALIBRATION_RCVD">DIAG_CALIBRATION_RCVD</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IN_GUARDED_EVENT">DIAG_IN_GUARDED_EVENT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IN_SAFETY_EVENT">DIAG_IN_SAFETY_EVENT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_WAITING_ON_SYNC">DIAG_WAITING_ON_SYNC</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_TRAJ_ACTIVE">DIAG_TRAJ_ACTIVE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC">DIAG_TRAJ_WAITING_ON_SYNC</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IN_SYNC_MODE">DIAG_IN_SYNC_MODE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.DIAG_IS_TRACE_ON">DIAG_IS_TRACE_ON</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_SAFETY_HOLD">CONFIG_SAFETY_HOLD</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_ENABLE_RUNSTOP">CONFIG_ENABLE_RUNSTOP</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_ENABLE_SYNC_MODE">CONFIG_ENABLE_SYNC_MODE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE">CONFIG_ENABLE_GUARDED_MODE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY">CONFIG_FLIP_ENCODER_POLARITY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY">CONFIG_FLIP_EFFORT_POLARITY</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG">CONFIG_ENABLE_VEL_WATCHDOG</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_MARK_POS">TRIGGER_MARK_POS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_RESET_MOTION_GEN">TRIGGER_RESET_MOTION_GEN</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_BOARD_RESET">TRIGGER_BOARD_RESET</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH">TRIGGER_WRITE_GAINS_TO_FLASH</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED">TRIGGER_RESET_POS_CALIBRATED</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_POS_CALIBRATED">TRIGGER_POS_CALIBRATED</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT">TRIGGER_MARK_POS_ON_CONTACT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_ENABLE_TRACE">TRIGGER_ENABLE_TRACE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRIGGER_DISABLE_TRACE">TRIGGER_DISABLE_TRACE</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRACE_TYPE_STATUS">TRACE_TYPE_STATUS</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRACE_TYPE_DEBUG">TRACE_TYPE_DEBUG</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.TRACE_TYPE_PRINT">TRACE_TYPE_PRINT</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.usb">usb</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.transport">transport</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.status">status</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.status_aux">status_aux</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.status_zero">status_zero</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.board_info">board_info</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.motion_limits">motion_limits</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.is_moving_history">is_moving_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.load_test_payload">load_test_payload</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.hw_valid">hw_valid</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.gains">gains</a>
                        </li>
                        <li>
                                <a class="variable" href="#StepperBase.gains_flash">gains_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.startup">startup</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.stop">stop</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.is_sync_required">is_sync_required</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.push_command">push_command</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.push_command_async">push_command_async</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pull_status">pull_status</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pull_status_async">pull_status_async</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.push_load_test">push_load_test</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pull_load_test">pull_load_test</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pretty_print">pretty_print</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.step_sentry">step_sentry</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_motion_limits">set_motion_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_gains">set_gains</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_gains_to_YAML">write_gains_to_YAML</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.board_reset">board_reset</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.mark_position">mark_position</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.reset_motion_gen">reset_motion_gen</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_safety">enable_safety</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_freewheel">enable_freewheel</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_hold">enable_hold</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_vel_pid">enable_vel_pid</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_pid">enable_pos_pid</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_vel_traj">enable_vel_traj</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_traj">enable_pos_traj</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_current">enable_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_sync_mode">enable_sync_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_sync_mode">disable_sync_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_runstop">enable_runstop</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_runstop">disable_runstop</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_command">set_command</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.current_to_torque">current_to_torque</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.torque_to_current">torque_to_current</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.get_chip_id">get_chip_id</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.print_menu">print_menu</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.menu_transaction">menu_transaction</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.start_waypoint_trajectory">start_waypoint_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.set_next_trajectory_segment">set_next_trajectory_segment</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.stop_waypoint_trajectory">stop_waypoint_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.unpack_board_info">unpack_board_info</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.unpack_status">unpack_status</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.unpack_gains">unpack_gains</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_motion_limits">pack_motion_limits</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_command">pack_command</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_gains">pack_gains</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_trigger">pack_trigger</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pack_trajectory_segment">pack_trajectory_segment</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_command_reply">rpc_command_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_status_reply">rpc_status_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_reset_traj_reply">rpc_reset_traj_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.enable_firmware_trace">enable_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.disable_firmware_trace">disable_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#StepperBase.pull_status_aux">pull_status_aux</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P0">Stepper_Protocol_P0</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P0.unpack_status">unpack_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P0.pretty_print">pretty_print</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P1">Stepper_Protocol_P1</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.unpack_status">unpack_status</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.pretty_print">pretty_print</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.start_waypoint_trajectory">start_waypoint_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.set_next_trajectory_segment">set_next_trajectory_segment</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.stop_waypoint_trajectory">stop_waypoint_trajectory</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.pack_trajectory_segment">pack_trajectory_segment</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P1.rpc_reset_traj_reply">rpc_reset_traj_reply</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P2">Stepper_Protocol_P2</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.read_firmware_trace">read_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.unpack_debug_trace">unpack_debug_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.unpack_print_trace">unpack_print_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.enable_firmware_trace">enable_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.disable_firmware_trace">disable_firmware_trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P2.unpack_status">unpack_status</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper_Protocol_P3">Stepper_Protocol_P3</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.push_load_test">push_load_test</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.pull_load_test">pull_load_test</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_load_test_push_reply">rpc_load_test_push_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_load_test_pull_reply">rpc_load_test_pull_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.pull_status_aux">pull_status_aux</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.unpack_status_aux">unpack_status_aux</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_status_aux_reply">rpc_status_aux_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.unpack_command_reply">unpack_command_reply</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper_Protocol_P3.rpc_command_reply">rpc_command_reply</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Stepper">Stepper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Stepper.__init__">Stepper</a>
                        </li>
                        <li>
                                <a class="variable" href="#Stepper.supported_protocols">supported_protocols</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper.expand_protocol_methods">expand_protocol_methods</a>
                        </li>
                        <li>
                                <a class="function" href="#Stepper.startup">startup</a>
                        </li>
                </ul>

            </li>
    </ul>


    <footer>My Package v1.0</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../stretch_body.html">stretch_body</a><wbr>.stepper    </h1>

                
                        <input id="mod-stepper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-stepper-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">from</span> <span class="nn">stretch_body.transport</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">from</span> <span class="nn">stretch_body.device</span> <span class="kn">import</span> <span class="n">Device</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">from</span> <span class="nn">stretch_body.hello_utils</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">textwrap</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">threading</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">array</span> <span class="k">as</span> <span class="nn">arr</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="c1"># ######################## STEPPER #################################</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="k">class</span> <span class="nc">StepperBase</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>    <span class="n">RPC_SET_COMMAND</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>    <span class="n">RPC_REPLY_COMMAND</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>    <span class="n">RPC_GET_STATUS</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>    <span class="n">RPC_REPLY_STATUS</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>    <span class="n">RPC_SET_GAINS</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>    <span class="n">RPC_REPLY_GAINS</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>    <span class="n">RPC_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="n">RPC_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">9</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="n">RPC_REPLY_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>    <span class="n">RPC_SET_ENC_CALIB</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>    <span class="n">RPC_REPLY_ENC_CALIB</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>    <span class="n">RPC_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>    <span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>    <span class="n">RPC_SET_MENU_ON</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>    <span class="n">RPC_REPLY_MENU_ON</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">RPC_GET_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>    <span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>    <span class="n">RPC_SET_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">19</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>    <span class="n">RPC_REPLY_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>    <span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">21</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>    <span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">22</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>    <span class="n">RPC_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">23</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">24</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="n">RPC_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">25</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>    <span class="n">RPC_REPLY_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">26</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>    <span class="n">RPC_READ_TRACE</span> <span class="o">=</span><span class="mi">27</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="n">RPC_REPLY_READ_TRACE</span> <span class="o">=</span><span class="mi">28</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="n">RPC_GET_STATUS_AUX</span> <span class="o">=</span> <span class="mi">29</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>    <span class="n">RPC_REPLY_STATUS_AUX</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>    <span class="n">RPC_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">31</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="n">MODE_SAFETY</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="n">MODE_FREEWHEEL</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="n">MODE_HOLD</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">MODE_POS_PID</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="n">MODE_VEL_PID</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="n">MODE_POS_TRAJ</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="n">MODE_VEL_TRAJ</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="n">MODE_CURRENT</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="n">MODE_POS_TRAJ_INCR</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="o">=</span><span class="mi">9</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>    <span class="n">MODE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="n">MODE_SAFETY</span><span class="p">:</span> <span class="s1">&#39;MODE_SAFETY&#39;</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="n">MODE_FREEWHEEL</span><span class="p">:</span> <span class="s1">&#39;MODE_FREEWHEEL&#39;</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>        <span class="n">MODE_HOLD</span><span class="p">:</span> <span class="s1">&#39;MODE_HOLD&#39;</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        <span class="n">MODE_POS_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_PID&#39;</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="n">MODE_VEL_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_PID&#39;</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="n">MODE_POS_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ&#39;</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>        <span class="n">MODE_VEL_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_TRAJ&#39;</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>        <span class="n">MODE_CURRENT</span><span class="p">:</span> <span class="s1">&#39;MODE_CURRENT&#39;</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>        <span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_INCR&#39;</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_WAYPOINT&#39;</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="p">}</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="n">DIAG_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Has a pos zero RPC been received since powerup</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="n">DIAG_RUNSTOP_ON</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Is controller in runstop mode</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Is pos controller within gains.pAs_d of setpoint</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Is vel controller within gains.vAs_d of setpoint</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="n">DIAG_IS_MOVING</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># Is measured velocity greater than gains.vAs_d</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>    <span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># Is controller current saturated</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    <span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">=</span> <span class="mi">64</span>  <span class="c1"># Is controller motion generator acceleration non-zero</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="n">DIAG_IS_MG_MOVING</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># Is controller motion generator velocity non-zero</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># Is calibration table in flash</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Guarded event occurred during motion</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># Is it forced into safety mode</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">2048</span>  <span class="c1"># Command received but no sync yet</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="n">DIAG_TRAJ_ACTIVE</span>     <span class="o">=</span> <span class="mi">4096</span>     <span class="c1"># Whether a waypoint trajectory is actively executing</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">8192</span> <span class="c1"># Currently waiting on a sync signal before starting trajectory</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">=</span> <span class="mi">16384</span>        <span class="c1"># Currently running in sync mode</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>    <span class="n">DIAG_IS_TRACE_ON</span> <span class="o">=</span> <span class="mi">32768</span>   <span class="c1">#Is trace recording</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="n">CONFIG_SAFETY_HOLD</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Hold position in safety mode? Otherwise freewheel</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="n">CONFIG_ENABLE_RUNSTOP</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Recognize runstop signal?</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="n">CONFIG_ENABLE_SYNC_MODE</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Commands are synchronized from digital trigger</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>    <span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Stops on current threshold</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>    <span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    <span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">=</span> <span class="mi">64</span> <span class="c1">#Timeout velocity commands</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="n">TRIGGER_MARK_POS</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="n">TRIGGER_RESET_MOTION_GEN</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="n">TRIGGER_BOARD_RESET</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    <span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="n">TRIGGER_RESET_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>    <span class="n">TRIGGER_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="n">TRIGGER_MARK_POS_ON_CONTACT</span><span class="o">=</span><span class="mi">64</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="n">TRIGGER_ENABLE_TRACE</span><span class="o">=</span><span class="mi">128</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="n">TRIGGER_DISABLE_TRACE</span><span class="o">=</span><span class="mi">256</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    <span class="n">TRACE_TYPE_STATUS</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="n">TRACE_TYPE_DEBUG</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>    <span class="n">TRACE_TYPE_PRINT</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="c1">#Pull from usb device name</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">Transport</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;a_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stiffness&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_pct&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;current&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                       <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>                       <span class="s1">&#39;is_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>                       <span class="s1">&#39;in_safety_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;trace_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>                       <span class="s1">&#39;waypoint_traj&#39;</span><span class="p">:{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="s1">&#39;setpoint&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;segment_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,}}</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;board_variant&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;firmware_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="c1"># ###########  Device Methods #############</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>                <span class="c1"># Pull board info</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STEPPER_BOARD_INFO</span><span class="p">])</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_board_info_reply</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">configure_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span><span class="kc">False</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="c1">#Configure control mode prior to calling this on process shutdown (or default to freewheel)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>            <span class="k">return</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down Stepper on: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">exiting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="k">def</span> <span class="nf">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_last_sync</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="n">ts_last_sync</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="k">return</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span>  <span class="c1"># Mark the time of latest new motion command sent</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>            <span class="k">return</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span> <span class="c1">#Mark the time of latest new motion command sent</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>            <span class="k">return</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="k">return</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;stepper_is_moving_filter&#39;</span><span class="p">]:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>    <span class="k">def</span> <span class="nf">set_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">):</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="k">if</span> <span class="n">limit_neg</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">limit_pos</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>            <span class="c1">#Push out immediately</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">]</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MOTION_LIMITS</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_motion_limits</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_motion_limits_reply</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;This method has been deprecated since v0.3.0&#39;</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>    <span class="k">def</span> <span class="nf">read_gains_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>    <span class="k">def</span> <span class="nf">board_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_BOARD_RESET</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">def</span> <span class="nf">mark_position_on_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS_ON_CONTACT</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not mark position. Must be in MODE_SAFETY for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="k">return</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="n">x</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>    <span class="k">def</span> <span class="nf">reset_motion_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_MOTION_GEN</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="k">def</span> <span class="nf">reset_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_POS_CALIBRATED</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>    <span class="k">def</span> <span class="nf">set_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_POS_CALIBRATED</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>    <span class="k">def</span> <span class="nf">enable_safety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>    <span class="k">def</span> <span class="nf">enable_freewheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_FREEWHEEL</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>    <span class="k">def</span> <span class="nf">enable_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_HOLD</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>    <span class="k">def</span> <span class="nf">enable_vel_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>    <span class="k">def</span> <span class="nf">enable_pos_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_PID</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>    <span class="k">def</span> <span class="nf">enable_vel_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>    <span class="k">def</span> <span class="nf">enable_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">,</span> <span class="n">i_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>    <span class="k">def</span> <span class="nf">enable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>    <span class="k">def</span> <span class="nf">disable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>    <span class="k">def</span> <span class="nf">enable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="k">def</span> <span class="nf">disable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>    <span class="k">def</span> <span class="nf">enable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>    <span class="k">def</span> <span class="nf">disable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="c1"># ######################################################################</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="c1">#Primary interface to controlling the stepper</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="c1">#YAML defaults are used if values not provided</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>    <span class="c1">#This allows user to override defaults every control cycle and then easily revert to defaults</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span>  <span class="p">):</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">255</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>        <span class="k">if</span> <span class="n">i_feedforward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_feedforward</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">if</span> <span class="n">i_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">i_des</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="k">if</span> <span class="n">i_contact_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_pos</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="k">if</span> <span class="n">i_contact_neg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_neg</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>        <span class="c1">#print(time.time(), i_des, self._command[&#39;i_feedforward&#39;],mode == self.MODE_CURRENT)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>        <span class="c1">#print(time.time(),self._command[&#39;x_des&#39;],self._command[&#39;incr_trigger&#39;],self._command[&#39;v_des&#39;],self._command[&#39;a_des&#39;])</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        Poll until is moving flag is false</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">        Return True if success</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        Return False if timeout</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">        Poll until near setpoint</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">        Return True if success</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        Return False if timeout</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="c1">########### Handle current and effort conversions  ###########</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="c1">#Effort_ticks are in the units of the uC current controller (0-255 8 bit)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="c1">#Conversion to A is based on the sense resistor and motor driver (see firmware)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>        <span class="n">effort_ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_A</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mA_per_tick</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">255</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">effort_ticks</span><span class="p">)))</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="k">def</span> <span class="nf">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="n">mA_per_tick</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="c1"># Effort_pct is defined as a percentage of the maximum allowable motor winding current</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="c1"># Range is -100.0 to 100.0</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="k">if</span> <span class="n">i_A</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i_A</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]))</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i_A</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])))</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="k">def</span> <span class="nf">effort_pct_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="k">if</span> <span class="n">e_pct</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>    <span class="k">def</span> <span class="nf">current_to_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method current_to_torque has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="k">def</span> <span class="nf">torque_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tq</span><span class="p">):</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method torque_to_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="c1"># ####################### Encoder Calibration ######################</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="k">def</span> <span class="nf">get_chip_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="k">return</span> <span class="n">cid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="n">device_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="n">sn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">sn</span><span class="o">+</span><span class="s1">&#39;.yaml&#39;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="n">enc_data</span><span class="o">=</span><span class="n">read_fleet_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="k">return</span> <span class="n">enc_data</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="n">device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">sn</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="n">write_fleet_yaml</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">fleet_dir</span><span class="o">=</span><span class="n">fleet_dir</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">19</span><span class="p">]</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reseting board&#39;</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_reset</span><span class="p">()</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># We now have string of floats, convert to list of floats</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="n">enc_calib</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="n">ff</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>            <span class="k">if</span> <span class="n">ff</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ff</span><span class="p">]))</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_calib</span><span class="p">)</span><span class="o">==</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Successful read of encoder calibration&#39;</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Failed to read encoder calibration&#39;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="k">return</span> <span class="n">enc_calib</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="k">return</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="c1">#This will take a few seconds. Blocks until complete.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">!=</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad encoder data&#39;</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_ENC_CALIB</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                <span class="n">sidx</span><span class="o">=</span><span class="mi">2</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                    <span class="n">pack_float_t</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">64</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                    <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                <span class="c1"># self.logger.debug(&#39;Sending encoder calibration rpc of size&#39;,sidx)</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_enc_calib_reply</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>    <span class="k">def</span> <span class="nf">rpc_enc_calib_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reply</span><span class="p">):</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_ENC_CALIB</span><span class="p">:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_ENC_CALIB&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    <span class="c1"># ######################Menu Interface ################################3</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>    <span class="k">def</span> <span class="nf">turn_rpc_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;zyx&#39;</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>    <span class="k">def</span> <span class="nf">turn_menu_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="k">return</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MENU_ON</span><span class="p">])</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_menu_on_reply</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>    <span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>    <span class="k">def</span> <span class="nf">menu_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>            <span class="k">return</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="n">reply</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="k">if</span> <span class="n">do_print</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="n">reply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="k">return</span> <span class="n">reply</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>    <span class="c1"># ################Waypoint Trajectory Interface #####################</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>    <span class="c1"># ################Transport Callbacks #####################</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>    <span class="k">def</span> <span class="nf">unpack_board_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span> <span class="c1">#New format of Stepper.x  Older format of Stepper.BoardName.Vx&#39; If older format,default to 0</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):]</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>    <span class="k">def</span> <span class="nf">unpack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>    <span class="k">def</span> <span class="nf">pack_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="k">def</span> <span class="nf">pack_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">])</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">])</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">])</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">])</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">])</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">])</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>    <span class="k">def</span> <span class="nf">pack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">sidx</span><span class="p">):</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="n">config</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="k">def</span> <span class="nf">pack_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="n">pack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>    <span class="k">def</span> <span class="nf">rpc_board_info_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unpack_board_info</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STEPPER_BOARD_INFO&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>    <span class="k">def</span> <span class="nf">rpc_gains_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_GAINS</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_GAINS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>    <span class="k">def</span> <span class="nf">rpc_trigger_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_TRIGGER</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_SET_TRIGGER&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>    <span class="k">def</span> <span class="nf">rpc_motion_limits_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MOTION_LIMITS</span><span class="p">:</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MOTION_LIMITS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>    <span class="k">def</span> <span class="nf">rpc_menu_on_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MENU_ON</span><span class="p">:</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MENU_ON&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>    <span class="k">def</span> <span class="nf">rpc_status_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS</span><span class="p">:</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>    <span class="k">def</span> <span class="nf">rpc_read_gains_from_flash_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span><span class="p">:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_gains</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_GAINS_FROM_FLASH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="c1"># ######################## STEPPER PROTOCOL PO #################################</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P0</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="c1"># ######################## STEPPER PROTOCOL P1 #################################</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P1</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Trace recording:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">])</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waypoint Trajectory&#39;</span><span class="p">)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       State:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Setpoint: (rad) </span><span class="si">%s</span><span class="s1"> | (deg) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">],</span>  <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">])))</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Segment ID:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">])</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts execution of a waypoint trajectory on hardware</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        Parameters</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">        ----------</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">        first_segment : list</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">            The hardware begins executing this first segment of a spline. The segment&#39;s duration and</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">            six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">            2 for the first segment, fills the last element of the list.</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        Returns</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        -------</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">        bool</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">            True if uC successfully initiated a new trajectory</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">first_segment</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_START_NEW_TRAJECTORY</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start_new_traj_reply</span><span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span><span class="p">:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="c1"># return self._waypoint_traj_start_success</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the next segment for the hardware to execute</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        This method is generally called multiple times while the prior segment is executing. This</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">        provides the hardware with the next segment to gracefully transition across the entire spline,</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        while allowing users to preempt or modify the future trajectory in real time.</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        This method will return False if there is not already an segment executing on the uC</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        Parameters</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        ----------</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        next_segment : list</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">            Duration and six coefficients fill the first seven elements of the list. Generally, the</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">            coefficients are calculated to smoothly transition across a spline. The segment ID, always</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">            1 higher than the prior segment&#39;s ID, fills the last element of the list.</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        Returns</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">        -------</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        bool</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">            True if uC successfully queued next trajectory</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">next_segment</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_set_next_traj_seg_reply</span><span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span><span class="p">:</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops execution of the waypoint trajectory running in hardware</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_RESET_TRAJECTORY</span><span class="p">])</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_reset_traj_reply</span><span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_RESET_TRAJECTORY</span><span class="p">:</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_RESET_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="c1"># ######################## STEPPER PROTOCOL P2 #################################</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P2</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="k">def</span> <span class="nf">read_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1">#Timestamp holds state, reset within lock to avoid threading issues</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="k">while</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&lt;</span><span class="mf">60.0</span><span class="p">:</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_TRACE</span><span class="p">])</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_firmware_trace_reply</span><span class="p">)</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>    <span class="k">def</span> <span class="nf">unpack_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="k">def</span> <span class="nf">unpack_print_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>        <span class="n">line_len</span><span class="o">=</span><span class="mi">32</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="n">line_len</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="n">line_len</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_TRACE</span><span class="p">:</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{},</span><span class="s1">&#39;debug&#39;</span><span class="p">:{},</span><span class="s1">&#39;print&#39;</span><span class="p">:{}})</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_STATUS</span><span class="p">:</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_DEBUG</span><span class="p">:</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_debug_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_PRINT</span><span class="p">:</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_print_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;print&#39;</span><span class="p">])</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized trace type </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_TRACE&#39;</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_ENABLE_TRACE</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_DISABLE_TRACE</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_TRACE_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="c1"># ######################## STEPPER PROTOCOL P3 #################################</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P3</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="k">return</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PUSH</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_push_reply</span><span class="p">)</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="k">return</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PULL</span><span class="p">])</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_pull_reply</span><span class="p">)</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_push_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PUSH</span><span class="p">:</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PUSH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_pull_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PULL</span><span class="p">:</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">]:</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load test pull bad data&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successful load test pull&#39;</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PULL&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="k">return</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS_AUX</span><span class="p">])</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_aux_reply</span><span class="p">)</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>    <span class="k">def</span> <span class="nf">unpack_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>    <span class="k">def</span> <span class="nf">rpc_status_aux_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS_AUX</span><span class="p">:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status_aux</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>    <span class="k">def</span> <span class="nf">unpack_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_command_reply</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="c1"># ######################## STEPPER #################################</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="k">class</span> <span class="nc">Stepper</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P3</span><span class="p">,</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,)}</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>    <span class="k">def</span> <span class="nf">expand_protocol_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_class</span><span class="p">):</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">protocol_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stepper</span><span class="p">))</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="sd">        First determine which protocol version the uC firmware is running.</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="sd">        Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>                <span class="n">protocol_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_protocol_methods</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="s2">                                    ----------------</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="s2">                                    Please power cycle the robot and try again.</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="s2">                                    ----------------</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="s2">                    ----------------</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="s2">                    Disabling device.</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="s2">                    ----------------</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</span></pre></div>


            </section>
                <section id="StepperBase">
                            <input id="StepperBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StepperBase</span><wbr>(<span class="base"><a href="device.html#Device">stretch_body.device.Device</a></span>):

                <label class="view-source-button" for="StepperBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase-16"><a href="#StepperBase-16"><span class="linenos"> 16</span></a><span class="k">class</span> <span class="nc">StepperBase</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
</span><span id="StepperBase-17"><a href="#StepperBase-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase-18"><a href="#StepperBase-18"><span class="linenos"> 18</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="StepperBase-19"><a href="#StepperBase-19"><span class="linenos"> 19</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="StepperBase-20"><a href="#StepperBase-20"><span class="linenos"> 20</span></a>    <span class="n">RPC_SET_COMMAND</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-21"><a href="#StepperBase-21"><span class="linenos"> 21</span></a>    <span class="n">RPC_REPLY_COMMAND</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-22"><a href="#StepperBase-22"><span class="linenos"> 22</span></a>    <span class="n">RPC_GET_STATUS</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="StepperBase-23"><a href="#StepperBase-23"><span class="linenos"> 23</span></a>    <span class="n">RPC_REPLY_STATUS</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="StepperBase-24"><a href="#StepperBase-24"><span class="linenos"> 24</span></a>    <span class="n">RPC_SET_GAINS</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="StepperBase-25"><a href="#StepperBase-25"><span class="linenos"> 25</span></a>    <span class="n">RPC_REPLY_GAINS</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="StepperBase-26"><a href="#StepperBase-26"><span class="linenos"> 26</span></a>    <span class="n">RPC_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="StepperBase-27"><a href="#StepperBase-27"><span class="linenos"> 27</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PUSH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="StepperBase-28"><a href="#StepperBase-28"><span class="linenos"> 28</span></a>    <span class="n">RPC_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">9</span>
</span><span id="StepperBase-29"><a href="#StepperBase-29"><span class="linenos"> 29</span></a>    <span class="n">RPC_REPLY_SET_TRIGGER</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="StepperBase-30"><a href="#StepperBase-30"><span class="linenos"> 30</span></a>    <span class="n">RPC_SET_ENC_CALIB</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="StepperBase-31"><a href="#StepperBase-31"><span class="linenos"> 31</span></a>    <span class="n">RPC_REPLY_ENC_CALIB</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="StepperBase-32"><a href="#StepperBase-32"><span class="linenos"> 32</span></a>    <span class="n">RPC_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="StepperBase-33"><a href="#StepperBase-33"><span class="linenos"> 33</span></a>    <span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="StepperBase-34"><a href="#StepperBase-34"><span class="linenos"> 34</span></a>    <span class="n">RPC_SET_MENU_ON</span> <span class="o">=</span> <span class="mi">15</span>
</span><span id="StepperBase-35"><a href="#StepperBase-35"><span class="linenos"> 35</span></a>    <span class="n">RPC_REPLY_MENU_ON</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="StepperBase-36"><a href="#StepperBase-36"><span class="linenos"> 36</span></a>    <span class="n">RPC_GET_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="StepperBase-37"><a href="#StepperBase-37"><span class="linenos"> 37</span></a>    <span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="StepperBase-38"><a href="#StepperBase-38"><span class="linenos"> 38</span></a>    <span class="n">RPC_SET_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">19</span>
</span><span id="StepperBase-39"><a href="#StepperBase-39"><span class="linenos"> 39</span></a>    <span class="n">RPC_REPLY_MOTION_LIMITS</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="StepperBase-40"><a href="#StepperBase-40"><span class="linenos"> 40</span></a>    <span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">21</span>
</span><span id="StepperBase-41"><a href="#StepperBase-41"><span class="linenos"> 41</span></a>    <span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span> <span class="o">=</span><span class="mi">22</span>
</span><span id="StepperBase-42"><a href="#StepperBase-42"><span class="linenos"> 42</span></a>    <span class="n">RPC_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">23</span>
</span><span id="StepperBase-43"><a href="#StepperBase-43"><span class="linenos"> 43</span></a>    <span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span> <span class="o">=</span><span class="mi">24</span>
</span><span id="StepperBase-44"><a href="#StepperBase-44"><span class="linenos"> 44</span></a>    <span class="n">RPC_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">25</span>
</span><span id="StepperBase-45"><a href="#StepperBase-45"><span class="linenos"> 45</span></a>    <span class="n">RPC_REPLY_RESET_TRAJECTORY</span> <span class="o">=</span><span class="mi">26</span>
</span><span id="StepperBase-46"><a href="#StepperBase-46"><span class="linenos"> 46</span></a>    <span class="n">RPC_READ_TRACE</span> <span class="o">=</span><span class="mi">27</span>
</span><span id="StepperBase-47"><a href="#StepperBase-47"><span class="linenos"> 47</span></a>    <span class="n">RPC_REPLY_READ_TRACE</span> <span class="o">=</span><span class="mi">28</span>
</span><span id="StepperBase-48"><a href="#StepperBase-48"><span class="linenos"> 48</span></a>    <span class="n">RPC_GET_STATUS_AUX</span> <span class="o">=</span> <span class="mi">29</span>
</span><span id="StepperBase-49"><a href="#StepperBase-49"><span class="linenos"> 49</span></a>    <span class="n">RPC_REPLY_STATUS_AUX</span> <span class="o">=</span> <span class="mi">30</span>
</span><span id="StepperBase-50"><a href="#StepperBase-50"><span class="linenos"> 50</span></a>    <span class="n">RPC_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">31</span>
</span><span id="StepperBase-51"><a href="#StepperBase-51"><span class="linenos"> 51</span></a>    <span class="n">RPC_REPLY_LOAD_TEST_PULL</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="StepperBase-52"><a href="#StepperBase-52"><span class="linenos"> 52</span></a>
</span><span id="StepperBase-53"><a href="#StepperBase-53"><span class="linenos"> 53</span></a>    <span class="n">MODE_SAFETY</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-54"><a href="#StepperBase-54"><span class="linenos"> 54</span></a>    <span class="n">MODE_FREEWHEEL</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-55"><a href="#StepperBase-55"><span class="linenos"> 55</span></a>    <span class="n">MODE_HOLD</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-56"><a href="#StepperBase-56"><span class="linenos"> 56</span></a>    <span class="n">MODE_POS_PID</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="StepperBase-57"><a href="#StepperBase-57"><span class="linenos"> 57</span></a>    <span class="n">MODE_VEL_PID</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="StepperBase-58"><a href="#StepperBase-58"><span class="linenos"> 58</span></a>    <span class="n">MODE_POS_TRAJ</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="StepperBase-59"><a href="#StepperBase-59"><span class="linenos"> 59</span></a>    <span class="n">MODE_VEL_TRAJ</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="StepperBase-60"><a href="#StepperBase-60"><span class="linenos"> 60</span></a>    <span class="n">MODE_CURRENT</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="StepperBase-61"><a href="#StepperBase-61"><span class="linenos"> 61</span></a>    <span class="n">MODE_POS_TRAJ_INCR</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="StepperBase-62"><a href="#StepperBase-62"><span class="linenos"> 62</span></a>    <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="o">=</span><span class="mi">9</span>
</span><span id="StepperBase-63"><a href="#StepperBase-63"><span class="linenos"> 63</span></a>
</span><span id="StepperBase-64"><a href="#StepperBase-64"><span class="linenos"> 64</span></a>    <span class="n">MODE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="StepperBase-65"><a href="#StepperBase-65"><span class="linenos"> 65</span></a>        <span class="n">MODE_SAFETY</span><span class="p">:</span> <span class="s1">&#39;MODE_SAFETY&#39;</span><span class="p">,</span>
</span><span id="StepperBase-66"><a href="#StepperBase-66"><span class="linenos"> 66</span></a>        <span class="n">MODE_FREEWHEEL</span><span class="p">:</span> <span class="s1">&#39;MODE_FREEWHEEL&#39;</span><span class="p">,</span>
</span><span id="StepperBase-67"><a href="#StepperBase-67"><span class="linenos"> 67</span></a>        <span class="n">MODE_HOLD</span><span class="p">:</span> <span class="s1">&#39;MODE_HOLD&#39;</span><span class="p">,</span>
</span><span id="StepperBase-68"><a href="#StepperBase-68"><span class="linenos"> 68</span></a>        <span class="n">MODE_POS_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_PID&#39;</span><span class="p">,</span>
</span><span id="StepperBase-69"><a href="#StepperBase-69"><span class="linenos"> 69</span></a>        <span class="n">MODE_VEL_PID</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_PID&#39;</span><span class="p">,</span>
</span><span id="StepperBase-70"><a href="#StepperBase-70"><span class="linenos"> 70</span></a>        <span class="n">MODE_POS_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ&#39;</span><span class="p">,</span>
</span><span id="StepperBase-71"><a href="#StepperBase-71"><span class="linenos"> 71</span></a>        <span class="n">MODE_VEL_TRAJ</span><span class="p">:</span> <span class="s1">&#39;MODE_VEL_TRAJ&#39;</span><span class="p">,</span>
</span><span id="StepperBase-72"><a href="#StepperBase-72"><span class="linenos"> 72</span></a>        <span class="n">MODE_CURRENT</span><span class="p">:</span> <span class="s1">&#39;MODE_CURRENT&#39;</span><span class="p">,</span>
</span><span id="StepperBase-73"><a href="#StepperBase-73"><span class="linenos"> 73</span></a>        <span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_INCR&#39;</span><span class="p">,</span>
</span><span id="StepperBase-74"><a href="#StepperBase-74"><span class="linenos"> 74</span></a>        <span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">:</span> <span class="s1">&#39;MODE_POS_TRAJ_WAYPOINT&#39;</span><span class="p">,</span>
</span><span id="StepperBase-75"><a href="#StepperBase-75"><span class="linenos"> 75</span></a>    <span class="p">}</span>
</span><span id="StepperBase-76"><a href="#StepperBase-76"><span class="linenos"> 76</span></a>
</span><span id="StepperBase-77"><a href="#StepperBase-77"><span class="linenos"> 77</span></a>    <span class="n">DIAG_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Has a pos zero RPC been received since powerup</span>
</span><span id="StepperBase-78"><a href="#StepperBase-78"><span class="linenos"> 78</span></a>    <span class="n">DIAG_RUNSTOP_ON</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Is controller in runstop mode</span>
</span><span id="StepperBase-79"><a href="#StepperBase-79"><span class="linenos"> 79</span></a>    <span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Is pos controller within gains.pAs_d of setpoint</span>
</span><span id="StepperBase-80"><a href="#StepperBase-80"><span class="linenos"> 80</span></a>    <span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Is vel controller within gains.vAs_d of setpoint</span>
</span><span id="StepperBase-81"><a href="#StepperBase-81"><span class="linenos"> 81</span></a>    <span class="n">DIAG_IS_MOVING</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># Is measured velocity greater than gains.vAs_d</span>
</span><span id="StepperBase-82"><a href="#StepperBase-82"><span class="linenos"> 82</span></a>    <span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># Is controller current saturated</span>
</span><span id="StepperBase-83"><a href="#StepperBase-83"><span class="linenos"> 83</span></a>    <span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">=</span> <span class="mi">64</span>  <span class="c1"># Is controller motion generator acceleration non-zero</span>
</span><span id="StepperBase-84"><a href="#StepperBase-84"><span class="linenos"> 84</span></a>    <span class="n">DIAG_IS_MG_MOVING</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># Is controller motion generator velocity non-zero</span>
</span><span id="StepperBase-85"><a href="#StepperBase-85"><span class="linenos"> 85</span></a>    <span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># Is calibration table in flash</span>
</span><span id="StepperBase-86"><a href="#StepperBase-86"><span class="linenos"> 86</span></a>    <span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Guarded event occurred during motion</span>
</span><span id="StepperBase-87"><a href="#StepperBase-87"><span class="linenos"> 87</span></a>    <span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">=</span> <span class="mi">1024</span>  <span class="c1"># Is it forced into safety mode</span>
</span><span id="StepperBase-88"><a href="#StepperBase-88"><span class="linenos"> 88</span></a>    <span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">2048</span>  <span class="c1"># Command received but no sync yet</span>
</span><span id="StepperBase-89"><a href="#StepperBase-89"><span class="linenos"> 89</span></a>    <span class="n">DIAG_TRAJ_ACTIVE</span>     <span class="o">=</span> <span class="mi">4096</span>     <span class="c1"># Whether a waypoint trajectory is actively executing</span>
</span><span id="StepperBase-90"><a href="#StepperBase-90"><span class="linenos"> 90</span></a>    <span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">=</span> <span class="mi">8192</span> <span class="c1"># Currently waiting on a sync signal before starting trajectory</span>
</span><span id="StepperBase-91"><a href="#StepperBase-91"><span class="linenos"> 91</span></a>    <span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">=</span> <span class="mi">16384</span>        <span class="c1"># Currently running in sync mode</span>
</span><span id="StepperBase-92"><a href="#StepperBase-92"><span class="linenos"> 92</span></a>    <span class="n">DIAG_IS_TRACE_ON</span> <span class="o">=</span> <span class="mi">32768</span>   <span class="c1">#Is trace recording</span>
</span><span id="StepperBase-93"><a href="#StepperBase-93"><span class="linenos"> 93</span></a>
</span><span id="StepperBase-94"><a href="#StepperBase-94"><span class="linenos"> 94</span></a>    <span class="n">CONFIG_SAFETY_HOLD</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Hold position in safety mode? Otherwise freewheel</span>
</span><span id="StepperBase-95"><a href="#StepperBase-95"><span class="linenos"> 95</span></a>    <span class="n">CONFIG_ENABLE_RUNSTOP</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Recognize runstop signal?</span>
</span><span id="StepperBase-96"><a href="#StepperBase-96"><span class="linenos"> 96</span></a>    <span class="n">CONFIG_ENABLE_SYNC_MODE</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Commands are synchronized from digital trigger</span>
</span><span id="StepperBase-97"><a href="#StepperBase-97"><span class="linenos"> 97</span></a>    <span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># Stops on current threshold</span>
</span><span id="StepperBase-98"><a href="#StepperBase-98"><span class="linenos"> 98</span></a>    <span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="StepperBase-99"><a href="#StepperBase-99"><span class="linenos"> 99</span></a>    <span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="StepperBase-100"><a href="#StepperBase-100"><span class="linenos">100</span></a>    <span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">=</span> <span class="mi">64</span> <span class="c1">#Timeout velocity commands</span>
</span><span id="StepperBase-101"><a href="#StepperBase-101"><span class="linenos">101</span></a>
</span><span id="StepperBase-102"><a href="#StepperBase-102"><span class="linenos">102</span></a>    <span class="n">TRIGGER_MARK_POS</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-103"><a href="#StepperBase-103"><span class="linenos">103</span></a>    <span class="n">TRIGGER_RESET_MOTION_GEN</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-104"><a href="#StepperBase-104"><span class="linenos">104</span></a>    <span class="n">TRIGGER_BOARD_RESET</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="StepperBase-105"><a href="#StepperBase-105"><span class="linenos">105</span></a>    <span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span> <span class="o">=</span> <span class="mi">8</span>
</span><span id="StepperBase-106"><a href="#StepperBase-106"><span class="linenos">106</span></a>    <span class="n">TRIGGER_RESET_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="StepperBase-107"><a href="#StepperBase-107"><span class="linenos">107</span></a>    <span class="n">TRIGGER_POS_CALIBRATED</span> <span class="o">=</span> <span class="mi">32</span>
</span><span id="StepperBase-108"><a href="#StepperBase-108"><span class="linenos">108</span></a>    <span class="n">TRIGGER_MARK_POS_ON_CONTACT</span><span class="o">=</span><span class="mi">64</span>
</span><span id="StepperBase-109"><a href="#StepperBase-109"><span class="linenos">109</span></a>    <span class="n">TRIGGER_ENABLE_TRACE</span><span class="o">=</span><span class="mi">128</span>
</span><span id="StepperBase-110"><a href="#StepperBase-110"><span class="linenos">110</span></a>    <span class="n">TRIGGER_DISABLE_TRACE</span><span class="o">=</span><span class="mi">256</span>
</span><span id="StepperBase-111"><a href="#StepperBase-111"><span class="linenos">111</span></a>
</span><span id="StepperBase-112"><a href="#StepperBase-112"><span class="linenos">112</span></a>    <span class="n">TRACE_TYPE_STATUS</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-113"><a href="#StepperBase-113"><span class="linenos">113</span></a>    <span class="n">TRACE_TYPE_DEBUG</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-114"><a href="#StepperBase-114"><span class="linenos">114</span></a>    <span class="n">TRACE_TYPE_PRINT</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StepperBase-115"><a href="#StepperBase-115"><span class="linenos">115</span></a>
</span><span id="StepperBase-116"><a href="#StepperBase-116"><span class="linenos">116</span></a>
</span><span id="StepperBase-117"><a href="#StepperBase-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase-118"><a href="#StepperBase-118"><span class="linenos">118</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-119"><a href="#StepperBase-119"><span class="linenos">119</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="c1">#Pull from usb device name</span>
</span><span id="StepperBase-120"><a href="#StepperBase-120"><span class="linenos">120</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="StepperBase-121"><a href="#StepperBase-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span>
</span><span id="StepperBase-122"><a href="#StepperBase-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">Transport</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="StepperBase-123"><a href="#StepperBase-123"><span class="linenos">123</span></a>
</span><span id="StepperBase-124"><a href="#StepperBase-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;a_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stiffness&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase-125"><a href="#StepperBase-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_pct&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;current&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-126"><a href="#StepperBase-126"><span class="linenos">126</span></a>                       <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-127"><a href="#StepperBase-127"><span class="linenos">127</span></a>                       <span class="s1">&#39;is_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-128"><a href="#StepperBase-128"><span class="linenos">128</span></a>                       <span class="s1">&#39;in_safety_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;trace_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase-129"><a href="#StepperBase-129"><span class="linenos">129</span></a>                       <span class="s1">&#39;waypoint_traj&#39;</span><span class="p">:{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="s1">&#39;setpoint&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;segment_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,}}</span>
</span><span id="StepperBase-130"><a href="#StepperBase-130"><span class="linenos">130</span></a>
</span><span id="StepperBase-131"><a href="#StepperBase-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase-132"><a href="#StepperBase-132"><span class="linenos">132</span></a>
</span><span id="StepperBase-133"><a href="#StepperBase-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase-134"><a href="#StepperBase-134"><span class="linenos">134</span></a>
</span><span id="StepperBase-135"><a href="#StepperBase-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;board_variant&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;firmware_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase-136"><a href="#StepperBase-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="StepperBase-137"><a href="#StepperBase-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="StepperBase-138"><a href="#StepperBase-138"><span class="linenos">138</span></a>
</span><span id="StepperBase-139"><a href="#StepperBase-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="StepperBase-140"><a href="#StepperBase-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-141"><a href="#StepperBase-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-142"><a href="#StepperBase-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase-143"><a href="#StepperBase-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase-144"><a href="#StepperBase-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StepperBase-145"><a href="#StepperBase-145"><span class="linenos">145</span></a>
</span><span id="StepperBase-146"><a href="#StepperBase-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-147"><a href="#StepperBase-147"><span class="linenos">147</span></a>
</span><span id="StepperBase-148"><a href="#StepperBase-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-149"><a href="#StepperBase-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-150"><a href="#StepperBase-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-151"><a href="#StepperBase-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase-152"><a href="#StepperBase-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-153"><a href="#StepperBase-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-154"><a href="#StepperBase-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</span><span id="StepperBase-155"><a href="#StepperBase-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase-156"><a href="#StepperBase-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase-157"><a href="#StepperBase-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StepperBase-158"><a href="#StepperBase-158"><span class="linenos">158</span></a>
</span><span id="StepperBase-159"><a href="#StepperBase-159"><span class="linenos">159</span></a>
</span><span id="StepperBase-160"><a href="#StepperBase-160"><span class="linenos">160</span></a>    <span class="c1"># ###########  Device Methods #############</span>
</span><span id="StepperBase-161"><a href="#StepperBase-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-162"><a href="#StepperBase-162"><span class="linenos">162</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="StepperBase-163"><a href="#StepperBase-163"><span class="linenos">163</span></a>            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="StepperBase-164"><a href="#StepperBase-164"><span class="linenos">164</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
</span><span id="StepperBase-165"><a href="#StepperBase-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-166"><a href="#StepperBase-166"><span class="linenos">166</span></a>                <span class="c1"># Pull board info</span>
</span><span id="StepperBase-167"><a href="#StepperBase-167"><span class="linenos">167</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STEPPER_BOARD_INFO</span><span class="p">])</span>
</span><span id="StepperBase-168"><a href="#StepperBase-168"><span class="linenos">168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_board_info_reply</span><span class="p">)</span>
</span><span id="StepperBase-169"><a href="#StepperBase-169"><span class="linenos">169</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">configure_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="StepperBase-170"><a href="#StepperBase-170"><span class="linenos">170</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="StepperBase-171"><a href="#StepperBase-171"><span class="linenos">171</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="StepperBase-172"><a href="#StepperBase-172"><span class="linenos">172</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="StepperBase-173"><a href="#StepperBase-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase-174"><a href="#StepperBase-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="StepperBase-175"><a href="#StepperBase-175"><span class="linenos">175</span></a>
</span><span id="StepperBase-176"><a href="#StepperBase-176"><span class="linenos">176</span></a>    <span class="c1">#Configure control mode prior to calling this on process shutdown (or default to freewheel)</span>
</span><span id="StepperBase-177"><a href="#StepperBase-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-178"><a href="#StepperBase-178"><span class="linenos">178</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="StepperBase-179"><a href="#StepperBase-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-180"><a href="#StepperBase-180"><span class="linenos">180</span></a>            <span class="k">return</span>
</span><span id="StepperBase-181"><a href="#StepperBase-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down Stepper on: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase-182"><a href="#StepperBase-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="StepperBase-183"><a href="#StepperBase-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">exiting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="StepperBase-184"><a href="#StepperBase-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="StepperBase-185"><a href="#StepperBase-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-186"><a href="#StepperBase-186"><span class="linenos">186</span></a>
</span><span id="StepperBase-187"><a href="#StepperBase-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_last_sync</span><span class="p">):</span>
</span><span id="StepperBase-188"><a href="#StepperBase-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="n">ts_last_sync</span>
</span><span id="StepperBase-189"><a href="#StepperBase-189"><span class="linenos">189</span></a>
</span><span id="StepperBase-190"><a href="#StepperBase-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-191"><a href="#StepperBase-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-192"><a href="#StepperBase-192"><span class="linenos">192</span></a>            <span class="k">return</span>
</span><span id="StepperBase-193"><a href="#StepperBase-193"><span class="linenos">193</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-194"><a href="#StepperBase-194"><span class="linenos">194</span></a>
</span><span id="StepperBase-195"><a href="#StepperBase-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase-196"><a href="#StepperBase-196"><span class="linenos">196</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase-197"><a href="#StepperBase-197"><span class="linenos">197</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-198"><a href="#StepperBase-198"><span class="linenos">198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-199"><a href="#StepperBase-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-200"><a href="#StepperBase-200"><span class="linenos">200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-201"><a href="#StepperBase-201"><span class="linenos">201</span></a>
</span><span id="StepperBase-202"><a href="#StepperBase-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase-203"><a href="#StepperBase-203"><span class="linenos">203</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase-204"><a href="#StepperBase-204"><span class="linenos">204</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-205"><a href="#StepperBase-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-206"><a href="#StepperBase-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-207"><a href="#StepperBase-207"><span class="linenos">207</span></a>
</span><span id="StepperBase-208"><a href="#StepperBase-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase-209"><a href="#StepperBase-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span>  <span class="c1"># Mark the time of latest new motion command sent</span>
</span><span id="StepperBase-210"><a href="#StepperBase-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-211"><a href="#StepperBase-211"><span class="linenos">211</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-212"><a href="#StepperBase-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-213"><a href="#StepperBase-213"><span class="linenos">213</span></a>
</span><span id="StepperBase-214"><a href="#StepperBase-214"><span class="linenos">214</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase-215"><a href="#StepperBase-215"><span class="linenos">215</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-216"><a href="#StepperBase-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-217"><a href="#StepperBase-217"><span class="linenos">217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-218"><a href="#StepperBase-218"><span class="linenos">218</span></a>
</span><span id="StepperBase-219"><a href="#StepperBase-219"><span class="linenos">219</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-220"><a href="#StepperBase-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-221"><a href="#StepperBase-221"><span class="linenos">221</span></a>            <span class="k">return</span>
</span><span id="StepperBase-222"><a href="#StepperBase-222"><span class="linenos">222</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-223"><a href="#StepperBase-223"><span class="linenos">223</span></a>
</span><span id="StepperBase-224"><a href="#StepperBase-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase-225"><a href="#StepperBase-225"><span class="linenos">225</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase-226"><a href="#StepperBase-226"><span class="linenos">226</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-227"><a href="#StepperBase-227"><span class="linenos">227</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-228"><a href="#StepperBase-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-229"><a href="#StepperBase-229"><span class="linenos">229</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-230"><a href="#StepperBase-230"><span class="linenos">230</span></a>
</span><span id="StepperBase-231"><a href="#StepperBase-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase-232"><a href="#StepperBase-232"><span class="linenos">232</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase-233"><a href="#StepperBase-233"><span class="linenos">233</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-234"><a href="#StepperBase-234"><span class="linenos">234</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-235"><a href="#StepperBase-235"><span class="linenos">235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-236"><a href="#StepperBase-236"><span class="linenos">236</span></a>
</span><span id="StepperBase-237"><a href="#StepperBase-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase-238"><a href="#StepperBase-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span> <span class="c1">#Mark the time of latest new motion command sent</span>
</span><span id="StepperBase-239"><a href="#StepperBase-239"><span class="linenos">239</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-240"><a href="#StepperBase-240"><span class="linenos">240</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-241"><a href="#StepperBase-241"><span class="linenos">241</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-242"><a href="#StepperBase-242"><span class="linenos">242</span></a>
</span><span id="StepperBase-243"><a href="#StepperBase-243"><span class="linenos">243</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase-244"><a href="#StepperBase-244"><span class="linenos">244</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-245"><a href="#StepperBase-245"><span class="linenos">245</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-246"><a href="#StepperBase-246"><span class="linenos">246</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-247"><a href="#StepperBase-247"><span class="linenos">247</span></a>
</span><span id="StepperBase-248"><a href="#StepperBase-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-249"><a href="#StepperBase-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-250"><a href="#StepperBase-250"><span class="linenos">250</span></a>            <span class="k">return</span>
</span><span id="StepperBase-251"><a href="#StepperBase-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase-252"><a href="#StepperBase-252"><span class="linenos">252</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase-253"><a href="#StepperBase-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">)</span>
</span><span id="StepperBase-254"><a href="#StepperBase-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-255"><a href="#StepperBase-255"><span class="linenos">255</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase-256"><a href="#StepperBase-256"><span class="linenos">256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-257"><a href="#StepperBase-257"><span class="linenos">257</span></a>
</span><span id="StepperBase-258"><a href="#StepperBase-258"><span class="linenos">258</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase-259"><a href="#StepperBase-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-260"><a href="#StepperBase-260"><span class="linenos">260</span></a>            <span class="k">return</span>
</span><span id="StepperBase-261"><a href="#StepperBase-261"><span class="linenos">261</span></a>
</span><span id="StepperBase-262"><a href="#StepperBase-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase-263"><a href="#StepperBase-263"><span class="linenos">263</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase-264"><a href="#StepperBase-264"><span class="linenos">264</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-265"><a href="#StepperBase-265"><span class="linenos">265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase-266"><a href="#StepperBase-266"><span class="linenos">266</span></a>
</span><span id="StepperBase-267"><a href="#StepperBase-267"><span class="linenos">267</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase-268"><a href="#StepperBase-268"><span class="linenos">268</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase-269"><a href="#StepperBase-269"><span class="linenos">269</span></a>
</span><span id="StepperBase-270"><a href="#StepperBase-270"><span class="linenos">270</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-271"><a href="#StepperBase-271"><span class="linenos">271</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-272"><a href="#StepperBase-272"><span class="linenos">272</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-273"><a href="#StepperBase-273"><span class="linenos">273</span></a>
</span><span id="StepperBase-274"><a href="#StepperBase-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-275"><a href="#StepperBase-275"><span class="linenos">275</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-276"><a href="#StepperBase-276"><span class="linenos">276</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-277"><a href="#StepperBase-277"><span class="linenos">277</span></a>
</span><span id="StepperBase-278"><a href="#StepperBase-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-279"><a href="#StepperBase-279"><span class="linenos">279</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-280"><a href="#StepperBase-280"><span class="linenos">280</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-281"><a href="#StepperBase-281"><span class="linenos">281</span></a>
</span><span id="StepperBase-282"><a href="#StepperBase-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="StepperBase-283"><a href="#StepperBase-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;stepper_is_moving_filter&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-284"><a href="#StepperBase-284"><span class="linenos">284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-285"><a href="#StepperBase-285"><span class="linenos">285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="StepperBase-286"><a href="#StepperBase-286"><span class="linenos">286</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span><span id="StepperBase-287"><a href="#StepperBase-287"><span class="linenos">287</span></a>
</span><span id="StepperBase-288"><a href="#StepperBase-288"><span class="linenos">288</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="StepperBase-289"><a href="#StepperBase-289"><span class="linenos">289</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="StepperBase-290"><a href="#StepperBase-290"><span class="linenos">290</span></a>
</span><span id="StepperBase-291"><a href="#StepperBase-291"><span class="linenos">291</span></a>
</span><span id="StepperBase-292"><a href="#StepperBase-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">set_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">):</span>
</span><span id="StepperBase-293"><a href="#StepperBase-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="n">limit_neg</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">limit_pos</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="StepperBase-294"><a href="#StepperBase-294"><span class="linenos">294</span></a>            <span class="c1">#Push out immediately</span>
</span><span id="StepperBase-295"><a href="#StepperBase-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">]</span>
</span><span id="StepperBase-296"><a href="#StepperBase-296"><span class="linenos">296</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-297"><a href="#StepperBase-297"><span class="linenos">297</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MOTION_LIMITS</span>
</span><span id="StepperBase-298"><a href="#StepperBase-298"><span class="linenos">298</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_motion_limits</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase-299"><a href="#StepperBase-299"><span class="linenos">299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_motion_limits_reply</span><span class="p">)</span>
</span><span id="StepperBase-300"><a href="#StepperBase-300"><span class="linenos">300</span></a>
</span><span id="StepperBase-301"><a href="#StepperBase-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
</span><span id="StepperBase-302"><a href="#StepperBase-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase-303"><a href="#StepperBase-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-304"><a href="#StepperBase-304"><span class="linenos">304</span></a>
</span><span id="StepperBase-305"><a href="#StepperBase-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-306"><a href="#StepperBase-306"><span class="linenos">306</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;This method has been deprecated since v0.3.0&#39;</span><span class="p">)</span>
</span><span id="StepperBase-307"><a href="#StepperBase-307"><span class="linenos">307</span></a>
</span><span id="StepperBase-308"><a href="#StepperBase-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-309"><a href="#StepperBase-309"><span class="linenos">309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span>
</span><span id="StepperBase-310"><a href="#StepperBase-310"><span class="linenos">310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-311"><a href="#StepperBase-311"><span class="linenos">311</span></a>
</span><span id="StepperBase-312"><a href="#StepperBase-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="nf">read_gains_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-313"><a href="#StepperBase-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-314"><a href="#StepperBase-314"><span class="linenos">314</span></a>
</span><span id="StepperBase-315"><a href="#StepperBase-315"><span class="linenos">315</span></a>    <span class="k">def</span> <span class="nf">board_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-316"><a href="#StepperBase-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_BOARD_RESET</span>
</span><span id="StepperBase-317"><a href="#StepperBase-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-318"><a href="#StepperBase-318"><span class="linenos">318</span></a>
</span><span id="StepperBase-319"><a href="#StepperBase-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">mark_position_on_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase-320"><a href="#StepperBase-320"><span class="linenos">320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="StepperBase-321"><a href="#StepperBase-321"><span class="linenos">321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS_ON_CONTACT</span>
</span><span id="StepperBase-322"><a href="#StepperBase-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-323"><a href="#StepperBase-323"><span class="linenos">323</span></a>
</span><span id="StepperBase-324"><a href="#StepperBase-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase-325"><a href="#StepperBase-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">:</span>
</span><span id="StepperBase-326"><a href="#StepperBase-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not mark position. Must be in MODE_SAFETY for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase-327"><a href="#StepperBase-327"><span class="linenos">327</span></a>            <span class="k">return</span>
</span><span id="StepperBase-328"><a href="#StepperBase-328"><span class="linenos">328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="n">x</span>
</span><span id="StepperBase-329"><a href="#StepperBase-329"><span class="linenos">329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS</span>
</span><span id="StepperBase-330"><a href="#StepperBase-330"><span class="linenos">330</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-331"><a href="#StepperBase-331"><span class="linenos">331</span></a>
</span><span id="StepperBase-332"><a href="#StepperBase-332"><span class="linenos">332</span></a>    <span class="k">def</span> <span class="nf">reset_motion_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-333"><a href="#StepperBase-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_MOTION_GEN</span>
</span><span id="StepperBase-334"><a href="#StepperBase-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-335"><a href="#StepperBase-335"><span class="linenos">335</span></a>
</span><span id="StepperBase-336"><a href="#StepperBase-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">reset_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-337"><a href="#StepperBase-337"><span class="linenos">337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_POS_CALIBRATED</span>
</span><span id="StepperBase-338"><a href="#StepperBase-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-339"><a href="#StepperBase-339"><span class="linenos">339</span></a>
</span><span id="StepperBase-340"><a href="#StepperBase-340"><span class="linenos">340</span></a>    <span class="k">def</span> <span class="nf">set_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-341"><a href="#StepperBase-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_POS_CALIBRATED</span>
</span><span id="StepperBase-342"><a href="#StepperBase-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="StepperBase-343"><a href="#StepperBase-343"><span class="linenos">343</span></a>
</span><span id="StepperBase-344"><a href="#StepperBase-344"><span class="linenos">344</span></a>
</span><span id="StepperBase-345"><a href="#StepperBase-345"><span class="linenos">345</span></a>
</span><span id="StepperBase-346"><a href="#StepperBase-346"><span class="linenos">346</span></a>    <span class="c1"># ###########################################################################</span>
</span><span id="StepperBase-347"><a href="#StepperBase-347"><span class="linenos">347</span></a>    <span class="k">def</span> <span class="nf">enable_safety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-348"><a href="#StepperBase-348"><span class="linenos">348</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">)</span>
</span><span id="StepperBase-349"><a href="#StepperBase-349"><span class="linenos">349</span></a>
</span><span id="StepperBase-350"><a href="#StepperBase-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">enable_freewheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-351"><a href="#StepperBase-351"><span class="linenos">351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_FREEWHEEL</span><span class="p">)</span>
</span><span id="StepperBase-352"><a href="#StepperBase-352"><span class="linenos">352</span></a>
</span><span id="StepperBase-353"><a href="#StepperBase-353"><span class="linenos">353</span></a>    <span class="k">def</span> <span class="nf">enable_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-354"><a href="#StepperBase-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_HOLD</span><span class="p">)</span>
</span><span id="StepperBase-355"><a href="#StepperBase-355"><span class="linenos">355</span></a>
</span><span id="StepperBase-356"><a href="#StepperBase-356"><span class="linenos">356</span></a>    <span class="k">def</span> <span class="nf">enable_vel_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-357"><a href="#StepperBase-357"><span class="linenos">357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-358"><a href="#StepperBase-358"><span class="linenos">358</span></a>
</span><span id="StepperBase-359"><a href="#StepperBase-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">enable_pos_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-360"><a href="#StepperBase-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_PID</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase-361"><a href="#StepperBase-361"><span class="linenos">361</span></a>
</span><span id="StepperBase-362"><a href="#StepperBase-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">enable_vel_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-363"><a href="#StepperBase-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-364"><a href="#StepperBase-364"><span class="linenos">364</span></a>
</span><span id="StepperBase-365"><a href="#StepperBase-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-366"><a href="#StepperBase-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase-367"><a href="#StepperBase-367"><span class="linenos">367</span></a>
</span><span id="StepperBase-368"><a href="#StepperBase-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-369"><a href="#StepperBase-369"><span class="linenos">369</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-370"><a href="#StepperBase-370"><span class="linenos">370</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-371"><a href="#StepperBase-371"><span class="linenos">371</span></a>
</span><span id="StepperBase-372"><a href="#StepperBase-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-373"><a href="#StepperBase-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-374"><a href="#StepperBase-374"><span class="linenos">374</span></a>
</span><span id="StepperBase-375"><a href="#StepperBase-375"><span class="linenos">375</span></a>    <span class="k">def</span> <span class="nf">enable_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-376"><a href="#StepperBase-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">,</span> <span class="n">i_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-377"><a href="#StepperBase-377"><span class="linenos">377</span></a>
</span><span id="StepperBase-378"><a href="#StepperBase-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">enable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-379"><a href="#StepperBase-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-380"><a href="#StepperBase-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-381"><a href="#StepperBase-381"><span class="linenos">381</span></a>
</span><span id="StepperBase-382"><a href="#StepperBase-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">disable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-383"><a href="#StepperBase-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-384"><a href="#StepperBase-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase-385"><a href="#StepperBase-385"><span class="linenos">385</span></a>
</span><span id="StepperBase-386"><a href="#StepperBase-386"><span class="linenos">386</span></a>    <span class="k">def</span> <span class="nf">enable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-387"><a href="#StepperBase-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-388"><a href="#StepperBase-388"><span class="linenos">388</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-389"><a href="#StepperBase-389"><span class="linenos">389</span></a>
</span><span id="StepperBase-390"><a href="#StepperBase-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">disable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-391"><a href="#StepperBase-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-392"><a href="#StepperBase-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase-393"><a href="#StepperBase-393"><span class="linenos">393</span></a>
</span><span id="StepperBase-394"><a href="#StepperBase-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="nf">enable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-395"><a href="#StepperBase-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-396"><a href="#StepperBase-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-397"><a href="#StepperBase-397"><span class="linenos">397</span></a>
</span><span id="StepperBase-398"><a href="#StepperBase-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">disable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-399"><a href="#StepperBase-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-400"><a href="#StepperBase-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase-401"><a href="#StepperBase-401"><span class="linenos">401</span></a>
</span><span id="StepperBase-402"><a href="#StepperBase-402"><span class="linenos">402</span></a>
</span><span id="StepperBase-403"><a href="#StepperBase-403"><span class="linenos">403</span></a>
</span><span id="StepperBase-404"><a href="#StepperBase-404"><span class="linenos">404</span></a>    <span class="c1"># ######################################################################</span>
</span><span id="StepperBase-405"><a href="#StepperBase-405"><span class="linenos">405</span></a>    <span class="c1">#Primary interface to controlling the stepper</span>
</span><span id="StepperBase-406"><a href="#StepperBase-406"><span class="linenos">406</span></a>    <span class="c1">#YAML defaults are used if values not provided</span>
</span><span id="StepperBase-407"><a href="#StepperBase-407"><span class="linenos">407</span></a>    <span class="c1">#This allows user to override defaults every control cycle and then easily revert to defaults</span>
</span><span id="StepperBase-408"><a href="#StepperBase-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span>  <span class="p">):</span>
</span><span id="StepperBase-409"><a href="#StepperBase-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-410"><a href="#StepperBase-410"><span class="linenos">410</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="StepperBase-411"><a href="#StepperBase-411"><span class="linenos">411</span></a>
</span><span id="StepperBase-412"><a href="#StepperBase-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-413"><a href="#StepperBase-413"><span class="linenos">413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="StepperBase-414"><a href="#StepperBase-414"><span class="linenos">414</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span>
</span><span id="StepperBase-415"><a href="#StepperBase-415"><span class="linenos">415</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">255</span>
</span><span id="StepperBase-416"><a href="#StepperBase-416"><span class="linenos">416</span></a>
</span><span id="StepperBase-417"><a href="#StepperBase-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-418"><a href="#StepperBase-418"><span class="linenos">418</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="StepperBase-419"><a href="#StepperBase-419"><span class="linenos">419</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-420"><a href="#StepperBase-420"><span class="linenos">420</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">:</span>
</span><span id="StepperBase-421"><a href="#StepperBase-421"><span class="linenos">421</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-422"><a href="#StepperBase-422"><span class="linenos">422</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-423"><a href="#StepperBase-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="StepperBase-424"><a href="#StepperBase-424"><span class="linenos">424</span></a>
</span><span id="StepperBase-425"><a href="#StepperBase-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-426"><a href="#StepperBase-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="StepperBase-427"><a href="#StepperBase-427"><span class="linenos">427</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-428"><a href="#StepperBase-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="StepperBase-429"><a href="#StepperBase-429"><span class="linenos">429</span></a>
</span><span id="StepperBase-430"><a href="#StepperBase-430"><span class="linenos">430</span></a>        <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-431"><a href="#StepperBase-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span>
</span><span id="StepperBase-432"><a href="#StepperBase-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-433"><a href="#StepperBase-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase-434"><a href="#StepperBase-434"><span class="linenos">434</span></a>
</span><span id="StepperBase-435"><a href="#StepperBase-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="n">i_feedforward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-436"><a href="#StepperBase-436"><span class="linenos">436</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_feedforward</span>
</span><span id="StepperBase-437"><a href="#StepperBase-437"><span class="linenos">437</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-438"><a href="#StepperBase-438"><span class="linenos">438</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-439"><a href="#StepperBase-439"><span class="linenos">439</span></a>
</span><span id="StepperBase-440"><a href="#StepperBase-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">i_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">:</span>
</span><span id="StepperBase-441"><a href="#StepperBase-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">i_des</span>
</span><span id="StepperBase-442"><a href="#StepperBase-442"><span class="linenos">442</span></a>
</span><span id="StepperBase-443"><a href="#StepperBase-443"><span class="linenos">443</span></a>
</span><span id="StepperBase-444"><a href="#StepperBase-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">i_contact_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-445"><a href="#StepperBase-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_pos</span>
</span><span id="StepperBase-446"><a href="#StepperBase-446"><span class="linenos">446</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-447"><a href="#StepperBase-447"><span class="linenos">447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase-448"><a href="#StepperBase-448"><span class="linenos">448</span></a>
</span><span id="StepperBase-449"><a href="#StepperBase-449"><span class="linenos">449</span></a>        <span class="k">if</span> <span class="n">i_contact_neg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-450"><a href="#StepperBase-450"><span class="linenos">450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_neg</span>
</span><span id="StepperBase-451"><a href="#StepperBase-451"><span class="linenos">451</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-452"><a href="#StepperBase-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span>
</span><span id="StepperBase-453"><a href="#StepperBase-453"><span class="linenos">453</span></a>        <span class="c1">#print(time.time(), i_des, self._command[&#39;i_feedforward&#39;],mode == self.MODE_CURRENT)</span>
</span><span id="StepperBase-454"><a href="#StepperBase-454"><span class="linenos">454</span></a>        <span class="c1">#print(time.time(),self._command[&#39;x_des&#39;],self._command[&#39;incr_trigger&#39;],self._command[&#39;v_des&#39;],self._command[&#39;a_des&#39;])</span>
</span><span id="StepperBase-455"><a href="#StepperBase-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="o">=</span><span class="kc">True</span>
</span><span id="StepperBase-456"><a href="#StepperBase-456"><span class="linenos">456</span></a>
</span><span id="StepperBase-457"><a href="#StepperBase-457"><span class="linenos">457</span></a>
</span><span id="StepperBase-458"><a href="#StepperBase-458"><span class="linenos">458</span></a>    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase-459"><a href="#StepperBase-459"><span class="linenos">459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase-460"><a href="#StepperBase-460"><span class="linenos">460</span></a><span class="sd">        Poll until is moving flag is false</span>
</span><span id="StepperBase-461"><a href="#StepperBase-461"><span class="linenos">461</span></a><span class="sd">        Return True if success</span>
</span><span id="StepperBase-462"><a href="#StepperBase-462"><span class="linenos">462</span></a><span class="sd">        Return False if timeout</span>
</span><span id="StepperBase-463"><a href="#StepperBase-463"><span class="linenos">463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-464"><a href="#StepperBase-464"><span class="linenos">464</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-465"><a href="#StepperBase-465"><span class="linenos">465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-466"><a href="#StepperBase-466"><span class="linenos">466</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase-467"><a href="#StepperBase-467"><span class="linenos">467</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-468"><a href="#StepperBase-468"><span class="linenos">468</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-469"><a href="#StepperBase-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span>
</span><span id="StepperBase-470"><a href="#StepperBase-470"><span class="linenos">470</span></a>
</span><span id="StepperBase-471"><a href="#StepperBase-471"><span class="linenos">471</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase-472"><a href="#StepperBase-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase-473"><a href="#StepperBase-473"><span class="linenos">473</span></a><span class="sd">        Poll until near setpoint</span>
</span><span id="StepperBase-474"><a href="#StepperBase-474"><span class="linenos">474</span></a><span class="sd">        Return True if success</span>
</span><span id="StepperBase-475"><a href="#StepperBase-475"><span class="linenos">475</span></a><span class="sd">        Return False if timeout</span>
</span><span id="StepperBase-476"><a href="#StepperBase-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase-477"><a href="#StepperBase-477"><span class="linenos">477</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase-478"><a href="#StepperBase-478"><span class="linenos">478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-479"><a href="#StepperBase-479"><span class="linenos">479</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase-480"><a href="#StepperBase-480"><span class="linenos">480</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-481"><a href="#StepperBase-481"><span class="linenos">481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase-482"><a href="#StepperBase-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span>
</span><span id="StepperBase-483"><a href="#StepperBase-483"><span class="linenos">483</span></a>
</span><span id="StepperBase-484"><a href="#StepperBase-484"><span class="linenos">484</span></a>    <span class="c1">########### Handle current and effort conversions  ###########</span>
</span><span id="StepperBase-485"><a href="#StepperBase-485"><span class="linenos">485</span></a>
</span><span id="StepperBase-486"><a href="#StepperBase-486"><span class="linenos">486</span></a>    <span class="c1">#Effort_ticks are in the units of the uC current controller (0-255 8 bit)</span>
</span><span id="StepperBase-487"><a href="#StepperBase-487"><span class="linenos">487</span></a>    <span class="c1">#Conversion to A is based on the sense resistor and motor driver (see firmware)</span>
</span><span id="StepperBase-488"><a href="#StepperBase-488"><span class="linenos">488</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase-489"><a href="#StepperBase-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase-490"><a href="#StepperBase-490"><span class="linenos">490</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-491"><a href="#StepperBase-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase-492"><a href="#StepperBase-492"><span class="linenos">492</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase-493"><a href="#StepperBase-493"><span class="linenos">493</span></a>        <span class="n">effort_ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_A</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mA_per_tick</span>
</span><span id="StepperBase-494"><a href="#StepperBase-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">255</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">effort_ticks</span><span class="p">)))</span>
</span><span id="StepperBase-495"><a href="#StepperBase-495"><span class="linenos">495</span></a>
</span><span id="StepperBase-496"><a href="#StepperBase-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="nf">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase-497"><a href="#StepperBase-497"><span class="linenos">497</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase-498"><a href="#StepperBase-498"><span class="linenos">498</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-499"><a href="#StepperBase-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase-500"><a href="#StepperBase-500"><span class="linenos">500</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase-501"><a href="#StepperBase-501"><span class="linenos">501</span></a>        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="n">mA_per_tick</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span><span id="StepperBase-502"><a href="#StepperBase-502"><span class="linenos">502</span></a>
</span><span id="StepperBase-503"><a href="#StepperBase-503"><span class="linenos">503</span></a>    <span class="c1"># Effort_pct is defined as a percentage of the maximum allowable motor winding current</span>
</span><span id="StepperBase-504"><a href="#StepperBase-504"><span class="linenos">504</span></a>    <span class="c1"># Range is -100.0 to 100.0</span>
</span><span id="StepperBase-505"><a href="#StepperBase-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase-506"><a href="#StepperBase-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="n">i_A</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase-507"><a href="#StepperBase-507"><span class="linenos">507</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i_A</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-508"><a href="#StepperBase-508"><span class="linenos">508</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-509"><a href="#StepperBase-509"><span class="linenos">509</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i_A</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])))</span>
</span><span id="StepperBase-510"><a href="#StepperBase-510"><span class="linenos">510</span></a>
</span><span id="StepperBase-511"><a href="#StepperBase-511"><span class="linenos">511</span></a>    <span class="k">def</span> <span class="nf">effort_pct_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
</span><span id="StepperBase-512"><a href="#StepperBase-512"><span class="linenos">512</span></a>        <span class="k">if</span> <span class="n">e_pct</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase-513"><a href="#StepperBase-513"><span class="linenos">513</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase-514"><a href="#StepperBase-514"><span class="linenos">514</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-515"><a href="#StepperBase-515"><span class="linenos">515</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])</span>
</span><span id="StepperBase-516"><a href="#StepperBase-516"><span class="linenos">516</span></a>
</span><span id="StepperBase-517"><a href="#StepperBase-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="nf">current_to_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="StepperBase-518"><a href="#StepperBase-518"><span class="linenos">518</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method current_to_torque has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="StepperBase-519"><a href="#StepperBase-519"><span class="linenos">519</span></a>
</span><span id="StepperBase-520"><a href="#StepperBase-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">torque_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tq</span><span class="p">):</span>
</span><span id="StepperBase-521"><a href="#StepperBase-521"><span class="linenos">521</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method torque_to_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="StepperBase-522"><a href="#StepperBase-522"><span class="linenos">522</span></a>
</span><span id="StepperBase-523"><a href="#StepperBase-523"><span class="linenos">523</span></a>
</span><span id="StepperBase-524"><a href="#StepperBase-524"><span class="linenos">524</span></a>        <span class="c1"># ####################### Encoder Calibration ######################</span>
</span><span id="StepperBase-525"><a href="#StepperBase-525"><span class="linenos">525</span></a>
</span><span id="StepperBase-526"><a href="#StepperBase-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">get_chip_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-527"><a href="#StepperBase-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-528"><a href="#StepperBase-528"><span class="linenos">528</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-529"><a href="#StepperBase-529"><span class="linenos">529</span></a>        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="StepperBase-530"><a href="#StepperBase-530"><span class="linenos">530</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-531"><a href="#StepperBase-531"><span class="linenos">531</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-532"><a href="#StepperBase-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="n">cid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="StepperBase-533"><a href="#StepperBase-533"><span class="linenos">533</span></a>
</span><span id="StepperBase-534"><a href="#StepperBase-534"><span class="linenos">534</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-535"><a href="#StepperBase-535"><span class="linenos">535</span></a>        <span class="n">device_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase-536"><a href="#StepperBase-536"><span class="linenos">536</span></a>        <span class="n">sn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase-537"><a href="#StepperBase-537"><span class="linenos">537</span></a>        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">sn</span><span class="o">+</span><span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase-538"><a href="#StepperBase-538"><span class="linenos">538</span></a>        <span class="n">enc_data</span><span class="o">=</span><span class="n">read_fleet_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="StepperBase-539"><a href="#StepperBase-539"><span class="linenos">539</span></a>        <span class="k">return</span> <span class="n">enc_data</span>
</span><span id="StepperBase-540"><a href="#StepperBase-540"><span class="linenos">540</span></a>
</span><span id="StepperBase-541"><a href="#StepperBase-541"><span class="linenos">541</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase-542"><a href="#StepperBase-542"><span class="linenos">542</span></a>        <span class="n">device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase-543"><a href="#StepperBase-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase-544"><a href="#StepperBase-544"><span class="linenos">544</span></a>            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase-545"><a href="#StepperBase-545"><span class="linenos">545</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">sn</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase-546"><a href="#StepperBase-546"><span class="linenos">546</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</span><span id="StepperBase-547"><a href="#StepperBase-547"><span class="linenos">547</span></a>        <span class="n">write_fleet_yaml</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">fleet_dir</span><span class="o">=</span><span class="n">fleet_dir</span><span class="p">)</span>
</span><span id="StepperBase-548"><a href="#StepperBase-548"><span class="linenos">548</span></a>
</span><span id="StepperBase-549"><a href="#StepperBase-549"><span class="linenos">549</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-550"><a href="#StepperBase-550"><span class="linenos">550</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-551"><a href="#StepperBase-551"><span class="linenos">551</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-552"><a href="#StepperBase-552"><span class="linenos">552</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase-553"><a href="#StepperBase-553"><span class="linenos">553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase-554"><a href="#StepperBase-554"><span class="linenos">554</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">19</span><span class="p">]</span>
</span><span id="StepperBase-555"><a href="#StepperBase-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase-556"><a href="#StepperBase-556"><span class="linenos">556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase-557"><a href="#StepperBase-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reseting board&#39;</span><span class="p">)</span>
</span><span id="StepperBase-558"><a href="#StepperBase-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_reset</span><span class="p">()</span>
</span><span id="StepperBase-559"><a href="#StepperBase-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase-560"><a href="#StepperBase-560"><span class="linenos">560</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># We now have string of floats, convert to list of floats</span>
</span><span id="StepperBase-561"><a href="#StepperBase-561"><span class="linenos">561</span></a>        <span class="n">enc_calib</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase-562"><a href="#StepperBase-562"><span class="linenos">562</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase-563"><a href="#StepperBase-563"><span class="linenos">563</span></a>            <span class="n">ff</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="StepperBase-564"><a href="#StepperBase-564"><span class="linenos">564</span></a>            <span class="k">if</span> <span class="n">ff</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="StepperBase-565"><a href="#StepperBase-565"><span class="linenos">565</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ff</span><span class="p">]))</span>
</span><span id="StepperBase-566"><a href="#StepperBase-566"><span class="linenos">566</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="StepperBase-567"><a href="#StepperBase-567"><span class="linenos">567</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-568"><a href="#StepperBase-568"><span class="linenos">568</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="StepperBase-569"><a href="#StepperBase-569"><span class="linenos">569</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase-570"><a href="#StepperBase-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_calib</span><span class="p">)</span><span class="o">==</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase-571"><a href="#StepperBase-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Successful read of encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase-572"><a href="#StepperBase-572"><span class="linenos">572</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-573"><a href="#StepperBase-573"><span class="linenos">573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Failed to read encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase-574"><a href="#StepperBase-574"><span class="linenos">574</span></a>        <span class="k">return</span> <span class="n">enc_calib</span>
</span><span id="StepperBase-575"><a href="#StepperBase-575"><span class="linenos">575</span></a>
</span><span id="StepperBase-576"><a href="#StepperBase-576"><span class="linenos">576</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
</span><span id="StepperBase-577"><a href="#StepperBase-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-578"><a href="#StepperBase-578"><span class="linenos">578</span></a>            <span class="k">return</span>
</span><span id="StepperBase-579"><a href="#StepperBase-579"><span class="linenos">579</span></a>        <span class="c1">#This will take a few seconds. Blocks until complete.</span>
</span><span id="StepperBase-580"><a href="#StepperBase-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">!=</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase-581"><a href="#StepperBase-581"><span class="linenos">581</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad encoder data&#39;</span><span class="p">)</span>
</span><span id="StepperBase-582"><a href="#StepperBase-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-583"><a href="#StepperBase-583"><span class="linenos">583</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase-584"><a href="#StepperBase-584"><span class="linenos">584</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase-585"><a href="#StepperBase-585"><span class="linenos">585</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span><span id="StepperBase-586"><a href="#StepperBase-586"><span class="linenos">586</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase-587"><a href="#StepperBase-587"><span class="linenos">587</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="StepperBase-588"><a href="#StepperBase-588"><span class="linenos">588</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="StepperBase-589"><a href="#StepperBase-589"><span class="linenos">589</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_ENC_CALIB</span>
</span><span id="StepperBase-590"><a href="#StepperBase-590"><span class="linenos">590</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="StepperBase-591"><a href="#StepperBase-591"><span class="linenos">591</span></a>                <span class="n">sidx</span><span class="o">=</span><span class="mi">2</span>
</span><span id="StepperBase-592"><a href="#StepperBase-592"><span class="linenos">592</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span><span id="StepperBase-593"><a href="#StepperBase-593"><span class="linenos">593</span></a>                    <span class="n">pack_float_t</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">64</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
</span><span id="StepperBase-594"><a href="#StepperBase-594"><span class="linenos">594</span></a>                    <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-595"><a href="#StepperBase-595"><span class="linenos">595</span></a>                <span class="c1"># self.logger.debug(&#39;Sending encoder calibration rpc of size&#39;,sidx)</span>
</span><span id="StepperBase-596"><a href="#StepperBase-596"><span class="linenos">596</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_enc_calib_reply</span><span class="p">)</span>
</span><span id="StepperBase-597"><a href="#StepperBase-597"><span class="linenos">597</span></a>
</span><span id="StepperBase-598"><a href="#StepperBase-598"><span class="linenos">598</span></a>    <span class="k">def</span> <span class="nf">rpc_enc_calib_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-599"><a href="#StepperBase-599"><span class="linenos">599</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_ENC_CALIB</span><span class="p">:</span>
</span><span id="StepperBase-600"><a href="#StepperBase-600"><span class="linenos">600</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_ENC_CALIB&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-601"><a href="#StepperBase-601"><span class="linenos">601</span></a>
</span><span id="StepperBase-602"><a href="#StepperBase-602"><span class="linenos">602</span></a>    <span class="c1"># ######################Menu Interface ################################3</span>
</span><span id="StepperBase-603"><a href="#StepperBase-603"><span class="linenos">603</span></a>
</span><span id="StepperBase-604"><a href="#StepperBase-604"><span class="linenos">604</span></a>
</span><span id="StepperBase-605"><a href="#StepperBase-605"><span class="linenos">605</span></a>    <span class="k">def</span> <span class="nf">turn_rpc_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-606"><a href="#StepperBase-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;zyx&#39;</span><span class="p">)</span>
</span><span id="StepperBase-607"><a href="#StepperBase-607"><span class="linenos">607</span></a>
</span><span id="StepperBase-608"><a href="#StepperBase-608"><span class="linenos">608</span></a>
</span><span id="StepperBase-609"><a href="#StepperBase-609"><span class="linenos">609</span></a>    <span class="k">def</span> <span class="nf">turn_menu_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-610"><a href="#StepperBase-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-611"><a href="#StepperBase-611"><span class="linenos">611</span></a>            <span class="k">return</span>
</span><span id="StepperBase-612"><a href="#StepperBase-612"><span class="linenos">612</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MENU_ON</span><span class="p">])</span>
</span><span id="StepperBase-613"><a href="#StepperBase-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_menu_on_reply</span><span class="p">)</span>
</span><span id="StepperBase-614"><a href="#StepperBase-614"><span class="linenos">614</span></a>
</span><span id="StepperBase-615"><a href="#StepperBase-615"><span class="linenos">615</span></a>
</span><span id="StepperBase-616"><a href="#StepperBase-616"><span class="linenos">616</span></a>    <span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-617"><a href="#StepperBase-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span><span id="StepperBase-618"><a href="#StepperBase-618"><span class="linenos">618</span></a>
</span><span id="StepperBase-619"><a href="#StepperBase-619"><span class="linenos">619</span></a>    <span class="k">def</span> <span class="nf">menu_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="StepperBase-620"><a href="#StepperBase-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase-621"><a href="#StepperBase-621"><span class="linenos">621</span></a>            <span class="k">return</span>
</span><span id="StepperBase-622"><a href="#StepperBase-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="StepperBase-623"><a href="#StepperBase-623"><span class="linenos">623</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase-624"><a href="#StepperBase-624"><span class="linenos">624</span></a>        <span class="n">reply</span><span class="o">=</span><span class="p">[]</span>
</span><span id="StepperBase-625"><a href="#StepperBase-625"><span class="linenos">625</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
</span><span id="StepperBase-626"><a href="#StepperBase-626"><span class="linenos">626</span></a>            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="StepperBase-627"><a href="#StepperBase-627"><span class="linenos">627</span></a>            <span class="k">if</span> <span class="n">do_print</span><span class="p">:</span>
</span><span id="StepperBase-628"><a href="#StepperBase-628"><span class="linenos">628</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span><span class="p">:</span>
</span><span id="StepperBase-629"><a href="#StepperBase-629"><span class="linenos">629</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase-630"><a href="#StepperBase-630"><span class="linenos">630</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-631"><a href="#StepperBase-631"><span class="linenos">631</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase-632"><a href="#StepperBase-632"><span class="linenos">632</span></a>            <span class="n">reply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="StepperBase-633"><a href="#StepperBase-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="n">reply</span>
</span><span id="StepperBase-634"><a href="#StepperBase-634"><span class="linenos">634</span></a>
</span><span id="StepperBase-635"><a href="#StepperBase-635"><span class="linenos">635</span></a>    <span class="c1"># ################Waypoint Trajectory Interface #####################</span>
</span><span id="StepperBase-636"><a href="#StepperBase-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="StepperBase-637"><a href="#StepperBase-637"><span class="linenos">637</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-638"><a href="#StepperBase-638"><span class="linenos">638</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-639"><a href="#StepperBase-639"><span class="linenos">639</span></a>
</span><span id="StepperBase-640"><a href="#StepperBase-640"><span class="linenos">640</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="StepperBase-641"><a href="#StepperBase-641"><span class="linenos">641</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-642"><a href="#StepperBase-642"><span class="linenos">642</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-643"><a href="#StepperBase-643"><span class="linenos">643</span></a>
</span><span id="StepperBase-644"><a href="#StepperBase-644"><span class="linenos">644</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-645"><a href="#StepperBase-645"><span class="linenos">645</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-646"><a href="#StepperBase-646"><span class="linenos">646</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-647"><a href="#StepperBase-647"><span class="linenos">647</span></a>
</span><span id="StepperBase-648"><a href="#StepperBase-648"><span class="linenos">648</span></a>    <span class="c1"># ################Transport Callbacks #####################</span>
</span><span id="StepperBase-649"><a href="#StepperBase-649"><span class="linenos">649</span></a>    <span class="k">def</span> <span class="nf">unpack_board_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase-650"><a href="#StepperBase-650"><span class="linenos">650</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-651"><a href="#StepperBase-651"><span class="linenos">651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase-652"><a href="#StepperBase-652"><span class="linenos">652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase-653"><a href="#StepperBase-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span> <span class="c1">#New format of Stepper.x  Older format of Stepper.BoardName.Vx&#39; If older format,default to 0</span>
</span><span id="StepperBase-654"><a href="#StepperBase-654"><span class="linenos">654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase-655"><a href="#StepperBase-655"><span class="linenos">655</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase-656"><a href="#StepperBase-656"><span class="linenos">656</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase-657"><a href="#StepperBase-657"><span class="linenos">657</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):]</span>
</span><span id="StepperBase-658"><a href="#StepperBase-658"><span class="linenos">658</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase-659"><a href="#StepperBase-659"><span class="linenos">659</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-660"><a href="#StepperBase-660"><span class="linenos">660</span></a>
</span><span id="StepperBase-661"><a href="#StepperBase-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase-662"><a href="#StepperBase-662"><span class="linenos">662</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-663"><a href="#StepperBase-663"><span class="linenos">663</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-664"><a href="#StepperBase-664"><span class="linenos">664</span></a>
</span><span id="StepperBase-665"><a href="#StepperBase-665"><span class="linenos">665</span></a>    <span class="k">def</span> <span class="nf">unpack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase-666"><a href="#StepperBase-666"><span class="linenos">666</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-667"><a href="#StepperBase-667"><span class="linenos">667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="StepperBase-668"><a href="#StepperBase-668"><span class="linenos">668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-669"><a href="#StepperBase-669"><span class="linenos">669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-670"><a href="#StepperBase-670"><span class="linenos">670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-671"><a href="#StepperBase-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-672"><a href="#StepperBase-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-673"><a href="#StepperBase-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-674"><a href="#StepperBase-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-675"><a href="#StepperBase-675"><span class="linenos">675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-676"><a href="#StepperBase-676"><span class="linenos">676</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-677"><a href="#StepperBase-677"><span class="linenos">677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-678"><a href="#StepperBase-678"><span class="linenos">678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-679"><a href="#StepperBase-679"><span class="linenos">679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-680"><a href="#StepperBase-680"><span class="linenos">680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-681"><a href="#StepperBase-681"><span class="linenos">681</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-682"><a href="#StepperBase-682"><span class="linenos">682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-683"><a href="#StepperBase-683"><span class="linenos">683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-684"><a href="#StepperBase-684"><span class="linenos">684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-685"><a href="#StepperBase-685"><span class="linenos">685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-686"><a href="#StepperBase-686"><span class="linenos">686</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-687"><a href="#StepperBase-687"><span class="linenos">687</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-688"><a href="#StepperBase-688"><span class="linenos">688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-689"><a href="#StepperBase-689"><span class="linenos">689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-690"><a href="#StepperBase-690"><span class="linenos">690</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-691"><a href="#StepperBase-691"><span class="linenos">691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-692"><a href="#StepperBase-692"><span class="linenos">692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-693"><a href="#StepperBase-693"><span class="linenos">693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-694"><a href="#StepperBase-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase-695"><a href="#StepperBase-695"><span class="linenos">695</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-696"><a href="#StepperBase-696"><span class="linenos">696</span></a>
</span><span id="StepperBase-697"><a href="#StepperBase-697"><span class="linenos">697</span></a>    <span class="k">def</span> <span class="nf">pack_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-698"><a href="#StepperBase-698"><span class="linenos">698</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-699"><a href="#StepperBase-699"><span class="linenos">699</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-700"><a href="#StepperBase-700"><span class="linenos">700</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase-701"><a href="#StepperBase-701"><span class="linenos">701</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-702"><a href="#StepperBase-702"><span class="linenos">702</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-703"><a href="#StepperBase-703"><span class="linenos">703</span></a>
</span><span id="StepperBase-704"><a href="#StepperBase-704"><span class="linenos">704</span></a>    <span class="k">def</span> <span class="nf">pack_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-705"><a href="#StepperBase-705"><span class="linenos">705</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span>
</span><span id="StepperBase-706"><a href="#StepperBase-706"><span class="linenos">706</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-707"><a href="#StepperBase-707"><span class="linenos">707</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase-708"><a href="#StepperBase-708"><span class="linenos">708</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-709"><a href="#StepperBase-709"><span class="linenos">709</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase-710"><a href="#StepperBase-710"><span class="linenos">710</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-711"><a href="#StepperBase-711"><span class="linenos">711</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase-712"><a href="#StepperBase-712"><span class="linenos">712</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-713"><a href="#StepperBase-713"><span class="linenos">713</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="StepperBase-714"><a href="#StepperBase-714"><span class="linenos">714</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-715"><a href="#StepperBase-715"><span class="linenos">715</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="StepperBase-716"><a href="#StepperBase-716"><span class="linenos">716</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-717"><a href="#StepperBase-717"><span class="linenos">717</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase-718"><a href="#StepperBase-718"><span class="linenos">718</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-719"><a href="#StepperBase-719"><span class="linenos">719</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">])</span>
</span><span id="StepperBase-720"><a href="#StepperBase-720"><span class="linenos">720</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-721"><a href="#StepperBase-721"><span class="linenos">721</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">])</span>
</span><span id="StepperBase-722"><a href="#StepperBase-722"><span class="linenos">722</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-723"><a href="#StepperBase-723"><span class="linenos">723</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-724"><a href="#StepperBase-724"><span class="linenos">724</span></a>
</span><span id="StepperBase-725"><a href="#StepperBase-725"><span class="linenos">725</span></a>    <span class="k">def</span> <span class="nf">pack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-726"><a href="#StepperBase-726"><span class="linenos">726</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-727"><a href="#StepperBase-727"><span class="linenos">727</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-728"><a href="#StepperBase-728"><span class="linenos">728</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-729"><a href="#StepperBase-729"><span class="linenos">729</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-730"><a href="#StepperBase-730"><span class="linenos">730</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-731"><a href="#StepperBase-731"><span class="linenos">731</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-732"><a href="#StepperBase-732"><span class="linenos">732</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-733"><a href="#StepperBase-733"><span class="linenos">733</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-734"><a href="#StepperBase-734"><span class="linenos">734</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-735"><a href="#StepperBase-735"><span class="linenos">735</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-736"><a href="#StepperBase-736"><span class="linenos">736</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-737"><a href="#StepperBase-737"><span class="linenos">737</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-738"><a href="#StepperBase-738"><span class="linenos">738</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-739"><a href="#StepperBase-739"><span class="linenos">739</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-740"><a href="#StepperBase-740"><span class="linenos">740</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-741"><a href="#StepperBase-741"><span class="linenos">741</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-742"><a href="#StepperBase-742"><span class="linenos">742</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-743"><a href="#StepperBase-743"><span class="linenos">743</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-744"><a href="#StepperBase-744"><span class="linenos">744</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-745"><a href="#StepperBase-745"><span class="linenos">745</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-746"><a href="#StepperBase-746"><span class="linenos">746</span></a>        <span class="n">config</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase-747"><a href="#StepperBase-747"><span class="linenos">747</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-748"><a href="#StepperBase-748"><span class="linenos">748</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span>
</span><span id="StepperBase-749"><a href="#StepperBase-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-750"><a href="#StepperBase-750"><span class="linenos">750</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span>
</span><span id="StepperBase-751"><a href="#StepperBase-751"><span class="linenos">751</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-752"><a href="#StepperBase-752"><span class="linenos">752</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span>
</span><span id="StepperBase-753"><a href="#StepperBase-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-754"><a href="#StepperBase-754"><span class="linenos">754</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span>
</span><span id="StepperBase-755"><a href="#StepperBase-755"><span class="linenos">755</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-756"><a href="#StepperBase-756"><span class="linenos">756</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span>
</span><span id="StepperBase-757"><a href="#StepperBase-757"><span class="linenos">757</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-758"><a href="#StepperBase-758"><span class="linenos">758</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span>
</span><span id="StepperBase-759"><a href="#StepperBase-759"><span class="linenos">759</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]:</span>
</span><span id="StepperBase-760"><a href="#StepperBase-760"><span class="linenos">760</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span>
</span><span id="StepperBase-761"><a href="#StepperBase-761"><span class="linenos">761</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase-762"><a href="#StepperBase-762"><span class="linenos">762</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-763"><a href="#StepperBase-763"><span class="linenos">763</span></a>
</span><span id="StepperBase-764"><a href="#StepperBase-764"><span class="linenos">764</span></a>    <span class="k">def</span> <span class="nf">pack_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-765"><a href="#StepperBase-765"><span class="linenos">765</span></a>        <span class="n">pack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">)</span>
</span><span id="StepperBase-766"><a href="#StepperBase-766"><span class="linenos">766</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-767"><a href="#StepperBase-767"><span class="linenos">767</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="p">)</span>
</span><span id="StepperBase-768"><a href="#StepperBase-768"><span class="linenos">768</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase-769"><a href="#StepperBase-769"><span class="linenos">769</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="StepperBase-770"><a href="#StepperBase-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase-771"><a href="#StepperBase-771"><span class="linenos">771</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-772"><a href="#StepperBase-772"><span class="linenos">772</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-773"><a href="#StepperBase-773"><span class="linenos">773</span></a>
</span><span id="StepperBase-774"><a href="#StepperBase-774"><span class="linenos">774</span></a>    <span class="k">def</span> <span class="nf">rpc_board_info_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-775"><a href="#StepperBase-775"><span class="linenos">775</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span><span class="p">:</span>
</span><span id="StepperBase-776"><a href="#StepperBase-776"><span class="linenos">776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unpack_board_info</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase-777"><a href="#StepperBase-777"><span class="linenos">777</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-778"><a href="#StepperBase-778"><span class="linenos">778</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STEPPER_BOARD_INFO&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-779"><a href="#StepperBase-779"><span class="linenos">779</span></a>
</span><span id="StepperBase-780"><a href="#StepperBase-780"><span class="linenos">780</span></a>    <span class="k">def</span> <span class="nf">rpc_gains_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-781"><a href="#StepperBase-781"><span class="linenos">781</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_GAINS</span><span class="p">:</span>
</span><span id="StepperBase-782"><a href="#StepperBase-782"><span class="linenos">782</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_GAINS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-783"><a href="#StepperBase-783"><span class="linenos">783</span></a>
</span><span id="StepperBase-784"><a href="#StepperBase-784"><span class="linenos">784</span></a>    <span class="k">def</span> <span class="nf">rpc_trigger_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-785"><a href="#StepperBase-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_TRIGGER</span><span class="p">:</span>
</span><span id="StepperBase-786"><a href="#StepperBase-786"><span class="linenos">786</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_SET_TRIGGER&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-787"><a href="#StepperBase-787"><span class="linenos">787</span></a>
</span><span id="StepperBase-788"><a href="#StepperBase-788"><span class="linenos">788</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-789"><a href="#StepperBase-789"><span class="linenos">789</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="StepperBase-790"><a href="#StepperBase-790"><span class="linenos">790</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-791"><a href="#StepperBase-791"><span class="linenos">791</span></a>
</span><span id="StepperBase-792"><a href="#StepperBase-792"><span class="linenos">792</span></a>    <span class="k">def</span> <span class="nf">rpc_motion_limits_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-793"><a href="#StepperBase-793"><span class="linenos">793</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MOTION_LIMITS</span><span class="p">:</span>
</span><span id="StepperBase-794"><a href="#StepperBase-794"><span class="linenos">794</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MOTION_LIMITS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-795"><a href="#StepperBase-795"><span class="linenos">795</span></a>
</span><span id="StepperBase-796"><a href="#StepperBase-796"><span class="linenos">796</span></a>    <span class="k">def</span> <span class="nf">rpc_menu_on_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-797"><a href="#StepperBase-797"><span class="linenos">797</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MENU_ON</span><span class="p">:</span>
</span><span id="StepperBase-798"><a href="#StepperBase-798"><span class="linenos">798</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MENU_ON&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-799"><a href="#StepperBase-799"><span class="linenos">799</span></a>
</span><span id="StepperBase-800"><a href="#StepperBase-800"><span class="linenos">800</span></a>    <span class="k">def</span> <span class="nf">rpc_status_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-801"><a href="#StepperBase-801"><span class="linenos">801</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS</span><span class="p">:</span>
</span><span id="StepperBase-802"><a href="#StepperBase-802"><span class="linenos">802</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase-803"><a href="#StepperBase-803"><span class="linenos">803</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-804"><a href="#StepperBase-804"><span class="linenos">804</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-805"><a href="#StepperBase-805"><span class="linenos">805</span></a>
</span><span id="StepperBase-806"><a href="#StepperBase-806"><span class="linenos">806</span></a>    <span class="k">def</span> <span class="nf">rpc_read_gains_from_flash_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-807"><a href="#StepperBase-807"><span class="linenos">807</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span><span class="p">:</span>
</span><span id="StepperBase-808"><a href="#StepperBase-808"><span class="linenos">808</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_gains</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase-809"><a href="#StepperBase-809"><span class="linenos">809</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase-810"><a href="#StepperBase-810"><span class="linenos">810</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_GAINS_FROM_FLASH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase-811"><a href="#StepperBase-811"><span class="linenos">811</span></a>
</span><span id="StepperBase-812"><a href="#StepperBase-812"><span class="linenos">812</span></a>
</span><span id="StepperBase-813"><a href="#StepperBase-813"><span class="linenos">813</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-814"><a href="#StepperBase-814"><span class="linenos">814</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-815"><a href="#StepperBase-815"><span class="linenos">815</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-816"><a href="#StepperBase-816"><span class="linenos">816</span></a>
</span><span id="StepperBase-817"><a href="#StepperBase-817"><span class="linenos">817</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-818"><a href="#StepperBase-818"><span class="linenos">818</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-819"><a href="#StepperBase-819"><span class="linenos">819</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-820"><a href="#StepperBase-820"><span class="linenos">820</span></a>
</span><span id="StepperBase-821"><a href="#StepperBase-821"><span class="linenos">821</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-822"><a href="#StepperBase-822"><span class="linenos">822</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-823"><a href="#StepperBase-823"><span class="linenos">823</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-824"><a href="#StepperBase-824"><span class="linenos">824</span></a>
</span><span id="StepperBase-825"><a href="#StepperBase-825"><span class="linenos">825</span></a>
</span><span id="StepperBase-826"><a href="#StepperBase-826"><span class="linenos">826</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase-827"><a href="#StepperBase-827"><span class="linenos">827</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-828"><a href="#StepperBase-828"><span class="linenos">828</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-829"><a href="#StepperBase-829"><span class="linenos">829</span></a>
</span><span id="StepperBase-830"><a href="#StepperBase-830"><span class="linenos">830</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-831"><a href="#StepperBase-831"><span class="linenos">831</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-832"><a href="#StepperBase-832"><span class="linenos">832</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-833"><a href="#StepperBase-833"><span class="linenos">833</span></a>
</span><span id="StepperBase-834"><a href="#StepperBase-834"><span class="linenos">834</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-835"><a href="#StepperBase-835"><span class="linenos">835</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-836"><a href="#StepperBase-836"><span class="linenos">836</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span><span id="StepperBase-837"><a href="#StepperBase-837"><span class="linenos">837</span></a>
</span><span id="StepperBase-838"><a href="#StepperBase-838"><span class="linenos">838</span></a>
</span><span id="StepperBase-839"><a href="#StepperBase-839"><span class="linenos">839</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase-840"><a href="#StepperBase-840"><span class="linenos">840</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase-841"><a href="#StepperBase-841"><span class="linenos">841</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="StepperBase.__init__" class="classattr">
                                        <input id="StepperBase.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">StepperBase</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">usb</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="StepperBase.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.__init__-117"><a href="#StepperBase.__init__-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase.__init__-118"><a href="#StepperBase.__init__-118"><span class="linenos">118</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.__init__-119"><a href="#StepperBase.__init__-119"><span class="linenos">119</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="c1">#Pull from usb device name</span>
</span><span id="StepperBase.__init__-120"><a href="#StepperBase.__init__-120"><span class="linenos">120</span></a>        <span class="n">Device</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="StepperBase.__init__-121"><a href="#StepperBase.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="o">=</span><span class="n">usb</span>
</span><span id="StepperBase.__init__-122"><a href="#StepperBase.__init__-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">Transport</span><span class="p">(</span><span class="n">usb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</span><span id="StepperBase.__init__-123"><a href="#StepperBase.__init__-123"><span class="linenos">123</span></a>
</span><span id="StepperBase.__init__-124"><a href="#StepperBase.__init__-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;x_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;a_des&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;stiffness&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase.__init__-125"><a href="#StepperBase.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_ticks&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;effort_pct&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;current&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;vel&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-126"><a href="#StepperBase.__init__-126"><span class="linenos">126</span></a>                       <span class="s1">&#39;transport&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">status</span><span class="p">,</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-127"><a href="#StepperBase.__init__-127"><span class="linenos">127</span></a>                       <span class="s1">&#39;is_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-128"><a href="#StepperBase.__init__-128"><span class="linenos">128</span></a>                       <span class="s1">&#39;in_safety_event&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;trace_on&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
</span><span id="StepperBase.__init__-129"><a href="#StepperBase.__init__-129"><span class="linenos">129</span></a>                       <span class="s1">&#39;waypoint_traj&#39;</span><span class="p">:{</span><span class="s1">&#39;state&#39;</span><span class="p">:</span><span class="s1">&#39;idle&#39;</span><span class="p">,</span><span class="s1">&#39;setpoint&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;segment_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,}}</span>
</span><span id="StepperBase.__init__-130"><a href="#StepperBase.__init__-130"><span class="linenos">130</span></a>
</span><span id="StepperBase.__init__-131"><a href="#StepperBase.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase.__init__-132"><a href="#StepperBase.__init__-132"><span class="linenos">132</span></a>
</span><span id="StepperBase.__init__-133"><a href="#StepperBase.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase.__init__-134"><a href="#StepperBase.__init__-134"><span class="linenos">134</span></a>
</span><span id="StepperBase.__init__-135"><a href="#StepperBase.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;board_variant&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;firmware_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</span><span id="StepperBase.__init__-136"><a href="#StepperBase.__init__-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="StepperBase.__init__-137"><a href="#StepperBase.__init__-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="StepperBase.__init__-138"><a href="#StepperBase.__init__-138"><span class="linenos">138</span></a>
</span><span id="StepperBase.__init__-139"><a href="#StepperBase.__init__-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
</span><span id="StepperBase.__init__-140"><a href="#StepperBase.__init__-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-141"><a href="#StepperBase.__init__-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-142"><a href="#StepperBase.__init__-142"><span class="linenos">142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase.__init__-143"><a href="#StepperBase.__init__-143"><span class="linenos">143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StepperBase.__init__-144"><a href="#StepperBase.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StepperBase.__init__-145"><a href="#StepperBase.__init__-145"><span class="linenos">145</span></a>
</span><span id="StepperBase.__init__-146"><a href="#StepperBase.__init__-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.__init__-147"><a href="#StepperBase.__init__-147"><span class="linenos">147</span></a>
</span><span id="StepperBase.__init__-148"><a href="#StepperBase.__init__-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-149"><a href="#StepperBase.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-150"><a href="#StepperBase.__init__-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.__init__-151"><a href="#StepperBase.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase.__init__-152"><a href="#StepperBase.__init__-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.__init__-153"><a href="#StepperBase.__init__-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.__init__-154"><a href="#StepperBase.__init__-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
</span><span id="StepperBase.__init__-155"><a href="#StepperBase.__init__-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase.__init__-156"><a href="#StepperBase.__init__-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase.__init__-157"><a href="#StepperBase.__init__-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.RPC_SET_COMMAND" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_COMMAND</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_COMMAND"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_COMMAND" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_COMMAND</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_COMMAND"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_GET_STATUS" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_GET_STATUS</span>        =
<span class="default_value">3</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_GET_STATUS"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_STATUS" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_STATUS</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_STATUS"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_SET_GAINS" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_GAINS</span>        =
<span class="default_value">5</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_GAINS"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_GAINS" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_GAINS</span>        =
<span class="default_value">6</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_GAINS"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_LOAD_TEST_PUSH" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_LOAD_TEST_PUSH</span>        =
<span class="default_value">7</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_LOAD_TEST_PUSH"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_LOAD_TEST_PUSH" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_LOAD_TEST_PUSH</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_SET_TRIGGER" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_TRIGGER</span>        =
<span class="default_value">9</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_TRIGGER"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_SET_TRIGGER" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_SET_TRIGGER</span>        =
<span class="default_value">10</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_SET_TRIGGER"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_SET_ENC_CALIB" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_ENC_CALIB</span>        =
<span class="default_value">11</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_ENC_CALIB"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_ENC_CALIB" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_ENC_CALIB</span>        =
<span class="default_value">12</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_ENC_CALIB"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_READ_GAINS_FROM_FLASH" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_READ_GAINS_FROM_FLASH</span>        =
<span class="default_value">13</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_READ_GAINS_FROM_FLASH"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_READ_GAINS_FROM_FLASH</span>        =
<span class="default_value">14</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_SET_MENU_ON" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_MENU_ON</span>        =
<span class="default_value">15</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_MENU_ON"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_MENU_ON" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_MENU_ON</span>        =
<span class="default_value">16</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_MENU_ON"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_GET_STEPPER_BOARD_INFO" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_GET_STEPPER_BOARD_INFO</span>        =
<span class="default_value">17</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_STEPPER_BOARD_INFO" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_STEPPER_BOARD_INFO</span>        =
<span class="default_value">18</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_SET_MOTION_LIMITS" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_MOTION_LIMITS</span>        =
<span class="default_value">19</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_MOTION_LIMITS"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_MOTION_LIMITS" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_MOTION_LIMITS</span>        =
<span class="default_value">20</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_MOTION_LIMITS"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_SET_NEXT_TRAJECTORY_SEG</span>        =
<span class="default_value">21</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span>        =
<span class="default_value">22</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_START_NEW_TRAJECTORY" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_START_NEW_TRAJECTORY</span>        =
<span class="default_value">23</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_START_NEW_TRAJECTORY"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_START_NEW_TRAJECTORY" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_START_NEW_TRAJECTORY</span>        =
<span class="default_value">24</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_RESET_TRAJECTORY" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_RESET_TRAJECTORY</span>        =
<span class="default_value">25</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_RESET_TRAJECTORY"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_RESET_TRAJECTORY" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_RESET_TRAJECTORY</span>        =
<span class="default_value">26</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_READ_TRACE" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_READ_TRACE</span>        =
<span class="default_value">27</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_READ_TRACE"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_READ_TRACE" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_READ_TRACE</span>        =
<span class="default_value">28</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_READ_TRACE"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_GET_STATUS_AUX" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_GET_STATUS_AUX</span>        =
<span class="default_value">29</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_GET_STATUS_AUX"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_STATUS_AUX" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_STATUS_AUX</span>        =
<span class="default_value">30</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_STATUS_AUX"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_LOAD_TEST_PULL" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_LOAD_TEST_PULL</span>        =
<span class="default_value">31</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_LOAD_TEST_PULL"></a>
    
    

                            </div>
                            <div id="StepperBase.RPC_REPLY_LOAD_TEST_PULL" class="classattr">
                                <div class="attr variable">
            <span class="name">RPC_REPLY_LOAD_TEST_PULL</span>        =
<span class="default_value">32</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_SAFETY" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_SAFETY</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_SAFETY"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_FREEWHEEL" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_FREEWHEEL</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_FREEWHEEL"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_HOLD" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_HOLD</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_HOLD"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_POS_PID" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_POS_PID</span>        =
<span class="default_value">3</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_POS_PID"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_VEL_PID" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_VEL_PID</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_VEL_PID"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_POS_TRAJ" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_POS_TRAJ</span>        =
<span class="default_value">5</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_POS_TRAJ"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_VEL_TRAJ" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_VEL_TRAJ</span>        =
<span class="default_value">6</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_VEL_TRAJ"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_CURRENT" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_CURRENT</span>        =
<span class="default_value">7</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_CURRENT"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_POS_TRAJ_INCR" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_POS_TRAJ_INCR</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_POS_TRAJ_INCR"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_POS_TRAJ_WAYPOINT" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_POS_TRAJ_WAYPOINT</span>        =
<span class="default_value">9</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_POS_TRAJ_WAYPOINT"></a>
    
    

                            </div>
                            <div id="StepperBase.MODE_NAMES" class="classattr">
                                <div class="attr variable">
            <span class="name">MODE_NAMES</span>        =
<input id="StepperBase.MODE_NAMES-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="StepperBase.MODE_NAMES-view-value"></label><span class="default_value">{0: &#39;MODE_SAFETY&#39;, 1: &#39;MODE_FREEWHEEL&#39;, 2: &#39;MODE_HOLD&#39;, 3: &#39;MODE_POS_PID&#39;, 4: &#39;MODE_VEL_PID&#39;, 5: &#39;MODE_POS_TRAJ&#39;, 6: &#39;MODE_VEL_TRAJ&#39;, 7: &#39;MODE_CURRENT&#39;, 8: &#39;MODE_POS_TRAJ_INCR&#39;, 9: &#39;MODE_POS_TRAJ_WAYPOINT&#39;}</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.MODE_NAMES"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_POS_CALIBRATED" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_POS_CALIBRATED</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_POS_CALIBRATED"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_RUNSTOP_ON" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_RUNSTOP_ON</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_RUNSTOP_ON"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_NEAR_POS_SETPOINT" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_NEAR_POS_SETPOINT</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_NEAR_POS_SETPOINT"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_NEAR_VEL_SETPOINT" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_NEAR_VEL_SETPOINT</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_NEAR_VEL_SETPOINT"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IS_MOVING" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IS_MOVING</span>        =
<span class="default_value">16</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IS_MOVING"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_AT_CURRENT_LIMIT" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_AT_CURRENT_LIMIT</span>        =
<span class="default_value">32</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_AT_CURRENT_LIMIT"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IS_MG_ACCELERATING" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IS_MG_ACCELERATING</span>        =
<span class="default_value">64</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IS_MG_ACCELERATING"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IS_MG_MOVING" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IS_MG_MOVING</span>        =
<span class="default_value">128</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IS_MG_MOVING"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_CALIBRATION_RCVD" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_CALIBRATION_RCVD</span>        =
<span class="default_value">256</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_CALIBRATION_RCVD"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IN_GUARDED_EVENT" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IN_GUARDED_EVENT</span>        =
<span class="default_value">512</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IN_GUARDED_EVENT"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IN_SAFETY_EVENT" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IN_SAFETY_EVENT</span>        =
<span class="default_value">1024</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IN_SAFETY_EVENT"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_WAITING_ON_SYNC" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_WAITING_ON_SYNC</span>        =
<span class="default_value">2048</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_WAITING_ON_SYNC"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_TRAJ_ACTIVE" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_TRAJ_ACTIVE</span>        =
<span class="default_value">4096</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_TRAJ_ACTIVE"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_TRAJ_WAITING_ON_SYNC" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_TRAJ_WAITING_ON_SYNC</span>        =
<span class="default_value">8192</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IN_SYNC_MODE" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IN_SYNC_MODE</span>        =
<span class="default_value">16384</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IN_SYNC_MODE"></a>
    
    

                            </div>
                            <div id="StepperBase.DIAG_IS_TRACE_ON" class="classattr">
                                <div class="attr variable">
            <span class="name">DIAG_IS_TRACE_ON</span>        =
<span class="default_value">32768</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.DIAG_IS_TRACE_ON"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_SAFETY_HOLD" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_SAFETY_HOLD</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_SAFETY_HOLD"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_ENABLE_RUNSTOP" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_ENABLE_RUNSTOP</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_ENABLE_RUNSTOP"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_ENABLE_SYNC_MODE" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_ENABLE_SYNC_MODE</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_ENABLE_SYNC_MODE"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_ENABLE_GUARDED_MODE" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_ENABLE_GUARDED_MODE</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_FLIP_ENCODER_POLARITY" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_FLIP_ENCODER_POLARITY</span>        =
<span class="default_value">16</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_FLIP_EFFORT_POLARITY" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_FLIP_EFFORT_POLARITY</span>        =
<span class="default_value">32</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY"></a>
    
    

                            </div>
                            <div id="StepperBase.CONFIG_ENABLE_VEL_WATCHDOG" class="classattr">
                                <div class="attr variable">
            <span class="name">CONFIG_ENABLE_VEL_WATCHDOG</span>        =
<span class="default_value">64</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_MARK_POS" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_MARK_POS</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_MARK_POS"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_RESET_MOTION_GEN" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_RESET_MOTION_GEN</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_RESET_MOTION_GEN"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_BOARD_RESET" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_BOARD_RESET</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_BOARD_RESET"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_WRITE_GAINS_TO_FLASH</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_RESET_POS_CALIBRATED" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_RESET_POS_CALIBRATED</span>        =
<span class="default_value">16</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_POS_CALIBRATED" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_POS_CALIBRATED</span>        =
<span class="default_value">32</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_POS_CALIBRATED"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_MARK_POS_ON_CONTACT" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_MARK_POS_ON_CONTACT</span>        =
<span class="default_value">64</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_ENABLE_TRACE" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_ENABLE_TRACE</span>        =
<span class="default_value">128</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_ENABLE_TRACE"></a>
    
    

                            </div>
                            <div id="StepperBase.TRIGGER_DISABLE_TRACE" class="classattr">
                                <div class="attr variable">
            <span class="name">TRIGGER_DISABLE_TRACE</span>        =
<span class="default_value">256</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRIGGER_DISABLE_TRACE"></a>
    
    

                            </div>
                            <div id="StepperBase.TRACE_TYPE_STATUS" class="classattr">
                                <div class="attr variable">
            <span class="name">TRACE_TYPE_STATUS</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRACE_TYPE_STATUS"></a>
    
    

                            </div>
                            <div id="StepperBase.TRACE_TYPE_DEBUG" class="classattr">
                                <div class="attr variable">
            <span class="name">TRACE_TYPE_DEBUG</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRACE_TYPE_DEBUG"></a>
    
    

                            </div>
                            <div id="StepperBase.TRACE_TYPE_PRINT" class="classattr">
                                <div class="attr variable">
            <span class="name">TRACE_TYPE_PRINT</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.TRACE_TYPE_PRINT"></a>
    
    

                            </div>
                            <div id="StepperBase.usb" class="classattr">
                                <div class="attr variable">
            <span class="name">usb</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.usb"></a>
    
    

                            </div>
                            <div id="StepperBase.transport" class="classattr">
                                <div class="attr variable">
            <span class="name">transport</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.transport"></a>
    
    

                            </div>
                            <div id="StepperBase.status" class="classattr">
                                <div class="attr variable">
            <span class="name">status</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.status"></a>
    
    

                            </div>
                            <div id="StepperBase.status_aux" class="classattr">
                                <div class="attr variable">
            <span class="name">status_aux</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.status_aux"></a>
    
    

                            </div>
                            <div id="StepperBase.status_zero" class="classattr">
                                <div class="attr variable">
            <span class="name">status_zero</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.status_zero"></a>
    
    

                            </div>
                            <div id="StepperBase.board_info" class="classattr">
                                <div class="attr variable">
            <span class="name">board_info</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.board_info"></a>
    
    

                            </div>
                            <div id="StepperBase.motion_limits" class="classattr">
                                <div class="attr variable">
            <span class="name">motion_limits</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.motion_limits"></a>
    
    

                            </div>
                            <div id="StepperBase.is_moving_history" class="classattr">
                                <div class="attr variable">
            <span class="name">is_moving_history</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.is_moving_history"></a>
    
    

                            </div>
                            <div id="StepperBase.ts_last_syncd_motion" class="classattr">
                                <div class="attr variable">
            <span class="name">ts_last_syncd_motion</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.ts_last_syncd_motion"></a>
    
    

                            </div>
                            <div id="StepperBase.load_test_payload" class="classattr">
                                <div class="attr variable">
            <span class="name">load_test_payload</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.load_test_payload"></a>
    
    

                            </div>
                            <div id="StepperBase.hw_valid" class="classattr">
                                <div class="attr variable">
            <span class="name">hw_valid</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.hw_valid"></a>
    
    

                            </div>
                            <div id="StepperBase.gains" class="classattr">
                                <div class="attr variable">
            <span class="name">gains</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.gains"></a>
    
    

                            </div>
                            <div id="StepperBase.gains_flash" class="classattr">
                                <div class="attr variable">
            <span class="name">gains_flash</span>

        
    </div>
    <a class="headerlink" href="#StepperBase.gains_flash"></a>
    
    

                            </div>
                            <div id="StepperBase.startup" class="classattr">
                                        <input id="StepperBase.startup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">startup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.startup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.startup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.startup-161"><a href="#StepperBase.startup-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.startup-162"><a href="#StepperBase.startup-162"><span class="linenos">162</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="StepperBase.startup-163"><a href="#StepperBase.startup-163"><span class="linenos">163</span></a>            <span class="n">Device</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="StepperBase.startup-164"><a href="#StepperBase.startup-164"><span class="linenos">164</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">startup</span><span class="p">()</span>
</span><span id="StepperBase.startup-165"><a href="#StepperBase.startup-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.startup-166"><a href="#StepperBase.startup-166"><span class="linenos">166</span></a>                <span class="c1"># Pull board info</span>
</span><span id="StepperBase.startup-167"><a href="#StepperBase.startup-167"><span class="linenos">167</span></a>                <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STEPPER_BOARD_INFO</span><span class="p">])</span>
</span><span id="StepperBase.startup-168"><a href="#StepperBase.startup-168"><span class="linenos">168</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_board_info_reply</span><span class="p">)</span>
</span><span id="StepperBase.startup-169"><a href="#StepperBase.startup-169"><span class="linenos">169</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">configure_version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="StepperBase.startup-170"><a href="#StepperBase.startup-170"><span class="linenos">170</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="StepperBase.startup-171"><a href="#StepperBase.startup-171"><span class="linenos">171</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="StepperBase.startup-172"><a href="#StepperBase.startup-172"><span class="linenos">172</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="StepperBase.startup-173"><a href="#StepperBase.startup-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span><span class="kc">False</span>
</span><span id="StepperBase.startup-174"><a href="#StepperBase.startup-174"><span class="linenos">174</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Starts machinery required to interface with this device</p>

<h2 id="parameters">Parameters</h2>

<p>threaded : bool
    whether a thread manages hardware polling/pushing in the background</p>

<h2 id="returns">Returns</h2>

<p>bool
    whether the startup procedure succeeded</p>
</div>


                            </div>
                            <div id="StepperBase.stop" class="classattr">
                                        <input id="StepperBase.stop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.stop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.stop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.stop-177"><a href="#StepperBase.stop-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.stop-178"><a href="#StepperBase.stop-178"><span class="linenos">178</span></a>        <span class="n">Device</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="StepperBase.stop-179"><a href="#StepperBase.stop-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.stop-180"><a href="#StepperBase.stop-180"><span class="linenos">180</span></a>            <span class="k">return</span>
</span><span id="StepperBase.stop-181"><a href="#StepperBase.stop-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Shutting down Stepper on: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase.stop-182"><a href="#StepperBase.stop-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="StepperBase.stop-183"><a href="#StepperBase.stop-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">(</span><span class="n">exiting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="StepperBase.stop-184"><a href="#StepperBase.stop-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="StepperBase.stop-185"><a href="#StepperBase.stop-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Shuts down machinery started in <code><a href="#StepperBase.startup">startup()</a></code></p>
</div>


                            </div>
                            <div id="StepperBase.is_sync_required" class="classattr">
                                        <input id="StepperBase.is_sync_required-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_sync_required</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ts_last_sync</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.is_sync_required-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.is_sync_required"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.is_sync_required-187"><a href="#StepperBase.is_sync_required-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">is_sync_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts_last_sync</span><span class="p">):</span>
</span><span id="StepperBase.is_sync_required-188"><a href="#StepperBase.is_sync_required-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">&gt;</span> <span class="n">ts_last_sync</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.push_command" class="classattr">
                                        <input id="StepperBase.push_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">push_command</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.push_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.push_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.push_command-190"><a href="#StepperBase.push_command-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">push_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.push_command-191"><a href="#StepperBase.push_command-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.push_command-192"><a href="#StepperBase.push_command-192"><span class="linenos">192</span></a>            <span class="k">return</span>
</span><span id="StepperBase.push_command-193"><a href="#StepperBase.push_command-193"><span class="linenos">193</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.push_command-194"><a href="#StepperBase.push_command-194"><span class="linenos">194</span></a>
</span><span id="StepperBase.push_command-195"><a href="#StepperBase.push_command-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase.push_command-196"><a href="#StepperBase.push_command-196"><span class="linenos">196</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase.push_command-197"><a href="#StepperBase.push_command-197"><span class="linenos">197</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command-198"><a href="#StepperBase.push_command-198"><span class="linenos">198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command-199"><a href="#StepperBase.push_command-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.push_command-200"><a href="#StepperBase.push_command-200"><span class="linenos">200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command-201"><a href="#StepperBase.push_command-201"><span class="linenos">201</span></a>
</span><span id="StepperBase.push_command-202"><a href="#StepperBase.push_command-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase.push_command-203"><a href="#StepperBase.push_command-203"><span class="linenos">203</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase.push_command-204"><a href="#StepperBase.push_command-204"><span class="linenos">204</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command-205"><a href="#StepperBase.push_command-205"><span class="linenos">205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command-206"><a href="#StepperBase.push_command-206"><span class="linenos">206</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command-207"><a href="#StepperBase.push_command-207"><span class="linenos">207</span></a>
</span><span id="StepperBase.push_command-208"><a href="#StepperBase.push_command-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase.push_command-209"><a href="#StepperBase.push_command-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span>  <span class="c1"># Mark the time of latest new motion command sent</span>
</span><span id="StepperBase.push_command-210"><a href="#StepperBase.push_command-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.push_command-211"><a href="#StepperBase.push_command-211"><span class="linenos">211</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.push_command-212"><a href="#StepperBase.push_command-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.push_command-213"><a href="#StepperBase.push_command-213"><span class="linenos">213</span></a>
</span><span id="StepperBase.push_command-214"><a href="#StepperBase.push_command-214"><span class="linenos">214</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase.push_command-215"><a href="#StepperBase.push_command-215"><span class="linenos">215</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command-216"><a href="#StepperBase.push_command-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command-217"><a href="#StepperBase.push_command-217"><span class="linenos">217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.push_command_async" class="classattr">
                                        <input id="StepperBase.push_command_async-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">push_command_async</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.push_command_async-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.push_command_async"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.push_command_async-219"><a href="#StepperBase.push_command_async-219"><span class="linenos">219</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">push_command_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.push_command_async-220"><a href="#StepperBase.push_command_async-220"><span class="linenos">220</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-221"><a href="#StepperBase.push_command_async-221"><span class="linenos">221</span></a>            <span class="k">return</span>
</span><span id="StepperBase.push_command_async-222"><a href="#StepperBase.push_command_async-222"><span class="linenos">222</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.push_command_async-223"><a href="#StepperBase.push_command_async-223"><span class="linenos">223</span></a>
</span><span id="StepperBase.push_command_async-224"><a href="#StepperBase.push_command_async-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-225"><a href="#StepperBase.push_command_async-225"><span class="linenos">225</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_TRIGGER</span>
</span><span id="StepperBase.push_command_async-226"><a href="#StepperBase.push_command_async-226"><span class="linenos">226</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trigger</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-227"><a href="#StepperBase.push_command_async-227"><span class="linenos">227</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_trigger_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-228"><a href="#StepperBase.push_command_async-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.push_command_async-229"><a href="#StepperBase.push_command_async-229"><span class="linenos">229</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command_async-230"><a href="#StepperBase.push_command_async-230"><span class="linenos">230</span></a>
</span><span id="StepperBase.push_command_async-231"><a href="#StepperBase.push_command_async-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-232"><a href="#StepperBase.push_command_async-232"><span class="linenos">232</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_GAINS</span>
</span><span id="StepperBase.push_command_async-233"><a href="#StepperBase.push_command_async-233"><span class="linenos">233</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_gains</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-234"><a href="#StepperBase.push_command_async-234"><span class="linenos">234</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_gains_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-235"><a href="#StepperBase.push_command_async-235"><span class="linenos">235</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.push_command_async-236"><a href="#StepperBase.push_command_async-236"><span class="linenos">236</span></a>
</span><span id="StepperBase.push_command_async-237"><a href="#StepperBase.push_command_async-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-238"><a href="#StepperBase.push_command_async-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]:</span> <span class="c1">#Mark the time of latest new motion command sent</span>
</span><span id="StepperBase.push_command_async-239"><a href="#StepperBase.push_command_async-239"><span class="linenos">239</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.push_command_async-240"><a href="#StepperBase.push_command_async-240"><span class="linenos">240</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.push_command_async-241"><a href="#StepperBase.push_command_async-241"><span class="linenos">241</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ts_last_syncd_motion</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.push_command_async-242"><a href="#StepperBase.push_command_async-242"><span class="linenos">242</span></a>
</span><span id="StepperBase.push_command_async-243"><a href="#StepperBase.push_command_async-243"><span class="linenos">243</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_COMMAND</span>
</span><span id="StepperBase.push_command_async-244"><a href="#StepperBase.push_command_async-244"><span class="linenos">244</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_command</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-245"><a href="#StepperBase.push_command_async-245"><span class="linenos">245</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_command_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.push_command_async-246"><a href="#StepperBase.push_command_async-246"><span class="linenos">246</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pull_status" class="classattr">
                                        <input id="StepperBase.pull_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pull_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pull_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pull_status-248"><a href="#StepperBase.pull_status-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">pull_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.pull_status-249"><a href="#StepperBase.pull_status-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.pull_status-250"><a href="#StepperBase.pull_status-250"><span class="linenos">250</span></a>            <span class="k">return</span>
</span><span id="StepperBase.pull_status-251"><a href="#StepperBase.pull_status-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase.pull_status-252"><a href="#StepperBase.pull_status-252"><span class="linenos">252</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase.pull_status-253"><a href="#StepperBase.pull_status-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">)</span>
</span><span id="StepperBase.pull_status-254"><a href="#StepperBase.pull_status-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.pull_status-255"><a href="#StepperBase.pull_status-255"><span class="linenos">255</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase.pull_status-256"><a href="#StepperBase.pull_status-256"><span class="linenos">256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pull_status_async" class="classattr">
                                        <input id="StepperBase.pull_status_async-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">pull_status_async</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exiting</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pull_status_async-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pull_status_async"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pull_status_async-258"><a href="#StepperBase.pull_status_async-258"><span class="linenos">258</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">pull_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="StepperBase.pull_status_async-259"><a href="#StepperBase.pull_status_async-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.pull_status_async-260"><a href="#StepperBase.pull_status_async-260"><span class="linenos">260</span></a>            <span class="k">return</span>
</span><span id="StepperBase.pull_status_async-261"><a href="#StepperBase.pull_status_async-261"><span class="linenos">261</span></a>
</span><span id="StepperBase.pull_status_async-262"><a href="#StepperBase.pull_status_async-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="p">:</span>
</span><span id="StepperBase.pull_status_async-263"><a href="#StepperBase.pull_status_async-263"><span class="linenos">263</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_GAINS_FROM_FLASH</span><span class="p">])</span>
</span><span id="StepperBase.pull_status_async-264"><a href="#StepperBase.pull_status_async-264"><span class="linenos">264</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_gains_from_flash_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span><span id="StepperBase.pull_status_async-265"><a href="#StepperBase.pull_status_async-265"><span class="linenos">265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StepperBase.pull_status_async-266"><a href="#StepperBase.pull_status_async-266"><span class="linenos">266</span></a>
</span><span id="StepperBase.pull_status_async-267"><a href="#StepperBase.pull_status_async-267"><span class="linenos">267</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS</span><span class="p">])</span>
</span><span id="StepperBase.pull_status_async-268"><a href="#StepperBase.pull_status_async-268"><span class="linenos">268</span></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_async</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_reply</span><span class="p">,</span> <span class="n">exiting</span><span class="o">=</span><span class="n">exiting</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.push_load_test" class="classattr">
                                        <input id="StepperBase.push_load_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">push_load_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.push_load_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.push_load_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.push_load_test-270"><a href="#StepperBase.push_load_test-270"><span class="linenos">270</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.push_load_test-271"><a href="#StepperBase.push_load_test-271"><span class="linenos">271</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.push_load_test-272"><a href="#StepperBase.push_load_test-272"><span class="linenos">272</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pull_load_test" class="classattr">
                                        <input id="StepperBase.pull_load_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_load_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pull_load_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pull_load_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pull_load_test-274"><a href="#StepperBase.pull_load_test-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.pull_load_test-275"><a href="#StepperBase.pull_load_test-275"><span class="linenos">275</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.pull_load_test-276"><a href="#StepperBase.pull_load_test-276"><span class="linenos">276</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pretty_print" class="classattr">
                                        <input id="StepperBase.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pretty_print-278"><a href="#StepperBase.pretty_print-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.pretty_print-279"><a href="#StepperBase.pretty_print-279"><span class="linenos">279</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.pretty_print-280"><a href="#StepperBase.pretty_print-280"><span class="linenos">280</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.step_sentry" class="classattr">
                                        <input id="StepperBase.step_sentry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">step_sentry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">robot</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.step_sentry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.step_sentry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.step_sentry-282"><a href="#StepperBase.step_sentry-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">step_sentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">):</span>
</span><span id="StepperBase.step_sentry-283"><a href="#StepperBase.step_sentry-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="s1">&#39;robot_sentry&#39;</span><span class="p">][</span><span class="s1">&#39;stepper_is_moving_filter&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.step_sentry-284"><a href="#StepperBase.step_sentry-284"><span class="linenos">284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.step_sentry-285"><a href="#StepperBase.step_sentry-285"><span class="linenos">285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="StepperBase.step_sentry-286"><a href="#StepperBase.step_sentry-286"><span class="linenos">286</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_moving_history</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.set_motion_limits" class="classattr">
                                        <input id="StepperBase.set_motion_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_motion_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">limit_neg</span>, </span><span class="param"><span class="n">limit_pos</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_motion_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_motion_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_motion_limits-292"><a href="#StepperBase.set_motion_limits-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">set_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">):</span>
</span><span id="StepperBase.set_motion_limits-293"><a href="#StepperBase.set_motion_limits-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="n">limit_neg</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">limit_pos</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="StepperBase.set_motion_limits-294"><a href="#StepperBase.set_motion_limits-294"><span class="linenos">294</span></a>            <span class="c1">#Push out immediately</span>
</span><span id="StepperBase.set_motion_limits-295"><a href="#StepperBase.set_motion_limits-295"><span class="linenos">295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="o">=</span><span class="p">[</span><span class="n">limit_neg</span><span class="p">,</span> <span class="n">limit_pos</span><span class="p">]</span>
</span><span id="StepperBase.set_motion_limits-296"><a href="#StepperBase.set_motion_limits-296"><span class="linenos">296</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.set_motion_limits-297"><a href="#StepperBase.set_motion_limits-297"><span class="linenos">297</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MOTION_LIMITS</span>
</span><span id="StepperBase.set_motion_limits-298"><a href="#StepperBase.set_motion_limits-298"><span class="linenos">298</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_motion_limits</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="StepperBase.set_motion_limits-299"><a href="#StepperBase.set_motion_limits-299"><span class="linenos">299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_motion_limits_reply</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.set_gains" class="classattr">
                                        <input id="StepperBase.set_gains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_gains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">g</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_gains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_gains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_gains-301"><a href="#StepperBase.set_gains-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">set_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
</span><span id="StepperBase.set_gains-302"><a href="#StepperBase.set_gains-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="StepperBase.set_gains-303"><a href="#StepperBase.set_gains-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.write_gains_to_YAML" class="classattr">
                                        <input id="StepperBase.write_gains_to_YAML-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_gains_to_YAML</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_gains_to_YAML-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_gains_to_YAML"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_gains_to_YAML-305"><a href="#StepperBase.write_gains_to_YAML-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.write_gains_to_YAML-306"><a href="#StepperBase.write_gains_to_YAML-306"><span class="linenos">306</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;This method has been deprecated since v0.3.0&#39;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.write_gains_to_flash" class="classattr">
                                        <input id="StepperBase.write_gains_to_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_gains_to_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_gains_to_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_gains_to_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_gains_to_flash-308"><a href="#StepperBase.write_gains_to_flash-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">write_gains_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.write_gains_to_flash-309"><a href="#StepperBase.write_gains_to_flash-309"><span class="linenos">309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_WRITE_GAINS_TO_FLASH</span>
</span><span id="StepperBase.write_gains_to_flash-310"><a href="#StepperBase.write_gains_to_flash-310"><span class="linenos">310</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.read_gains_from_flash" class="classattr">
                                        <input id="StepperBase.read_gains_from_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_gains_from_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.read_gains_from_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.read_gains_from_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.read_gains_from_flash-312"><a href="#StepperBase.read_gains_from_flash-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="nf">read_gains_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.read_gains_from_flash-313"><a href="#StepperBase.read_gains_from_flash-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_read_gains_from_flash</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.board_reset" class="classattr">
                                        <input id="StepperBase.board_reset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">board_reset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.board_reset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.board_reset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.board_reset-315"><a href="#StepperBase.board_reset-315"><span class="linenos">315</span></a>    <span class="k">def</span> <span class="nf">board_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.board_reset-316"><a href="#StepperBase.board_reset-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_BOARD_RESET</span>
</span><span id="StepperBase.board_reset-317"><a href="#StepperBase.board_reset-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.mark_position_on_contact" class="classattr">
                                        <input id="StepperBase.mark_position_on_contact-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_position_on_contact</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.mark_position_on_contact-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.mark_position_on_contact"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.mark_position_on_contact-319"><a href="#StepperBase.mark_position_on_contact-319"><span class="linenos">319</span></a>    <span class="k">def</span> <span class="nf">mark_position_on_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase.mark_position_on_contact-320"><a href="#StepperBase.mark_position_on_contact-320"><span class="linenos">320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="StepperBase.mark_position_on_contact-321"><a href="#StepperBase.mark_position_on_contact-321"><span class="linenos">321</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS_ON_CONTACT</span>
</span><span id="StepperBase.mark_position_on_contact-322"><a href="#StepperBase.mark_position_on_contact-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.mark_position" class="classattr">
                                        <input id="StepperBase.mark_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_position</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.mark_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.mark_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.mark_position-324"><a href="#StepperBase.mark_position-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
</span><span id="StepperBase.mark_position-325"><a href="#StepperBase.mark_position-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">:</span>
</span><span id="StepperBase.mark_position-326"><a href="#StepperBase.mark_position-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not mark position. Must be in MODE_SAFETY for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">)</span>
</span><span id="StepperBase.mark_position-327"><a href="#StepperBase.mark_position-327"><span class="linenos">327</span></a>            <span class="k">return</span>
</span><span id="StepperBase.mark_position-328"><a href="#StepperBase.mark_position-328"><span class="linenos">328</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="o">=</span><span class="n">x</span>
</span><span id="StepperBase.mark_position-329"><a href="#StepperBase.mark_position-329"><span class="linenos">329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_MARK_POS</span>
</span><span id="StepperBase.mark_position-330"><a href="#StepperBase.mark_position-330"><span class="linenos">330</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.reset_motion_gen" class="classattr">
                                        <input id="StepperBase.reset_motion_gen-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_motion_gen</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.reset_motion_gen-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.reset_motion_gen"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.reset_motion_gen-332"><a href="#StepperBase.reset_motion_gen-332"><span class="linenos">332</span></a>    <span class="k">def</span> <span class="nf">reset_motion_gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.reset_motion_gen-333"><a href="#StepperBase.reset_motion_gen-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_MOTION_GEN</span>
</span><span id="StepperBase.reset_motion_gen-334"><a href="#StepperBase.reset_motion_gen-334"><span class="linenos">334</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.reset_pos_calibrated" class="classattr">
                                        <input id="StepperBase.reset_pos_calibrated-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_pos_calibrated</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.reset_pos_calibrated-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.reset_pos_calibrated"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.reset_pos_calibrated-336"><a href="#StepperBase.reset_pos_calibrated-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">reset_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.reset_pos_calibrated-337"><a href="#StepperBase.reset_pos_calibrated-337"><span class="linenos">337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_RESET_POS_CALIBRATED</span>
</span><span id="StepperBase.reset_pos_calibrated-338"><a href="#StepperBase.reset_pos_calibrated-338"><span class="linenos">338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.set_pos_calibrated" class="classattr">
                                        <input id="StepperBase.set_pos_calibrated-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pos_calibrated</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_pos_calibrated-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_pos_calibrated"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_pos_calibrated-340"><a href="#StepperBase.set_pos_calibrated-340"><span class="linenos">340</span></a>    <span class="k">def</span> <span class="nf">set_pos_calibrated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.set_pos_calibrated-341"><a href="#StepperBase.set_pos_calibrated-341"><span class="linenos">341</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_POS_CALIBRATED</span>
</span><span id="StepperBase.set_pos_calibrated-342"><a href="#StepperBase.set_pos_calibrated-342"><span class="linenos">342</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_safety" class="classattr">
                                        <input id="StepperBase.enable_safety-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_safety</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_safety-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_safety"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_safety-347"><a href="#StepperBase.enable_safety-347"><span class="linenos">347</span></a>    <span class="k">def</span> <span class="nf">enable_safety</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_safety-348"><a href="#StepperBase.enable_safety-348"><span class="linenos">348</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_SAFETY</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_freewheel" class="classattr">
                                        <input id="StepperBase.enable_freewheel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_freewheel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_freewheel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_freewheel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_freewheel-350"><a href="#StepperBase.enable_freewheel-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">enable_freewheel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_freewheel-351"><a href="#StepperBase.enable_freewheel-351"><span class="linenos">351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_FREEWHEEL</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_hold" class="classattr">
                                        <input id="StepperBase.enable_hold-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_hold</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_hold-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_hold"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_hold-353"><a href="#StepperBase.enable_hold-353"><span class="linenos">353</span></a>    <span class="k">def</span> <span class="nf">enable_hold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_hold-354"><a href="#StepperBase.enable_hold-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_HOLD</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_vel_pid" class="classattr">
                                        <input id="StepperBase.enable_vel_pid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_vel_pid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_vel_pid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_vel_pid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_vel_pid-356"><a href="#StepperBase.enable_vel_pid-356"><span class="linenos">356</span></a>    <span class="k">def</span> <span class="nf">enable_vel_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_vel_pid-357"><a href="#StepperBase.enable_vel_pid-357"><span class="linenos">357</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_pos_pid" class="classattr">
                                        <input id="StepperBase.enable_pos_pid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_pid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_pid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_pid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_pid-359"><a href="#StepperBase.enable_pos_pid-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">enable_pos_pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_pid-360"><a href="#StepperBase.enable_pos_pid-360"><span class="linenos">360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_PID</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_vel_traj" class="classattr">
                                        <input id="StepperBase.enable_vel_traj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_vel_traj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_vel_traj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_vel_traj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_vel_traj-362"><a href="#StepperBase.enable_vel_traj-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">enable_vel_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_vel_traj-363"><a href="#StepperBase.enable_vel_traj-363"><span class="linenos">363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_pos_traj" class="classattr">
                                        <input id="StepperBase.enable_pos_traj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_traj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_traj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_traj-365"><a href="#StepperBase.enable_pos_traj-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_traj-366"><a href="#StepperBase.enable_pos_traj-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_pos_traj_waypoint" class="classattr">
                                        <input id="StepperBase.enable_pos_traj_waypoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj_waypoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_traj_waypoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_traj_waypoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_traj_waypoint-368"><a href="#StepperBase.enable_pos_traj_waypoint-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_traj_waypoint-369"><a href="#StepperBase.enable_pos_traj_waypoint-369"><span class="linenos">369</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.enable_pos_traj_waypoint-370"><a href="#StepperBase.enable_pos_traj_waypoint-370"><span class="linenos">370</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_pos_traj_incr" class="classattr">
                                        <input id="StepperBase.enable_pos_traj_incr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj_incr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_pos_traj_incr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_pos_traj_incr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_pos_traj_incr-372"><a href="#StepperBase.enable_pos_traj_incr-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_incr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_pos_traj_incr-373"><a href="#StepperBase.enable_pos_traj_incr-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_current" class="classattr">
                                        <input id="StepperBase.enable_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_current-375"><a href="#StepperBase.enable_current-375"><span class="linenos">375</span></a>    <span class="k">def</span> <span class="nf">enable_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_current-376"><a href="#StepperBase.enable_current-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">,</span> <span class="n">i_des</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_sync_mode" class="classattr">
                                        <input id="StepperBase.enable_sync_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_sync_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_sync_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_sync_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_sync_mode-378"><a href="#StepperBase.enable_sync_mode-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">enable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_sync_mode-379"><a href="#StepperBase.enable_sync_mode-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase.enable_sync_mode-380"><a href="#StepperBase.enable_sync_mode-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.disable_sync_mode" class="classattr">
                                        <input id="StepperBase.disable_sync_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_sync_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_sync_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_sync_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_sync_mode-382"><a href="#StepperBase.disable_sync_mode-382"><span class="linenos">382</span></a>    <span class="k">def</span> <span class="nf">disable_sync_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_sync_mode-383"><a href="#StepperBase.disable_sync_mode-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.disable_sync_mode-384"><a href="#StepperBase.disable_sync_mode-384"><span class="linenos">384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_runstop" class="classattr">
                                        <input id="StepperBase.enable_runstop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_runstop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_runstop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_runstop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_runstop-386"><a href="#StepperBase.enable_runstop-386"><span class="linenos">386</span></a>    <span class="k">def</span> <span class="nf">enable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_runstop-387"><a href="#StepperBase.enable_runstop-387"><span class="linenos">387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase.enable_runstop-388"><a href="#StepperBase.enable_runstop-388"><span class="linenos">388</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.disable_runstop" class="classattr">
                                        <input id="StepperBase.disable_runstop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_runstop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_runstop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_runstop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_runstop-390"><a href="#StepperBase.disable_runstop-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">disable_runstop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_runstop-391"><a href="#StepperBase.disable_runstop-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.disable_runstop-392"><a href="#StepperBase.disable_runstop-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span><span class="o">=</span><span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_guarded_mode" class="classattr">
                                        <input id="StepperBase.enable_guarded_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_guarded_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_guarded_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_guarded_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_guarded_mode-394"><a href="#StepperBase.enable_guarded_mode-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="nf">enable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_guarded_mode-395"><a href="#StepperBase.enable_guarded_mode-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="StepperBase.enable_guarded_mode-396"><a href="#StepperBase.enable_guarded_mode-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.disable_guarded_mode" class="classattr">
                                        <input id="StepperBase.disable_guarded_mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_guarded_mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_guarded_mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_guarded_mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_guarded_mode-398"><a href="#StepperBase.disable_guarded_mode-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">disable_guarded_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_guarded_mode-399"><a href="#StepperBase.disable_guarded_mode-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.disable_guarded_mode-400"><a href="#StepperBase.disable_guarded_mode-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.set_command" class="classattr">
                                        <input id="StepperBase.set_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_command</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">x_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">v_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">a_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_des</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_command-408"><a href="#StepperBase.set_command-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">set_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">a_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_des</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stiffness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">i_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i_contact_neg</span><span class="o">=</span><span class="kc">None</span>  <span class="p">):</span>
</span><span id="StepperBase.set_command-409"><a href="#StepperBase.set_command-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-410"><a href="#StepperBase.set_command-410"><span class="linenos">410</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="StepperBase.set_command-411"><a href="#StepperBase.set_command-411"><span class="linenos">411</span></a>
</span><span id="StepperBase.set_command-412"><a href="#StepperBase.set_command-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">x_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-413"><a href="#StepperBase.set_command-413"><span class="linenos">413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_des</span>
</span><span id="StepperBase.set_command-414"><a href="#StepperBase.set_command-414"><span class="linenos">414</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_INCR</span><span class="p">:</span>
</span><span id="StepperBase.set_command-415"><a href="#StepperBase.set_command-415"><span class="linenos">415</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">255</span>
</span><span id="StepperBase.set_command-416"><a href="#StepperBase.set_command-416"><span class="linenos">416</span></a>
</span><span id="StepperBase.set_command-417"><a href="#StepperBase.set_command-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">v_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-418"><a href="#StepperBase.set_command-418"><span class="linenos">418</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_des</span>
</span><span id="StepperBase.set_command-419"><a href="#StepperBase.set_command-419"><span class="linenos">419</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-420"><a href="#StepperBase.set_command-420"><span class="linenos">420</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_PID</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_VEL_TRAJ</span><span class="p">:</span>
</span><span id="StepperBase.set_command-421"><a href="#StepperBase.set_command-421"><span class="linenos">421</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.set_command-422"><a href="#StepperBase.set_command-422"><span class="linenos">422</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-423"><a href="#StepperBase.set_command-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-424"><a href="#StepperBase.set_command-424"><span class="linenos">424</span></a>
</span><span id="StepperBase.set_command-425"><a href="#StepperBase.set_command-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">a_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-426"><a href="#StepperBase.set_command-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_des</span>
</span><span id="StepperBase.set_command-427"><a href="#StepperBase.set_command-427"><span class="linenos">427</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-428"><a href="#StepperBase.set_command-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;motion&#39;</span><span class="p">][</span><span class="s1">&#39;accel&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-429"><a href="#StepperBase.set_command-429"><span class="linenos">429</span></a>
</span><span id="StepperBase.set_command-430"><a href="#StepperBase.set_command-430"><span class="linenos">430</span></a>        <span class="k">if</span> <span class="n">stiffness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-431"><a href="#StepperBase.set_command-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stiffness</span><span class="p">))</span>
</span><span id="StepperBase.set_command-432"><a href="#StepperBase.set_command-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-433"><a href="#StepperBase.set_command-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">]</span> <span class="o">=</span><span class="mi">1</span>
</span><span id="StepperBase.set_command-434"><a href="#StepperBase.set_command-434"><span class="linenos">434</span></a>
</span><span id="StepperBase.set_command-435"><a href="#StepperBase.set_command-435"><span class="linenos">435</span></a>        <span class="k">if</span> <span class="n">i_feedforward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-436"><a href="#StepperBase.set_command-436"><span class="linenos">436</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_feedforward</span>
</span><span id="StepperBase.set_command-437"><a href="#StepperBase.set_command-437"><span class="linenos">437</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-438"><a href="#StepperBase.set_command-438"><span class="linenos">438</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.set_command-439"><a href="#StepperBase.set_command-439"><span class="linenos">439</span></a>
</span><span id="StepperBase.set_command-440"><a href="#StepperBase.set_command-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">i_des</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_CURRENT</span><span class="p">:</span>
</span><span id="StepperBase.set_command-441"><a href="#StepperBase.set_command-441"><span class="linenos">441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">i_des</span>
</span><span id="StepperBase.set_command-442"><a href="#StepperBase.set_command-442"><span class="linenos">442</span></a>
</span><span id="StepperBase.set_command-443"><a href="#StepperBase.set_command-443"><span class="linenos">443</span></a>
</span><span id="StepperBase.set_command-444"><a href="#StepperBase.set_command-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">i_contact_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-445"><a href="#StepperBase.set_command-445"><span class="linenos">445</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_pos</span>
</span><span id="StepperBase.set_command-446"><a href="#StepperBase.set_command-446"><span class="linenos">446</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-447"><a href="#StepperBase.set_command-447"><span class="linenos">447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-448"><a href="#StepperBase.set_command-448"><span class="linenos">448</span></a>
</span><span id="StepperBase.set_command-449"><a href="#StepperBase.set_command-449"><span class="linenos">449</span></a>        <span class="k">if</span> <span class="n">i_contact_neg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.set_command-450"><a href="#StepperBase.set_command-450"><span class="linenos">450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_contact_neg</span>
</span><span id="StepperBase.set_command-451"><a href="#StepperBase.set_command-451"><span class="linenos">451</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.set_command-452"><a href="#StepperBase.set_command-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;gains&#39;</span><span class="p">][</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">]</span>
</span><span id="StepperBase.set_command-453"><a href="#StepperBase.set_command-453"><span class="linenos">453</span></a>        <span class="c1">#print(time.time(), i_des, self._command[&#39;i_feedforward&#39;],mode == self.MODE_CURRENT)</span>
</span><span id="StepperBase.set_command-454"><a href="#StepperBase.set_command-454"><span class="linenos">454</span></a>        <span class="c1">#print(time.time(),self._command[&#39;x_des&#39;],self._command[&#39;incr_trigger&#39;],self._command[&#39;v_des&#39;],self._command[&#39;a_des&#39;])</span>
</span><span id="StepperBase.set_command-455"><a href="#StepperBase.set_command-455"><span class="linenos">455</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_command</span><span class="o">=</span><span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.wait_while_is_moving" class="classattr">
                                        <input id="StepperBase.wait_while_is_moving-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wait_while_is_moving</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.wait_while_is_moving-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.wait_while_is_moving"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.wait_while_is_moving-458"><a href="#StepperBase.wait_while_is_moving-458"><span class="linenos">458</span></a>    <span class="k">def</span> <span class="nf">wait_while_is_moving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase.wait_while_is_moving-459"><a href="#StepperBase.wait_while_is_moving-459"><span class="linenos">459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_while_is_moving-460"><a href="#StepperBase.wait_while_is_moving-460"><span class="linenos">460</span></a><span class="sd">        Poll until is moving flag is false</span>
</span><span id="StepperBase.wait_while_is_moving-461"><a href="#StepperBase.wait_while_is_moving-461"><span class="linenos">461</span></a><span class="sd">        Return True if success</span>
</span><span id="StepperBase.wait_while_is_moving-462"><a href="#StepperBase.wait_while_is_moving-462"><span class="linenos">462</span></a><span class="sd">        Return False if timeout</span>
</span><span id="StepperBase.wait_while_is_moving-463"><a href="#StepperBase.wait_while_is_moving-463"><span class="linenos">463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_while_is_moving-464"><a href="#StepperBase.wait_while_is_moving-464"><span class="linenos">464</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.wait_while_is_moving-465"><a href="#StepperBase.wait_while_is_moving-465"><span class="linenos">465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_while_is_moving-466"><a href="#StepperBase.wait_while_is_moving-466"><span class="linenos">466</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase.wait_while_is_moving-467"><a href="#StepperBase.wait_while_is_moving-467"><span class="linenos">467</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.wait_while_is_moving-468"><a href="#StepperBase.wait_while_is_moving-468"><span class="linenos">468</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_while_is_moving-469"><a href="#StepperBase.wait_while_is_moving-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Poll until is moving flag is false
Return True if success
Return False if timeout</p>
</div>


                            </div>
                            <div id="StepperBase.wait_until_at_setpoint" class="classattr">
                                        <input id="StepperBase.wait_until_at_setpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wait_until_at_setpoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.wait_until_at_setpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.wait_until_at_setpoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.wait_until_at_setpoint-471"><a href="#StepperBase.wait_until_at_setpoint-471"><span class="linenos">471</span></a>    <span class="k">def</span> <span class="nf">wait_until_at_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">15.0</span><span class="p">):</span>
</span><span id="StepperBase.wait_until_at_setpoint-472"><a href="#StepperBase.wait_until_at_setpoint-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_until_at_setpoint-473"><a href="#StepperBase.wait_until_at_setpoint-473"><span class="linenos">473</span></a><span class="sd">        Poll until near setpoint</span>
</span><span id="StepperBase.wait_until_at_setpoint-474"><a href="#StepperBase.wait_until_at_setpoint-474"><span class="linenos">474</span></a><span class="sd">        Return True if success</span>
</span><span id="StepperBase.wait_until_at_setpoint-475"><a href="#StepperBase.wait_until_at_setpoint-475"><span class="linenos">475</span></a><span class="sd">        Return False if timeout</span>
</span><span id="StepperBase.wait_until_at_setpoint-476"><a href="#StepperBase.wait_until_at_setpoint-476"><span class="linenos">476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StepperBase.wait_until_at_setpoint-477"><a href="#StepperBase.wait_until_at_setpoint-477"><span class="linenos">477</span></a>        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="StepperBase.wait_until_at_setpoint-478"><a href="#StepperBase.wait_until_at_setpoint-478"><span class="linenos">478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_until_at_setpoint-479"><a href="#StepperBase.wait_until_at_setpoint-479"><span class="linenos">479</span></a>        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="StepperBase.wait_until_at_setpoint-480"><a href="#StepperBase.wait_until_at_setpoint-480"><span class="linenos">480</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.wait_until_at_setpoint-481"><a href="#StepperBase.wait_until_at_setpoint-481"><span class="linenos">481</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="StepperBase.wait_until_at_setpoint-482"><a href="#StepperBase.wait_until_at_setpoint-482"><span class="linenos">482</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Poll until near setpoint
Return True if success
Return False if timeout</p>
</div>


                            </div>
                            <div id="StepperBase.current_to_effort_ticks" class="classattr">
                                        <input id="StepperBase.current_to_effort_ticks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_to_effort_ticks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i_A</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.current_to_effort_ticks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.current_to_effort_ticks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.current_to_effort_ticks-488"><a href="#StepperBase.current_to_effort_ticks-488"><span class="linenos">488</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase.current_to_effort_ticks-489"><a href="#StepperBase.current_to_effort_ticks-489"><span class="linenos">489</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase.current_to_effort_ticks-490"><a href="#StepperBase.current_to_effort_ticks-490"><span class="linenos">490</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.current_to_effort_ticks-491"><a href="#StepperBase.current_to_effort_ticks-491"><span class="linenos">491</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase.current_to_effort_ticks-492"><a href="#StepperBase.current_to_effort_ticks-492"><span class="linenos">492</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase.current_to_effort_ticks-493"><a href="#StepperBase.current_to_effort_ticks-493"><span class="linenos">493</span></a>        <span class="n">effort_ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_A</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mA_per_tick</span>
</span><span id="StepperBase.current_to_effort_ticks-494"><a href="#StepperBase.current_to_effort_ticks-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">255</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">effort_ticks</span><span class="p">)))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.effort_ticks_to_current" class="classattr">
                                        <input id="StepperBase.effort_ticks_to_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">effort_ticks_to_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">e</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.effort_ticks_to_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.effort_ticks_to_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.effort_ticks_to_current-496"><a href="#StepperBase.effort_ticks_to_current-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="nf">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase.effort_ticks_to_current-497"><a href="#StepperBase.effort_ticks_to_current-497"><span class="linenos">497</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># I = Vref / (10 * R), Rs = 0.10 Ohm, Vref = 3.3V --&gt;3.3A</span>
</span><span id="StepperBase.effort_ticks_to_current-498"><a href="#StepperBase.effort_ticks_to_current-498"><span class="linenos">498</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.effort_ticks_to_current-499"><a href="#StepperBase.effort_ticks_to_current-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># I = Vref / (5 * R), Rs = 0.150 Ohm, Vref = 3.3V --&gt;4.4A</span>
</span><span id="StepperBase.effort_ticks_to_current-500"><a href="#StepperBase.effort_ticks_to_current-500"><span class="linenos">500</span></a>            <span class="n">mA_per_tick</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3300</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
</span><span id="StepperBase.effort_ticks_to_current-501"><a href="#StepperBase.effort_ticks_to_current-501"><span class="linenos">501</span></a>        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="n">mA_per_tick</span> <span class="o">/</span> <span class="mf">1000.0</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.current_to_effort_pct" class="classattr">
                                        <input id="StepperBase.current_to_effort_pct-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_to_effort_pct</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i_A</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.current_to_effort_pct-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.current_to_effort_pct"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.current_to_effort_pct-505"><a href="#StepperBase.current_to_effort_pct-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="nf">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i_A</span><span class="p">):</span>
</span><span id="StepperBase.current_to_effort_pct-506"><a href="#StepperBase.current_to_effort_pct-506"><span class="linenos">506</span></a>        <span class="k">if</span> <span class="n">i_A</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase.current_to_effort_pct-507"><a href="#StepperBase.current_to_effort_pct-507"><span class="linenos">507</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">i_A</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]))</span>
</span><span id="StepperBase.current_to_effort_pct-508"><a href="#StepperBase.current_to_effort_pct-508"><span class="linenos">508</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.current_to_effort_pct-509"><a href="#StepperBase.current_to_effort_pct-509"><span class="linenos">509</span></a>            <span class="k">return</span> <span class="mi">100</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i_A</span><span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.effort_pct_to_current" class="classattr">
                                        <input id="StepperBase.effort_pct_to_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">effort_pct_to_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">e_pct</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.effort_pct_to_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.effort_pct_to_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.effort_pct_to_current-511"><a href="#StepperBase.effort_pct_to_current-511"><span class="linenos">511</span></a>    <span class="k">def</span> <span class="nf">effort_pct_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e_pct</span><span class="p">):</span>
</span><span id="StepperBase.effort_pct_to_current-512"><a href="#StepperBase.effort_pct_to_current-512"><span class="linenos">512</span></a>        <span class="k">if</span> <span class="n">e_pct</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase.effort_pct_to_current-513"><a href="#StepperBase.effort_pct_to_current-513"><span class="linenos">513</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span>
</span><span id="StepperBase.effort_pct_to_current-514"><a href="#StepperBase.effort_pct_to_current-514"><span class="linenos">514</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.effort_pct_to_current-515"><a href="#StepperBase.effort_pct_to_current-515"><span class="linenos">515</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">e_pct</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.current_to_torque" class="classattr">
                                        <input id="StepperBase.current_to_torque-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_to_torque</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.current_to_torque-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.current_to_torque"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.current_to_torque-517"><a href="#StepperBase.current_to_torque-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="nf">current_to_torque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="StepperBase.current_to_torque-518"><a href="#StepperBase.current_to_torque-518"><span class="linenos">518</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method current_to_torque has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.torque_to_current" class="classattr">
                                        <input id="StepperBase.torque_to_current-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">torque_to_current</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tq</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.torque_to_current-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.torque_to_current"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.torque_to_current-520"><a href="#StepperBase.torque_to_current-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">torque_to_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tq</span><span class="p">):</span>
</span><span id="StepperBase.torque_to_current-521"><a href="#StepperBase.torque_to_current-521"><span class="linenos">521</span></a>        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s1">&#39;Method torque_to_current has been deprecated since v0.3.5&#39;</span><span class="p">)</span>
</span><span id="StepperBase.torque_to_current-522"><a href="#StepperBase.torque_to_current-522"><span class="linenos">522</span></a>
</span><span id="StepperBase.torque_to_current-523"><a href="#StepperBase.torque_to_current-523"><span class="linenos">523</span></a>
</span><span id="StepperBase.torque_to_current-524"><a href="#StepperBase.torque_to_current-524"><span class="linenos">524</span></a>        <span class="c1"># ####################### Encoder Calibration ######################</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.get_chip_id" class="classattr">
                                        <input id="StepperBase.get_chip_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_chip_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.get_chip_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.get_chip_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.get_chip_id-526"><a href="#StepperBase.get_chip_id-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">get_chip_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.get_chip_id-527"><a href="#StepperBase.get_chip_id-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.get_chip_id-528"><a href="#StepperBase.get_chip_id-528"><span class="linenos">528</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.get_chip_id-529"><a href="#StepperBase.get_chip_id-529"><span class="linenos">529</span></a>        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="StepperBase.get_chip_id-530"><a href="#StepperBase.get_chip_id-530"><span class="linenos">530</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.get_chip_id-531"><a href="#StepperBase.get_chip_id-531"><span class="linenos">531</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.get_chip_id-532"><a href="#StepperBase.get_chip_id-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="n">cid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.read_encoder_calibration_from_YAML" class="classattr">
                                        <input id="StepperBase.read_encoder_calibration_from_YAML-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_encoder_calibration_from_YAML</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.read_encoder_calibration_from_YAML-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.read_encoder_calibration_from_YAML"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.read_encoder_calibration_from_YAML-534"><a href="#StepperBase.read_encoder_calibration_from_YAML-534"><span class="linenos">534</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-535"><a href="#StepperBase.read_encoder_calibration_from_YAML-535"><span class="linenos">535</span></a>        <span class="n">device_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-536"><a href="#StepperBase.read_encoder_calibration_from_YAML-536"><span class="linenos">536</span></a>        <span class="n">sn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-537"><a href="#StepperBase.read_encoder_calibration_from_YAML-537"><span class="linenos">537</span></a>        <span class="n">fn</span><span class="o">=</span><span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">sn</span><span class="o">+</span><span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-538"><a href="#StepperBase.read_encoder_calibration_from_YAML-538"><span class="linenos">538</span></a>        <span class="n">enc_data</span><span class="o">=</span><span class="n">read_fleet_yaml</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_YAML-539"><a href="#StepperBase.read_encoder_calibration_from_YAML-539"><span class="linenos">539</span></a>        <span class="k">return</span> <span class="n">enc_data</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.write_encoder_calibration_to_YAML" class="classattr">
                                        <input id="StepperBase.write_encoder_calibration_to_YAML-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_encoder_calibration_to_YAML</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">filename</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_encoder_calibration_to_YAML-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_encoder_calibration_to_YAML"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_encoder_calibration_to_YAML-541"><a href="#StepperBase.write_encoder_calibration_to_YAML-541"><span class="linenos">541</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_YAML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fleet_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-542"><a href="#StepperBase.write_encoder_calibration_to_YAML-542"><span class="linenos">542</span></a>        <span class="n">device_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usb</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-543"><a href="#StepperBase.write_encoder_calibration_to_YAML-543"><span class="linenos">543</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-544"><a href="#StepperBase.write_encoder_calibration_to_YAML-544"><span class="linenos">544</span></a>            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot_params</span><span class="p">[</span><span class="n">device_name</span><span class="p">][</span><span class="s1">&#39;serial_no&#39;</span><span class="p">]</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-545"><a href="#StepperBase.write_encoder_calibration_to_YAML-545"><span class="linenos">545</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;calibration_steppers/&#39;</span><span class="o">+</span><span class="n">device_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">sn</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-546"><a href="#StepperBase.write_encoder_calibration_to_YAML-546"><span class="linenos">546</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_YAML-547"><a href="#StepperBase.write_encoder_calibration_to_YAML-547"><span class="linenos">547</span></a>        <span class="n">write_fleet_yaml</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">fleet_dir</span><span class="o">=</span><span class="n">fleet_dir</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.read_encoder_calibration_from_flash" class="classattr">
                                        <input id="StepperBase.read_encoder_calibration_from_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_encoder_calibration_from_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.read_encoder_calibration_from_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.read_encoder_calibration_from_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.read_encoder_calibration_from_flash-549"><a href="#StepperBase.read_encoder_calibration_from_flash-549"><span class="linenos">549</span></a>    <span class="k">def</span> <span class="nf">read_encoder_calibration_from_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-550"><a href="#StepperBase.read_encoder_calibration_from_flash-550"><span class="linenos">550</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_menu_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-551"><a href="#StepperBase.read_encoder_calibration_from_flash-551"><span class="linenos">551</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-552"><a href="#StepperBase.read_encoder_calibration_from_flash-552"><span class="linenos">552</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-553"><a href="#StepperBase.read_encoder_calibration_from_flash-553"><span class="linenos">553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reading encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-554"><a href="#StepperBase.read_encoder_calibration_from_flash-554"><span class="linenos">554</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">19</span><span class="p">]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-555"><a href="#StepperBase.read_encoder_calibration_from_flash-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">turn_rpc_interface_on</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-556"><a href="#StepperBase.read_encoder_calibration_from_flash-556"><span class="linenos">556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-557"><a href="#StepperBase.read_encoder_calibration_from_flash-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Reseting board&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-558"><a href="#StepperBase.read_encoder_calibration_from_flash-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_reset</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-559"><a href="#StepperBase.read_encoder_calibration_from_flash-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-560"><a href="#StepperBase.read_encoder_calibration_from_flash-560"><span class="linenos">560</span></a>        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># We now have string of floats, convert to list of floats</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-561"><a href="#StepperBase.read_encoder_calibration_from_flash-561"><span class="linenos">561</span></a>        <span class="n">enc_calib</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-562"><a href="#StepperBase.read_encoder_calibration_from_flash-562"><span class="linenos">562</span></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-563"><a href="#StepperBase.read_encoder_calibration_from_flash-563"><span class="linenos">563</span></a>            <span class="n">ff</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-564"><a href="#StepperBase.read_encoder_calibration_from_flash-564"><span class="linenos">564</span></a>            <span class="k">if</span> <span class="n">ff</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-565"><a href="#StepperBase.read_encoder_calibration_from_flash-565"><span class="linenos">565</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ff</span><span class="p">]))</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-566"><a href="#StepperBase.read_encoder_calibration_from_flash-566"><span class="linenos">566</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-567"><a href="#StepperBase.read_encoder_calibration_from_flash-567"><span class="linenos">567</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-568"><a href="#StepperBase.read_encoder_calibration_from_flash-568"><span class="linenos">568</span></a>                <span class="n">enc_calib</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-569"><a href="#StepperBase.read_encoder_calibration_from_flash-569"><span class="linenos">569</span></a>                <span class="n">e</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-570"><a href="#StepperBase.read_encoder_calibration_from_flash-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc_calib</span><span class="p">)</span><span class="o">==</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-571"><a href="#StepperBase.read_encoder_calibration_from_flash-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Successful read of encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-572"><a href="#StepperBase.read_encoder_calibration_from_flash-572"><span class="linenos">572</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-573"><a href="#StepperBase.read_encoder_calibration_from_flash-573"><span class="linenos">573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Failed to read encoder calibration&#39;</span><span class="p">)</span>
</span><span id="StepperBase.read_encoder_calibration_from_flash-574"><a href="#StepperBase.read_encoder_calibration_from_flash-574"><span class="linenos">574</span></a>        <span class="k">return</span> <span class="n">enc_calib</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.write_encoder_calibration_to_flash" class="classattr">
                                        <input id="StepperBase.write_encoder_calibration_to_flash-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_encoder_calibration_to_flash</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.write_encoder_calibration_to_flash-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.write_encoder_calibration_to_flash"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.write_encoder_calibration_to_flash-576"><a href="#StepperBase.write_encoder_calibration_to_flash-576"><span class="linenos">576</span></a>    <span class="k">def</span> <span class="nf">write_encoder_calibration_to_flash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-577"><a href="#StepperBase.write_encoder_calibration_to_flash-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-578"><a href="#StepperBase.write_encoder_calibration_to_flash-578"><span class="linenos">578</span></a>            <span class="k">return</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-579"><a href="#StepperBase.write_encoder_calibration_to_flash-579"><span class="linenos">579</span></a>        <span class="c1">#This will take a few seconds. Blocks until complete.</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-580"><a href="#StepperBase.write_encoder_calibration_to_flash-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">!=</span><span class="mi">16384</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-581"><a href="#StepperBase.write_encoder_calibration_to_flash-581"><span class="linenos">581</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Bad encoder data&#39;</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-582"><a href="#StepperBase.write_encoder_calibration_to_flash-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-583"><a href="#StepperBase.write_encoder_calibration_to_flash-583"><span class="linenos">583</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Writing encoder calibration...&#39;</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-584"><a href="#StepperBase.write_encoder_calibration_to_flash-584"><span class="linenos">584</span></a>            <span class="n">payload</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-585"><a href="#StepperBase.write_encoder_calibration_to_flash-585"><span class="linenos">585</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-586"><a href="#StepperBase.write_encoder_calibration_to_flash-586"><span class="linenos">586</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-587"><a href="#StepperBase.write_encoder_calibration_to_flash-587"><span class="linenos">587</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-588"><a href="#StepperBase.write_encoder_calibration_to_flash-588"><span class="linenos">588</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-589"><a href="#StepperBase.write_encoder_calibration_to_flash-589"><span class="linenos">589</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_ENC_CALIB</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-590"><a href="#StepperBase.write_encoder_calibration_to_flash-590"><span class="linenos">590</span></a>                <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-591"><a href="#StepperBase.write_encoder_calibration_to_flash-591"><span class="linenos">591</span></a>                <span class="n">sidx</span><span class="o">=</span><span class="mi">2</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-592"><a href="#StepperBase.write_encoder_calibration_to_flash-592"><span class="linenos">592</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-593"><a href="#StepperBase.write_encoder_calibration_to_flash-593"><span class="linenos">593</span></a>                    <span class="n">pack_float_t</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">*</span><span class="mi">64</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-594"><a href="#StepperBase.write_encoder_calibration_to_flash-594"><span class="linenos">594</span></a>                    <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-595"><a href="#StepperBase.write_encoder_calibration_to_flash-595"><span class="linenos">595</span></a>                <span class="c1"># self.logger.debug(&#39;Sending encoder calibration rpc of size&#39;,sidx)</span>
</span><span id="StepperBase.write_encoder_calibration_to_flash-596"><a href="#StepperBase.write_encoder_calibration_to_flash-596"><span class="linenos">596</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_enc_calib_reply</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_enc_calib_reply" class="classattr">
                                        <input id="StepperBase.rpc_enc_calib_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_enc_calib_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_enc_calib_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_enc_calib_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_enc_calib_reply-598"><a href="#StepperBase.rpc_enc_calib_reply-598"><span class="linenos">598</span></a>    <span class="k">def</span> <span class="nf">rpc_enc_calib_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_enc_calib_reply-599"><a href="#StepperBase.rpc_enc_calib_reply-599"><span class="linenos">599</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_ENC_CALIB</span><span class="p">:</span>
</span><span id="StepperBase.rpc_enc_calib_reply-600"><a href="#StepperBase.rpc_enc_calib_reply-600"><span class="linenos">600</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_ENC_CALIB&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.turn_rpc_interface_on" class="classattr">
                                        <input id="StepperBase.turn_rpc_interface_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">turn_rpc_interface_on</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.turn_rpc_interface_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.turn_rpc_interface_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.turn_rpc_interface_on-605"><a href="#StepperBase.turn_rpc_interface_on-605"><span class="linenos">605</span></a>    <span class="k">def</span> <span class="nf">turn_rpc_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.turn_rpc_interface_on-606"><a href="#StepperBase.turn_rpc_interface_on-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;zyx&#39;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.turn_menu_interface_on" class="classattr">
                                        <input id="StepperBase.turn_menu_interface_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">turn_menu_interface_on</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.turn_menu_interface_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.turn_menu_interface_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.turn_menu_interface_on-609"><a href="#StepperBase.turn_menu_interface_on-609"><span class="linenos">609</span></a>    <span class="k">def</span> <span class="nf">turn_menu_interface_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.turn_menu_interface_on-610"><a href="#StepperBase.turn_menu_interface_on-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.turn_menu_interface_on-611"><a href="#StepperBase.turn_menu_interface_on-611"><span class="linenos">611</span></a>            <span class="k">return</span>
</span><span id="StepperBase.turn_menu_interface_on-612"><a href="#StepperBase.turn_menu_interface_on-612"><span class="linenos">612</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_MENU_ON</span><span class="p">])</span>
</span><span id="StepperBase.turn_menu_interface_on-613"><a href="#StepperBase.turn_menu_interface_on-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_menu_on_reply</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.print_menu" class="classattr">
                                        <input id="StepperBase.print_menu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_menu</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.print_menu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.print_menu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.print_menu-616"><a href="#StepperBase.print_menu-616"><span class="linenos">616</span></a>    <span class="k">def</span> <span class="nf">print_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.print_menu-617"><a href="#StepperBase.print_menu-617"><span class="linenos">617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">menu_transaction</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.menu_transaction" class="classattr">
                                        <input id="StepperBase.menu_transaction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">menu_transaction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.menu_transaction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.menu_transaction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.menu_transaction-619"><a href="#StepperBase.menu_transaction-619"><span class="linenos">619</span></a>    <span class="k">def</span> <span class="nf">menu_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">do_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="StepperBase.menu_transaction-620"><a href="#StepperBase.menu_transaction-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-621"><a href="#StepperBase.menu_transaction-621"><span class="linenos">621</span></a>            <span class="k">return</span>
</span><span id="StepperBase.menu_transaction-622"><a href="#StepperBase.menu_transaction-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-623"><a href="#StepperBase.menu_transaction-623"><span class="linenos">623</span></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-624"><a href="#StepperBase.menu_transaction-624"><span class="linenos">624</span></a>        <span class="n">reply</span><span class="o">=</span><span class="p">[]</span>
</span><span id="StepperBase.menu_transaction-625"><a href="#StepperBase.menu_transaction-625"><span class="linenos">625</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">():</span>
</span><span id="StepperBase.menu_transaction-626"><a href="#StepperBase.menu_transaction-626"><span class="linenos">626</span></a>            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="StepperBase.menu_transaction-627"><a href="#StepperBase.menu_transaction-627"><span class="linenos">627</span></a>            <span class="k">if</span> <span class="n">do_print</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-628"><a href="#StepperBase.menu_transaction-628"><span class="linenos">628</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-629"><a href="#StepperBase.menu_transaction-629"><span class="linenos">629</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-630"><a href="#StepperBase.menu_transaction-630"><span class="linenos">630</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.menu_transaction-631"><a href="#StepperBase.menu_transaction-631"><span class="linenos">631</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-632"><a href="#StepperBase.menu_transaction-632"><span class="linenos">632</span></a>            <span class="n">reply</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="StepperBase.menu_transaction-633"><a href="#StepperBase.menu_transaction-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="n">reply</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.start_waypoint_trajectory" class="classattr">
                                        <input id="StepperBase.start_waypoint_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_waypoint_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">first_segment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.start_waypoint_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.start_waypoint_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.start_waypoint_trajectory-636"><a href="#StepperBase.start_waypoint_trajectory-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="StepperBase.start_waypoint_trajectory-637"><a href="#StepperBase.start_waypoint_trajectory-637"><span class="linenos">637</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.start_waypoint_trajectory-638"><a href="#StepperBase.start_waypoint_trajectory-638"><span class="linenos">638</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.set_next_trajectory_segment" class="classattr">
                                        <input id="StepperBase.set_next_trajectory_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_next_trajectory_segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">next_segment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.set_next_trajectory_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.set_next_trajectory_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.set_next_trajectory_segment-640"><a href="#StepperBase.set_next_trajectory_segment-640"><span class="linenos">640</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="StepperBase.set_next_trajectory_segment-641"><a href="#StepperBase.set_next_trajectory_segment-641"><span class="linenos">641</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.set_next_trajectory_segment-642"><a href="#StepperBase.set_next_trajectory_segment-642"><span class="linenos">642</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.stop_waypoint_trajectory" class="classattr">
                                        <input id="StepperBase.stop_waypoint_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_waypoint_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.stop_waypoint_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.stop_waypoint_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.stop_waypoint_trajectory-644"><a href="#StepperBase.stop_waypoint_trajectory-644"><span class="linenos">644</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.stop_waypoint_trajectory-645"><a href="#StepperBase.stop_waypoint_trajectory-645"><span class="linenos">645</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.stop_waypoint_trajectory-646"><a href="#StepperBase.stop_waypoint_trajectory-646"><span class="linenos">646</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.unpack_board_info" class="classattr">
                                        <input id="StepperBase.unpack_board_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_board_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.unpack_board_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.unpack_board_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.unpack_board_info-649"><a href="#StepperBase.unpack_board_info-649"><span class="linenos">649</span></a>    <span class="k">def</span> <span class="nf">unpack_board_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase.unpack_board_info-650"><a href="#StepperBase.unpack_board_info-650"><span class="linenos">650</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.unpack_board_info-651"><a href="#StepperBase.unpack_board_info-651"><span class="linenos">651</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase.unpack_board_info-652"><a href="#StepperBase.unpack_board_info-652"><span class="linenos">652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="StepperBase.unpack_board_info-653"><a href="#StepperBase.unpack_board_info-653"><span class="linenos">653</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">9</span><span class="p">:</span> <span class="c1">#New format of Stepper.x  Older format of Stepper.BoardName.Vx&#39; If older format,default to 0</span>
</span><span id="StepperBase.unpack_board_info-654"><a href="#StepperBase.unpack_board_info-654"><span class="linenos">654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;hardware_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase.unpack_board_info-655"><a href="#StepperBase.unpack_board_info-655"><span class="linenos">655</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase.unpack_board_info-656"><a href="#StepperBase.unpack_board_info-656"><span class="linenos">656</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="StepperBase.unpack_board_info-657"><a href="#StepperBase.unpack_board_info-657"><span class="linenos">657</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">):]</span>
</span><span id="StepperBase.unpack_board_info-658"><a href="#StepperBase.unpack_board_info-658"><span class="linenos">658</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">20</span>
</span><span id="StepperBase.unpack_board_info-659"><a href="#StepperBase.unpack_board_info-659"><span class="linenos">659</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.unpack_status" class="classattr">
                                        <input id="StepperBase.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.unpack_status-661"><a href="#StepperBase.unpack_status-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase.unpack_status-662"><a href="#StepperBase.unpack_status-662"><span class="linenos">662</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.unpack_status-663"><a href="#StepperBase.unpack_status-663"><span class="linenos">663</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.unpack_gains" class="classattr">
                                        <input id="StepperBase.unpack_gains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_gains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.unpack_gains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.unpack_gains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.unpack_gains-665"><a href="#StepperBase.unpack_gains-665"><span class="linenos">665</span></a>    <span class="k">def</span> <span class="nf">unpack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="StepperBase.unpack_gains-666"><a href="#StepperBase.unpack_gains-666"><span class="linenos">666</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.unpack_gains-667"><a href="#StepperBase.unpack_gains-667"><span class="linenos">667</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-668"><a href="#StepperBase.unpack_gains-668"><span class="linenos">668</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-669"><a href="#StepperBase.unpack_gains-669"><span class="linenos">669</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-670"><a href="#StepperBase.unpack_gains-670"><span class="linenos">670</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-671"><a href="#StepperBase.unpack_gains-671"><span class="linenos">671</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-672"><a href="#StepperBase.unpack_gains-672"><span class="linenos">672</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-673"><a href="#StepperBase.unpack_gains-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-674"><a href="#StepperBase.unpack_gains-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-675"><a href="#StepperBase.unpack_gains-675"><span class="linenos">675</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-676"><a href="#StepperBase.unpack_gains-676"><span class="linenos">676</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-677"><a href="#StepperBase.unpack_gains-677"><span class="linenos">677</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-678"><a href="#StepperBase.unpack_gains-678"><span class="linenos">678</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-679"><a href="#StepperBase.unpack_gains-679"><span class="linenos">679</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-680"><a href="#StepperBase.unpack_gains-680"><span class="linenos">680</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-681"><a href="#StepperBase.unpack_gains-681"><span class="linenos">681</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-682"><a href="#StepperBase.unpack_gains-682"><span class="linenos">682</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-683"><a href="#StepperBase.unpack_gains-683"><span class="linenos">683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-684"><a href="#StepperBase.unpack_gains-684"><span class="linenos">684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-685"><a href="#StepperBase.unpack_gains-685"><span class="linenos">685</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-686"><a href="#StepperBase.unpack_gains-686"><span class="linenos">686</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.unpack_gains-687"><a href="#StepperBase.unpack_gains-687"><span class="linenos">687</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.unpack_gains-688"><a href="#StepperBase.unpack_gains-688"><span class="linenos">688</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-689"><a href="#StepperBase.unpack_gains-689"><span class="linenos">689</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-690"><a href="#StepperBase.unpack_gains-690"><span class="linenos">690</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-691"><a href="#StepperBase.unpack_gains-691"><span class="linenos">691</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-692"><a href="#StepperBase.unpack_gains-692"><span class="linenos">692</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-693"><a href="#StepperBase.unpack_gains-693"><span class="linenos">693</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-694"><a href="#StepperBase.unpack_gains-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gains_flash</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="StepperBase.unpack_gains-695"><a href="#StepperBase.unpack_gains-695"><span class="linenos">695</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pack_motion_limits" class="classattr">
                                        <input id="StepperBase.pack_motion_limits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_motion_limits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_motion_limits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_motion_limits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_motion_limits-697"><a href="#StepperBase.pack_motion_limits-697"><span class="linenos">697</span></a>    <span class="k">def</span> <span class="nf">pack_motion_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_motion_limits-698"><a href="#StepperBase.pack_motion_limits-698"><span class="linenos">698</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="StepperBase.pack_motion_limits-699"><a href="#StepperBase.pack_motion_limits-699"><span class="linenos">699</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_motion_limits-700"><a href="#StepperBase.pack_motion_limits-700"><span class="linenos">700</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="StepperBase.pack_motion_limits-701"><a href="#StepperBase.pack_motion_limits-701"><span class="linenos">701</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_motion_limits-702"><a href="#StepperBase.pack_motion_limits-702"><span class="linenos">702</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pack_command" class="classattr">
                                        <input id="StepperBase.pack_command-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_command</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_command-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_command"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_command-704"><a href="#StepperBase.pack_command-704"><span class="linenos">704</span></a>    <span class="k">def</span> <span class="nf">pack_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_command-705"><a href="#StepperBase.pack_command-705"><span class="linenos">705</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-706"><a href="#StepperBase.pack_command-706"><span class="linenos">706</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.pack_command-707"><a href="#StepperBase.pack_command-707"><span class="linenos">707</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-708"><a href="#StepperBase.pack_command-708"><span class="linenos">708</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-709"><a href="#StepperBase.pack_command-709"><span class="linenos">709</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-710"><a href="#StepperBase.pack_command-710"><span class="linenos">710</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-711"><a href="#StepperBase.pack_command-711"><span class="linenos">711</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-712"><a href="#StepperBase.pack_command-712"><span class="linenos">712</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-713"><a href="#StepperBase.pack_command-713"><span class="linenos">713</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-714"><a href="#StepperBase.pack_command-714"><span class="linenos">714</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-715"><a href="#StepperBase.pack_command-715"><span class="linenos">715</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-716"><a href="#StepperBase.pack_command-716"><span class="linenos">716</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-717"><a href="#StepperBase.pack_command-717"><span class="linenos">717</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_pos&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-718"><a href="#StepperBase.pack_command-718"><span class="linenos">718</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-719"><a href="#StepperBase.pack_command-719"><span class="linenos">719</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_contact_neg&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-720"><a href="#StepperBase.pack_command-720"><span class="linenos">720</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_command-721"><a href="#StepperBase.pack_command-721"><span class="linenos">721</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;incr_trigger&#39;</span><span class="p">])</span>
</span><span id="StepperBase.pack_command-722"><a href="#StepperBase.pack_command-722"><span class="linenos">722</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.pack_command-723"><a href="#StepperBase.pack_command-723"><span class="linenos">723</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pack_gains" class="classattr">
                                        <input id="StepperBase.pack_gains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_gains</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_gains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_gains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_gains-725"><a href="#StepperBase.pack_gains-725"><span class="linenos">725</span></a>    <span class="k">def</span> <span class="nf">pack_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_gains-726"><a href="#StepperBase.pack_gains-726"><span class="linenos">726</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-727"><a href="#StepperBase.pack_gains-727"><span class="linenos">727</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-728"><a href="#StepperBase.pack_gains-728"><span class="linenos">728</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-729"><a href="#StepperBase.pack_gains-729"><span class="linenos">729</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-730"><a href="#StepperBase.pack_gains-730"><span class="linenos">730</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pKi_limit&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-731"><a href="#StepperBase.pack_gains-731"><span class="linenos">731</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKp_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-732"><a href="#StepperBase.pack_gains-732"><span class="linenos">732</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-733"><a href="#StepperBase.pack_gains-733"><span class="linenos">733</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKd_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-734"><a href="#StepperBase.pack_gains-734"><span class="linenos">734</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vLPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-735"><a href="#StepperBase.pack_gains-735"><span class="linenos">735</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vKi_limit&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-736"><a href="#StepperBase.pack_gains-736"><span class="linenos">736</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vTe_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-737"><a href="#StepperBase.pack_gains-737"><span class="linenos">737</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_pos&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-738"><a href="#StepperBase.pack_gains-738"><span class="linenos">738</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;iMax_neg&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-739"><a href="#StepperBase.pack_gains-739"><span class="linenos">739</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;phase_advance_d&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-740"><a href="#StepperBase.pack_gains-740"><span class="linenos">740</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;pos_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-741"><a href="#StepperBase.pack_gains-741"><span class="linenos">741</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_near_setpoint_d&#39;</span><span class="p">]);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-742"><a href="#StepperBase.pack_gains-742"><span class="linenos">742</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;vel_status_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-743"><a href="#StepperBase.pack_gains-743"><span class="linenos">743</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;effort_LPF&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-744"><a href="#StepperBase.pack_gains-744"><span class="linenos">744</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_stiffness&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-745"><a href="#StepperBase.pack_gains-745"><span class="linenos">745</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;i_safety_feedforward&#39;</span><span class="p">]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_gains-746"><a href="#StepperBase.pack_gains-746"><span class="linenos">746</span></a>        <span class="n">config</span><span class="o">=</span><span class="mi">0</span>
</span><span id="StepperBase.pack_gains-747"><a href="#StepperBase.pack_gains-747"><span class="linenos">747</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;safety_hold&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-748"><a href="#StepperBase.pack_gains-748"><span class="linenos">748</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_SAFETY_HOLD</span>
</span><span id="StepperBase.pack_gains-749"><a href="#StepperBase.pack_gains-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_runstop&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-750"><a href="#StepperBase.pack_gains-750"><span class="linenos">750</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_RUNSTOP</span>
</span><span id="StepperBase.pack_gains-751"><a href="#StepperBase.pack_gains-751"><span class="linenos">751</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_sync_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-752"><a href="#StepperBase.pack_gains-752"><span class="linenos">752</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_SYNC_MODE</span>
</span><span id="StepperBase.pack_gains-753"><a href="#StepperBase.pack_gains-753"><span class="linenos">753</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_guarded_mode&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-754"><a href="#StepperBase.pack_gains-754"><span class="linenos">754</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_GUARDED_MODE</span>
</span><span id="StepperBase.pack_gains-755"><a href="#StepperBase.pack_gains-755"><span class="linenos">755</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_encoder_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-756"><a href="#StepperBase.pack_gains-756"><span class="linenos">756</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_ENCODER_POLARITY</span>
</span><span id="StepperBase.pack_gains-757"><a href="#StepperBase.pack_gains-757"><span class="linenos">757</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;flip_effort_polarity&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-758"><a href="#StepperBase.pack_gains-758"><span class="linenos">758</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_FLIP_EFFORT_POLARITY</span>
</span><span id="StepperBase.pack_gains-759"><a href="#StepperBase.pack_gains-759"><span class="linenos">759</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gains</span><span class="p">[</span><span class="s1">&#39;enable_vel_watchdog&#39;</span><span class="p">]:</span>
</span><span id="StepperBase.pack_gains-760"><a href="#StepperBase.pack_gains-760"><span class="linenos">760</span></a>            <span class="n">config</span><span class="o">=</span><span class="n">config</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONFIG_ENABLE_VEL_WATCHDOG</span>
</span><span id="StepperBase.pack_gains-761"><a href="#StepperBase.pack_gains-761"><span class="linenos">761</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="n">config</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="StepperBase.pack_gains-762"><a href="#StepperBase.pack_gains-762"><span class="linenos">762</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pack_trigger" class="classattr">
                                        <input id="StepperBase.pack_trigger-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_trigger</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_trigger-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_trigger"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_trigger-764"><a href="#StepperBase.pack_trigger-764"><span class="linenos">764</span></a>    <span class="k">def</span> <span class="nf">pack_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_trigger-765"><a href="#StepperBase.pack_trigger-765"><span class="linenos">765</span></a>        <span class="n">pack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span><span class="p">)</span>
</span><span id="StepperBase.pack_trigger-766"><a href="#StepperBase.pack_trigger-766"><span class="linenos">766</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_trigger-767"><a href="#StepperBase.pack_trigger-767"><span class="linenos">767</span></a>        <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_data</span><span class="p">)</span>
</span><span id="StepperBase.pack_trigger-768"><a href="#StepperBase.pack_trigger-768"><span class="linenos">768</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="StepperBase.pack_trigger-769"><a href="#StepperBase.pack_trigger-769"><span class="linenos">769</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pack_trajectory_segment" class="classattr">
                                        <input id="StepperBase.pack_trajectory_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_trajectory_segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pack_trajectory_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pack_trajectory_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pack_trajectory_segment-770"><a href="#StepperBase.pack_trajectory_segment-770"><span class="linenos">770</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="StepperBase.pack_trajectory_segment-771"><a href="#StepperBase.pack_trajectory_segment-771"><span class="linenos">771</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.pack_trajectory_segment-772"><a href="#StepperBase.pack_trajectory_segment-772"><span class="linenos">772</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_board_info_reply" class="classattr">
                                        <input id="StepperBase.rpc_board_info_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_board_info_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_board_info_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_board_info_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_board_info_reply-774"><a href="#StepperBase.rpc_board_info_reply-774"><span class="linenos">774</span></a>    <span class="k">def</span> <span class="nf">rpc_board_info_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_board_info_reply-775"><a href="#StepperBase.rpc_board_info_reply-775"><span class="linenos">775</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STEPPER_BOARD_INFO</span><span class="p">:</span>
</span><span id="StepperBase.rpc_board_info_reply-776"><a href="#StepperBase.rpc_board_info_reply-776"><span class="linenos">776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unpack_board_info</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase.rpc_board_info_reply-777"><a href="#StepperBase.rpc_board_info_reply-777"><span class="linenos">777</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.rpc_board_info_reply-778"><a href="#StepperBase.rpc_board_info_reply-778"><span class="linenos">778</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STEPPER_BOARD_INFO&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_gains_reply" class="classattr">
                                        <input id="StepperBase.rpc_gains_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_gains_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_gains_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_gains_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_gains_reply-780"><a href="#StepperBase.rpc_gains_reply-780"><span class="linenos">780</span></a>    <span class="k">def</span> <span class="nf">rpc_gains_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_gains_reply-781"><a href="#StepperBase.rpc_gains_reply-781"><span class="linenos">781</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_GAINS</span><span class="p">:</span>
</span><span id="StepperBase.rpc_gains_reply-782"><a href="#StepperBase.rpc_gains_reply-782"><span class="linenos">782</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_GAINS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_trigger_reply" class="classattr">
                                        <input id="StepperBase.rpc_trigger_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_trigger_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_trigger_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_trigger_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_trigger_reply-784"><a href="#StepperBase.rpc_trigger_reply-784"><span class="linenos">784</span></a>    <span class="k">def</span> <span class="nf">rpc_trigger_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_trigger_reply-785"><a href="#StepperBase.rpc_trigger_reply-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_TRIGGER</span><span class="p">:</span>
</span><span id="StepperBase.rpc_trigger_reply-786"><a href="#StepperBase.rpc_trigger_reply-786"><span class="linenos">786</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_SET_TRIGGER&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_command_reply" class="classattr">
                                        <input id="StepperBase.rpc_command_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_command_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_command_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_command_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_command_reply-788"><a href="#StepperBase.rpc_command_reply-788"><span class="linenos">788</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_command_reply-789"><a href="#StepperBase.rpc_command_reply-789"><span class="linenos">789</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="StepperBase.rpc_command_reply-790"><a href="#StepperBase.rpc_command_reply-790"><span class="linenos">790</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_motion_limits_reply" class="classattr">
                                        <input id="StepperBase.rpc_motion_limits_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_motion_limits_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_motion_limits_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_motion_limits_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_motion_limits_reply-792"><a href="#StepperBase.rpc_motion_limits_reply-792"><span class="linenos">792</span></a>    <span class="k">def</span> <span class="nf">rpc_motion_limits_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_motion_limits_reply-793"><a href="#StepperBase.rpc_motion_limits_reply-793"><span class="linenos">793</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MOTION_LIMITS</span><span class="p">:</span>
</span><span id="StepperBase.rpc_motion_limits_reply-794"><a href="#StepperBase.rpc_motion_limits_reply-794"><span class="linenos">794</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MOTION_LIMITS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_menu_on_reply" class="classattr">
                                        <input id="StepperBase.rpc_menu_on_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_menu_on_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_menu_on_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_menu_on_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_menu_on_reply-796"><a href="#StepperBase.rpc_menu_on_reply-796"><span class="linenos">796</span></a>    <span class="k">def</span> <span class="nf">rpc_menu_on_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_menu_on_reply-797"><a href="#StepperBase.rpc_menu_on_reply-797"><span class="linenos">797</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_MENU_ON</span><span class="p">:</span>
</span><span id="StepperBase.rpc_menu_on_reply-798"><a href="#StepperBase.rpc_menu_on_reply-798"><span class="linenos">798</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_MENU_ON&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_status_reply" class="classattr">
                                        <input id="StepperBase.rpc_status_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_status_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_status_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_status_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_status_reply-800"><a href="#StepperBase.rpc_status_reply-800"><span class="linenos">800</span></a>    <span class="k">def</span> <span class="nf">rpc_status_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_status_reply-801"><a href="#StepperBase.rpc_status_reply-801"><span class="linenos">801</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS</span><span class="p">:</span>
</span><span id="StepperBase.rpc_status_reply-802"><a href="#StepperBase.rpc_status_reply-802"><span class="linenos">802</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase.rpc_status_reply-803"><a href="#StepperBase.rpc_status_reply-803"><span class="linenos">803</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.rpc_status_reply-804"><a href="#StepperBase.rpc_status_reply-804"><span class="linenos">804</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_read_gains_from_flash_reply" class="classattr">
                                        <input id="StepperBase.rpc_read_gains_from_flash_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_read_gains_from_flash_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_read_gains_from_flash_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_read_gains_from_flash_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_read_gains_from_flash_reply-806"><a href="#StepperBase.rpc_read_gains_from_flash_reply-806"><span class="linenos">806</span></a>    <span class="k">def</span> <span class="nf">rpc_read_gains_from_flash_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-807"><a href="#StepperBase.rpc_read_gains_from_flash_reply-807"><span class="linenos">807</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_GAINS_FROM_FLASH</span><span class="p">:</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-808"><a href="#StepperBase.rpc_read_gains_from_flash_reply-808"><span class="linenos">808</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_gains</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-809"><a href="#StepperBase.rpc_read_gains_from_flash_reply-809"><span class="linenos">809</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StepperBase.rpc_read_gains_from_flash_reply-810"><a href="#StepperBase.rpc_read_gains_from_flash_reply-810"><span class="linenos">810</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_GAINS_FROM_FLASH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_start_new_traj_reply" class="classattr">
                                        <input id="StepperBase.rpc_start_new_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_start_new_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_start_new_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_start_new_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_start_new_traj_reply-813"><a href="#StepperBase.rpc_start_new_traj_reply-813"><span class="linenos">813</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_start_new_traj_reply-814"><a href="#StepperBase.rpc_start_new_traj_reply-814"><span class="linenos">814</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.rpc_start_new_traj_reply-815"><a href="#StepperBase.rpc_start_new_traj_reply-815"><span class="linenos">815</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_set_next_traj_seg_reply" class="classattr">
                                        <input id="StepperBase.rpc_set_next_traj_seg_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_set_next_traj_seg_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_set_next_traj_seg_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_set_next_traj_seg_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_set_next_traj_seg_reply-817"><a href="#StepperBase.rpc_set_next_traj_seg_reply-817"><span class="linenos">817</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_set_next_traj_seg_reply-818"><a href="#StepperBase.rpc_set_next_traj_seg_reply-818"><span class="linenos">818</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.rpc_set_next_traj_seg_reply-819"><a href="#StepperBase.rpc_set_next_traj_seg_reply-819"><span class="linenos">819</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_reset_traj_reply" class="classattr">
                                        <input id="StepperBase.rpc_reset_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_reset_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_reset_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_reset_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_reset_traj_reply-821"><a href="#StepperBase.rpc_reset_traj_reply-821"><span class="linenos">821</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_reset_traj_reply-822"><a href="#StepperBase.rpc_reset_traj_reply-822"><span class="linenos">822</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.rpc_reset_traj_reply-823"><a href="#StepperBase.rpc_reset_traj_reply-823"><span class="linenos">823</span></a>            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.rpc_read_firmware_trace_reply" class="classattr">
                                        <input id="StepperBase.rpc_read_firmware_trace_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_read_firmware_trace_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.rpc_read_firmware_trace_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.rpc_read_firmware_trace_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.rpc_read_firmware_trace_reply-826"><a href="#StepperBase.rpc_read_firmware_trace_reply-826"><span class="linenos">826</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="StepperBase.rpc_read_firmware_trace_reply-827"><a href="#StepperBase.rpc_read_firmware_trace_reply-827"><span class="linenos">827</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.rpc_read_firmware_trace_reply-828"><a href="#StepperBase.rpc_read_firmware_trace_reply-828"><span class="linenos">828</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.enable_firmware_trace" class="classattr">
                                        <input id="StepperBase.enable_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.enable_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.enable_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.enable_firmware_trace-830"><a href="#StepperBase.enable_firmware_trace-830"><span class="linenos">830</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.enable_firmware_trace-831"><a href="#StepperBase.enable_firmware_trace-831"><span class="linenos">831</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.enable_firmware_trace-832"><a href="#StepperBase.enable_firmware_trace-832"><span class="linenos">832</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.disable_firmware_trace" class="classattr">
                                        <input id="StepperBase.disable_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.disable_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.disable_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.disable_firmware_trace-834"><a href="#StepperBase.disable_firmware_trace-834"><span class="linenos">834</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.disable_firmware_trace-835"><a href="#StepperBase.disable_firmware_trace-835"><span class="linenos">835</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.disable_firmware_trace-836"><a href="#StepperBase.disable_firmware_trace-836"><span class="linenos">836</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="StepperBase.pull_status_aux" class="classattr">
                                        <input id="StepperBase.pull_status_aux-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_status_aux</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StepperBase.pull_status_aux-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StepperBase.pull_status_aux"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StepperBase.pull_status_aux-839"><a href="#StepperBase.pull_status_aux-839"><span class="linenos">839</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StepperBase.pull_status_aux-840"><a href="#StepperBase.pull_status_aux-840"><span class="linenos">840</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This method not supported for firmware on protocol </span><span class="si">{0}</span><span class="s1">.&#39;</span>
</span><span id="StepperBase.pull_status_aux-841"><a href="#StepperBase.pull_status_aux-841"><span class="linenos">841</span></a>                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="StepperBase.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="StepperBase.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="StepperBase.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="StepperBase.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="StepperBase.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="StepperBase.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="StepperBase.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="StepperBase.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="StepperBase.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="StepperBase.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="StepperBase.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="StepperBase.write_device_params" class="function"><a href="device.html#Device.write_device_params">write_device_params</a></dd>
                <dd id="StepperBase.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="StepperBase.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P0">
                            <input id="Stepper_Protocol_P0-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P0</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P0-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P0"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P0-845"><a href="#Stepper_Protocol_P0-845"><span class="linenos">845</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P0</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0-846"><a href="#Stepper_Protocol_P0-846"><span class="linenos">846</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0-847"><a href="#Stepper_Protocol_P0-847"><span class="linenos">847</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-848"><a href="#Stepper_Protocol_P0-848"><span class="linenos">848</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P0-849"><a href="#Stepper_Protocol_P0-849"><span class="linenos">849</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-850"><a href="#Stepper_Protocol_P0-850"><span class="linenos">850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-851"><a href="#Stepper_Protocol_P0-851"><span class="linenos">851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-852"><a href="#Stepper_Protocol_P0-852"><span class="linenos">852</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P0-853"><a href="#Stepper_Protocol_P0-853"><span class="linenos">853</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-854"><a href="#Stepper_Protocol_P0-854"><span class="linenos">854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-855"><a href="#Stepper_Protocol_P0-855"><span class="linenos">855</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-856"><a href="#Stepper_Protocol_P0-856"><span class="linenos">856</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-857"><a href="#Stepper_Protocol_P0-857"><span class="linenos">857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-858"><a href="#Stepper_Protocol_P0-858"><span class="linenos">858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0-859"><a href="#Stepper_Protocol_P0-859"><span class="linenos">859</span></a>
</span><span id="Stepper_Protocol_P0-860"><a href="#Stepper_Protocol_P0-860"><span class="linenos">860</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-861"><a href="#Stepper_Protocol_P0-861"><span class="linenos">861</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-862"><a href="#Stepper_Protocol_P0-862"><span class="linenos">862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-863"><a href="#Stepper_Protocol_P0-863"><span class="linenos">863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-864"><a href="#Stepper_Protocol_P0-864"><span class="linenos">864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-865"><a href="#Stepper_Protocol_P0-865"><span class="linenos">865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-866"><a href="#Stepper_Protocol_P0-866"><span class="linenos">866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-867"><a href="#Stepper_Protocol_P0-867"><span class="linenos">867</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-868"><a href="#Stepper_Protocol_P0-868"><span class="linenos">868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-869"><a href="#Stepper_Protocol_P0-869"><span class="linenos">869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-870"><a href="#Stepper_Protocol_P0-870"><span class="linenos">870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-871"><a href="#Stepper_Protocol_P0-871"><span class="linenos">871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0-872"><a href="#Stepper_Protocol_P0-872"><span class="linenos">872</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P0-873"><a href="#Stepper_Protocol_P0-873"><span class="linenos">873</span></a>
</span><span id="Stepper_Protocol_P0-874"><a href="#Stepper_Protocol_P0-874"><span class="linenos">874</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0-875"><a href="#Stepper_Protocol_P0-875"><span class="linenos">875</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P0-876"><a href="#Stepper_Protocol_P0-876"><span class="linenos">876</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P0-877"><a href="#Stepper_Protocol_P0-877"><span class="linenos">877</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-878"><a href="#Stepper_Protocol_P0-878"><span class="linenos">878</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-879"><a href="#Stepper_Protocol_P0-879"><span class="linenos">879</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-880"><a href="#Stepper_Protocol_P0-880"><span class="linenos">880</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-881"><a href="#Stepper_Protocol_P0-881"><span class="linenos">881</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-882"><a href="#Stepper_Protocol_P0-882"><span class="linenos">882</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-883"><a href="#Stepper_Protocol_P0-883"><span class="linenos">883</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-884"><a href="#Stepper_Protocol_P0-884"><span class="linenos">884</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-885"><a href="#Stepper_Protocol_P0-885"><span class="linenos">885</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-886"><a href="#Stepper_Protocol_P0-886"><span class="linenos">886</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-887"><a href="#Stepper_Protocol_P0-887"><span class="linenos">887</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0-888"><a href="#Stepper_Protocol_P0-888"><span class="linenos">888</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-889"><a href="#Stepper_Protocol_P0-889"><span class="linenos">889</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-890"><a href="#Stepper_Protocol_P0-890"><span class="linenos">890</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P0-891"><a href="#Stepper_Protocol_P0-891"><span class="linenos">891</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-892"><a href="#Stepper_Protocol_P0-892"><span class="linenos">892</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-893"><a href="#Stepper_Protocol_P0-893"><span class="linenos">893</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-894"><a href="#Stepper_Protocol_P0-894"><span class="linenos">894</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-895"><a href="#Stepper_Protocol_P0-895"><span class="linenos">895</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-896"><a href="#Stepper_Protocol_P0-896"><span class="linenos">896</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-897"><a href="#Stepper_Protocol_P0-897"><span class="linenos">897</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-898"><a href="#Stepper_Protocol_P0-898"><span class="linenos">898</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-899"><a href="#Stepper_Protocol_P0-899"><span class="linenos">899</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-900"><a href="#Stepper_Protocol_P0-900"><span class="linenos">900</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-901"><a href="#Stepper_Protocol_P0-901"><span class="linenos">901</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-902"><a href="#Stepper_Protocol_P0-902"><span class="linenos">902</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-903"><a href="#Stepper_Protocol_P0-903"><span class="linenos">903</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-904"><a href="#Stepper_Protocol_P0-904"><span class="linenos">904</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-905"><a href="#Stepper_Protocol_P0-905"><span class="linenos">905</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P0-906"><a href="#Stepper_Protocol_P0-906"><span class="linenos">906</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0-907"><a href="#Stepper_Protocol_P0-907"><span class="linenos">907</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P0.unpack_status" class="classattr">
                                        <input id="Stepper_Protocol_P0.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P0.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P0.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P0.unpack_status-846"><a href="#Stepper_Protocol_P0.unpack_status-846"><span class="linenos">846</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0.unpack_status-847"><a href="#Stepper_Protocol_P0.unpack_status-847"><span class="linenos">847</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-848"><a href="#Stepper_Protocol_P0.unpack_status-848"><span class="linenos">848</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P0.unpack_status-849"><a href="#Stepper_Protocol_P0.unpack_status-849"><span class="linenos">849</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-850"><a href="#Stepper_Protocol_P0.unpack_status-850"><span class="linenos">850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.unpack_status-851"><a href="#Stepper_Protocol_P0.unpack_status-851"><span class="linenos">851</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.unpack_status-852"><a href="#Stepper_Protocol_P0.unpack_status-852"><span class="linenos">852</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P0.unpack_status-853"><a href="#Stepper_Protocol_P0.unpack_status-853"><span class="linenos">853</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-854"><a href="#Stepper_Protocol_P0.unpack_status-854"><span class="linenos">854</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-855"><a href="#Stepper_Protocol_P0.unpack_status-855"><span class="linenos">855</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-856"><a href="#Stepper_Protocol_P0.unpack_status-856"><span class="linenos">856</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-857"><a href="#Stepper_Protocol_P0.unpack_status-857"><span class="linenos">857</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-858"><a href="#Stepper_Protocol_P0.unpack_status-858"><span class="linenos">858</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P0.unpack_status-859"><a href="#Stepper_Protocol_P0.unpack_status-859"><span class="linenos">859</span></a>
</span><span id="Stepper_Protocol_P0.unpack_status-860"><a href="#Stepper_Protocol_P0.unpack_status-860"><span class="linenos">860</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-861"><a href="#Stepper_Protocol_P0.unpack_status-861"><span class="linenos">861</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-862"><a href="#Stepper_Protocol_P0.unpack_status-862"><span class="linenos">862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-863"><a href="#Stepper_Protocol_P0.unpack_status-863"><span class="linenos">863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-864"><a href="#Stepper_Protocol_P0.unpack_status-864"><span class="linenos">864</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-865"><a href="#Stepper_Protocol_P0.unpack_status-865"><span class="linenos">865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-866"><a href="#Stepper_Protocol_P0.unpack_status-866"><span class="linenos">866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-867"><a href="#Stepper_Protocol_P0.unpack_status-867"><span class="linenos">867</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-868"><a href="#Stepper_Protocol_P0.unpack_status-868"><span class="linenos">868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-869"><a href="#Stepper_Protocol_P0.unpack_status-869"><span class="linenos">869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-870"><a href="#Stepper_Protocol_P0.unpack_status-870"><span class="linenos">870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-871"><a href="#Stepper_Protocol_P0.unpack_status-871"><span class="linenos">871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P0.unpack_status-872"><a href="#Stepper_Protocol_P0.unpack_status-872"><span class="linenos">872</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P0.pretty_print" class="classattr">
                                        <input id="Stepper_Protocol_P0.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P0.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P0.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P0.pretty_print-874"><a href="#Stepper_Protocol_P0.pretty_print-874"><span class="linenos">874</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P0.pretty_print-875"><a href="#Stepper_Protocol_P0.pretty_print-875"><span class="linenos">875</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P0.pretty_print-876"><a href="#Stepper_Protocol_P0.pretty_print-876"><span class="linenos">876</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-877"><a href="#Stepper_Protocol_P0.pretty_print-877"><span class="linenos">877</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-878"><a href="#Stepper_Protocol_P0.pretty_print-878"><span class="linenos">878</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-879"><a href="#Stepper_Protocol_P0.pretty_print-879"><span class="linenos">879</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-880"><a href="#Stepper_Protocol_P0.pretty_print-880"><span class="linenos">880</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-881"><a href="#Stepper_Protocol_P0.pretty_print-881"><span class="linenos">881</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-882"><a href="#Stepper_Protocol_P0.pretty_print-882"><span class="linenos">882</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-883"><a href="#Stepper_Protocol_P0.pretty_print-883"><span class="linenos">883</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-884"><a href="#Stepper_Protocol_P0.pretty_print-884"><span class="linenos">884</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-885"><a href="#Stepper_Protocol_P0.pretty_print-885"><span class="linenos">885</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-886"><a href="#Stepper_Protocol_P0.pretty_print-886"><span class="linenos">886</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-887"><a href="#Stepper_Protocol_P0.pretty_print-887"><span class="linenos">887</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-888"><a href="#Stepper_Protocol_P0.pretty_print-888"><span class="linenos">888</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-889"><a href="#Stepper_Protocol_P0.pretty_print-889"><span class="linenos">889</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-890"><a href="#Stepper_Protocol_P0.pretty_print-890"><span class="linenos">890</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P0.pretty_print-891"><a href="#Stepper_Protocol_P0.pretty_print-891"><span class="linenos">891</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-892"><a href="#Stepper_Protocol_P0.pretty_print-892"><span class="linenos">892</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-893"><a href="#Stepper_Protocol_P0.pretty_print-893"><span class="linenos">893</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-894"><a href="#Stepper_Protocol_P0.pretty_print-894"><span class="linenos">894</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-895"><a href="#Stepper_Protocol_P0.pretty_print-895"><span class="linenos">895</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-896"><a href="#Stepper_Protocol_P0.pretty_print-896"><span class="linenos">896</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-897"><a href="#Stepper_Protocol_P0.pretty_print-897"><span class="linenos">897</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-898"><a href="#Stepper_Protocol_P0.pretty_print-898"><span class="linenos">898</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-899"><a href="#Stepper_Protocol_P0.pretty_print-899"><span class="linenos">899</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-900"><a href="#Stepper_Protocol_P0.pretty_print-900"><span class="linenos">900</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-901"><a href="#Stepper_Protocol_P0.pretty_print-901"><span class="linenos">901</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-902"><a href="#Stepper_Protocol_P0.pretty_print-902"><span class="linenos">902</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-903"><a href="#Stepper_Protocol_P0.pretty_print-903"><span class="linenos">903</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-904"><a href="#Stepper_Protocol_P0.pretty_print-904"><span class="linenos">904</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-905"><a href="#Stepper_Protocol_P0.pretty_print-905"><span class="linenos">905</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-906"><a href="#Stepper_Protocol_P0.pretty_print-906"><span class="linenos">906</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P0.pretty_print-907"><a href="#Stepper_Protocol_P0.pretty_print-907"><span class="linenos">907</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P0.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_COMMAND" class="variable"><a href="#StepperBase.RPC_SET_COMMAND">RPC_SET_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_COMMAND" class="variable"><a href="#StepperBase.RPC_REPLY_COMMAND">RPC_REPLY_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_GET_STATUS" class="variable"><a href="#StepperBase.RPC_GET_STATUS">RPC_GET_STATUS</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_STATUS" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS">RPC_REPLY_STATUS</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_GAINS" class="variable"><a href="#StepperBase.RPC_SET_GAINS">RPC_SET_GAINS</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_GAINS" class="variable"><a href="#StepperBase.RPC_REPLY_GAINS">RPC_REPLY_GAINS</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PUSH">RPC_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH">RPC_REPLY_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_SET_TRIGGER">RPC_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_REPLY_SET_TRIGGER">RPC_REPLY_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_SET_ENC_CALIB">RPC_SET_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_REPLY_ENC_CALIB">RPC_REPLY_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_READ_GAINS_FROM_FLASH">RPC_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH">RPC_REPLY_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_MENU_ON" class="variable"><a href="#StepperBase.RPC_SET_MENU_ON">RPC_SET_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_MENU_ON" class="variable"><a href="#StepperBase.RPC_REPLY_MENU_ON">RPC_REPLY_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_GET_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO">RPC_GET_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO">RPC_REPLY_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_SET_MOTION_LIMITS">RPC_SET_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_REPLY_MOTION_LIMITS">RPC_REPLY_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG">RPC_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_START_NEW_TRAJECTORY">RPC_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY">RPC_REPLY_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_RESET_TRAJECTORY">RPC_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY">RPC_REPLY_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_READ_TRACE" class="variable"><a href="#StepperBase.RPC_READ_TRACE">RPC_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_READ_TRACE" class="variable"><a href="#StepperBase.RPC_REPLY_READ_TRACE">RPC_REPLY_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_GET_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_GET_STATUS_AUX">RPC_GET_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS_AUX">RPC_REPLY_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PULL">RPC_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P0.RPC_REPLY_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL">RPC_REPLY_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_SAFETY" class="variable"><a href="#StepperBase.MODE_SAFETY">MODE_SAFETY</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_FREEWHEEL" class="variable"><a href="#StepperBase.MODE_FREEWHEEL">MODE_FREEWHEEL</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_HOLD" class="variable"><a href="#StepperBase.MODE_HOLD">MODE_HOLD</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_POS_PID" class="variable"><a href="#StepperBase.MODE_POS_PID">MODE_POS_PID</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_VEL_PID" class="variable"><a href="#StepperBase.MODE_VEL_PID">MODE_VEL_PID</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_POS_TRAJ" class="variable"><a href="#StepperBase.MODE_POS_TRAJ">MODE_POS_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_VEL_TRAJ" class="variable"><a href="#StepperBase.MODE_VEL_TRAJ">MODE_VEL_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_CURRENT" class="variable"><a href="#StepperBase.MODE_CURRENT">MODE_CURRENT</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_POS_TRAJ_INCR" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_INCR">MODE_POS_TRAJ_INCR</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_POS_TRAJ_WAYPOINT" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_WAYPOINT">MODE_POS_TRAJ_WAYPOINT</a></dd>
                <dd id="Stepper_Protocol_P0.MODE_NAMES" class="variable"><a href="#StepperBase.MODE_NAMES">MODE_NAMES</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_POS_CALIBRATED" class="variable"><a href="#StepperBase.DIAG_POS_CALIBRATED">DIAG_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_RUNSTOP_ON" class="variable"><a href="#StepperBase.DIAG_RUNSTOP_ON">DIAG_RUNSTOP_ON</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_NEAR_POS_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_POS_SETPOINT">DIAG_NEAR_POS_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_NEAR_VEL_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_VEL_SETPOINT">DIAG_NEAR_VEL_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IS_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MOVING">DIAG_IS_MOVING</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_AT_CURRENT_LIMIT" class="variable"><a href="#StepperBase.DIAG_AT_CURRENT_LIMIT">DIAG_AT_CURRENT_LIMIT</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IS_MG_ACCELERATING" class="variable"><a href="#StepperBase.DIAG_IS_MG_ACCELERATING">DIAG_IS_MG_ACCELERATING</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IS_MG_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MG_MOVING">DIAG_IS_MG_MOVING</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_CALIBRATION_RCVD" class="variable"><a href="#StepperBase.DIAG_CALIBRATION_RCVD">DIAG_CALIBRATION_RCVD</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IN_GUARDED_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_GUARDED_EVENT">DIAG_IN_GUARDED_EVENT</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IN_SAFETY_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_SAFETY_EVENT">DIAG_IN_SAFETY_EVENT</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_WAITING_ON_SYNC">DIAG_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_TRAJ_ACTIVE" class="variable"><a href="#StepperBase.DIAG_TRAJ_ACTIVE">DIAG_TRAJ_ACTIVE</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_TRAJ_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC">DIAG_TRAJ_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IN_SYNC_MODE" class="variable"><a href="#StepperBase.DIAG_IN_SYNC_MODE">DIAG_IN_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P0.DIAG_IS_TRACE_ON" class="variable"><a href="#StepperBase.DIAG_IS_TRACE_ON">DIAG_IS_TRACE_ON</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_SAFETY_HOLD" class="variable"><a href="#StepperBase.CONFIG_SAFETY_HOLD">CONFIG_SAFETY_HOLD</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_ENABLE_RUNSTOP" class="variable"><a href="#StepperBase.CONFIG_ENABLE_RUNSTOP">CONFIG_ENABLE_RUNSTOP</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_ENABLE_SYNC_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_SYNC_MODE">CONFIG_ENABLE_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_ENABLE_GUARDED_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE">CONFIG_ENABLE_GUARDED_MODE</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_FLIP_ENCODER_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY">CONFIG_FLIP_ENCODER_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_FLIP_EFFORT_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY">CONFIG_FLIP_EFFORT_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P0.CONFIG_ENABLE_VEL_WATCHDOG" class="variable"><a href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG">CONFIG_ENABLE_VEL_WATCHDOG</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_MARK_POS" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS">TRIGGER_MARK_POS</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_RESET_MOTION_GEN" class="variable"><a href="#StepperBase.TRIGGER_RESET_MOTION_GEN">TRIGGER_RESET_MOTION_GEN</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_BOARD_RESET" class="variable"><a href="#StepperBase.TRIGGER_BOARD_RESET">TRIGGER_BOARD_RESET</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_WRITE_GAINS_TO_FLASH" class="variable"><a href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH">TRIGGER_WRITE_GAINS_TO_FLASH</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_RESET_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED">TRIGGER_RESET_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_POS_CALIBRATED">TRIGGER_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_MARK_POS_ON_CONTACT" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT">TRIGGER_MARK_POS_ON_CONTACT</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_ENABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_ENABLE_TRACE">TRIGGER_ENABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P0.TRIGGER_DISABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_DISABLE_TRACE">TRIGGER_DISABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P0.TRACE_TYPE_STATUS" class="variable"><a href="#StepperBase.TRACE_TYPE_STATUS">TRACE_TYPE_STATUS</a></dd>
                <dd id="Stepper_Protocol_P0.TRACE_TYPE_DEBUG" class="variable"><a href="#StepperBase.TRACE_TYPE_DEBUG">TRACE_TYPE_DEBUG</a></dd>
                <dd id="Stepper_Protocol_P0.TRACE_TYPE_PRINT" class="variable"><a href="#StepperBase.TRACE_TYPE_PRINT">TRACE_TYPE_PRINT</a></dd>
                <dd id="Stepper_Protocol_P0.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P0.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P0.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P0.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P0.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P0.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P0.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P0.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P0.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P0.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P0.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P0.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P0.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P0.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P0.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P0.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P0.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P0.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P0.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P0.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P0.push_load_test" class="function"><a href="#StepperBase.push_load_test">push_load_test</a></dd>
                <dd id="Stepper_Protocol_P0.pull_load_test" class="function"><a href="#StepperBase.pull_load_test">pull_load_test</a></dd>
                <dd id="Stepper_Protocol_P0.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P0.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P0.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P0.write_gains_to_YAML" class="function"><a href="#StepperBase.write_gains_to_YAML">write_gains_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P0.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P0.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P0.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P0.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P0.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P0.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P0.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P0.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P0.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P0.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P0.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P0.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_traj_waypoint" class="function"><a href="#StepperBase.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a></dd>
                <dd id="Stepper_Protocol_P0.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P0.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P0.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P0.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P0.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P0.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P0.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P0.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P0.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P0.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P0.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P0.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P0.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P0.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P0.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P0.current_to_torque" class="function"><a href="#StepperBase.current_to_torque">current_to_torque</a></dd>
                <dd id="Stepper_Protocol_P0.torque_to_current" class="function"><a href="#StepperBase.torque_to_current">torque_to_current</a></dd>
                <dd id="Stepper_Protocol_P0.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P0.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P0.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P0.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P0.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P0.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P0.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P0.start_waypoint_trajectory" class="function"><a href="#StepperBase.start_waypoint_trajectory">start_waypoint_trajectory</a></dd>
                <dd id="Stepper_Protocol_P0.set_next_trajectory_segment" class="function"><a href="#StepperBase.set_next_trajectory_segment">set_next_trajectory_segment</a></dd>
                <dd id="Stepper_Protocol_P0.stop_waypoint_trajectory" class="function"><a href="#StepperBase.stop_waypoint_trajectory">stop_waypoint_trajectory</a></dd>
                <dd id="Stepper_Protocol_P0.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P0.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P0.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P0.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P0.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P0.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P0.pack_trajectory_segment" class="function"><a href="#StepperBase.pack_trajectory_segment">pack_trajectory_segment</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_start_new_traj_reply" class="function"><a href="#StepperBase.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_set_next_traj_seg_reply" class="function"><a href="#StepperBase.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_reset_traj_reply" class="function"><a href="#StepperBase.rpc_reset_traj_reply">rpc_reset_traj_reply</a></dd>
                <dd id="Stepper_Protocol_P0.rpc_read_firmware_trace_reply" class="function"><a href="#StepperBase.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a></dd>
                <dd id="Stepper_Protocol_P0.enable_firmware_trace" class="function"><a href="#StepperBase.enable_firmware_trace">enable_firmware_trace</a></dd>
                <dd id="Stepper_Protocol_P0.disable_firmware_trace" class="function"><a href="#StepperBase.disable_firmware_trace">disable_firmware_trace</a></dd>
                <dd id="Stepper_Protocol_P0.pull_status_aux" class="function"><a href="#StepperBase.pull_status_aux">pull_status_aux</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P0.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P0.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P0.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P0.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P0.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P0.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P0.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P0.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P0.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P0.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P0.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P0.write_device_params" class="function"><a href="device.html#Device.write_device_params">write_device_params</a></dd>
                <dd id="Stepper_Protocol_P0.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P0.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P1">
                            <input id="Stepper_Protocol_P1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P1</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1-910"><a href="#Stepper_Protocol_P1-910"><span class="linenos"> 910</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P1</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-911"><a href="#Stepper_Protocol_P1-911"><span class="linenos"> 911</span></a>
</span><span id="Stepper_Protocol_P1-912"><a href="#Stepper_Protocol_P1-912"><span class="linenos"> 912</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-913"><a href="#Stepper_Protocol_P1-913"><span class="linenos"> 913</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-914"><a href="#Stepper_Protocol_P1-914"><span class="linenos"> 914</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P1-915"><a href="#Stepper_Protocol_P1-915"><span class="linenos"> 915</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-916"><a href="#Stepper_Protocol_P1-916"><span class="linenos"> 916</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-917"><a href="#Stepper_Protocol_P1-917"><span class="linenos"> 917</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-918"><a href="#Stepper_Protocol_P1-918"><span class="linenos"> 918</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-919"><a href="#Stepper_Protocol_P1-919"><span class="linenos"> 919</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-920"><a href="#Stepper_Protocol_P1-920"><span class="linenos"> 920</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P1-921"><a href="#Stepper_Protocol_P1-921"><span class="linenos"> 921</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-922"><a href="#Stepper_Protocol_P1-922"><span class="linenos"> 922</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-923"><a href="#Stepper_Protocol_P1-923"><span class="linenos"> 923</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-924"><a href="#Stepper_Protocol_P1-924"><span class="linenos"> 924</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P1-925"><a href="#Stepper_Protocol_P1-925"><span class="linenos"> 925</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-926"><a href="#Stepper_Protocol_P1-926"><span class="linenos"> 926</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-927"><a href="#Stepper_Protocol_P1-927"><span class="linenos"> 927</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-928"><a href="#Stepper_Protocol_P1-928"><span class="linenos"> 928</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P1-929"><a href="#Stepper_Protocol_P1-929"><span class="linenos"> 929</span></a>
</span><span id="Stepper_Protocol_P1-930"><a href="#Stepper_Protocol_P1-930"><span class="linenos"> 930</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-931"><a href="#Stepper_Protocol_P1-931"><span class="linenos"> 931</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-932"><a href="#Stepper_Protocol_P1-932"><span class="linenos"> 932</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-933"><a href="#Stepper_Protocol_P1-933"><span class="linenos"> 933</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-934"><a href="#Stepper_Protocol_P1-934"><span class="linenos"> 934</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-935"><a href="#Stepper_Protocol_P1-935"><span class="linenos"> 935</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-936"><a href="#Stepper_Protocol_P1-936"><span class="linenos"> 936</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-937"><a href="#Stepper_Protocol_P1-937"><span class="linenos"> 937</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-938"><a href="#Stepper_Protocol_P1-938"><span class="linenos"> 938</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-939"><a href="#Stepper_Protocol_P1-939"><span class="linenos"> 939</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-940"><a href="#Stepper_Protocol_P1-940"><span class="linenos"> 940</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-941"><a href="#Stepper_Protocol_P1-941"><span class="linenos"> 941</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-942"><a href="#Stepper_Protocol_P1-942"><span class="linenos"> 942</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1-943"><a href="#Stepper_Protocol_P1-943"><span class="linenos"> 943</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-944"><a href="#Stepper_Protocol_P1-944"><span class="linenos"> 944</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P1-945"><a href="#Stepper_Protocol_P1-945"><span class="linenos"> 945</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-946"><a href="#Stepper_Protocol_P1-946"><span class="linenos"> 946</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P1-947"><a href="#Stepper_Protocol_P1-947"><span class="linenos"> 947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-948"><a href="#Stepper_Protocol_P1-948"><span class="linenos"> 948</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P1-949"><a href="#Stepper_Protocol_P1-949"><span class="linenos"> 949</span></a>
</span><span id="Stepper_Protocol_P1-950"><a href="#Stepper_Protocol_P1-950"><span class="linenos"> 950</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P1-951"><a href="#Stepper_Protocol_P1-951"><span class="linenos"> 951</span></a>
</span><span id="Stepper_Protocol_P1-952"><a href="#Stepper_Protocol_P1-952"><span class="linenos"> 952</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-953"><a href="#Stepper_Protocol_P1-953"><span class="linenos"> 953</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-954"><a href="#Stepper_Protocol_P1-954"><span class="linenos"> 954</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P1-955"><a href="#Stepper_Protocol_P1-955"><span class="linenos"> 955</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-956"><a href="#Stepper_Protocol_P1-956"><span class="linenos"> 956</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-957"><a href="#Stepper_Protocol_P1-957"><span class="linenos"> 957</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-958"><a href="#Stepper_Protocol_P1-958"><span class="linenos"> 958</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-959"><a href="#Stepper_Protocol_P1-959"><span class="linenos"> 959</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-960"><a href="#Stepper_Protocol_P1-960"><span class="linenos"> 960</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-961"><a href="#Stepper_Protocol_P1-961"><span class="linenos"> 961</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-962"><a href="#Stepper_Protocol_P1-962"><span class="linenos"> 962</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-963"><a href="#Stepper_Protocol_P1-963"><span class="linenos"> 963</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-964"><a href="#Stepper_Protocol_P1-964"><span class="linenos"> 964</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-965"><a href="#Stepper_Protocol_P1-965"><span class="linenos"> 965</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-966"><a href="#Stepper_Protocol_P1-966"><span class="linenos"> 966</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-967"><a href="#Stepper_Protocol_P1-967"><span class="linenos"> 967</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-968"><a href="#Stepper_Protocol_P1-968"><span class="linenos"> 968</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P1-969"><a href="#Stepper_Protocol_P1-969"><span class="linenos"> 969</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-970"><a href="#Stepper_Protocol_P1-970"><span class="linenos"> 970</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-971"><a href="#Stepper_Protocol_P1-971"><span class="linenos"> 971</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-972"><a href="#Stepper_Protocol_P1-972"><span class="linenos"> 972</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-973"><a href="#Stepper_Protocol_P1-973"><span class="linenos"> 973</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-974"><a href="#Stepper_Protocol_P1-974"><span class="linenos"> 974</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-975"><a href="#Stepper_Protocol_P1-975"><span class="linenos"> 975</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-976"><a href="#Stepper_Protocol_P1-976"><span class="linenos"> 976</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-977"><a href="#Stepper_Protocol_P1-977"><span class="linenos"> 977</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-978"><a href="#Stepper_Protocol_P1-978"><span class="linenos"> 978</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-979"><a href="#Stepper_Protocol_P1-979"><span class="linenos"> 979</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-980"><a href="#Stepper_Protocol_P1-980"><span class="linenos"> 980</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-981"><a href="#Stepper_Protocol_P1-981"><span class="linenos"> 981</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-982"><a href="#Stepper_Protocol_P1-982"><span class="linenos"> 982</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Trace recording:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-983"><a href="#Stepper_Protocol_P1-983"><span class="linenos"> 983</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waypoint Trajectory&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-984"><a href="#Stepper_Protocol_P1-984"><span class="linenos"> 984</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       State:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-985"><a href="#Stepper_Protocol_P1-985"><span class="linenos"> 985</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Setpoint: (rad) </span><span class="si">%s</span><span class="s1"> | (deg) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">],</span>  <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">])))</span>
</span><span id="Stepper_Protocol_P1-986"><a href="#Stepper_Protocol_P1-986"><span class="linenos"> 986</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Segment ID:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-987"><a href="#Stepper_Protocol_P1-987"><span class="linenos"> 987</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-988"><a href="#Stepper_Protocol_P1-988"><span class="linenos"> 988</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P1-989"><a href="#Stepper_Protocol_P1-989"><span class="linenos"> 989</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-990"><a href="#Stepper_Protocol_P1-990"><span class="linenos"> 990</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-991"><a href="#Stepper_Protocol_P1-991"><span class="linenos"> 991</span></a>
</span><span id="Stepper_Protocol_P1-992"><a href="#Stepper_Protocol_P1-992"><span class="linenos"> 992</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-993"><a href="#Stepper_Protocol_P1-993"><span class="linenos"> 993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-994"><a href="#Stepper_Protocol_P1-994"><span class="linenos"> 994</span></a>
</span><span id="Stepper_Protocol_P1-995"><a href="#Stepper_Protocol_P1-995"><span class="linenos"> 995</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-996"><a href="#Stepper_Protocol_P1-996"><span class="linenos"> 996</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts execution of a waypoint trajectory on hardware</span>
</span><span id="Stepper_Protocol_P1-997"><a href="#Stepper_Protocol_P1-997"><span class="linenos"> 997</span></a>
</span><span id="Stepper_Protocol_P1-998"><a href="#Stepper_Protocol_P1-998"><span class="linenos"> 998</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-999"><a href="#Stepper_Protocol_P1-999"><span class="linenos"> 999</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1000"><a href="#Stepper_Protocol_P1-1000"><span class="linenos">1000</span></a><span class="sd">        first_segment : list</span>
</span><span id="Stepper_Protocol_P1-1001"><a href="#Stepper_Protocol_P1-1001"><span class="linenos">1001</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1-1002"><a href="#Stepper_Protocol_P1-1002"><span class="linenos">1002</span></a><span class="sd">            The hardware begins executing this first segment of a spline. The segment&#39;s duration and</span>
</span><span id="Stepper_Protocol_P1-1003"><a href="#Stepper_Protocol_P1-1003"><span class="linenos">1003</span></a><span class="sd">            six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always</span>
</span><span id="Stepper_Protocol_P1-1004"><a href="#Stepper_Protocol_P1-1004"><span class="linenos">1004</span></a><span class="sd">            2 for the first segment, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1-1005"><a href="#Stepper_Protocol_P1-1005"><span class="linenos">1005</span></a>
</span><span id="Stepper_Protocol_P1-1006"><a href="#Stepper_Protocol_P1-1006"><span class="linenos">1006</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1-1007"><a href="#Stepper_Protocol_P1-1007"><span class="linenos">1007</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1-1008"><a href="#Stepper_Protocol_P1-1008"><span class="linenos">1008</span></a><span class="sd">        bool</span>
</span><span id="Stepper_Protocol_P1-1009"><a href="#Stepper_Protocol_P1-1009"><span class="linenos">1009</span></a><span class="sd">            True if uC successfully initiated a new trajectory</span>
</span><span id="Stepper_Protocol_P1-1010"><a href="#Stepper_Protocol_P1-1010"><span class="linenos">1010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1011"><a href="#Stepper_Protocol_P1-1011"><span class="linenos">1011</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1012"><a href="#Stepper_Protocol_P1-1012"><span class="linenos">1012</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1013"><a href="#Stepper_Protocol_P1-1013"><span class="linenos">1013</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1-1014"><a href="#Stepper_Protocol_P1-1014"><span class="linenos">1014</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">first_segment</span>
</span><span id="Stepper_Protocol_P1-1015"><a href="#Stepper_Protocol_P1-1015"><span class="linenos">1015</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1-1016"><a href="#Stepper_Protocol_P1-1016"><span class="linenos">1016</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1017"><a href="#Stepper_Protocol_P1-1017"><span class="linenos">1017</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1-1018"><a href="#Stepper_Protocol_P1-1018"><span class="linenos">1018</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_START_NEW_TRAJECTORY</span>
</span><span id="Stepper_Protocol_P1-1019"><a href="#Stepper_Protocol_P1-1019"><span class="linenos">1019</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1020"><a href="#Stepper_Protocol_P1-1020"><span class="linenos">1020</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start_new_traj_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1021"><a href="#Stepper_Protocol_P1-1021"><span class="linenos">1021</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1022"><a href="#Stepper_Protocol_P1-1022"><span class="linenos">1022</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1-1023"><a href="#Stepper_Protocol_P1-1023"><span class="linenos">1023</span></a>        <span class="c1"># return self._waypoint_traj_start_success</span>
</span><span id="Stepper_Protocol_P1-1024"><a href="#Stepper_Protocol_P1-1024"><span class="linenos">1024</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span>
</span><span id="Stepper_Protocol_P1-1025"><a href="#Stepper_Protocol_P1-1025"><span class="linenos">1025</span></a>
</span><span id="Stepper_Protocol_P1-1026"><a href="#Stepper_Protocol_P1-1026"><span class="linenos">1026</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1027"><a href="#Stepper_Protocol_P1-1027"><span class="linenos">1027</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the next segment for the hardware to execute</span>
</span><span id="Stepper_Protocol_P1-1028"><a href="#Stepper_Protocol_P1-1028"><span class="linenos">1028</span></a>
</span><span id="Stepper_Protocol_P1-1029"><a href="#Stepper_Protocol_P1-1029"><span class="linenos">1029</span></a><span class="sd">        This method is generally called multiple times while the prior segment is executing. This</span>
</span><span id="Stepper_Protocol_P1-1030"><a href="#Stepper_Protocol_P1-1030"><span class="linenos">1030</span></a><span class="sd">        provides the hardware with the next segment to gracefully transition across the entire spline,</span>
</span><span id="Stepper_Protocol_P1-1031"><a href="#Stepper_Protocol_P1-1031"><span class="linenos">1031</span></a><span class="sd">        while allowing users to preempt or modify the future trajectory in real time.</span>
</span><span id="Stepper_Protocol_P1-1032"><a href="#Stepper_Protocol_P1-1032"><span class="linenos">1032</span></a>
</span><span id="Stepper_Protocol_P1-1033"><a href="#Stepper_Protocol_P1-1033"><span class="linenos">1033</span></a><span class="sd">        This method will return False if there is not already an segment executing on the uC</span>
</span><span id="Stepper_Protocol_P1-1034"><a href="#Stepper_Protocol_P1-1034"><span class="linenos">1034</span></a>
</span><span id="Stepper_Protocol_P1-1035"><a href="#Stepper_Protocol_P1-1035"><span class="linenos">1035</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1-1036"><a href="#Stepper_Protocol_P1-1036"><span class="linenos">1036</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1-1037"><a href="#Stepper_Protocol_P1-1037"><span class="linenos">1037</span></a><span class="sd">        next_segment : list</span>
</span><span id="Stepper_Protocol_P1-1038"><a href="#Stepper_Protocol_P1-1038"><span class="linenos">1038</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1-1039"><a href="#Stepper_Protocol_P1-1039"><span class="linenos">1039</span></a><span class="sd">            Duration and six coefficients fill the first seven elements of the list. Generally, the</span>
</span><span id="Stepper_Protocol_P1-1040"><a href="#Stepper_Protocol_P1-1040"><span class="linenos">1040</span></a><span class="sd">            coefficients are calculated to smoothly transition across a spline. The segment ID, always</span>
</span><span id="Stepper_Protocol_P1-1041"><a href="#Stepper_Protocol_P1-1041"><span class="linenos">1041</span></a><span class="sd">            1 higher than the prior segment&#39;s ID, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1-1042"><a href="#Stepper_Protocol_P1-1042"><span class="linenos">1042</span></a>
</span><span id="Stepper_Protocol_P1-1043"><a href="#Stepper_Protocol_P1-1043"><span class="linenos">1043</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1-1044"><a href="#Stepper_Protocol_P1-1044"><span class="linenos">1044</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1-1045"><a href="#Stepper_Protocol_P1-1045"><span class="linenos">1045</span></a><span class="sd">        bool</span>
</span><span id="Stepper_Protocol_P1-1046"><a href="#Stepper_Protocol_P1-1046"><span class="linenos">1046</span></a><span class="sd">            True if uC successfully queued next trajectory</span>
</span><span id="Stepper_Protocol_P1-1047"><a href="#Stepper_Protocol_P1-1047"><span class="linenos">1047</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1048"><a href="#Stepper_Protocol_P1-1048"><span class="linenos">1048</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1049"><a href="#Stepper_Protocol_P1-1049"><span class="linenos">1049</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1050"><a href="#Stepper_Protocol_P1-1050"><span class="linenos">1050</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1-1051"><a href="#Stepper_Protocol_P1-1051"><span class="linenos">1051</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">next_segment</span>
</span><span id="Stepper_Protocol_P1-1052"><a href="#Stepper_Protocol_P1-1052"><span class="linenos">1052</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1053"><a href="#Stepper_Protocol_P1-1053"><span class="linenos">1053</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1-1054"><a href="#Stepper_Protocol_P1-1054"><span class="linenos">1054</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span>
</span><span id="Stepper_Protocol_P1-1055"><a href="#Stepper_Protocol_P1-1055"><span class="linenos">1055</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1056"><a href="#Stepper_Protocol_P1-1056"><span class="linenos">1056</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_set_next_traj_seg_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1057"><a href="#Stepper_Protocol_P1-1057"><span class="linenos">1057</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1058"><a href="#Stepper_Protocol_P1-1058"><span class="linenos">1058</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1-1059"><a href="#Stepper_Protocol_P1-1059"><span class="linenos">1059</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span>
</span><span id="Stepper_Protocol_P1-1060"><a href="#Stepper_Protocol_P1-1060"><span class="linenos">1060</span></a>
</span><span id="Stepper_Protocol_P1-1061"><a href="#Stepper_Protocol_P1-1061"><span class="linenos">1061</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1062"><a href="#Stepper_Protocol_P1-1062"><span class="linenos">1062</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops execution of the waypoint trajectory running in hardware</span>
</span><span id="Stepper_Protocol_P1-1063"><a href="#Stepper_Protocol_P1-1063"><span class="linenos">1063</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1-1064"><a href="#Stepper_Protocol_P1-1064"><span class="linenos">1064</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Stepper_Protocol_P1-1065"><a href="#Stepper_Protocol_P1-1065"><span class="linenos">1065</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_RESET_TRAJECTORY</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1-1066"><a href="#Stepper_Protocol_P1-1066"><span class="linenos">1066</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_reset_traj_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1067"><a href="#Stepper_Protocol_P1-1067"><span class="linenos">1067</span></a>
</span><span id="Stepper_Protocol_P1-1068"><a href="#Stepper_Protocol_P1-1068"><span class="linenos">1068</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1069"><a href="#Stepper_Protocol_P1-1069"><span class="linenos">1069</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1070"><a href="#Stepper_Protocol_P1-1070"><span class="linenos">1070</span></a>            <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1-1071"><a href="#Stepper_Protocol_P1-1071"><span class="linenos">1071</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1-1072"><a href="#Stepper_Protocol_P1-1072"><span class="linenos">1072</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1-1073"><a href="#Stepper_Protocol_P1-1073"><span class="linenos">1073</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1074"><a href="#Stepper_Protocol_P1-1074"><span class="linenos">1074</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P1-1075"><a href="#Stepper_Protocol_P1-1075"><span class="linenos">1075</span></a>
</span><span id="Stepper_Protocol_P1-1076"><a href="#Stepper_Protocol_P1-1076"><span class="linenos">1076</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1077"><a href="#Stepper_Protocol_P1-1077"><span class="linenos">1077</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1078"><a href="#Stepper_Protocol_P1-1078"><span class="linenos">1078</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1079"><a href="#Stepper_Protocol_P1-1079"><span class="linenos">1079</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1-1080"><a href="#Stepper_Protocol_P1-1080"><span class="linenos">1080</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1081"><a href="#Stepper_Protocol_P1-1081"><span class="linenos">1081</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1082"><a href="#Stepper_Protocol_P1-1082"><span class="linenos">1082</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1-1083"><a href="#Stepper_Protocol_P1-1083"><span class="linenos">1083</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1084"><a href="#Stepper_Protocol_P1-1084"><span class="linenos">1084</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1085"><a href="#Stepper_Protocol_P1-1085"><span class="linenos">1085</span></a>
</span><span id="Stepper_Protocol_P1-1086"><a href="#Stepper_Protocol_P1-1086"><span class="linenos">1086</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1087"><a href="#Stepper_Protocol_P1-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1088"><a href="#Stepper_Protocol_P1-1088"><span class="linenos">1088</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1089"><a href="#Stepper_Protocol_P1-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1-1090"><a href="#Stepper_Protocol_P1-1090"><span class="linenos">1090</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1-1091"><a href="#Stepper_Protocol_P1-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1-1092"><a href="#Stepper_Protocol_P1-1092"><span class="linenos">1092</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1-1093"><a href="#Stepper_Protocol_P1-1093"><span class="linenos">1093</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1094"><a href="#Stepper_Protocol_P1-1094"><span class="linenos">1094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1-1095"><a href="#Stepper_Protocol_P1-1095"><span class="linenos">1095</span></a>
</span><span id="Stepper_Protocol_P1-1096"><a href="#Stepper_Protocol_P1-1096"><span class="linenos">1096</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1-1097"><a href="#Stepper_Protocol_P1-1097"><span class="linenos">1097</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_RESET_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1-1098"><a href="#Stepper_Protocol_P1-1098"><span class="linenos">1098</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_RESET_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P1.unpack_status" class="classattr">
                                        <input id="Stepper_Protocol_P1.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.unpack_status-912"><a href="#Stepper_Protocol_P1.unpack_status-912"><span class="linenos">912</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.unpack_status-913"><a href="#Stepper_Protocol_P1.unpack_status-913"><span class="linenos">913</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-914"><a href="#Stepper_Protocol_P1.unpack_status-914"><span class="linenos">914</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P1.unpack_status-915"><a href="#Stepper_Protocol_P1.unpack_status-915"><span class="linenos">915</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-916"><a href="#Stepper_Protocol_P1.unpack_status-916"><span class="linenos">916</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.unpack_status-917"><a href="#Stepper_Protocol_P1.unpack_status-917"><span class="linenos">917</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-918"><a href="#Stepper_Protocol_P1.unpack_status-918"><span class="linenos">918</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.unpack_status-919"><a href="#Stepper_Protocol_P1.unpack_status-919"><span class="linenos">919</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.unpack_status-920"><a href="#Stepper_Protocol_P1.unpack_status-920"><span class="linenos">920</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P1.unpack_status-921"><a href="#Stepper_Protocol_P1.unpack_status-921"><span class="linenos">921</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-922"><a href="#Stepper_Protocol_P1.unpack_status-922"><span class="linenos">922</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-923"><a href="#Stepper_Protocol_P1.unpack_status-923"><span class="linenos">923</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-924"><a href="#Stepper_Protocol_P1.unpack_status-924"><span class="linenos">924</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P1.unpack_status-925"><a href="#Stepper_Protocol_P1.unpack_status-925"><span class="linenos">925</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-926"><a href="#Stepper_Protocol_P1.unpack_status-926"><span class="linenos">926</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-927"><a href="#Stepper_Protocol_P1.unpack_status-927"><span class="linenos">927</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.unpack_status-928"><a href="#Stepper_Protocol_P1.unpack_status-928"><span class="linenos">928</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P1.unpack_status-929"><a href="#Stepper_Protocol_P1.unpack_status-929"><span class="linenos">929</span></a>
</span><span id="Stepper_Protocol_P1.unpack_status-930"><a href="#Stepper_Protocol_P1.unpack_status-930"><span class="linenos">930</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-931"><a href="#Stepper_Protocol_P1.unpack_status-931"><span class="linenos">931</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-932"><a href="#Stepper_Protocol_P1.unpack_status-932"><span class="linenos">932</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-933"><a href="#Stepper_Protocol_P1.unpack_status-933"><span class="linenos">933</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-934"><a href="#Stepper_Protocol_P1.unpack_status-934"><span class="linenos">934</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-935"><a href="#Stepper_Protocol_P1.unpack_status-935"><span class="linenos">935</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-936"><a href="#Stepper_Protocol_P1.unpack_status-936"><span class="linenos">936</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-937"><a href="#Stepper_Protocol_P1.unpack_status-937"><span class="linenos">937</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-938"><a href="#Stepper_Protocol_P1.unpack_status-938"><span class="linenos">938</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-939"><a href="#Stepper_Protocol_P1.unpack_status-939"><span class="linenos">939</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-940"><a href="#Stepper_Protocol_P1.unpack_status-940"><span class="linenos">940</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-941"><a href="#Stepper_Protocol_P1.unpack_status-941"><span class="linenos">941</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-942"><a href="#Stepper_Protocol_P1.unpack_status-942"><span class="linenos">942</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P1.unpack_status-943"><a href="#Stepper_Protocol_P1.unpack_status-943"><span class="linenos">943</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-944"><a href="#Stepper_Protocol_P1.unpack_status-944"><span class="linenos">944</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-945"><a href="#Stepper_Protocol_P1.unpack_status-945"><span class="linenos">945</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-946"><a href="#Stepper_Protocol_P1.unpack_status-946"><span class="linenos">946</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-947"><a href="#Stepper_Protocol_P1.unpack_status-947"><span class="linenos">947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.unpack_status-948"><a href="#Stepper_Protocol_P1.unpack_status-948"><span class="linenos">948</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P1.unpack_status-949"><a href="#Stepper_Protocol_P1.unpack_status-949"><span class="linenos">949</span></a>
</span><span id="Stepper_Protocol_P1.unpack_status-950"><a href="#Stepper_Protocol_P1.unpack_status-950"><span class="linenos">950</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P1.pretty_print" class="classattr">
                                        <input id="Stepper_Protocol_P1.pretty_print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretty_print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.pretty_print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.pretty_print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.pretty_print-952"><a href="#Stepper_Protocol_P1.pretty_print-952"><span class="linenos">952</span></a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.pretty_print-953"><a href="#Stepper_Protocol_P1.pretty_print-953"><span class="linenos">953</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.pretty_print-954"><a href="#Stepper_Protocol_P1.pretty_print-954"><span class="linenos">954</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MODE_NAMES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-955"><a href="#Stepper_Protocol_P1.pretty_print-955"><span class="linenos">955</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;x_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-956"><a href="#Stepper_Protocol_P1.pretty_print-956"><span class="linenos">956</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;v_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-957"><a href="#Stepper_Protocol_P1.pretty_print-957"><span class="linenos">957</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a_des (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;a_des&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-958"><a href="#Stepper_Protocol_P1.pretty_print-958"><span class="linenos">958</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stiffness&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;stiffness&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-959"><a href="#Stepper_Protocol_P1.pretty_print-959"><span class="linenos">959</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feedforward&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="s1">&#39;i_feedforward&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-960"><a href="#Stepper_Protocol_P1.pretty_print-960"><span class="linenos">960</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos (rad)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-961"><a href="#Stepper_Protocol_P1.pretty_print-961"><span class="linenos">961</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vel (rad/s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="s1">&#39;(deg)&#39;</span><span class="p">,</span><span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-962"><a href="#Stepper_Protocol_P1.pretty_print-962"><span class="linenos">962</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Ticks)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-963"><a href="#Stepper_Protocol_P1.pretty_print-963"><span class="linenos">963</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Effort (Pct)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-964"><a href="#Stepper_Protocol_P1.pretty_print-964"><span class="linenos">964</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current (A)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-965"><a href="#Stepper_Protocol_P1.pretty_print-965"><span class="linenos">965</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error (deg)&#39;</span><span class="p">,</span> <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-966"><a href="#Stepper_Protocol_P1.pretty_print-966"><span class="linenos">966</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-967"><a href="#Stepper_Protocol_P1.pretty_print-967"><span class="linenos">967</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guarded Events:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-968"><a href="#Stepper_Protocol_P1.pretty_print-968"><span class="linenos">968</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diag&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">],</span> <span class="s1">&#39;032b&#39;</span><span class="p">))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-969"><a href="#Stepper_Protocol_P1.pretty_print-969"><span class="linenos">969</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Position Calibrated:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-970"><a href="#Stepper_Protocol_P1.pretty_print-970"><span class="linenos">970</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Runstop on:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-971"><a href="#Stepper_Protocol_P1.pretty_print-971"><span class="linenos">971</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Pos Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-972"><a href="#Stepper_Protocol_P1.pretty_print-972"><span class="linenos">972</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Near Vel Setpoint:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-973"><a href="#Stepper_Protocol_P1.pretty_print-973"><span class="linenos">973</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-974"><a href="#Stepper_Protocol_P1.pretty_print-974"><span class="linenos">974</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is Moving Filtered:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_moving_filtered&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-975"><a href="#Stepper_Protocol_P1.pretty_print-975"><span class="linenos">975</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       At Current Limit:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-976"><a href="#Stepper_Protocol_P1.pretty_print-976"><span class="linenos">976</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Accelerating:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-977"><a href="#Stepper_Protocol_P1.pretty_print-977"><span class="linenos">977</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Is MG Moving:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-978"><a href="#Stepper_Protocol_P1.pretty_print-978"><span class="linenos">978</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Encoder Calibration in Flash:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-979"><a href="#Stepper_Protocol_P1.pretty_print-979"><span class="linenos">979</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Guarded Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-980"><a href="#Stepper_Protocol_P1.pretty_print-980"><span class="linenos">980</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       In Safety Event:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-981"><a href="#Stepper_Protocol_P1.pretty_print-981"><span class="linenos">981</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Waiting on Sync:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-982"><a href="#Stepper_Protocol_P1.pretty_print-982"><span class="linenos">982</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Trace recording:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-983"><a href="#Stepper_Protocol_P1.pretty_print-983"><span class="linenos">983</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waypoint Trajectory&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.pretty_print-984"><a href="#Stepper_Protocol_P1.pretty_print-984"><span class="linenos">984</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       State:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-985"><a href="#Stepper_Protocol_P1.pretty_print-985"><span class="linenos">985</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Setpoint: (rad) </span><span class="si">%s</span><span class="s1"> | (deg) </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">],</span>  <span class="n">rad_to_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">])))</span>
</span><span id="Stepper_Protocol_P1.pretty_print-986"><a href="#Stepper_Protocol_P1.pretty_print-986"><span class="linenos">986</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Segment ID:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-987"><a href="#Stepper_Protocol_P1.pretty_print-987"><span class="linenos">987</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-988"><a href="#Stepper_Protocol_P1.pretty_print-988"><span class="linenos">988</span></a>        <span class="c1">#print(&#39;Read error&#39;, self.transport.status[&#39;read_error&#39;])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-989"><a href="#Stepper_Protocol_P1.pretty_print-989"><span class="linenos">989</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Board variant:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;board_variant&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.pretty_print-990"><a href="#Stepper_Protocol_P1.pretty_print-990"><span class="linenos">990</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Firmware version:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;firmware_version&#39;</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P1.enable_pos_traj_waypoint" class="classattr">
                                        <input id="Stepper_Protocol_P1.enable_pos_traj_waypoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_pos_traj_waypoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.enable_pos_traj_waypoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.enable_pos_traj_waypoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.enable_pos_traj_waypoint-992"><a href="#Stepper_Protocol_P1.enable_pos_traj_waypoint-992"><span class="linenos">992</span></a>    <span class="k">def</span> <span class="nf">enable_pos_traj_waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.enable_pos_traj_waypoint-993"><a href="#Stepper_Protocol_P1.enable_pos_traj_waypoint-993"><span class="linenos">993</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_command</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MODE_POS_TRAJ_WAYPOINT</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P1.start_waypoint_trajectory" class="classattr">
                                        <input id="Stepper_Protocol_P1.start_waypoint_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_waypoint_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">first_segment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.start_waypoint_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.start_waypoint_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-995"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-995"><span class="linenos"> 995</span></a>    <span class="k">def</span> <span class="nf">start_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-996"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-996"><span class="linenos"> 996</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Starts execution of a waypoint trajectory on hardware</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-997"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-997"><span class="linenos"> 997</span></a>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-998"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-998"><span class="linenos"> 998</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-999"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-999"><span class="linenos"> 999</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1000"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1000"><span class="linenos">1000</span></a><span class="sd">        first_segment : list</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1001"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1001"><span class="linenos">1001</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1002"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1002"><span class="linenos">1002</span></a><span class="sd">            The hardware begins executing this first segment of a spline. The segment&#39;s duration and</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1003"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1003"><span class="linenos">1003</span></a><span class="sd">            six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1004"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1004"><span class="linenos">1004</span></a><span class="sd">            2 for the first segment, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1005"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1005"><span class="linenos">1005</span></a>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1006"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1006"><span class="linenos">1006</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1007"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1007"><span class="linenos">1007</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1008"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1008"><span class="linenos">1008</span></a><span class="sd">        bool</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1009"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1009"><span class="linenos">1009</span></a><span class="sd">            True if uC successfully initiated a new trajectory</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1010"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1010"><span class="linenos">1010</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1011"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1011"><span class="linenos">1011</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1012"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1012"><span class="linenos">1012</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1013"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1013"><span class="linenos">1013</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1014"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1014"><span class="linenos">1014</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">first_segment</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1015"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1015"><span class="linenos">1015</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1016"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1016"><span class="linenos">1016</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1017"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1017"><span class="linenos">1017</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1018"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1018"><span class="linenos">1018</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_START_NEW_TRAJECTORY</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1019"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1019"><span class="linenos">1019</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1020"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1020"><span class="linenos">1020</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start_new_traj_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1021"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1021"><span class="linenos">1021</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1022"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1022"><span class="linenos">1022</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;start_waypoint_trajectory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1023"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1023"><span class="linenos">1023</span></a>        <span class="c1"># return self._waypoint_traj_start_success</span>
</span><span id="Stepper_Protocol_P1.start_waypoint_trajectory-1024"><a href="#Stepper_Protocol_P1.start_waypoint_trajectory-1024"><span class="linenos">1024</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span>
</span></pre></div>


            <div class="docstring"><p>Starts execution of a waypoint trajectory on hardware</p>

<h2 id="parameters">Parameters</h2>

<p>first_segment : list
    List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].
    The hardware begins executing this first segment of a spline. The segment's duration and
    six coefficients (a0-a5) fill the first seven elements of the list. A segment ID, always
    2 for the first segment, fills the last element of the list.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if uC successfully initiated a new trajectory</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.set_next_trajectory_segment" class="classattr">
                                        <input id="Stepper_Protocol_P1.set_next_trajectory_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_next_trajectory_segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">next_segment</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.set_next_trajectory_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.set_next_trajectory_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1026"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1026"><span class="linenos">1026</span></a>    <span class="k">def</span> <span class="nf">set_next_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_segment</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1027"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1027"><span class="linenos">1027</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the next segment for the hardware to execute</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1028"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1028"><span class="linenos">1028</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1029"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1029"><span class="linenos">1029</span></a><span class="sd">        This method is generally called multiple times while the prior segment is executing. This</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1030"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1030"><span class="linenos">1030</span></a><span class="sd">        provides the hardware with the next segment to gracefully transition across the entire spline,</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1031"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1031"><span class="linenos">1031</span></a><span class="sd">        while allowing users to preempt or modify the future trajectory in real time.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1032"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1032"><span class="linenos">1032</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1033"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1033"><span class="linenos">1033</span></a><span class="sd">        This method will return False if there is not already an segment executing on the uC</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1034"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1034"><span class="linenos">1034</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1035"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1035"><span class="linenos">1035</span></a><span class="sd">        Parameters</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1036"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1036"><span class="linenos">1036</span></a><span class="sd">        ----------</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1037"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1037"><span class="linenos">1037</span></a><span class="sd">        next_segment : list</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1038"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1038"><span class="linenos">1038</span></a><span class="sd">            List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1039"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1039"><span class="linenos">1039</span></a><span class="sd">            Duration and six coefficients fill the first seven elements of the list. Generally, the</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1040"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1040"><span class="linenos">1040</span></a><span class="sd">            coefficients are calculated to smoothly transition across a spline. The segment ID, always</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1041"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1041"><span class="linenos">1041</span></a><span class="sd">            1 higher than the prior segment&#39;s ID, fills the last element of the list.</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1042"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1042"><span class="linenos">1042</span></a>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1043"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1043"><span class="linenos">1043</span></a><span class="sd">        Returns</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1044"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1044"><span class="linenos">1044</span></a><span class="sd">        -------</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1045"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1045"><span class="linenos">1045</span></a><span class="sd">        bool</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1046"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1046"><span class="linenos">1046</span></a><span class="sd">            True if uC successfully queued next trajectory</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1047"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1047"><span class="linenos">1047</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1048"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1048"><span class="linenos">1048</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_segment</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1049"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1049"><span class="linenos">1049</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: Invalid segment arr length (must be 8)&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1050"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1050"><span class="linenos">1050</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1051"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1051"><span class="linenos">1051</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="o">=</span> <span class="n">next_segment</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1052"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1052"><span class="linenos">1052</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1053"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1053"><span class="linenos">1053</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1054"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1054"><span class="linenos">1054</span></a>            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_SET_NEXT_TRAJECTORY_SEG</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1055"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1055"><span class="linenos">1055</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_trajectory_segment</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1056"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1056"><span class="linenos">1056</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">[:</span><span class="n">sidx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_set_next_traj_seg_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1057"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1057"><span class="linenos">1057</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1058"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1058"><span class="linenos">1058</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_next_trajectory_segment: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</span><span id="Stepper_Protocol_P1.set_next_trajectory_segment-1059"><a href="#Stepper_Protocol_P1.set_next_trajectory_segment-1059"><span class="linenos">1059</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span>
</span></pre></div>


            <div class="docstring"><p>Sets the next segment for the hardware to execute</p>

<p>This method is generally called multiple times while the prior segment is executing. This
provides the hardware with the next segment to gracefully transition across the entire spline,
while allowing users to preempt or modify the future trajectory in real time.</p>

<p>This method will return False if there is not already an segment executing on the uC</p>

<h2 id="parameters">Parameters</h2>

<p>next_segment : list
    List of length eight, structured like [duration_s, a0, a1, a2, a3, a4, a5, segment_id].
    Duration and six coefficients fill the first seven elements of the list. Generally, the
    coefficients are calculated to smoothly transition across a spline. The segment ID, always
    1 higher than the prior segment's ID, fills the last element of the list.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if uC successfully queued next trajectory</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.stop_waypoint_trajectory" class="classattr">
                                        <input id="Stepper_Protocol_P1.stop_waypoint_trajectory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop_waypoint_trajectory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.stop_waypoint_trajectory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.stop_waypoint_trajectory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1061"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1061"><span class="linenos">1061</span></a>    <span class="k">def</span> <span class="nf">stop_waypoint_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1062"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1062"><span class="linenos">1062</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops execution of the waypoint trajectory running in hardware</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1063"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1063"><span class="linenos">1063</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1064"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1064"><span class="linenos">1064</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_ts</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1065"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1065"><span class="linenos">1065</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_RESET_TRAJECTORY</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P1.stop_waypoint_trajectory-1066"><a href="#Stepper_Protocol_P1.stop_waypoint_trajectory-1066"><span class="linenos">1066</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_reset_traj_reply</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Stops execution of the waypoint trajectory running in hardware</p>
</div>


                            </div>
                            <div id="Stepper_Protocol_P1.pack_trajectory_segment" class="classattr">
                                        <input id="Stepper_Protocol_P1.pack_trajectory_segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pack_trajectory_segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">sidx</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.pack_trajectory_segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.pack_trajectory_segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1068"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1068"><span class="linenos">1068</span></a>    <span class="k">def</span> <span class="nf">pack_trajectory_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1069"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1069"><span class="linenos">1069</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1070"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1070"><span class="linenos">1070</span></a>            <span class="n">pack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1071"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1071"><span class="linenos">1071</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1072"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1072"><span class="linenos">1072</span></a>        <span class="n">pack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sidx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_segment</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1073"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1073"><span class="linenos">1073</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.pack_trajectory_segment-1074"><a href="#Stepper_Protocol_P1.pack_trajectory_segment-1074"><span class="linenos">1074</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P1.rpc_start_new_traj_reply" class="classattr">
                                        <input id="Stepper_Protocol_P1.rpc_start_new_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_start_new_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.rpc_start_new_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.rpc_start_new_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1076"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1076"><span class="linenos">1076</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1077"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1077"><span class="linenos">1077</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1078"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1078"><span class="linenos">1078</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1079"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1079"><span class="linenos">1079</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1080"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1080"><span class="linenos">1080</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1081"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1081"><span class="linenos">1081</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1082"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1082"><span class="linenos">1082</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1083"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1083"><span class="linenos">1083</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_start_new_traj_reply-1084"><a href="#Stepper_Protocol_P1.rpc_start_new_traj_reply-1084"><span class="linenos">1084</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply" class="classattr">
                                        <input id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_set_next_traj_seg_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1086"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1086"><span class="linenos">1086</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1087"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1088"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1088"><span class="linenos">1088</span></a>            <span class="n">sidx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1089"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1089"><span class="linenos">1089</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1090"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1090"><span class="linenos">1090</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1091"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1091"><span class="linenos">1091</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_error_msg</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1092"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1092"><span class="linenos">1092</span></a>            <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">100</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1093"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1093"><span class="linenos">1093</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1094"><a href="#Stepper_Protocol_P1.rpc_set_next_traj_seg_reply-1094"><span class="linenos">1094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P1.rpc_reset_traj_reply" class="classattr">
                                        <input id="Stepper_Protocol_P1.rpc_reset_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_reset_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P1.rpc_reset_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P1.rpc_reset_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1096"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1096"><span class="linenos">1096</span></a>    <span class="k">def</span> <span class="nf">rpc_reset_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1097"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1097"><span class="linenos">1097</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_RESET_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P1.rpc_reset_traj_reply-1098"><a href="#Stepper_Protocol_P1.rpc_reset_traj_reply-1098"><span class="linenos">1098</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_RESET_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P1.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_COMMAND" class="variable"><a href="#StepperBase.RPC_SET_COMMAND">RPC_SET_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_COMMAND" class="variable"><a href="#StepperBase.RPC_REPLY_COMMAND">RPC_REPLY_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_GET_STATUS" class="variable"><a href="#StepperBase.RPC_GET_STATUS">RPC_GET_STATUS</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_STATUS" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS">RPC_REPLY_STATUS</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_GAINS" class="variable"><a href="#StepperBase.RPC_SET_GAINS">RPC_SET_GAINS</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_GAINS" class="variable"><a href="#StepperBase.RPC_REPLY_GAINS">RPC_REPLY_GAINS</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PUSH">RPC_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH">RPC_REPLY_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_SET_TRIGGER">RPC_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_REPLY_SET_TRIGGER">RPC_REPLY_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_SET_ENC_CALIB">RPC_SET_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_REPLY_ENC_CALIB">RPC_REPLY_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_READ_GAINS_FROM_FLASH">RPC_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH">RPC_REPLY_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_MENU_ON" class="variable"><a href="#StepperBase.RPC_SET_MENU_ON">RPC_SET_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_MENU_ON" class="variable"><a href="#StepperBase.RPC_REPLY_MENU_ON">RPC_REPLY_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_GET_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO">RPC_GET_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO">RPC_REPLY_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_SET_MOTION_LIMITS">RPC_SET_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_REPLY_MOTION_LIMITS">RPC_REPLY_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG">RPC_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_START_NEW_TRAJECTORY">RPC_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY">RPC_REPLY_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_RESET_TRAJECTORY">RPC_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY">RPC_REPLY_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_READ_TRACE" class="variable"><a href="#StepperBase.RPC_READ_TRACE">RPC_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_READ_TRACE" class="variable"><a href="#StepperBase.RPC_REPLY_READ_TRACE">RPC_REPLY_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_GET_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_GET_STATUS_AUX">RPC_GET_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS_AUX">RPC_REPLY_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PULL">RPC_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P1.RPC_REPLY_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL">RPC_REPLY_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_SAFETY" class="variable"><a href="#StepperBase.MODE_SAFETY">MODE_SAFETY</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_FREEWHEEL" class="variable"><a href="#StepperBase.MODE_FREEWHEEL">MODE_FREEWHEEL</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_HOLD" class="variable"><a href="#StepperBase.MODE_HOLD">MODE_HOLD</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_POS_PID" class="variable"><a href="#StepperBase.MODE_POS_PID">MODE_POS_PID</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_VEL_PID" class="variable"><a href="#StepperBase.MODE_VEL_PID">MODE_VEL_PID</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_POS_TRAJ" class="variable"><a href="#StepperBase.MODE_POS_TRAJ">MODE_POS_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_VEL_TRAJ" class="variable"><a href="#StepperBase.MODE_VEL_TRAJ">MODE_VEL_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_CURRENT" class="variable"><a href="#StepperBase.MODE_CURRENT">MODE_CURRENT</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_POS_TRAJ_INCR" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_INCR">MODE_POS_TRAJ_INCR</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_POS_TRAJ_WAYPOINT" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_WAYPOINT">MODE_POS_TRAJ_WAYPOINT</a></dd>
                <dd id="Stepper_Protocol_P1.MODE_NAMES" class="variable"><a href="#StepperBase.MODE_NAMES">MODE_NAMES</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_POS_CALIBRATED" class="variable"><a href="#StepperBase.DIAG_POS_CALIBRATED">DIAG_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_RUNSTOP_ON" class="variable"><a href="#StepperBase.DIAG_RUNSTOP_ON">DIAG_RUNSTOP_ON</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_NEAR_POS_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_POS_SETPOINT">DIAG_NEAR_POS_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_NEAR_VEL_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_VEL_SETPOINT">DIAG_NEAR_VEL_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IS_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MOVING">DIAG_IS_MOVING</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_AT_CURRENT_LIMIT" class="variable"><a href="#StepperBase.DIAG_AT_CURRENT_LIMIT">DIAG_AT_CURRENT_LIMIT</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IS_MG_ACCELERATING" class="variable"><a href="#StepperBase.DIAG_IS_MG_ACCELERATING">DIAG_IS_MG_ACCELERATING</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IS_MG_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MG_MOVING">DIAG_IS_MG_MOVING</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_CALIBRATION_RCVD" class="variable"><a href="#StepperBase.DIAG_CALIBRATION_RCVD">DIAG_CALIBRATION_RCVD</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IN_GUARDED_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_GUARDED_EVENT">DIAG_IN_GUARDED_EVENT</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IN_SAFETY_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_SAFETY_EVENT">DIAG_IN_SAFETY_EVENT</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_WAITING_ON_SYNC">DIAG_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_TRAJ_ACTIVE" class="variable"><a href="#StepperBase.DIAG_TRAJ_ACTIVE">DIAG_TRAJ_ACTIVE</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_TRAJ_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC">DIAG_TRAJ_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IN_SYNC_MODE" class="variable"><a href="#StepperBase.DIAG_IN_SYNC_MODE">DIAG_IN_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P1.DIAG_IS_TRACE_ON" class="variable"><a href="#StepperBase.DIAG_IS_TRACE_ON">DIAG_IS_TRACE_ON</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_SAFETY_HOLD" class="variable"><a href="#StepperBase.CONFIG_SAFETY_HOLD">CONFIG_SAFETY_HOLD</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_ENABLE_RUNSTOP" class="variable"><a href="#StepperBase.CONFIG_ENABLE_RUNSTOP">CONFIG_ENABLE_RUNSTOP</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_ENABLE_SYNC_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_SYNC_MODE">CONFIG_ENABLE_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_ENABLE_GUARDED_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE">CONFIG_ENABLE_GUARDED_MODE</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_FLIP_ENCODER_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY">CONFIG_FLIP_ENCODER_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_FLIP_EFFORT_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY">CONFIG_FLIP_EFFORT_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P1.CONFIG_ENABLE_VEL_WATCHDOG" class="variable"><a href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG">CONFIG_ENABLE_VEL_WATCHDOG</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_MARK_POS" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS">TRIGGER_MARK_POS</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_RESET_MOTION_GEN" class="variable"><a href="#StepperBase.TRIGGER_RESET_MOTION_GEN">TRIGGER_RESET_MOTION_GEN</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_BOARD_RESET" class="variable"><a href="#StepperBase.TRIGGER_BOARD_RESET">TRIGGER_BOARD_RESET</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_WRITE_GAINS_TO_FLASH" class="variable"><a href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH">TRIGGER_WRITE_GAINS_TO_FLASH</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_RESET_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED">TRIGGER_RESET_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_POS_CALIBRATED">TRIGGER_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_MARK_POS_ON_CONTACT" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT">TRIGGER_MARK_POS_ON_CONTACT</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_ENABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_ENABLE_TRACE">TRIGGER_ENABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P1.TRIGGER_DISABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_DISABLE_TRACE">TRIGGER_DISABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P1.TRACE_TYPE_STATUS" class="variable"><a href="#StepperBase.TRACE_TYPE_STATUS">TRACE_TYPE_STATUS</a></dd>
                <dd id="Stepper_Protocol_P1.TRACE_TYPE_DEBUG" class="variable"><a href="#StepperBase.TRACE_TYPE_DEBUG">TRACE_TYPE_DEBUG</a></dd>
                <dd id="Stepper_Protocol_P1.TRACE_TYPE_PRINT" class="variable"><a href="#StepperBase.TRACE_TYPE_PRINT">TRACE_TYPE_PRINT</a></dd>
                <dd id="Stepper_Protocol_P1.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P1.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P1.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P1.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P1.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P1.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P1.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P1.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P1.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P1.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P1.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P1.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P1.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P1.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P1.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P1.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P1.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P1.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P1.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P1.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P1.push_load_test" class="function"><a href="#StepperBase.push_load_test">push_load_test</a></dd>
                <dd id="Stepper_Protocol_P1.pull_load_test" class="function"><a href="#StepperBase.pull_load_test">pull_load_test</a></dd>
                <dd id="Stepper_Protocol_P1.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P1.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P1.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P1.write_gains_to_YAML" class="function"><a href="#StepperBase.write_gains_to_YAML">write_gains_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P1.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P1.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P1.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P1.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P1.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P1.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P1.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P1.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P1.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P1.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P1.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P1.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P1.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P1.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P1.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P1.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P1.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P1.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P1.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P1.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P1.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P1.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P1.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P1.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P1.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P1.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P1.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P1.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P1.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P1.current_to_torque" class="function"><a href="#StepperBase.current_to_torque">current_to_torque</a></dd>
                <dd id="Stepper_Protocol_P1.torque_to_current" class="function"><a href="#StepperBase.torque_to_current">torque_to_current</a></dd>
                <dd id="Stepper_Protocol_P1.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P1.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P1.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P1.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P1.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P1.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P1.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P1.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P1.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P1.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P1.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P1.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P1.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>
                <dd id="Stepper_Protocol_P1.rpc_read_firmware_trace_reply" class="function"><a href="#StepperBase.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a></dd>
                <dd id="Stepper_Protocol_P1.enable_firmware_trace" class="function"><a href="#StepperBase.enable_firmware_trace">enable_firmware_trace</a></dd>
                <dd id="Stepper_Protocol_P1.disable_firmware_trace" class="function"><a href="#StepperBase.disable_firmware_trace">disable_firmware_trace</a></dd>
                <dd id="Stepper_Protocol_P1.pull_status_aux" class="function"><a href="#StepperBase.pull_status_aux">pull_status_aux</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P1.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P1.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P1.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P1.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P1.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P1.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P1.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P1.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P1.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P1.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P1.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P1.write_device_params" class="function"><a href="device.html#Device.write_device_params">write_device_params</a></dd>
                <dd id="Stepper_Protocol_P1.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P1.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P2">
                            <input id="Stepper_Protocol_P2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P2</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2-1102"><a href="#Stepper_Protocol_P2-1102"><span class="linenos">1102</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P2</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1103"><a href="#Stepper_Protocol_P2-1103"><span class="linenos">1103</span></a>
</span><span id="Stepper_Protocol_P2-1104"><a href="#Stepper_Protocol_P2-1104"><span class="linenos">1104</span></a>    <span class="k">def</span> <span class="nf">read_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1105"><a href="#Stepper_Protocol_P2-1105"><span class="linenos">1105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Stepper_Protocol_P2-1106"><a href="#Stepper_Protocol_P2-1106"><span class="linenos">1106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1">#Timestamp holds state, reset within lock to avoid threading issues</span>
</span><span id="Stepper_Protocol_P2-1107"><a href="#Stepper_Protocol_P2-1107"><span class="linenos">1107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1108"><a href="#Stepper_Protocol_P2-1108"><span class="linenos">1108</span></a>        <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2-1109"><a href="#Stepper_Protocol_P2-1109"><span class="linenos">1109</span></a>        <span class="k">while</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&lt;</span><span class="mf">60.0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1110"><a href="#Stepper_Protocol_P2-1110"><span class="linenos">1110</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_TRACE</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1111"><a href="#Stepper_Protocol_P2-1111"><span class="linenos">1111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_firmware_trace_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2-1112"><a href="#Stepper_Protocol_P2-1112"><span class="linenos">1112</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2-1113"><a href="#Stepper_Protocol_P2-1113"><span class="linenos">1113</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span>
</span><span id="Stepper_Protocol_P2-1114"><a href="#Stepper_Protocol_P2-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="nf">unpack_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1115"><a href="#Stepper_Protocol_P2-1115"><span class="linenos">1115</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1116"><a href="#Stepper_Protocol_P2-1116"><span class="linenos">1116</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1117"><a href="#Stepper_Protocol_P2-1117"><span class="linenos">1117</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1118"><a href="#Stepper_Protocol_P2-1118"><span class="linenos">1118</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1119"><a href="#Stepper_Protocol_P2-1119"><span class="linenos">1119</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1120"><a href="#Stepper_Protocol_P2-1120"><span class="linenos">1120</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1121"><a href="#Stepper_Protocol_P2-1121"><span class="linenos">1121</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P2-1122"><a href="#Stepper_Protocol_P2-1122"><span class="linenos">1122</span></a>
</span><span id="Stepper_Protocol_P2-1123"><a href="#Stepper_Protocol_P2-1123"><span class="linenos">1123</span></a>    <span class="k">def</span> <span class="nf">unpack_print_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1124"><a href="#Stepper_Protocol_P2-1124"><span class="linenos">1124</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1125"><a href="#Stepper_Protocol_P2-1125"><span class="linenos">1125</span></a>        <span class="n">line_len</span><span class="o">=</span><span class="mi">32</span>
</span><span id="Stepper_Protocol_P2-1126"><a href="#Stepper_Protocol_P2-1126"><span class="linenos">1126</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2-1127"><a href="#Stepper_Protocol_P2-1127"><span class="linenos">1127</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="n">line_len</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="n">line_len</span>
</span><span id="Stepper_Protocol_P2-1128"><a href="#Stepper_Protocol_P2-1128"><span class="linenos">1128</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1129"><a href="#Stepper_Protocol_P2-1129"><span class="linenos">1129</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P2-1130"><a href="#Stepper_Protocol_P2-1130"><span class="linenos">1130</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1131"><a href="#Stepper_Protocol_P2-1131"><span class="linenos">1131</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_TRACE</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1132"><a href="#Stepper_Protocol_P2-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Stepper_Protocol_P2-1133"><a href="#Stepper_Protocol_P2-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{},</span><span class="s1">&#39;debug&#39;</span><span class="p">:{},</span><span class="s1">&#39;print&#39;</span><span class="p">:{}})</span>
</span><span id="Stepper_Protocol_P2-1134"><a href="#Stepper_Protocol_P2-1134"><span class="linenos">1134</span></a>            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_STATUS</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1135"><a href="#Stepper_Protocol_P2-1135"><span class="linenos">1135</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2-1136"><a href="#Stepper_Protocol_P2-1136"><span class="linenos">1136</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1137"><a href="#Stepper_Protocol_P2-1137"><span class="linenos">1137</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_DEBUG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1138"><a href="#Stepper_Protocol_P2-1138"><span class="linenos">1138</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_debug_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1139"><a href="#Stepper_Protocol_P2-1139"><span class="linenos">1139</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_PRINT</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1140"><a href="#Stepper_Protocol_P2-1140"><span class="linenos">1140</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_print_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;print&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1141"><a href="#Stepper_Protocol_P2-1141"><span class="linenos">1141</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1142"><a href="#Stepper_Protocol_P2-1142"><span class="linenos">1142</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized trace type </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1143"><a href="#Stepper_Protocol_P2-1143"><span class="linenos">1143</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1144"><a href="#Stepper_Protocol_P2-1144"><span class="linenos">1144</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_TRACE&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2-1145"><a href="#Stepper_Protocol_P2-1145"><span class="linenos">1145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1146"><a href="#Stepper_Protocol_P2-1146"><span class="linenos">1146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Stepper_Protocol_P2-1147"><a href="#Stepper_Protocol_P2-1147"><span class="linenos">1147</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1148"><a href="#Stepper_Protocol_P2-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_ENABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2-1149"><a href="#Stepper_Protocol_P2-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper_Protocol_P2-1150"><a href="#Stepper_Protocol_P2-1150"><span class="linenos">1150</span></a>
</span><span id="Stepper_Protocol_P2-1151"><a href="#Stepper_Protocol_P2-1151"><span class="linenos">1151</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1152"><a href="#Stepper_Protocol_P2-1152"><span class="linenos">1152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_DISABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2-1153"><a href="#Stepper_Protocol_P2-1153"><span class="linenos">1153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper_Protocol_P2-1154"><a href="#Stepper_Protocol_P2-1154"><span class="linenos">1154</span></a>
</span><span id="Stepper_Protocol_P2-1155"><a href="#Stepper_Protocol_P2-1155"><span class="linenos">1155</span></a>
</span><span id="Stepper_Protocol_P2-1156"><a href="#Stepper_Protocol_P2-1156"><span class="linenos">1156</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2-1157"><a href="#Stepper_Protocol_P2-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1158"><a href="#Stepper_Protocol_P2-1158"><span class="linenos">1158</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P2-1159"><a href="#Stepper_Protocol_P2-1159"><span class="linenos">1159</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1160"><a href="#Stepper_Protocol_P2-1160"><span class="linenos">1160</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2-1161"><a href="#Stepper_Protocol_P2-1161"><span class="linenos">1161</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1162"><a href="#Stepper_Protocol_P2-1162"><span class="linenos">1162</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1163"><a href="#Stepper_Protocol_P2-1163"><span class="linenos">1163</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2-1164"><a href="#Stepper_Protocol_P2-1164"><span class="linenos">1164</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P2-1165"><a href="#Stepper_Protocol_P2-1165"><span class="linenos">1165</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1166"><a href="#Stepper_Protocol_P2-1166"><span class="linenos">1166</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1167"><a href="#Stepper_Protocol_P2-1167"><span class="linenos">1167</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1168"><a href="#Stepper_Protocol_P2-1168"><span class="linenos">1168</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2-1169"><a href="#Stepper_Protocol_P2-1169"><span class="linenos">1169</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1170"><a href="#Stepper_Protocol_P2-1170"><span class="linenos">1170</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1171"><a href="#Stepper_Protocol_P2-1171"><span class="linenos">1171</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2-1172"><a href="#Stepper_Protocol_P2-1172"><span class="linenos">1172</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P2-1173"><a href="#Stepper_Protocol_P2-1173"><span class="linenos">1173</span></a>
</span><span id="Stepper_Protocol_P2-1174"><a href="#Stepper_Protocol_P2-1174"><span class="linenos">1174</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1175"><a href="#Stepper_Protocol_P2-1175"><span class="linenos">1175</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1176"><a href="#Stepper_Protocol_P2-1176"><span class="linenos">1176</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1177"><a href="#Stepper_Protocol_P2-1177"><span class="linenos">1177</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1178"><a href="#Stepper_Protocol_P2-1178"><span class="linenos">1178</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1179"><a href="#Stepper_Protocol_P2-1179"><span class="linenos">1179</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1180"><a href="#Stepper_Protocol_P2-1180"><span class="linenos">1180</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1181"><a href="#Stepper_Protocol_P2-1181"><span class="linenos">1181</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1182"><a href="#Stepper_Protocol_P2-1182"><span class="linenos">1182</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1183"><a href="#Stepper_Protocol_P2-1183"><span class="linenos">1183</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1184"><a href="#Stepper_Protocol_P2-1184"><span class="linenos">1184</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1185"><a href="#Stepper_Protocol_P2-1185"><span class="linenos">1185</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1186"><a href="#Stepper_Protocol_P2-1186"><span class="linenos">1186</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1187"><a href="#Stepper_Protocol_P2-1187"><span class="linenos">1187</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_TRACE_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2-1188"><a href="#Stepper_Protocol_P2-1188"><span class="linenos">1188</span></a>
</span><span id="Stepper_Protocol_P2-1189"><a href="#Stepper_Protocol_P2-1189"><span class="linenos">1189</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1190"><a href="#Stepper_Protocol_P2-1190"><span class="linenos">1190</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P2-1191"><a href="#Stepper_Protocol_P2-1191"><span class="linenos">1191</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1192"><a href="#Stepper_Protocol_P2-1192"><span class="linenos">1192</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P2-1193"><a href="#Stepper_Protocol_P2-1193"><span class="linenos">1193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2-1194"><a href="#Stepper_Protocol_P2-1194"><span class="linenos">1194</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P2-1195"><a href="#Stepper_Protocol_P2-1195"><span class="linenos">1195</span></a>
</span><span id="Stepper_Protocol_P2-1196"><a href="#Stepper_Protocol_P2-1196"><span class="linenos">1196</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P2.read_firmware_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.read_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.read_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.read_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.read_firmware_trace-1104"><a href="#Stepper_Protocol_P2.read_firmware_trace-1104"><span class="linenos">1104</span></a>    <span class="k">def</span> <span class="nf">read_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1105"><a href="#Stepper_Protocol_P2.read_firmware_trace-1105"><span class="linenos">1105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1106"><a href="#Stepper_Protocol_P2.read_firmware_trace-1106"><span class="linenos">1106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span> <span class="c1">#Timestamp holds state, reset within lock to avoid threading issues</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1107"><a href="#Stepper_Protocol_P2.read_firmware_trace-1107"><span class="linenos">1107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1108"><a href="#Stepper_Protocol_P2.read_firmware_trace-1108"><span class="linenos">1108</span></a>        <span class="n">ts</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1109"><a href="#Stepper_Protocol_P2.read_firmware_trace-1109"><span class="linenos">1109</span></a>        <span class="k">while</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">ts</span><span class="o">&lt;</span><span class="mf">60.0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1110"><a href="#Stepper_Protocol_P2.read_firmware_trace-1110"><span class="linenos">1110</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_READ_TRACE</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1111"><a href="#Stepper_Protocol_P2.read_firmware_trace-1111"><span class="linenos">1111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_read_firmware_trace_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1112"><a href="#Stepper_Protocol_P2.read_firmware_trace-1112"><span class="linenos">1112</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2.read_firmware_trace-1113"><a href="#Stepper_Protocol_P2.read_firmware_trace-1113"><span class="linenos">1113</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P2.unpack_debug_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.unpack_debug_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_debug_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.unpack_debug_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.unpack_debug_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.unpack_debug_trace-1114"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="nf">unpack_debug_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1115"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1115"><span class="linenos">1115</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1116"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1116"><span class="linenos">1116</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1117"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1117"><span class="linenos">1117</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;u8_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1118"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1118"><span class="linenos">1118</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1119"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1119"><span class="linenos">1119</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1120"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1120"><span class="linenos">1120</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;f_3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_debug_trace-1121"><a href="#Stepper_Protocol_P2.unpack_debug_trace-1121"><span class="linenos">1121</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P2.unpack_print_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.unpack_print_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_print_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.unpack_print_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.unpack_print_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.unpack_print_trace-1123"><a href="#Stepper_Protocol_P2.unpack_print_trace-1123"><span class="linenos">1123</span></a>    <span class="k">def</span> <span class="nf">unpack_print_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1124"><a href="#Stepper_Protocol_P2.unpack_print_trace-1124"><span class="linenos">1124</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1125"><a href="#Stepper_Protocol_P2.unpack_print_trace-1125"><span class="linenos">1125</span></a>        <span class="n">line_len</span><span class="o">=</span><span class="mi">32</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1126"><a href="#Stepper_Protocol_P2.unpack_print_trace-1126"><span class="linenos">1126</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1127"><a href="#Stepper_Protocol_P2.unpack_print_trace-1127"><span class="linenos">1127</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_string_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:],</span> <span class="n">line_len</span><span class="p">);</span> <span class="n">sidx</span> <span class="o">+=</span> <span class="n">line_len</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1128"><a href="#Stepper_Protocol_P2.unpack_print_trace-1128"><span class="linenos">1128</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_print_trace-1129"><a href="#Stepper_Protocol_P2.unpack_print_trace-1129"><span class="linenos">1129</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply" class="classattr">
                                        <input id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_read_firmware_trace_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1130"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1130"><span class="linenos">1130</span></a>    <span class="k">def</span> <span class="nf">rpc_read_firmware_trace_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1131"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1131"><span class="linenos">1131</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_READ_TRACE</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1132"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1132"><span class="linenos">1132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1133"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1133"><span class="linenos">1133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">),</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="p">{},</span><span class="s1">&#39;debug&#39;</span><span class="p">:{},</span><span class="s1">&#39;print&#39;</span><span class="p">:{}})</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1134"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1134"><span class="linenos">1134</span></a>            <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_STATUS</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1135"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1135"><span class="linenos">1135</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_zero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1136"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1136"><span class="linenos">1136</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1137"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1137"><span class="linenos">1137</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_DEBUG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1138"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1138"><span class="linenos">1138</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_debug_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1139"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1139"><span class="linenos">1139</span></a>            <span class="k">elif</span> <span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">TRACE_TYPE_PRINT</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1140"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1140"><span class="linenos">1140</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unpack_print_trace</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span><span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;print&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1141"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1141"><span class="linenos">1141</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1142"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1142"><span class="linenos">1142</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unrecognized trace type </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">reply</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1143"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1143"><span class="linenos">1143</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1144"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1144"><span class="linenos">1144</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_READ_TRACE&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1145"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1145"><span class="linenos">1145</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_trace_read</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1146"><a href="#Stepper_Protocol_P2.rpc_read_firmware_trace_reply-1146"><span class="linenos">1146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trace_buf</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P2.enable_firmware_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.enable_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.enable_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.enable_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.enable_firmware_trace-1147"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1147"><span class="linenos">1147</span></a>    <span class="k">def</span> <span class="nf">enable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.enable_firmware_trace-1148"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1148"><span class="linenos">1148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_ENABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2.enable_firmware_trace-1149"><a href="#Stepper_Protocol_P2.enable_firmware_trace-1149"><span class="linenos">1149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P2.disable_firmware_trace" class="classattr">
                                        <input id="Stepper_Protocol_P2.disable_firmware_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_firmware_trace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.disable_firmware_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.disable_firmware_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.disable_firmware_trace-1151"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1151"><span class="linenos">1151</span></a>    <span class="k">def</span> <span class="nf">disable_firmware_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.disable_firmware_trace-1152"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1152"><span class="linenos">1152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trigger</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRIGGER_DISABLE_TRACE</span>
</span><span id="Stepper_Protocol_P2.disable_firmware_trace-1153"><a href="#Stepper_Protocol_P2.disable_firmware_trace-1153"><span class="linenos">1153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_trigger</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P2.unpack_status" class="classattr">
                                        <input id="Stepper_Protocol_P2.unpack_status-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P2.unpack_status-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P2.unpack_status"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P2.unpack_status-1156"><a href="#Stepper_Protocol_P2.unpack_status-1156"><span class="linenos">1156</span></a>    <span class="k">def</span> <span class="nf">unpack_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">unpack_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1157"><a href="#Stepper_Protocol_P2.unpack_status-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="n">unpack_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1158"><a href="#Stepper_Protocol_P2.unpack_status-1158"><span class="linenos">1158</span></a>            <span class="n">unpack_to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1159"><a href="#Stepper_Protocol_P2.unpack_status-1159"><span class="linenos">1159</span></a>        <span class="n">sidx</span><span class="o">=</span><span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1160"><a href="#Stepper_Protocol_P2.unpack_status-1160"><span class="linenos">1160</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">1</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1161"><a href="#Stepper_Protocol_P2.unpack_status-1161"><span class="linenos">1161</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1162"><a href="#Stepper_Protocol_P2.unpack_status-1162"><span class="linenos">1162</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">effort_ticks_to_current</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_ticks&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1163"><a href="#Stepper_Protocol_P2.unpack_status-1163"><span class="linenos">1163</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;effort_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_to_effort_pct</span><span class="p">(</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;current&#39;</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1164"><a href="#Stepper_Protocol_P2.unpack_status-1164"><span class="linenos">1164</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_double_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">8</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1165"><a href="#Stepper_Protocol_P2.unpack_status-1165"><span class="linenos">1165</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span><span class="o">+=</span><span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1166"><a href="#Stepper_Protocol_P2.unpack_status-1166"><span class="linenos">1166</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1167"><a href="#Stepper_Protocol_P2.unpack_status-1167"><span class="linenos">1167</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1168"><a href="#Stepper_Protocol_P2.unpack_status-1168"><span class="linenos">1168</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">unpack_uint64_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]));</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">8</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1169"><a href="#Stepper_Protocol_P2.unpack_status-1169"><span class="linenos">1169</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1170"><a href="#Stepper_Protocol_P2.unpack_status-1170"><span class="linenos">1170</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint32_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1171"><a href="#Stepper_Protocol_P2.unpack_status-1171"><span class="linenos">1171</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_float_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1172"><a href="#Stepper_Protocol_P2.unpack_status-1172"><span class="linenos">1172</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;segment_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:]);</span><span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1173"><a href="#Stepper_Protocol_P2.unpack_status-1173"><span class="linenos">1173</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1174"><a href="#Stepper_Protocol_P2.unpack_status-1174"><span class="linenos">1174</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;pos_calibrated&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_POS_CALIBRATED</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1175"><a href="#Stepper_Protocol_P2.unpack_status-1175"><span class="linenos">1175</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;runstop_on&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_RUNSTOP_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1176"><a href="#Stepper_Protocol_P2.unpack_status-1176"><span class="linenos">1176</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_pos_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_POS_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1177"><a href="#Stepper_Protocol_P2.unpack_status-1177"><span class="linenos">1177</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;near_vel_setpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_NEAR_VEL_SETPOINT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1178"><a href="#Stepper_Protocol_P2.unpack_status-1178"><span class="linenos">1178</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1179"><a href="#Stepper_Protocol_P2.unpack_status-1179"><span class="linenos">1179</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;at_current_limit&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_AT_CURRENT_LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1180"><a href="#Stepper_Protocol_P2.unpack_status-1180"><span class="linenos">1180</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_accelerating&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_ACCELERATING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1181"><a href="#Stepper_Protocol_P2.unpack_status-1181"><span class="linenos">1181</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;is_mg_moving&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_MG_MOVING</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1182"><a href="#Stepper_Protocol_P2.unpack_status-1182"><span class="linenos">1182</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;calibration_rcvd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_CALIBRATION_RCVD</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1183"><a href="#Stepper_Protocol_P2.unpack_status-1183"><span class="linenos">1183</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_guarded_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_GUARDED_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1184"><a href="#Stepper_Protocol_P2.unpack_status-1184"><span class="linenos">1184</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_safety_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SAFETY_EVENT</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1185"><a href="#Stepper_Protocol_P2.unpack_status-1185"><span class="linenos">1185</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waiting_on_sync&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1186"><a href="#Stepper_Protocol_P2.unpack_status-1186"><span class="linenos">1186</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;in_sync_mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IN_SYNC_MODE</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1187"><a href="#Stepper_Protocol_P2.unpack_status-1187"><span class="linenos">1187</span></a>        <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;trace_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_IS_TRACE_ON</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1188"><a href="#Stepper_Protocol_P2.unpack_status-1188"><span class="linenos">1188</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1189"><a href="#Stepper_Protocol_P2.unpack_status-1189"><span class="linenos">1189</span></a>        <span class="k">if</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_WAITING_ON_SYNC</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1190"><a href="#Stepper_Protocol_P2.unpack_status-1190"><span class="linenos">1190</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;waiting_on_sync&#39;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1191"><a href="#Stepper_Protocol_P2.unpack_status-1191"><span class="linenos">1191</span></a>        <span class="k">elif</span> <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;diag&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">DIAG_TRAJ_ACTIVE</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1192"><a href="#Stepper_Protocol_P2.unpack_status-1192"><span class="linenos">1192</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;active&#39;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1193"><a href="#Stepper_Protocol_P2.unpack_status-1193"><span class="linenos">1193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1194"><a href="#Stepper_Protocol_P2.unpack_status-1194"><span class="linenos">1194</span></a>            <span class="n">unpack_to</span><span class="p">[</span><span class="s1">&#39;waypoint_traj&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;idle&#39;</span>
</span><span id="Stepper_Protocol_P2.unpack_status-1195"><a href="#Stepper_Protocol_P2.unpack_status-1195"><span class="linenos">1195</span></a>
</span><span id="Stepper_Protocol_P2.unpack_status-1196"><a href="#Stepper_Protocol_P2.unpack_status-1196"><span class="linenos">1196</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P2.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_COMMAND" class="variable"><a href="#StepperBase.RPC_SET_COMMAND">RPC_SET_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_COMMAND" class="variable"><a href="#StepperBase.RPC_REPLY_COMMAND">RPC_REPLY_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_GET_STATUS" class="variable"><a href="#StepperBase.RPC_GET_STATUS">RPC_GET_STATUS</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_STATUS" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS">RPC_REPLY_STATUS</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_GAINS" class="variable"><a href="#StepperBase.RPC_SET_GAINS">RPC_SET_GAINS</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_GAINS" class="variable"><a href="#StepperBase.RPC_REPLY_GAINS">RPC_REPLY_GAINS</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PUSH">RPC_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH">RPC_REPLY_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_SET_TRIGGER">RPC_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_REPLY_SET_TRIGGER">RPC_REPLY_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_SET_ENC_CALIB">RPC_SET_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_REPLY_ENC_CALIB">RPC_REPLY_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_READ_GAINS_FROM_FLASH">RPC_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH">RPC_REPLY_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_MENU_ON" class="variable"><a href="#StepperBase.RPC_SET_MENU_ON">RPC_SET_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_MENU_ON" class="variable"><a href="#StepperBase.RPC_REPLY_MENU_ON">RPC_REPLY_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_GET_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO">RPC_GET_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO">RPC_REPLY_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_SET_MOTION_LIMITS">RPC_SET_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_REPLY_MOTION_LIMITS">RPC_REPLY_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG">RPC_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_START_NEW_TRAJECTORY">RPC_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY">RPC_REPLY_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_RESET_TRAJECTORY">RPC_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY">RPC_REPLY_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_READ_TRACE" class="variable"><a href="#StepperBase.RPC_READ_TRACE">RPC_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_READ_TRACE" class="variable"><a href="#StepperBase.RPC_REPLY_READ_TRACE">RPC_REPLY_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_GET_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_GET_STATUS_AUX">RPC_GET_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS_AUX">RPC_REPLY_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PULL">RPC_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P2.RPC_REPLY_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL">RPC_REPLY_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_SAFETY" class="variable"><a href="#StepperBase.MODE_SAFETY">MODE_SAFETY</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_FREEWHEEL" class="variable"><a href="#StepperBase.MODE_FREEWHEEL">MODE_FREEWHEEL</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_HOLD" class="variable"><a href="#StepperBase.MODE_HOLD">MODE_HOLD</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_POS_PID" class="variable"><a href="#StepperBase.MODE_POS_PID">MODE_POS_PID</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_VEL_PID" class="variable"><a href="#StepperBase.MODE_VEL_PID">MODE_VEL_PID</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_POS_TRAJ" class="variable"><a href="#StepperBase.MODE_POS_TRAJ">MODE_POS_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_VEL_TRAJ" class="variable"><a href="#StepperBase.MODE_VEL_TRAJ">MODE_VEL_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_CURRENT" class="variable"><a href="#StepperBase.MODE_CURRENT">MODE_CURRENT</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_POS_TRAJ_INCR" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_INCR">MODE_POS_TRAJ_INCR</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_POS_TRAJ_WAYPOINT" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_WAYPOINT">MODE_POS_TRAJ_WAYPOINT</a></dd>
                <dd id="Stepper_Protocol_P2.MODE_NAMES" class="variable"><a href="#StepperBase.MODE_NAMES">MODE_NAMES</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_POS_CALIBRATED" class="variable"><a href="#StepperBase.DIAG_POS_CALIBRATED">DIAG_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_RUNSTOP_ON" class="variable"><a href="#StepperBase.DIAG_RUNSTOP_ON">DIAG_RUNSTOP_ON</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_NEAR_POS_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_POS_SETPOINT">DIAG_NEAR_POS_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_NEAR_VEL_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_VEL_SETPOINT">DIAG_NEAR_VEL_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IS_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MOVING">DIAG_IS_MOVING</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_AT_CURRENT_LIMIT" class="variable"><a href="#StepperBase.DIAG_AT_CURRENT_LIMIT">DIAG_AT_CURRENT_LIMIT</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IS_MG_ACCELERATING" class="variable"><a href="#StepperBase.DIAG_IS_MG_ACCELERATING">DIAG_IS_MG_ACCELERATING</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IS_MG_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MG_MOVING">DIAG_IS_MG_MOVING</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_CALIBRATION_RCVD" class="variable"><a href="#StepperBase.DIAG_CALIBRATION_RCVD">DIAG_CALIBRATION_RCVD</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IN_GUARDED_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_GUARDED_EVENT">DIAG_IN_GUARDED_EVENT</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IN_SAFETY_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_SAFETY_EVENT">DIAG_IN_SAFETY_EVENT</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_WAITING_ON_SYNC">DIAG_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_TRAJ_ACTIVE" class="variable"><a href="#StepperBase.DIAG_TRAJ_ACTIVE">DIAG_TRAJ_ACTIVE</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_TRAJ_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC">DIAG_TRAJ_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IN_SYNC_MODE" class="variable"><a href="#StepperBase.DIAG_IN_SYNC_MODE">DIAG_IN_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P2.DIAG_IS_TRACE_ON" class="variable"><a href="#StepperBase.DIAG_IS_TRACE_ON">DIAG_IS_TRACE_ON</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_SAFETY_HOLD" class="variable"><a href="#StepperBase.CONFIG_SAFETY_HOLD">CONFIG_SAFETY_HOLD</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_ENABLE_RUNSTOP" class="variable"><a href="#StepperBase.CONFIG_ENABLE_RUNSTOP">CONFIG_ENABLE_RUNSTOP</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_ENABLE_SYNC_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_SYNC_MODE">CONFIG_ENABLE_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_ENABLE_GUARDED_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE">CONFIG_ENABLE_GUARDED_MODE</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_FLIP_ENCODER_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY">CONFIG_FLIP_ENCODER_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_FLIP_EFFORT_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY">CONFIG_FLIP_EFFORT_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P2.CONFIG_ENABLE_VEL_WATCHDOG" class="variable"><a href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG">CONFIG_ENABLE_VEL_WATCHDOG</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_MARK_POS" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS">TRIGGER_MARK_POS</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_RESET_MOTION_GEN" class="variable"><a href="#StepperBase.TRIGGER_RESET_MOTION_GEN">TRIGGER_RESET_MOTION_GEN</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_BOARD_RESET" class="variable"><a href="#StepperBase.TRIGGER_BOARD_RESET">TRIGGER_BOARD_RESET</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_WRITE_GAINS_TO_FLASH" class="variable"><a href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH">TRIGGER_WRITE_GAINS_TO_FLASH</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_RESET_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED">TRIGGER_RESET_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_POS_CALIBRATED">TRIGGER_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_MARK_POS_ON_CONTACT" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT">TRIGGER_MARK_POS_ON_CONTACT</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_ENABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_ENABLE_TRACE">TRIGGER_ENABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P2.TRIGGER_DISABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_DISABLE_TRACE">TRIGGER_DISABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P2.TRACE_TYPE_STATUS" class="variable"><a href="#StepperBase.TRACE_TYPE_STATUS">TRACE_TYPE_STATUS</a></dd>
                <dd id="Stepper_Protocol_P2.TRACE_TYPE_DEBUG" class="variable"><a href="#StepperBase.TRACE_TYPE_DEBUG">TRACE_TYPE_DEBUG</a></dd>
                <dd id="Stepper_Protocol_P2.TRACE_TYPE_PRINT" class="variable"><a href="#StepperBase.TRACE_TYPE_PRINT">TRACE_TYPE_PRINT</a></dd>
                <dd id="Stepper_Protocol_P2.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P2.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P2.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P2.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P2.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P2.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P2.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P2.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P2.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P2.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P2.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P2.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P2.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P2.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P2.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P2.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P2.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P2.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P2.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P2.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P2.push_load_test" class="function"><a href="#StepperBase.push_load_test">push_load_test</a></dd>
                <dd id="Stepper_Protocol_P2.pull_load_test" class="function"><a href="#StepperBase.pull_load_test">pull_load_test</a></dd>
                <dd id="Stepper_Protocol_P2.pretty_print" class="function"><a href="#StepperBase.pretty_print">pretty_print</a></dd>
                <dd id="Stepper_Protocol_P2.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P2.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P2.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P2.write_gains_to_YAML" class="function"><a href="#StepperBase.write_gains_to_YAML">write_gains_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P2.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P2.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P2.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P2.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P2.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P2.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P2.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P2.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P2.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P2.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P2.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P2.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_traj_waypoint" class="function"><a href="#StepperBase.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a></dd>
                <dd id="Stepper_Protocol_P2.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P2.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P2.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P2.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P2.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P2.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P2.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P2.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P2.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P2.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P2.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P2.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P2.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P2.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P2.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P2.current_to_torque" class="function"><a href="#StepperBase.current_to_torque">current_to_torque</a></dd>
                <dd id="Stepper_Protocol_P2.torque_to_current" class="function"><a href="#StepperBase.torque_to_current">torque_to_current</a></dd>
                <dd id="Stepper_Protocol_P2.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P2.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P2.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P2.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P2.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P2.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P2.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P2.start_waypoint_trajectory" class="function"><a href="#StepperBase.start_waypoint_trajectory">start_waypoint_trajectory</a></dd>
                <dd id="Stepper_Protocol_P2.set_next_trajectory_segment" class="function"><a href="#StepperBase.set_next_trajectory_segment">set_next_trajectory_segment</a></dd>
                <dd id="Stepper_Protocol_P2.stop_waypoint_trajectory" class="function"><a href="#StepperBase.stop_waypoint_trajectory">stop_waypoint_trajectory</a></dd>
                <dd id="Stepper_Protocol_P2.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P2.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P2.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P2.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P2.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P2.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P2.pack_trajectory_segment" class="function"><a href="#StepperBase.pack_trajectory_segment">pack_trajectory_segment</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_start_new_traj_reply" class="function"><a href="#StepperBase.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_set_next_traj_seg_reply" class="function"><a href="#StepperBase.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a></dd>
                <dd id="Stepper_Protocol_P2.rpc_reset_traj_reply" class="function"><a href="#StepperBase.rpc_reset_traj_reply">rpc_reset_traj_reply</a></dd>
                <dd id="Stepper_Protocol_P2.pull_status_aux" class="function"><a href="#StepperBase.pull_status_aux">pull_status_aux</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P2.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P2.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P2.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P2.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P2.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P2.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P2.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P2.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P2.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P2.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P2.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P2.write_device_params" class="function"><a href="device.html#Device.write_device_params">write_device_params</a></dd>
                <dd id="Stepper_Protocol_P2.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P2.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper_Protocol_P3">
                            <input id="Stepper_Protocol_P3-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper_Protocol_P3</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper_Protocol_P3-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3-1200"><a href="#Stepper_Protocol_P3-1200"><span class="linenos">1200</span></a><span class="k">class</span> <span class="nc">Stepper_Protocol_P3</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1201"><a href="#Stepper_Protocol_P3-1201"><span class="linenos">1201</span></a>
</span><span id="Stepper_Protocol_P3-1202"><a href="#Stepper_Protocol_P3-1202"><span class="linenos">1202</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1203"><a href="#Stepper_Protocol_P3-1203"><span class="linenos">1203</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1204"><a href="#Stepper_Protocol_P3-1204"><span class="linenos">1204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1205"><a href="#Stepper_Protocol_P3-1205"><span class="linenos">1205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3-1206"><a href="#Stepper_Protocol_P3-1206"><span class="linenos">1206</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1207"><a href="#Stepper_Protocol_P3-1207"><span class="linenos">1207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P3-1208"><a href="#Stepper_Protocol_P3-1208"><span class="linenos">1208</span></a>
</span><span id="Stepper_Protocol_P3-1209"><a href="#Stepper_Protocol_P3-1209"><span class="linenos">1209</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1210"><a href="#Stepper_Protocol_P3-1210"><span class="linenos">1210</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1211"><a href="#Stepper_Protocol_P3-1211"><span class="linenos">1211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1212"><a href="#Stepper_Protocol_P3-1212"><span class="linenos">1212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3-1213"><a href="#Stepper_Protocol_P3-1213"><span class="linenos">1213</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1214"><a href="#Stepper_Protocol_P3-1214"><span class="linenos">1214</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="Stepper_Protocol_P3-1215"><a href="#Stepper_Protocol_P3-1215"><span class="linenos">1215</span></a>
</span><span id="Stepper_Protocol_P3-1216"><a href="#Stepper_Protocol_P3-1216"><span class="linenos">1216</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1217"><a href="#Stepper_Protocol_P3-1217"><span class="linenos">1217</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1218"><a href="#Stepper_Protocol_P3-1218"><span class="linenos">1218</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3-1219"><a href="#Stepper_Protocol_P3-1219"><span class="linenos">1219</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P3-1220"><a href="#Stepper_Protocol_P3-1220"><span class="linenos">1220</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PUSH</span>
</span><span id="Stepper_Protocol_P3-1221"><a href="#Stepper_Protocol_P3-1221"><span class="linenos">1221</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span>
</span><span id="Stepper_Protocol_P3-1222"><a href="#Stepper_Protocol_P3-1222"><span class="linenos">1222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_push_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1223"><a href="#Stepper_Protocol_P3-1223"><span class="linenos">1223</span></a>
</span><span id="Stepper_Protocol_P3-1224"><a href="#Stepper_Protocol_P3-1224"><span class="linenos">1224</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1225"><a href="#Stepper_Protocol_P3-1225"><span class="linenos">1225</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1226"><a href="#Stepper_Protocol_P3-1226"><span class="linenos">1226</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3-1227"><a href="#Stepper_Protocol_P3-1227"><span class="linenos">1227</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PULL</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1228"><a href="#Stepper_Protocol_P3-1228"><span class="linenos">1228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_pull_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1229"><a href="#Stepper_Protocol_P3-1229"><span class="linenos">1229</span></a>
</span><span id="Stepper_Protocol_P3-1230"><a href="#Stepper_Protocol_P3-1230"><span class="linenos">1230</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_push_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1231"><a href="#Stepper_Protocol_P3-1231"><span class="linenos">1231</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PUSH</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1232"><a href="#Stepper_Protocol_P3-1232"><span class="linenos">1232</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PUSH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1233"><a href="#Stepper_Protocol_P3-1233"><span class="linenos">1233</span></a>
</span><span id="Stepper_Protocol_P3-1234"><a href="#Stepper_Protocol_P3-1234"><span class="linenos">1234</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_pull_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1235"><a href="#Stepper_Protocol_P3-1235"><span class="linenos">1235</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PULL</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1236"><a href="#Stepper_Protocol_P3-1236"><span class="linenos">1236</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Stepper_Protocol_P3-1237"><a href="#Stepper_Protocol_P3-1237"><span class="linenos">1237</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1238"><a href="#Stepper_Protocol_P3-1238"><span class="linenos">1238</span></a>                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">]:</span>
</span><span id="Stepper_Protocol_P3-1239"><a href="#Stepper_Protocol_P3-1239"><span class="linenos">1239</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load test pull bad data&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1240"><a href="#Stepper_Protocol_P3-1240"><span class="linenos">1240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="Stepper_Protocol_P3-1241"><a href="#Stepper_Protocol_P3-1241"><span class="linenos">1241</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successful load test pull&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1242"><a href="#Stepper_Protocol_P3-1242"><span class="linenos">1242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1243"><a href="#Stepper_Protocol_P3-1243"><span class="linenos">1243</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PULL&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1244"><a href="#Stepper_Protocol_P3-1244"><span class="linenos">1244</span></a>
</span><span id="Stepper_Protocol_P3-1245"><a href="#Stepper_Protocol_P3-1245"><span class="linenos">1245</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1246"><a href="#Stepper_Protocol_P3-1246"><span class="linenos">1246</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1247"><a href="#Stepper_Protocol_P3-1247"><span class="linenos">1247</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3-1248"><a href="#Stepper_Protocol_P3-1248"><span class="linenos">1248</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS_AUX</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1249"><a href="#Stepper_Protocol_P3-1249"><span class="linenos">1249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_aux_reply</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3-1250"><a href="#Stepper_Protocol_P3-1250"><span class="linenos">1250</span></a>
</span><span id="Stepper_Protocol_P3-1251"><a href="#Stepper_Protocol_P3-1251"><span class="linenos">1251</span></a>    <span class="k">def</span> <span class="nf">unpack_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1252"><a href="#Stepper_Protocol_P3-1252"><span class="linenos">1252</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3-1253"><a href="#Stepper_Protocol_P3-1253"><span class="linenos">1253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1254"><a href="#Stepper_Protocol_P3-1254"><span class="linenos">1254</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1255"><a href="#Stepper_Protocol_P3-1255"><span class="linenos">1255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1256"><a href="#Stepper_Protocol_P3-1256"><span class="linenos">1256</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1257"><a href="#Stepper_Protocol_P3-1257"><span class="linenos">1257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1258"><a href="#Stepper_Protocol_P3-1258"><span class="linenos">1258</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1259"><a href="#Stepper_Protocol_P3-1259"><span class="linenos">1259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1260"><a href="#Stepper_Protocol_P3-1260"><span class="linenos">1260</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1261"><a href="#Stepper_Protocol_P3-1261"><span class="linenos">1261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1262"><a href="#Stepper_Protocol_P3-1262"><span class="linenos">1262</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1263"><a href="#Stepper_Protocol_P3-1263"><span class="linenos">1263</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P3-1264"><a href="#Stepper_Protocol_P3-1264"><span class="linenos">1264</span></a>
</span><span id="Stepper_Protocol_P3-1265"><a href="#Stepper_Protocol_P3-1265"><span class="linenos">1265</span></a>    <span class="k">def</span> <span class="nf">rpc_status_aux_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1266"><a href="#Stepper_Protocol_P3-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS_AUX</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1267"><a href="#Stepper_Protocol_P3-1267"><span class="linenos">1267</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status_aux</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1268"><a href="#Stepper_Protocol_P3-1268"><span class="linenos">1268</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1269"><a href="#Stepper_Protocol_P3-1269"><span class="linenos">1269</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3-1270"><a href="#Stepper_Protocol_P3-1270"><span class="linenos">1270</span></a>
</span><span id="Stepper_Protocol_P3-1271"><a href="#Stepper_Protocol_P3-1271"><span class="linenos">1271</span></a>
</span><span id="Stepper_Protocol_P3-1272"><a href="#Stepper_Protocol_P3-1272"><span class="linenos">1272</span></a>    <span class="k">def</span> <span class="nf">unpack_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1273"><a href="#Stepper_Protocol_P3-1273"><span class="linenos">1273</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3-1274"><a href="#Stepper_Protocol_P3-1274"><span class="linenos">1274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1275"><a href="#Stepper_Protocol_P3-1275"><span class="linenos">1275</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3-1276"><a href="#Stepper_Protocol_P3-1276"><span class="linenos">1276</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span><span id="Stepper_Protocol_P3-1277"><a href="#Stepper_Protocol_P3-1277"><span class="linenos">1277</span></a>
</span><span id="Stepper_Protocol_P3-1278"><a href="#Stepper_Protocol_P3-1278"><span class="linenos">1278</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3-1279"><a href="#Stepper_Protocol_P3-1279"><span class="linenos">1279</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1280"><a href="#Stepper_Protocol_P3-1280"><span class="linenos">1280</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_command_reply</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3-1281"><a href="#Stepper_Protocol_P3-1281"><span class="linenos">1281</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3-1282"><a href="#Stepper_Protocol_P3-1282"><span class="linenos">1282</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper_Protocol_P3.rpc_start_new_traj_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_start_new_traj_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_start_new_traj_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_start_new_traj_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_start_new_traj_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1202"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1202"><span class="linenos">1202</span></a>    <span class="k">def</span> <span class="nf">rpc_start_new_traj_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1203"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1203"><span class="linenos">1203</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_START_NEW_TRAJECTORY</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1204"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1204"><span class="linenos">1204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1205"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1205"><span class="linenos">1205</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_error_msg</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1206"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1206"><span class="linenos">1206</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_start_new_traj_reply-1207"><a href="#Stepper_Protocol_P3.rpc_start_new_traj_reply-1207"><span class="linenos">1207</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_START_NEW_TRAJECTORY replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_set_next_traj_seg_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1209"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1209"><span class="linenos">1209</span></a>    <span class="k">def</span> <span class="nf">rpc_set_next_traj_seg_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1210"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1210"><span class="linenos">1210</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1211"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1211"><span class="linenos">1211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="n">unpack_uint8_t</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1212"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1212"><span class="linenos">1212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_set_next_traj_success</span> <span class="o">=</span> <span class="s1">&#39;SUCCESS&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_waypoint_traj_start_success</span> <span class="k">else</span> <span class="s1">&#39;FAIL&#39;</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1213"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1213"><span class="linenos">1213</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1214"><a href="#Stepper_Protocol_P3.rpc_set_next_traj_seg_reply-1214"><span class="linenos">1214</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;RPC_REPLY_SET_NEXT_TRAJECTORY_SEG replied </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.push_load_test" class="classattr">
                                        <input id="Stepper_Protocol_P3.push_load_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">push_load_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.push_load_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.push_load_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.push_load_test-1216"><a href="#Stepper_Protocol_P3.push_load_test-1216"><span class="linenos">1216</span></a>    <span class="k">def</span> <span class="nf">push_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1217"><a href="#Stepper_Protocol_P3.push_load_test-1217"><span class="linenos">1217</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1218"><a href="#Stepper_Protocol_P3.push_load_test-1218"><span class="linenos">1218</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1219"><a href="#Stepper_Protocol_P3.push_load_test-1219"><span class="linenos">1219</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_empty_payload</span><span class="p">()</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1220"><a href="#Stepper_Protocol_P3.push_load_test-1220"><span class="linenos">1220</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PUSH</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1221"><a href="#Stepper_Protocol_P3.push_load_test-1221"><span class="linenos">1221</span></a>        <span class="n">payload</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span>
</span><span id="Stepper_Protocol_P3.push_load_test-1222"><a href="#Stepper_Protocol_P3.push_load_test-1222"><span class="linenos">1222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_push_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_push_reply</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.pull_load_test" class="classattr">
                                        <input id="Stepper_Protocol_P3.pull_load_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_load_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.pull_load_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.pull_load_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.pull_load_test-1224"><a href="#Stepper_Protocol_P3.pull_load_test-1224"><span class="linenos">1224</span></a>    <span class="k">def</span> <span class="nf">pull_load_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1225"><a href="#Stepper_Protocol_P3.pull_load_test-1225"><span class="linenos">1225</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1226"><a href="#Stepper_Protocol_P3.pull_load_test-1226"><span class="linenos">1226</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1227"><a href="#Stepper_Protocol_P3.pull_load_test-1227"><span class="linenos">1227</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_LOAD_TEST_PULL</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3.pull_load_test-1228"><a href="#Stepper_Protocol_P3.pull_load_test-1228"><span class="linenos">1228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_load_test_pull_reply</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.rpc_load_test_push_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_load_test_push_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_load_test_push_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_load_test_push_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_load_test_push_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1230"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1230"><span class="linenos">1230</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_push_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1231"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1231"><span class="linenos">1231</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PUSH</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_push_reply-1232"><a href="#Stepper_Protocol_P3.rpc_load_test_push_reply-1232"><span class="linenos">1232</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PUSH&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.rpc_load_test_pull_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_load_test_pull_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_load_test_pull_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_load_test_pull_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_load_test_pull_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1234"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1234"><span class="linenos">1234</span></a>    <span class="k">def</span> <span class="nf">rpc_load_test_pull_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1235"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1235"><span class="linenos">1235</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_LOAD_TEST_PULL</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1236"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1236"><span class="linenos">1236</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1237"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1237"><span class="linenos">1237</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1238"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1238"><span class="linenos">1238</span></a>                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">]:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1239"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1239"><span class="linenos">1239</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load test pull bad data&#39;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1240"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1240"><span class="linenos">1240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_test_payload</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1241"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1241"><span class="linenos">1241</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successful load test pull&#39;</span><span class="p">)</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1242"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1242"><span class="linenos">1242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_load_test_pull_reply-1243"><a href="#Stepper_Protocol_P3.rpc_load_test_pull_reply-1243"><span class="linenos">1243</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_LOAD_TEST_PULL&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.pull_status_aux" class="classattr">
                                        <input id="Stepper_Protocol_P3.pull_status_aux-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pull_status_aux</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.pull_status_aux-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.pull_status_aux"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.pull_status_aux-1245"><a href="#Stepper_Protocol_P3.pull_status_aux-1245"><span class="linenos">1245</span></a>    <span class="k">def</span> <span class="nf">pull_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1246"><a href="#Stepper_Protocol_P3.pull_status_aux-1246"><span class="linenos">1246</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1247"><a href="#Stepper_Protocol_P3.pull_status_aux-1247"><span class="linenos">1247</span></a>            <span class="k">return</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1248"><a href="#Stepper_Protocol_P3.pull_status_aux-1248"><span class="linenos">1248</span></a>        <span class="n">payload</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_GET_STATUS_AUX</span><span class="p">])</span>
</span><span id="Stepper_Protocol_P3.pull_status_aux-1249"><a href="#Stepper_Protocol_P3.pull_status_aux-1249"><span class="linenos">1249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">do_pull_rpc_sync</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_status_aux_reply</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.unpack_status_aux" class="classattr">
                                        <input id="Stepper_Protocol_P3.unpack_status_aux-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_status_aux</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.unpack_status_aux-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.unpack_status_aux"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.unpack_status_aux-1251"><a href="#Stepper_Protocol_P3.unpack_status_aux-1251"><span class="linenos">1251</span></a>    <span class="k">def</span> <span class="nf">unpack_status_aux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1252"><a href="#Stepper_Protocol_P3.unpack_status_aux-1252"><span class="linenos">1252</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1253"><a href="#Stepper_Protocol_P3.unpack_status_aux-1253"><span class="linenos">1253</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_rpc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1254"><a href="#Stepper_Protocol_P3.unpack_status_aux-1254"><span class="linenos">1254</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1255"><a href="#Stepper_Protocol_P3.unpack_status_aux-1255"><span class="linenos">1255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_cnt_exec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1256"><a href="#Stepper_Protocol_P3.unpack_status_aux-1256"><span class="linenos">1256</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1257"><a href="#Stepper_Protocol_P3.unpack_status_aux-1257"><span class="linenos">1257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;cmd_rpc_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1258"><a href="#Stepper_Protocol_P3.unpack_status_aux-1258"><span class="linenos">1258</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1259"><a href="#Stepper_Protocol_P3.unpack_status_aux-1259"><span class="linenos">1259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1260"><a href="#Stepper_Protocol_P3.unpack_status_aux-1260"><span class="linenos">1260</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1261"><a href="#Stepper_Protocol_P3.unpack_status_aux-1261"><span class="linenos">1261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status_aux</span><span class="p">[</span><span class="s1">&#39;sync_irq_overflow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1262"><a href="#Stepper_Protocol_P3.unpack_status_aux-1262"><span class="linenos">1262</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_status_aux-1263"><a href="#Stepper_Protocol_P3.unpack_status_aux-1263"><span class="linenos">1263</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.rpc_status_aux_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_status_aux_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_status_aux_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_status_aux_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_status_aux_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1265"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1265"><span class="linenos">1265</span></a>    <span class="k">def</span> <span class="nf">rpc_status_aux_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1266"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_STATUS_AUX</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1267"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1267"><span class="linenos">1267</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_status_aux</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1268"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1268"><span class="linenos">1268</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_status_aux_reply-1269"><a href="#Stepper_Protocol_P3.rpc_status_aux_reply-1269"><span class="linenos">1269</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_STATUS&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.unpack_command_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.unpack_command_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unpack_command_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.unpack_command_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.unpack_command_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.unpack_command_reply-1272"><a href="#Stepper_Protocol_P3.unpack_command_reply-1272"><span class="linenos">1272</span></a>    <span class="k">def</span> <span class="nf">unpack_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1273"><a href="#Stepper_Protocol_P3.unpack_command_reply-1273"><span class="linenos">1273</span></a>        <span class="n">sidx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1274"><a href="#Stepper_Protocol_P3.unpack_command_reply-1274"><span class="linenos">1274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;ctrl_cycle_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unpack_uint16_t</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">sidx</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1275"><a href="#Stepper_Protocol_P3.unpack_command_reply-1275"><span class="linenos">1275</span></a>        <span class="n">sidx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="Stepper_Protocol_P3.unpack_command_reply-1276"><a href="#Stepper_Protocol_P3.unpack_command_reply-1276"><span class="linenos">1276</span></a>        <span class="k">return</span> <span class="n">sidx</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper_Protocol_P3.rpc_command_reply" class="classattr">
                                        <input id="Stepper_Protocol_P3.rpc_command_reply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rpc_command_reply</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">reply</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper_Protocol_P3.rpc_command_reply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper_Protocol_P3.rpc_command_reply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper_Protocol_P3.rpc_command_reply-1278"><a href="#Stepper_Protocol_P3.rpc_command_reply-1278"><span class="linenos">1278</span></a>    <span class="k">def</span> <span class="nf">rpc_command_reply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1279"><a href="#Stepper_Protocol_P3.rpc_command_reply-1279"><span class="linenos">1279</span></a>        <span class="k">if</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_REPLY_COMMAND</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1280"><a href="#Stepper_Protocol_P3.rpc_command_reply-1280"><span class="linenos">1280</span></a>            <span class="n">nr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_command_reply</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1281"><a href="#Stepper_Protocol_P3.rpc_command_reply-1281"><span class="linenos">1281</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper_Protocol_P3.rpc_command_reply-1282"><a href="#Stepper_Protocol_P3.rpc_command_reply-1282"><span class="linenos">1282</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error RPC_REPLY_COMMAND&#39;</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper_Protocol_P3.__init__" class="function"><a href="#StepperBase.__init__">StepperBase</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_COMMAND" class="variable"><a href="#StepperBase.RPC_SET_COMMAND">RPC_SET_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_COMMAND" class="variable"><a href="#StepperBase.RPC_REPLY_COMMAND">RPC_REPLY_COMMAND</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_GET_STATUS" class="variable"><a href="#StepperBase.RPC_GET_STATUS">RPC_GET_STATUS</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_STATUS" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS">RPC_REPLY_STATUS</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_GAINS" class="variable"><a href="#StepperBase.RPC_SET_GAINS">RPC_SET_GAINS</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_GAINS" class="variable"><a href="#StepperBase.RPC_REPLY_GAINS">RPC_REPLY_GAINS</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PUSH">RPC_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH">RPC_REPLY_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_SET_TRIGGER">RPC_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_REPLY_SET_TRIGGER">RPC_REPLY_SET_TRIGGER</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_SET_ENC_CALIB">RPC_SET_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_REPLY_ENC_CALIB">RPC_REPLY_ENC_CALIB</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_READ_GAINS_FROM_FLASH">RPC_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH">RPC_REPLY_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_MENU_ON" class="variable"><a href="#StepperBase.RPC_SET_MENU_ON">RPC_SET_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_MENU_ON" class="variable"><a href="#StepperBase.RPC_REPLY_MENU_ON">RPC_REPLY_MENU_ON</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_GET_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO">RPC_GET_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO">RPC_REPLY_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_SET_MOTION_LIMITS">RPC_SET_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_REPLY_MOTION_LIMITS">RPC_REPLY_MOTION_LIMITS</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG">RPC_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_START_NEW_TRAJECTORY">RPC_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY">RPC_REPLY_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_RESET_TRAJECTORY">RPC_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY">RPC_REPLY_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_READ_TRACE" class="variable"><a href="#StepperBase.RPC_READ_TRACE">RPC_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_READ_TRACE" class="variable"><a href="#StepperBase.RPC_REPLY_READ_TRACE">RPC_REPLY_READ_TRACE</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_GET_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_GET_STATUS_AUX">RPC_GET_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS_AUX">RPC_REPLY_STATUS_AUX</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PULL">RPC_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P3.RPC_REPLY_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL">RPC_REPLY_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_SAFETY" class="variable"><a href="#StepperBase.MODE_SAFETY">MODE_SAFETY</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_FREEWHEEL" class="variable"><a href="#StepperBase.MODE_FREEWHEEL">MODE_FREEWHEEL</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_HOLD" class="variable"><a href="#StepperBase.MODE_HOLD">MODE_HOLD</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_POS_PID" class="variable"><a href="#StepperBase.MODE_POS_PID">MODE_POS_PID</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_VEL_PID" class="variable"><a href="#StepperBase.MODE_VEL_PID">MODE_VEL_PID</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_POS_TRAJ" class="variable"><a href="#StepperBase.MODE_POS_TRAJ">MODE_POS_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_VEL_TRAJ" class="variable"><a href="#StepperBase.MODE_VEL_TRAJ">MODE_VEL_TRAJ</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_CURRENT" class="variable"><a href="#StepperBase.MODE_CURRENT">MODE_CURRENT</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_POS_TRAJ_INCR" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_INCR">MODE_POS_TRAJ_INCR</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_POS_TRAJ_WAYPOINT" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_WAYPOINT">MODE_POS_TRAJ_WAYPOINT</a></dd>
                <dd id="Stepper_Protocol_P3.MODE_NAMES" class="variable"><a href="#StepperBase.MODE_NAMES">MODE_NAMES</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_POS_CALIBRATED" class="variable"><a href="#StepperBase.DIAG_POS_CALIBRATED">DIAG_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_RUNSTOP_ON" class="variable"><a href="#StepperBase.DIAG_RUNSTOP_ON">DIAG_RUNSTOP_ON</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_NEAR_POS_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_POS_SETPOINT">DIAG_NEAR_POS_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_NEAR_VEL_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_VEL_SETPOINT">DIAG_NEAR_VEL_SETPOINT</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IS_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MOVING">DIAG_IS_MOVING</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_AT_CURRENT_LIMIT" class="variable"><a href="#StepperBase.DIAG_AT_CURRENT_LIMIT">DIAG_AT_CURRENT_LIMIT</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IS_MG_ACCELERATING" class="variable"><a href="#StepperBase.DIAG_IS_MG_ACCELERATING">DIAG_IS_MG_ACCELERATING</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IS_MG_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MG_MOVING">DIAG_IS_MG_MOVING</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_CALIBRATION_RCVD" class="variable"><a href="#StepperBase.DIAG_CALIBRATION_RCVD">DIAG_CALIBRATION_RCVD</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IN_GUARDED_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_GUARDED_EVENT">DIAG_IN_GUARDED_EVENT</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IN_SAFETY_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_SAFETY_EVENT">DIAG_IN_SAFETY_EVENT</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_WAITING_ON_SYNC">DIAG_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_TRAJ_ACTIVE" class="variable"><a href="#StepperBase.DIAG_TRAJ_ACTIVE">DIAG_TRAJ_ACTIVE</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_TRAJ_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC">DIAG_TRAJ_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IN_SYNC_MODE" class="variable"><a href="#StepperBase.DIAG_IN_SYNC_MODE">DIAG_IN_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P3.DIAG_IS_TRACE_ON" class="variable"><a href="#StepperBase.DIAG_IS_TRACE_ON">DIAG_IS_TRACE_ON</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_SAFETY_HOLD" class="variable"><a href="#StepperBase.CONFIG_SAFETY_HOLD">CONFIG_SAFETY_HOLD</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_ENABLE_RUNSTOP" class="variable"><a href="#StepperBase.CONFIG_ENABLE_RUNSTOP">CONFIG_ENABLE_RUNSTOP</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_ENABLE_SYNC_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_SYNC_MODE">CONFIG_ENABLE_SYNC_MODE</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_ENABLE_GUARDED_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE">CONFIG_ENABLE_GUARDED_MODE</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_FLIP_ENCODER_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY">CONFIG_FLIP_ENCODER_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_FLIP_EFFORT_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY">CONFIG_FLIP_EFFORT_POLARITY</a></dd>
                <dd id="Stepper_Protocol_P3.CONFIG_ENABLE_VEL_WATCHDOG" class="variable"><a href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG">CONFIG_ENABLE_VEL_WATCHDOG</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_MARK_POS" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS">TRIGGER_MARK_POS</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_RESET_MOTION_GEN" class="variable"><a href="#StepperBase.TRIGGER_RESET_MOTION_GEN">TRIGGER_RESET_MOTION_GEN</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_BOARD_RESET" class="variable"><a href="#StepperBase.TRIGGER_BOARD_RESET">TRIGGER_BOARD_RESET</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_WRITE_GAINS_TO_FLASH" class="variable"><a href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH">TRIGGER_WRITE_GAINS_TO_FLASH</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_RESET_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED">TRIGGER_RESET_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_POS_CALIBRATED">TRIGGER_POS_CALIBRATED</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_MARK_POS_ON_CONTACT" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT">TRIGGER_MARK_POS_ON_CONTACT</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_ENABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_ENABLE_TRACE">TRIGGER_ENABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P3.TRIGGER_DISABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_DISABLE_TRACE">TRIGGER_DISABLE_TRACE</a></dd>
                <dd id="Stepper_Protocol_P3.TRACE_TYPE_STATUS" class="variable"><a href="#StepperBase.TRACE_TYPE_STATUS">TRACE_TYPE_STATUS</a></dd>
                <dd id="Stepper_Protocol_P3.TRACE_TYPE_DEBUG" class="variable"><a href="#StepperBase.TRACE_TYPE_DEBUG">TRACE_TYPE_DEBUG</a></dd>
                <dd id="Stepper_Protocol_P3.TRACE_TYPE_PRINT" class="variable"><a href="#StepperBase.TRACE_TYPE_PRINT">TRACE_TYPE_PRINT</a></dd>
                <dd id="Stepper_Protocol_P3.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper_Protocol_P3.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper_Protocol_P3.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper_Protocol_P3.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper_Protocol_P3.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper_Protocol_P3.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper_Protocol_P3.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper_Protocol_P3.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper_Protocol_P3.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper_Protocol_P3.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper_Protocol_P3.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper_Protocol_P3.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper_Protocol_P3.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper_Protocol_P3.startup" class="function"><a href="#StepperBase.startup">startup</a></dd>
                <dd id="Stepper_Protocol_P3.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper_Protocol_P3.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper_Protocol_P3.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper_Protocol_P3.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper_Protocol_P3.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper_Protocol_P3.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper_Protocol_P3.pretty_print" class="function"><a href="#StepperBase.pretty_print">pretty_print</a></dd>
                <dd id="Stepper_Protocol_P3.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper_Protocol_P3.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P3.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper_Protocol_P3.write_gains_to_YAML" class="function"><a href="#StepperBase.write_gains_to_YAML">write_gains_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper_Protocol_P3.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper_Protocol_P3.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper_Protocol_P3.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper_Protocol_P3.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper_Protocol_P3.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper_Protocol_P3.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P3.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper_Protocol_P3.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper_Protocol_P3.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper_Protocol_P3.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper_Protocol_P3.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper_Protocol_P3.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_traj_waypoint" class="function"><a href="#StepperBase.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a></dd>
                <dd id="Stepper_Protocol_P3.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper_Protocol_P3.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper_Protocol_P3.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P3.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper_Protocol_P3.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper_Protocol_P3.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper_Protocol_P3.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P3.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper_Protocol_P3.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper_Protocol_P3.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper_Protocol_P3.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper_Protocol_P3.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper_Protocol_P3.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper_Protocol_P3.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper_Protocol_P3.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper_Protocol_P3.current_to_torque" class="function"><a href="#StepperBase.current_to_torque">current_to_torque</a></dd>
                <dd id="Stepper_Protocol_P3.torque_to_current" class="function"><a href="#StepperBase.torque_to_current">torque_to_current</a></dd>
                <dd id="Stepper_Protocol_P3.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper_Protocol_P3.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper_Protocol_P3.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper_Protocol_P3.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper_Protocol_P3.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper_Protocol_P3.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper_Protocol_P3.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper_Protocol_P3.start_waypoint_trajectory" class="function"><a href="#StepperBase.start_waypoint_trajectory">start_waypoint_trajectory</a></dd>
                <dd id="Stepper_Protocol_P3.set_next_trajectory_segment" class="function"><a href="#StepperBase.set_next_trajectory_segment">set_next_trajectory_segment</a></dd>
                <dd id="Stepper_Protocol_P3.stop_waypoint_trajectory" class="function"><a href="#StepperBase.stop_waypoint_trajectory">stop_waypoint_trajectory</a></dd>
                <dd id="Stepper_Protocol_P3.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper_Protocol_P3.unpack_status" class="function"><a href="#StepperBase.unpack_status">unpack_status</a></dd>
                <dd id="Stepper_Protocol_P3.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper_Protocol_P3.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper_Protocol_P3.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper_Protocol_P3.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper_Protocol_P3.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper_Protocol_P3.pack_trajectory_segment" class="function"><a href="#StepperBase.pack_trajectory_segment">pack_trajectory_segment</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_reset_traj_reply" class="function"><a href="#StepperBase.rpc_reset_traj_reply">rpc_reset_traj_reply</a></dd>
                <dd id="Stepper_Protocol_P3.rpc_read_firmware_trace_reply" class="function"><a href="#StepperBase.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a></dd>
                <dd id="Stepper_Protocol_P3.enable_firmware_trace" class="function"><a href="#StepperBase.enable_firmware_trace">enable_firmware_trace</a></dd>
                <dd id="Stepper_Protocol_P3.disable_firmware_trace" class="function"><a href="#StepperBase.disable_firmware_trace">disable_firmware_trace</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper_Protocol_P3.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper_Protocol_P3.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper_Protocol_P3.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper_Protocol_P3.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper_Protocol_P3.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper_Protocol_P3.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper_Protocol_P3.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper_Protocol_P3.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper_Protocol_P3.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper_Protocol_P3.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper_Protocol_P3.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper_Protocol_P3.write_device_params" class="function"><a href="device.html#Device.write_device_params">write_device_params</a></dd>
                <dd id="Stepper_Protocol_P3.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper_Protocol_P3.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Stepper">
                            <input id="Stepper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Stepper</span><wbr>(<span class="base"><a href="#StepperBase">StepperBase</a></span>):

                <label class="view-source-button" for="Stepper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper-1285"><a href="#Stepper-1285"><span class="linenos">1285</span></a><span class="k">class</span> <span class="nc">Stepper</span><span class="p">(</span><span class="n">StepperBase</span><span class="p">):</span>
</span><span id="Stepper-1286"><a href="#Stepper-1286"><span class="linenos">1286</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Stepper-1287"><a href="#Stepper-1287"><span class="linenos">1287</span></a><span class="sd">    API to the Stretch Stepper Board</span>
</span><span id="Stepper-1288"><a href="#Stepper-1288"><span class="linenos">1288</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Stepper-1289"><a href="#Stepper-1289"><span class="linenos">1289</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper-1290"><a href="#Stepper-1290"><span class="linenos">1290</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper-1291"><a href="#Stepper-1291"><span class="linenos">1291</span></a>        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
</span><span id="Stepper-1292"><a href="#Stepper-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper-1293"><a href="#Stepper-1293"><span class="linenos">1293</span></a>                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper-1294"><a href="#Stepper-1294"><span class="linenos">1294</span></a>                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper-1295"><a href="#Stepper-1295"><span class="linenos">1295</span></a>                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P3</span><span class="p">,</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,)}</span>
</span><span id="Stepper-1296"><a href="#Stepper-1296"><span class="linenos">1296</span></a>    
</span><span id="Stepper-1297"><a href="#Stepper-1297"><span class="linenos">1297</span></a>    <span class="k">def</span> <span class="nf">expand_protocol_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_class</span><span class="p">):</span>
</span><span id="Stepper-1298"><a href="#Stepper-1298"><span class="linenos">1298</span></a>        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">protocol_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Stepper-1299"><a href="#Stepper-1299"><span class="linenos">1299</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
</span><span id="Stepper-1300"><a href="#Stepper-1300"><span class="linenos">1300</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stepper</span><span class="p">))</span>
</span><span id="Stepper-1301"><a href="#Stepper-1301"><span class="linenos">1301</span></a>                
</span><span id="Stepper-1302"><a href="#Stepper-1302"><span class="linenos">1302</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Stepper-1303"><a href="#Stepper-1303"><span class="linenos">1303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Stepper-1304"><a href="#Stepper-1304"><span class="linenos">1304</span></a><span class="sd">        First determine which protocol version the uC firmware is running.</span>
</span><span id="Stepper-1305"><a href="#Stepper-1305"><span class="linenos">1305</span></a><span class="sd">        Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</span>
</span><span id="Stepper-1306"><a href="#Stepper-1306"><span class="linenos">1306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper-1307"><a href="#Stepper-1307"><span class="linenos">1307</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="Stepper-1308"><a href="#Stepper-1308"><span class="linenos">1308</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper-1309"><a href="#Stepper-1309"><span class="linenos">1309</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
</span><span id="Stepper-1310"><a href="#Stepper-1310"><span class="linenos">1310</span></a>                <span class="n">protocol_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
</span><span id="Stepper-1311"><a href="#Stepper-1311"><span class="linenos">1311</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Stepper-1312"><a href="#Stepper-1312"><span class="linenos">1312</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_protocol_methods</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Stepper-1313"><a href="#Stepper-1313"><span class="linenos">1313</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper-1314"><a href="#Stepper-1314"><span class="linenos">1314</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper-1315"><a href="#Stepper-1315"><span class="linenos">1315</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper-1316"><a href="#Stepper-1316"><span class="linenos">1316</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper-1317"><a href="#Stepper-1317"><span class="linenos">1317</span></a><span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
</span><span id="Stepper-1318"><a href="#Stepper-1318"><span class="linenos">1318</span></a><span class="s2">                                    Please power cycle the robot and try again.</span>
</span><span id="Stepper-1319"><a href="#Stepper-1319"><span class="linenos">1319</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper-1320"><a href="#Stepper-1320"><span class="linenos">1320</span></a><span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper-1321"><a href="#Stepper-1321"><span class="linenos">1321</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper-1322"><a href="#Stepper-1322"><span class="linenos">1322</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper-1323"><a href="#Stepper-1323"><span class="linenos">1323</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper-1324"><a href="#Stepper-1324"><span class="linenos">1324</span></a><span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
</span><span id="Stepper-1325"><a href="#Stepper-1325"><span class="linenos">1325</span></a><span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
</span><span id="Stepper-1326"><a href="#Stepper-1326"><span class="linenos">1326</span></a><span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
</span><span id="Stepper-1327"><a href="#Stepper-1327"><span class="linenos">1327</span></a><span class="s2">                    Disabling device.</span>
</span><span id="Stepper-1328"><a href="#Stepper-1328"><span class="linenos">1328</span></a><span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
</span><span id="Stepper-1329"><a href="#Stepper-1329"><span class="linenos">1329</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper-1330"><a href="#Stepper-1330"><span class="linenos">1330</span></a><span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Stepper-1331"><a href="#Stepper-1331"><span class="linenos">1331</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
</span><span id="Stepper-1332"><a href="#Stepper-1332"><span class="linenos">1332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Stepper-1333"><a href="#Stepper-1333"><span class="linenos">1333</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Stepper-1334"><a href="#Stepper-1334"><span class="linenos">1334</span></a>
</span><span id="Stepper-1335"><a href="#Stepper-1335"><span class="linenos">1335</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper-1336"><a href="#Stepper-1336"><span class="linenos">1336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="Stepper-1337"><a href="#Stepper-1337"><span class="linenos">1337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper-1338"><a href="#Stepper-1338"><span class="linenos">1338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="Stepper-1339"><a href="#Stepper-1339"><span class="linenos">1339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="Stepper-1340"><a href="#Stepper-1340"><span class="linenos">1340</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</span></pre></div>


            <div class="docstring"><p>API to the Stretch Stepper Board</p>
</div>


                            <div id="Stepper.__init__" class="classattr">
                                        <input id="Stepper.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Stepper</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">usb</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Stepper.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper.__init__-1289"><a href="#Stepper.__init__-1289"><span class="linenos">1289</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Stepper.__init__-1290"><a href="#Stepper.__init__-1290"><span class="linenos">1290</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">usb</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper.__init__-1291"><a href="#Stepper.__init__-1291"><span class="linenos">1291</span></a>        <span class="c1"># Order in descending order so more recent protocols/methods override less recent</span>
</span><span id="Stepper.__init__-1292"><a href="#Stepper.__init__-1292"><span class="linenos">1292</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;p0&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper.__init__-1293"><a href="#Stepper.__init__-1293"><span class="linenos">1293</span></a>                                    <span class="s1">&#39;p1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper.__init__-1294"><a href="#Stepper.__init__-1294"><span class="linenos">1294</span></a>                                    <span class="s1">&#39;p2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,),</span>
</span><span id="Stepper.__init__-1295"><a href="#Stepper.__init__-1295"><span class="linenos">1295</span></a>                                    <span class="s1">&#39;p3&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">Stepper_Protocol_P3</span><span class="p">,</span><span class="n">Stepper_Protocol_P2</span><span class="p">,</span><span class="n">Stepper_Protocol_P1</span><span class="p">,</span><span class="n">Stepper_Protocol_P0</span><span class="p">,)}</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper.supported_protocols" class="classattr">
                                <div class="attr variable">
            <span class="name">supported_protocols</span>

        
    </div>
    <a class="headerlink" href="#Stepper.supported_protocols"></a>
    
    

                            </div>
                            <div id="Stepper.expand_protocol_methods" class="classattr">
                                        <input id="Stepper.expand_protocol_methods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">expand_protocol_methods</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">protocol_class</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper.expand_protocol_methods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper.expand_protocol_methods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper.expand_protocol_methods-1297"><a href="#Stepper.expand_protocol_methods-1297"><span class="linenos">1297</span></a>    <span class="k">def</span> <span class="nf">expand_protocol_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol_class</span><span class="p">):</span>
</span><span id="Stepper.expand_protocol_methods-1298"><a href="#Stepper.expand_protocol_methods-1298"><span class="linenos">1298</span></a>        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">protocol_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Stepper.expand_protocol_methods-1299"><a href="#Stepper.expand_protocol_methods-1299"><span class="linenos">1299</span></a>            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">):</span>
</span><span id="Stepper.expand_protocol_methods-1300"><a href="#Stepper.expand_protocol_methods-1300"><span class="linenos">1300</span></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Stepper</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Stepper.startup" class="classattr">
                                        <input id="Stepper.startup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">startup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">threaded</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Stepper.startup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Stepper.startup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Stepper.startup-1302"><a href="#Stepper.startup-1302"><span class="linenos">1302</span></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Stepper.startup-1303"><a href="#Stepper.startup-1303"><span class="linenos">1303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Stepper.startup-1304"><a href="#Stepper.startup-1304"><span class="linenos">1304</span></a><span class="sd">        First determine which protocol version the uC firmware is running.</span>
</span><span id="Stepper.startup-1305"><a href="#Stepper.startup-1305"><span class="linenos">1305</span></a><span class="sd">        Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</span>
</span><span id="Stepper.startup-1306"><a href="#Stepper.startup-1306"><span class="linenos">1306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Stepper.startup-1307"><a href="#Stepper.startup-1307"><span class="linenos">1307</span></a>        <span class="n">StepperBase</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="n">threaded</span><span class="p">)</span>
</span><span id="Stepper.startup-1308"><a href="#Stepper.startup-1308"><span class="linenos">1308</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper.startup-1309"><a href="#Stepper.startup-1309"><span class="linenos">1309</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">:</span>
</span><span id="Stepper.startup-1310"><a href="#Stepper.startup-1310"><span class="linenos">1310</span></a>                <span class="n">protocol_classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]]</span>
</span><span id="Stepper.startup-1311"><a href="#Stepper.startup-1311"><span class="linenos">1311</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">protocol_classes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Stepper.startup-1312"><a href="#Stepper.startup-1312"><span class="linenos">1312</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">expand_protocol_methods</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="Stepper.startup-1313"><a href="#Stepper.startup-1313"><span class="linenos">1313</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper.startup-1314"><a href="#Stepper.startup-1314"><span class="linenos">1314</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Stepper.startup-1315"><a href="#Stepper.startup-1315"><span class="linenos">1315</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper.startup-1316"><a href="#Stepper.startup-1316"><span class="linenos">1316</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper.startup-1317"><a href="#Stepper.startup-1317"><span class="linenos">1317</span></a><span class="s2">                                    Failure in communications for </span><span class="si">{0}</span><span class="s2"> on startup.</span>
</span><span id="Stepper.startup-1318"><a href="#Stepper.startup-1318"><span class="linenos">1318</span></a><span class="s2">                                    Please power cycle the robot and try again.</span>
</span><span id="Stepper.startup-1319"><a href="#Stepper.startup-1319"><span class="linenos">1319</span></a><span class="s2">                                    ----------------</span>
</span><span id="Stepper.startup-1320"><a href="#Stepper.startup-1320"><span class="linenos">1320</span></a><span class="s2">                                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="Stepper.startup-1321"><a href="#Stepper.startup-1321"><span class="linenos">1321</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Stepper.startup-1322"><a href="#Stepper.startup-1322"><span class="linenos">1322</span></a>                    <span class="n">protocol_msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="Stepper.startup-1323"><a href="#Stepper.startup-1323"><span class="linenos">1323</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper.startup-1324"><a href="#Stepper.startup-1324"><span class="linenos">1324</span></a><span class="s2">                    Firmware protocol mismatch on </span><span class="si">{0}</span><span class="s2">.</span>
</span><span id="Stepper.startup-1325"><a href="#Stepper.startup-1325"><span class="linenos">1325</span></a><span class="s2">                    Protocol on board is </span><span class="si">{1}</span><span class="s2">.</span>
</span><span id="Stepper.startup-1326"><a href="#Stepper.startup-1326"><span class="linenos">1326</span></a><span class="s2">                    Valid protocols are: </span><span class="si">{2}</span><span class="s2">.</span>
</span><span id="Stepper.startup-1327"><a href="#Stepper.startup-1327"><span class="linenos">1327</span></a><span class="s2">                    Disabling device.</span>
</span><span id="Stepper.startup-1328"><a href="#Stepper.startup-1328"><span class="linenos">1328</span></a><span class="s2">                    Please upgrade the firmware and/or version of Stretch Body.</span>
</span><span id="Stepper.startup-1329"><a href="#Stepper.startup-1329"><span class="linenos">1329</span></a><span class="s2">                    ----------------</span>
</span><span id="Stepper.startup-1330"><a href="#Stepper.startup-1330"><span class="linenos">1330</span></a><span class="s2">                    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_info</span><span class="p">[</span><span class="s1">&#39;protocol_version&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Stepper.startup-1331"><a href="#Stepper.startup-1331"><span class="linenos">1331</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">protocol_msg</span><span class="p">))</span>
</span><span id="Stepper.startup-1332"><a href="#Stepper.startup-1332"><span class="linenos">1332</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Stepper.startup-1333"><a href="#Stepper.startup-1333"><span class="linenos">1333</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Stepper.startup-1334"><a href="#Stepper.startup-1334"><span class="linenos">1334</span></a>
</span><span id="Stepper.startup-1335"><a href="#Stepper.startup-1335"><span class="linenos">1335</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span><span class="p">:</span>
</span><span id="Stepper.startup-1336"><a href="#Stepper.startup-1336"><span class="linenos">1336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">enable_safety</span><span class="p">()</span>
</span><span id="Stepper.startup-1337"><a href="#Stepper.startup-1337"><span class="linenos">1337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dirty_gains</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Stepper.startup-1338"><a href="#Stepper.startup-1338"><span class="linenos">1338</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pull_status</span><span class="p">()</span>
</span><span id="Stepper.startup-1339"><a href="#Stepper.startup-1339"><span class="linenos">1339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">push_command</span><span class="p">()</span>
</span><span id="Stepper.startup-1340"><a href="#Stepper.startup-1340"><span class="linenos">1340</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hw_valid</span>
</span></pre></div>


            <div class="docstring"><p>First determine which protocol version the uC firmware is running.
Based on that version, populates Stepper class with the supported specific Stepper_protocol_P* class methods.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StepperBase">StepperBase</a></dt>
                                <dd id="Stepper.RPC_SET_COMMAND" class="variable"><a href="#StepperBase.RPC_SET_COMMAND">RPC_SET_COMMAND</a></dd>
                <dd id="Stepper.RPC_REPLY_COMMAND" class="variable"><a href="#StepperBase.RPC_REPLY_COMMAND">RPC_REPLY_COMMAND</a></dd>
                <dd id="Stepper.RPC_GET_STATUS" class="variable"><a href="#StepperBase.RPC_GET_STATUS">RPC_GET_STATUS</a></dd>
                <dd id="Stepper.RPC_REPLY_STATUS" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS">RPC_REPLY_STATUS</a></dd>
                <dd id="Stepper.RPC_SET_GAINS" class="variable"><a href="#StepperBase.RPC_SET_GAINS">RPC_SET_GAINS</a></dd>
                <dd id="Stepper.RPC_REPLY_GAINS" class="variable"><a href="#StepperBase.RPC_REPLY_GAINS">RPC_REPLY_GAINS</a></dd>
                <dd id="Stepper.RPC_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PUSH">RPC_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper.RPC_REPLY_LOAD_TEST_PUSH" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PUSH">RPC_REPLY_LOAD_TEST_PUSH</a></dd>
                <dd id="Stepper.RPC_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_SET_TRIGGER">RPC_SET_TRIGGER</a></dd>
                <dd id="Stepper.RPC_REPLY_SET_TRIGGER" class="variable"><a href="#StepperBase.RPC_REPLY_SET_TRIGGER">RPC_REPLY_SET_TRIGGER</a></dd>
                <dd id="Stepper.RPC_SET_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_SET_ENC_CALIB">RPC_SET_ENC_CALIB</a></dd>
                <dd id="Stepper.RPC_REPLY_ENC_CALIB" class="variable"><a href="#StepperBase.RPC_REPLY_ENC_CALIB">RPC_REPLY_ENC_CALIB</a></dd>
                <dd id="Stepper.RPC_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_READ_GAINS_FROM_FLASH">RPC_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper.RPC_REPLY_READ_GAINS_FROM_FLASH" class="variable"><a href="#StepperBase.RPC_REPLY_READ_GAINS_FROM_FLASH">RPC_REPLY_READ_GAINS_FROM_FLASH</a></dd>
                <dd id="Stepper.RPC_SET_MENU_ON" class="variable"><a href="#StepperBase.RPC_SET_MENU_ON">RPC_SET_MENU_ON</a></dd>
                <dd id="Stepper.RPC_REPLY_MENU_ON" class="variable"><a href="#StepperBase.RPC_REPLY_MENU_ON">RPC_REPLY_MENU_ON</a></dd>
                <dd id="Stepper.RPC_GET_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_GET_STEPPER_BOARD_INFO">RPC_GET_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper.RPC_REPLY_STEPPER_BOARD_INFO" class="variable"><a href="#StepperBase.RPC_REPLY_STEPPER_BOARD_INFO">RPC_REPLY_STEPPER_BOARD_INFO</a></dd>
                <dd id="Stepper.RPC_SET_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_SET_MOTION_LIMITS">RPC_SET_MOTION_LIMITS</a></dd>
                <dd id="Stepper.RPC_REPLY_MOTION_LIMITS" class="variable"><a href="#StepperBase.RPC_REPLY_MOTION_LIMITS">RPC_REPLY_MOTION_LIMITS</a></dd>
                <dd id="Stepper.RPC_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_SET_NEXT_TRAJECTORY_SEG">RPC_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG" class="variable"><a href="#StepperBase.RPC_REPLY_SET_NEXT_TRAJECTORY_SEG">RPC_REPLY_SET_NEXT_TRAJECTORY_SEG</a></dd>
                <dd id="Stepper.RPC_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_START_NEW_TRAJECTORY">RPC_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper.RPC_REPLY_START_NEW_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_START_NEW_TRAJECTORY">RPC_REPLY_START_NEW_TRAJECTORY</a></dd>
                <dd id="Stepper.RPC_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_RESET_TRAJECTORY">RPC_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper.RPC_REPLY_RESET_TRAJECTORY" class="variable"><a href="#StepperBase.RPC_REPLY_RESET_TRAJECTORY">RPC_REPLY_RESET_TRAJECTORY</a></dd>
                <dd id="Stepper.RPC_READ_TRACE" class="variable"><a href="#StepperBase.RPC_READ_TRACE">RPC_READ_TRACE</a></dd>
                <dd id="Stepper.RPC_REPLY_READ_TRACE" class="variable"><a href="#StepperBase.RPC_REPLY_READ_TRACE">RPC_REPLY_READ_TRACE</a></dd>
                <dd id="Stepper.RPC_GET_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_GET_STATUS_AUX">RPC_GET_STATUS_AUX</a></dd>
                <dd id="Stepper.RPC_REPLY_STATUS_AUX" class="variable"><a href="#StepperBase.RPC_REPLY_STATUS_AUX">RPC_REPLY_STATUS_AUX</a></dd>
                <dd id="Stepper.RPC_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_LOAD_TEST_PULL">RPC_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper.RPC_REPLY_LOAD_TEST_PULL" class="variable"><a href="#StepperBase.RPC_REPLY_LOAD_TEST_PULL">RPC_REPLY_LOAD_TEST_PULL</a></dd>
                <dd id="Stepper.MODE_SAFETY" class="variable"><a href="#StepperBase.MODE_SAFETY">MODE_SAFETY</a></dd>
                <dd id="Stepper.MODE_FREEWHEEL" class="variable"><a href="#StepperBase.MODE_FREEWHEEL">MODE_FREEWHEEL</a></dd>
                <dd id="Stepper.MODE_HOLD" class="variable"><a href="#StepperBase.MODE_HOLD">MODE_HOLD</a></dd>
                <dd id="Stepper.MODE_POS_PID" class="variable"><a href="#StepperBase.MODE_POS_PID">MODE_POS_PID</a></dd>
                <dd id="Stepper.MODE_VEL_PID" class="variable"><a href="#StepperBase.MODE_VEL_PID">MODE_VEL_PID</a></dd>
                <dd id="Stepper.MODE_POS_TRAJ" class="variable"><a href="#StepperBase.MODE_POS_TRAJ">MODE_POS_TRAJ</a></dd>
                <dd id="Stepper.MODE_VEL_TRAJ" class="variable"><a href="#StepperBase.MODE_VEL_TRAJ">MODE_VEL_TRAJ</a></dd>
                <dd id="Stepper.MODE_CURRENT" class="variable"><a href="#StepperBase.MODE_CURRENT">MODE_CURRENT</a></dd>
                <dd id="Stepper.MODE_POS_TRAJ_INCR" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_INCR">MODE_POS_TRAJ_INCR</a></dd>
                <dd id="Stepper.MODE_POS_TRAJ_WAYPOINT" class="variable"><a href="#StepperBase.MODE_POS_TRAJ_WAYPOINT">MODE_POS_TRAJ_WAYPOINT</a></dd>
                <dd id="Stepper.MODE_NAMES" class="variable"><a href="#StepperBase.MODE_NAMES">MODE_NAMES</a></dd>
                <dd id="Stepper.DIAG_POS_CALIBRATED" class="variable"><a href="#StepperBase.DIAG_POS_CALIBRATED">DIAG_POS_CALIBRATED</a></dd>
                <dd id="Stepper.DIAG_RUNSTOP_ON" class="variable"><a href="#StepperBase.DIAG_RUNSTOP_ON">DIAG_RUNSTOP_ON</a></dd>
                <dd id="Stepper.DIAG_NEAR_POS_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_POS_SETPOINT">DIAG_NEAR_POS_SETPOINT</a></dd>
                <dd id="Stepper.DIAG_NEAR_VEL_SETPOINT" class="variable"><a href="#StepperBase.DIAG_NEAR_VEL_SETPOINT">DIAG_NEAR_VEL_SETPOINT</a></dd>
                <dd id="Stepper.DIAG_IS_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MOVING">DIAG_IS_MOVING</a></dd>
                <dd id="Stepper.DIAG_AT_CURRENT_LIMIT" class="variable"><a href="#StepperBase.DIAG_AT_CURRENT_LIMIT">DIAG_AT_CURRENT_LIMIT</a></dd>
                <dd id="Stepper.DIAG_IS_MG_ACCELERATING" class="variable"><a href="#StepperBase.DIAG_IS_MG_ACCELERATING">DIAG_IS_MG_ACCELERATING</a></dd>
                <dd id="Stepper.DIAG_IS_MG_MOVING" class="variable"><a href="#StepperBase.DIAG_IS_MG_MOVING">DIAG_IS_MG_MOVING</a></dd>
                <dd id="Stepper.DIAG_CALIBRATION_RCVD" class="variable"><a href="#StepperBase.DIAG_CALIBRATION_RCVD">DIAG_CALIBRATION_RCVD</a></dd>
                <dd id="Stepper.DIAG_IN_GUARDED_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_GUARDED_EVENT">DIAG_IN_GUARDED_EVENT</a></dd>
                <dd id="Stepper.DIAG_IN_SAFETY_EVENT" class="variable"><a href="#StepperBase.DIAG_IN_SAFETY_EVENT">DIAG_IN_SAFETY_EVENT</a></dd>
                <dd id="Stepper.DIAG_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_WAITING_ON_SYNC">DIAG_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper.DIAG_TRAJ_ACTIVE" class="variable"><a href="#StepperBase.DIAG_TRAJ_ACTIVE">DIAG_TRAJ_ACTIVE</a></dd>
                <dd id="Stepper.DIAG_TRAJ_WAITING_ON_SYNC" class="variable"><a href="#StepperBase.DIAG_TRAJ_WAITING_ON_SYNC">DIAG_TRAJ_WAITING_ON_SYNC</a></dd>
                <dd id="Stepper.DIAG_IN_SYNC_MODE" class="variable"><a href="#StepperBase.DIAG_IN_SYNC_MODE">DIAG_IN_SYNC_MODE</a></dd>
                <dd id="Stepper.DIAG_IS_TRACE_ON" class="variable"><a href="#StepperBase.DIAG_IS_TRACE_ON">DIAG_IS_TRACE_ON</a></dd>
                <dd id="Stepper.CONFIG_SAFETY_HOLD" class="variable"><a href="#StepperBase.CONFIG_SAFETY_HOLD">CONFIG_SAFETY_HOLD</a></dd>
                <dd id="Stepper.CONFIG_ENABLE_RUNSTOP" class="variable"><a href="#StepperBase.CONFIG_ENABLE_RUNSTOP">CONFIG_ENABLE_RUNSTOP</a></dd>
                <dd id="Stepper.CONFIG_ENABLE_SYNC_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_SYNC_MODE">CONFIG_ENABLE_SYNC_MODE</a></dd>
                <dd id="Stepper.CONFIG_ENABLE_GUARDED_MODE" class="variable"><a href="#StepperBase.CONFIG_ENABLE_GUARDED_MODE">CONFIG_ENABLE_GUARDED_MODE</a></dd>
                <dd id="Stepper.CONFIG_FLIP_ENCODER_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_ENCODER_POLARITY">CONFIG_FLIP_ENCODER_POLARITY</a></dd>
                <dd id="Stepper.CONFIG_FLIP_EFFORT_POLARITY" class="variable"><a href="#StepperBase.CONFIG_FLIP_EFFORT_POLARITY">CONFIG_FLIP_EFFORT_POLARITY</a></dd>
                <dd id="Stepper.CONFIG_ENABLE_VEL_WATCHDOG" class="variable"><a href="#StepperBase.CONFIG_ENABLE_VEL_WATCHDOG">CONFIG_ENABLE_VEL_WATCHDOG</a></dd>
                <dd id="Stepper.TRIGGER_MARK_POS" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS">TRIGGER_MARK_POS</a></dd>
                <dd id="Stepper.TRIGGER_RESET_MOTION_GEN" class="variable"><a href="#StepperBase.TRIGGER_RESET_MOTION_GEN">TRIGGER_RESET_MOTION_GEN</a></dd>
                <dd id="Stepper.TRIGGER_BOARD_RESET" class="variable"><a href="#StepperBase.TRIGGER_BOARD_RESET">TRIGGER_BOARD_RESET</a></dd>
                <dd id="Stepper.TRIGGER_WRITE_GAINS_TO_FLASH" class="variable"><a href="#StepperBase.TRIGGER_WRITE_GAINS_TO_FLASH">TRIGGER_WRITE_GAINS_TO_FLASH</a></dd>
                <dd id="Stepper.TRIGGER_RESET_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_RESET_POS_CALIBRATED">TRIGGER_RESET_POS_CALIBRATED</a></dd>
                <dd id="Stepper.TRIGGER_POS_CALIBRATED" class="variable"><a href="#StepperBase.TRIGGER_POS_CALIBRATED">TRIGGER_POS_CALIBRATED</a></dd>
                <dd id="Stepper.TRIGGER_MARK_POS_ON_CONTACT" class="variable"><a href="#StepperBase.TRIGGER_MARK_POS_ON_CONTACT">TRIGGER_MARK_POS_ON_CONTACT</a></dd>
                <dd id="Stepper.TRIGGER_ENABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_ENABLE_TRACE">TRIGGER_ENABLE_TRACE</a></dd>
                <dd id="Stepper.TRIGGER_DISABLE_TRACE" class="variable"><a href="#StepperBase.TRIGGER_DISABLE_TRACE">TRIGGER_DISABLE_TRACE</a></dd>
                <dd id="Stepper.TRACE_TYPE_STATUS" class="variable"><a href="#StepperBase.TRACE_TYPE_STATUS">TRACE_TYPE_STATUS</a></dd>
                <dd id="Stepper.TRACE_TYPE_DEBUG" class="variable"><a href="#StepperBase.TRACE_TYPE_DEBUG">TRACE_TYPE_DEBUG</a></dd>
                <dd id="Stepper.TRACE_TYPE_PRINT" class="variable"><a href="#StepperBase.TRACE_TYPE_PRINT">TRACE_TYPE_PRINT</a></dd>
                <dd id="Stepper.usb" class="variable"><a href="#StepperBase.usb">usb</a></dd>
                <dd id="Stepper.transport" class="variable"><a href="#StepperBase.transport">transport</a></dd>
                <dd id="Stepper.status" class="variable"><a href="#StepperBase.status">status</a></dd>
                <dd id="Stepper.status_aux" class="variable"><a href="#StepperBase.status_aux">status_aux</a></dd>
                <dd id="Stepper.status_zero" class="variable"><a href="#StepperBase.status_zero">status_zero</a></dd>
                <dd id="Stepper.board_info" class="variable"><a href="#StepperBase.board_info">board_info</a></dd>
                <dd id="Stepper.motion_limits" class="variable"><a href="#StepperBase.motion_limits">motion_limits</a></dd>
                <dd id="Stepper.is_moving_history" class="variable"><a href="#StepperBase.is_moving_history">is_moving_history</a></dd>
                <dd id="Stepper.ts_last_syncd_motion" class="variable"><a href="#StepperBase.ts_last_syncd_motion">ts_last_syncd_motion</a></dd>
                <dd id="Stepper.load_test_payload" class="variable"><a href="#StepperBase.load_test_payload">load_test_payload</a></dd>
                <dd id="Stepper.hw_valid" class="variable"><a href="#StepperBase.hw_valid">hw_valid</a></dd>
                <dd id="Stepper.gains" class="variable"><a href="#StepperBase.gains">gains</a></dd>
                <dd id="Stepper.gains_flash" class="variable"><a href="#StepperBase.gains_flash">gains_flash</a></dd>
                <dd id="Stepper.stop" class="function"><a href="#StepperBase.stop">stop</a></dd>
                <dd id="Stepper.is_sync_required" class="function"><a href="#StepperBase.is_sync_required">is_sync_required</a></dd>
                <dd id="Stepper.push_command" class="function"><a href="#StepperBase.push_command">push_command</a></dd>
                <dd id="Stepper.push_command_async" class="function"><a href="#StepperBase.push_command_async">push_command_async</a></dd>
                <dd id="Stepper.pull_status" class="function"><a href="#StepperBase.pull_status">pull_status</a></dd>
                <dd id="Stepper.pull_status_async" class="function"><a href="#StepperBase.pull_status_async">pull_status_async</a></dd>
                <dd id="Stepper.push_load_test" class="function"><a href="#StepperBase.push_load_test">push_load_test</a></dd>
                <dd id="Stepper.pull_load_test" class="function"><a href="#StepperBase.pull_load_test">pull_load_test</a></dd>
                <dd id="Stepper.pretty_print" class="function"><a href="#StepperBase.pretty_print">pretty_print</a></dd>
                <dd id="Stepper.step_sentry" class="function"><a href="#StepperBase.step_sentry">step_sentry</a></dd>
                <dd id="Stepper.set_motion_limits" class="function"><a href="#StepperBase.set_motion_limits">set_motion_limits</a></dd>
                <dd id="Stepper.set_gains" class="function"><a href="#StepperBase.set_gains">set_gains</a></dd>
                <dd id="Stepper.write_gains_to_YAML" class="function"><a href="#StepperBase.write_gains_to_YAML">write_gains_to_YAML</a></dd>
                <dd id="Stepper.write_gains_to_flash" class="function"><a href="#StepperBase.write_gains_to_flash">write_gains_to_flash</a></dd>
                <dd id="Stepper.read_gains_from_flash" class="function"><a href="#StepperBase.read_gains_from_flash">read_gains_from_flash</a></dd>
                <dd id="Stepper.board_reset" class="function"><a href="#StepperBase.board_reset">board_reset</a></dd>
                <dd id="Stepper.mark_position_on_contact" class="function"><a href="#StepperBase.mark_position_on_contact">mark_position_on_contact</a></dd>
                <dd id="Stepper.mark_position" class="function"><a href="#StepperBase.mark_position">mark_position</a></dd>
                <dd id="Stepper.reset_motion_gen" class="function"><a href="#StepperBase.reset_motion_gen">reset_motion_gen</a></dd>
                <dd id="Stepper.reset_pos_calibrated" class="function"><a href="#StepperBase.reset_pos_calibrated">reset_pos_calibrated</a></dd>
                <dd id="Stepper.set_pos_calibrated" class="function"><a href="#StepperBase.set_pos_calibrated">set_pos_calibrated</a></dd>
                <dd id="Stepper.enable_safety" class="function"><a href="#StepperBase.enable_safety">enable_safety</a></dd>
                <dd id="Stepper.enable_freewheel" class="function"><a href="#StepperBase.enable_freewheel">enable_freewheel</a></dd>
                <dd id="Stepper.enable_hold" class="function"><a href="#StepperBase.enable_hold">enable_hold</a></dd>
                <dd id="Stepper.enable_vel_pid" class="function"><a href="#StepperBase.enable_vel_pid">enable_vel_pid</a></dd>
                <dd id="Stepper.enable_pos_pid" class="function"><a href="#StepperBase.enable_pos_pid">enable_pos_pid</a></dd>
                <dd id="Stepper.enable_vel_traj" class="function"><a href="#StepperBase.enable_vel_traj">enable_vel_traj</a></dd>
                <dd id="Stepper.enable_pos_traj" class="function"><a href="#StepperBase.enable_pos_traj">enable_pos_traj</a></dd>
                <dd id="Stepper.enable_pos_traj_waypoint" class="function"><a href="#StepperBase.enable_pos_traj_waypoint">enable_pos_traj_waypoint</a></dd>
                <dd id="Stepper.enable_pos_traj_incr" class="function"><a href="#StepperBase.enable_pos_traj_incr">enable_pos_traj_incr</a></dd>
                <dd id="Stepper.enable_current" class="function"><a href="#StepperBase.enable_current">enable_current</a></dd>
                <dd id="Stepper.enable_sync_mode" class="function"><a href="#StepperBase.enable_sync_mode">enable_sync_mode</a></dd>
                <dd id="Stepper.disable_sync_mode" class="function"><a href="#StepperBase.disable_sync_mode">disable_sync_mode</a></dd>
                <dd id="Stepper.enable_runstop" class="function"><a href="#StepperBase.enable_runstop">enable_runstop</a></dd>
                <dd id="Stepper.disable_runstop" class="function"><a href="#StepperBase.disable_runstop">disable_runstop</a></dd>
                <dd id="Stepper.enable_guarded_mode" class="function"><a href="#StepperBase.enable_guarded_mode">enable_guarded_mode</a></dd>
                <dd id="Stepper.disable_guarded_mode" class="function"><a href="#StepperBase.disable_guarded_mode">disable_guarded_mode</a></dd>
                <dd id="Stepper.set_command" class="function"><a href="#StepperBase.set_command">set_command</a></dd>
                <dd id="Stepper.wait_while_is_moving" class="function"><a href="#StepperBase.wait_while_is_moving">wait_while_is_moving</a></dd>
                <dd id="Stepper.wait_until_at_setpoint" class="function"><a href="#StepperBase.wait_until_at_setpoint">wait_until_at_setpoint</a></dd>
                <dd id="Stepper.current_to_effort_ticks" class="function"><a href="#StepperBase.current_to_effort_ticks">current_to_effort_ticks</a></dd>
                <dd id="Stepper.effort_ticks_to_current" class="function"><a href="#StepperBase.effort_ticks_to_current">effort_ticks_to_current</a></dd>
                <dd id="Stepper.current_to_effort_pct" class="function"><a href="#StepperBase.current_to_effort_pct">current_to_effort_pct</a></dd>
                <dd id="Stepper.effort_pct_to_current" class="function"><a href="#StepperBase.effort_pct_to_current">effort_pct_to_current</a></dd>
                <dd id="Stepper.current_to_torque" class="function"><a href="#StepperBase.current_to_torque">current_to_torque</a></dd>
                <dd id="Stepper.torque_to_current" class="function"><a href="#StepperBase.torque_to_current">torque_to_current</a></dd>
                <dd id="Stepper.get_chip_id" class="function"><a href="#StepperBase.get_chip_id">get_chip_id</a></dd>
                <dd id="Stepper.read_encoder_calibration_from_YAML" class="function"><a href="#StepperBase.read_encoder_calibration_from_YAML">read_encoder_calibration_from_YAML</a></dd>
                <dd id="Stepper.write_encoder_calibration_to_YAML" class="function"><a href="#StepperBase.write_encoder_calibration_to_YAML">write_encoder_calibration_to_YAML</a></dd>
                <dd id="Stepper.read_encoder_calibration_from_flash" class="function"><a href="#StepperBase.read_encoder_calibration_from_flash">read_encoder_calibration_from_flash</a></dd>
                <dd id="Stepper.write_encoder_calibration_to_flash" class="function"><a href="#StepperBase.write_encoder_calibration_to_flash">write_encoder_calibration_to_flash</a></dd>
                <dd id="Stepper.rpc_enc_calib_reply" class="function"><a href="#StepperBase.rpc_enc_calib_reply">rpc_enc_calib_reply</a></dd>
                <dd id="Stepper.turn_rpc_interface_on" class="function"><a href="#StepperBase.turn_rpc_interface_on">turn_rpc_interface_on</a></dd>
                <dd id="Stepper.turn_menu_interface_on" class="function"><a href="#StepperBase.turn_menu_interface_on">turn_menu_interface_on</a></dd>
                <dd id="Stepper.print_menu" class="function"><a href="#StepperBase.print_menu">print_menu</a></dd>
                <dd id="Stepper.menu_transaction" class="function"><a href="#StepperBase.menu_transaction">menu_transaction</a></dd>
                <dd id="Stepper.start_waypoint_trajectory" class="function"><a href="#StepperBase.start_waypoint_trajectory">start_waypoint_trajectory</a></dd>
                <dd id="Stepper.set_next_trajectory_segment" class="function"><a href="#StepperBase.set_next_trajectory_segment">set_next_trajectory_segment</a></dd>
                <dd id="Stepper.stop_waypoint_trajectory" class="function"><a href="#StepperBase.stop_waypoint_trajectory">stop_waypoint_trajectory</a></dd>
                <dd id="Stepper.unpack_board_info" class="function"><a href="#StepperBase.unpack_board_info">unpack_board_info</a></dd>
                <dd id="Stepper.unpack_status" class="function"><a href="#StepperBase.unpack_status">unpack_status</a></dd>
                <dd id="Stepper.unpack_gains" class="function"><a href="#StepperBase.unpack_gains">unpack_gains</a></dd>
                <dd id="Stepper.pack_motion_limits" class="function"><a href="#StepperBase.pack_motion_limits">pack_motion_limits</a></dd>
                <dd id="Stepper.pack_command" class="function"><a href="#StepperBase.pack_command">pack_command</a></dd>
                <dd id="Stepper.pack_gains" class="function"><a href="#StepperBase.pack_gains">pack_gains</a></dd>
                <dd id="Stepper.pack_trigger" class="function"><a href="#StepperBase.pack_trigger">pack_trigger</a></dd>
                <dd id="Stepper.pack_trajectory_segment" class="function"><a href="#StepperBase.pack_trajectory_segment">pack_trajectory_segment</a></dd>
                <dd id="Stepper.rpc_board_info_reply" class="function"><a href="#StepperBase.rpc_board_info_reply">rpc_board_info_reply</a></dd>
                <dd id="Stepper.rpc_gains_reply" class="function"><a href="#StepperBase.rpc_gains_reply">rpc_gains_reply</a></dd>
                <dd id="Stepper.rpc_trigger_reply" class="function"><a href="#StepperBase.rpc_trigger_reply">rpc_trigger_reply</a></dd>
                <dd id="Stepper.rpc_command_reply" class="function"><a href="#StepperBase.rpc_command_reply">rpc_command_reply</a></dd>
                <dd id="Stepper.rpc_motion_limits_reply" class="function"><a href="#StepperBase.rpc_motion_limits_reply">rpc_motion_limits_reply</a></dd>
                <dd id="Stepper.rpc_menu_on_reply" class="function"><a href="#StepperBase.rpc_menu_on_reply">rpc_menu_on_reply</a></dd>
                <dd id="Stepper.rpc_status_reply" class="function"><a href="#StepperBase.rpc_status_reply">rpc_status_reply</a></dd>
                <dd id="Stepper.rpc_read_gains_from_flash_reply" class="function"><a href="#StepperBase.rpc_read_gains_from_flash_reply">rpc_read_gains_from_flash_reply</a></dd>
                <dd id="Stepper.rpc_start_new_traj_reply" class="function"><a href="#StepperBase.rpc_start_new_traj_reply">rpc_start_new_traj_reply</a></dd>
                <dd id="Stepper.rpc_set_next_traj_seg_reply" class="function"><a href="#StepperBase.rpc_set_next_traj_seg_reply">rpc_set_next_traj_seg_reply</a></dd>
                <dd id="Stepper.rpc_reset_traj_reply" class="function"><a href="#StepperBase.rpc_reset_traj_reply">rpc_reset_traj_reply</a></dd>
                <dd id="Stepper.rpc_read_firmware_trace_reply" class="function"><a href="#StepperBase.rpc_read_firmware_trace_reply">rpc_read_firmware_trace_reply</a></dd>
                <dd id="Stepper.enable_firmware_trace" class="function"><a href="#StepperBase.enable_firmware_trace">enable_firmware_trace</a></dd>
                <dd id="Stepper.disable_firmware_trace" class="function"><a href="#StepperBase.disable_firmware_trace">disable_firmware_trace</a></dd>
                <dd id="Stepper.pull_status_aux" class="function"><a href="#StepperBase.pull_status_aux">pull_status_aux</a></dd>

            </div>
            <div><dt><a href="device.html#Device">stretch_body.device.Device</a></dt>
                                <dd id="Stepper.logging_params" class="variable"><a href="device.html#Device.logging_params">logging_params</a></dd>
                <dd id="Stepper.name" class="variable"><a href="device.html#Device.name">name</a></dd>
                <dd id="Stepper.params" class="variable"><a href="device.html#Device.params">params</a></dd>
                <dd id="Stepper.logger" class="variable"><a href="device.html#Device.logger">logger</a></dd>
                <dd id="Stepper.timestamp" class="variable"><a href="device.html#Device.timestamp">timestamp</a></dd>
                <dd id="Stepper.thread_active" class="variable"><a href="device.html#Device.thread_active">thread_active</a></dd>
                <dd id="Stepper.thread_rate_hz" class="variable"><a href="device.html#Device.thread_rate_hz">thread_rate_hz</a></dd>
                <dd id="Stepper.thread_stats" class="variable"><a href="device.html#Device.thread_stats">thread_stats</a></dd>
                <dd id="Stepper.thread" class="variable"><a href="device.html#Device.thread">thread</a></dd>
                <dd id="Stepper.thread_shutdown_flag" class="variable"><a href="device.html#Device.thread_shutdown_flag">thread_shutdown_flag</a></dd>
                <dd id="Stepper.home" class="function"><a href="device.html#Device.home">home</a></dd>
                <dd id="Stepper.write_device_params" class="function"><a href="device.html#Device.write_device_params">write_device_params</a></dd>
                <dd id="Stepper.write_configuration_param_to_YAML" class="function"><a href="device.html#Device.write_configuration_param_to_YAML">write_configuration_param_to_YAML</a></dd>
                <dd id="Stepper.write_user_param_to_YAML" class="function"><a href="device.html#Device.write_user_param_to_YAML">write_user_param_to_YAML</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>